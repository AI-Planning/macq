<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>macq.extract API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../macq.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;macq</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#extract">Extract</a>
  <ul>
    <li><a href="#usage">Usage</a></li>
    <li><a href="#debugging">Debugging</a></li>
    <li><a href="#extraction-techniques">Extraction Techniques</a></li>
  </ul></li>
  <li><a href="#observer">Observer</a>
  <ul>
    <li><a href="#usage-2">Usage</a></li>
  </ul></li>
  <li><a href="#slaf">SLAF</a>
  <ul>
    <li><a href="#usage-3">Usage</a></li>
  </ul></li>
  <li><a href="#arms">ARMS</a>
  <ul>
    <li><a href="#usage-4">Usage</a></li>
  </ul></li>
  <li><a href="#amdn">AMDN</a>
  <ul>
    <li><a href="#usage-5">Usage</a></li>
  </ul></li>
  <li><a href="#locm">LOCM</a></li>
  <li><a href="#api-documentation">API Documentation</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#LearnedAction">LearnedAction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LearnedAction.__init__">LearnedAction</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedAction.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedAction.obj_params">obj_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedAction.precond">precond</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedAction.add">add</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedAction.delete">delete</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedAction.details">details</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedAction.update_precond">update_precond</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedAction.update_add">update_add</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedAction.update_delete">update_delete</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedAction.clear">clear</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedAction.compare">compare</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LearnedLiftedAction">LearnedLiftedAction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LearnedLiftedAction.__init__">LearnedLiftedAction</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedAction.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedAction.param_sorts">param_sorts</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedAction.precond">precond</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedAction.add">add</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedAction.delete">delete</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedLiftedAction.details">details</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedLiftedAction.update_precond">update_precond</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedLiftedAction.update_add">update_add</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedLiftedAction.update_delete">update_delete</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LearnedFluent">LearnedFluent</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LearnedFluent.__init__">LearnedFluent</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedFluent.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedFluent.objects">objects</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedFluent.details">details</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LearnedLiftedFluent">LearnedLiftedFluent</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LearnedLiftedFluent.__init__">LearnedLiftedFluent</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedFluent.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedFluent.param_sorts">param_sorts</a>
                        </li>
                        <li>
                                <a class="variable" href="#LearnedLiftedFluent.param_act_inds">param_act_inds</a>
                        </li>
                        <li>
                                <a class="function" href="#LearnedLiftedFluent.details">details</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Model">Model</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Model.__init__">Model</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.fluents">fluents</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.actions">actions</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.details">details</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.serialize">serialize</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.to_pddl">to_pddl</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.to_pddl_lifted">to_pddl_lifted</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.to_pddl_grounded">to_pddl_grounded</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.deserialize">deserialize</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Extract">Extract</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Extract.__init__">Extract</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#modes">modes</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#modes.OBSERVER">OBSERVER</a>
                        </li>
                        <li>
                                <a class="variable" href="#modes.SLAF">SLAF</a>
                        </li>
                        <li>
                                <a class="variable" href="#modes.AMDN">AMDN</a>
                        </li>
                        <li>
                                <a class="variable" href="#modes.ARMS">ARMS</a>
                        </li>
                        <li>
                                <a class="variable" href="#modes.LOCM">LOCM</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IncompatibleObservationToken">IncompatibleObservationToken</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IncompatibleObservationToken.__init__">IncompatibleObservationToken</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ARMS">ARMS</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ARMS.__init__">ARMS</a>
                        </li>
                        <li>
                                <a class="class" href="#ARMS.InvalidThreshold">ARMS.InvalidThreshold</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#ARMS.InvalidThreshold.__init__">InvalidThreshold</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#ARMS.step1">step1</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step2">step2</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step2A">step2A</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step2I">step2I</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step2P">step2P</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step3">step3</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step4">step4</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.step5">step5</a>
                        </li>
                        <li>
                                <a class="function" href="#ARMS.debug_menu">debug_menu</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AMDN">AMDN</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AMDN.__init__">AMDN</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LOCM">LOCM</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LOCM.__init__">LOCM</a>
                        </li>
                        <li>
                                <a class="variable" href="#LOCM.zero_obj">zero_obj</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SLAF">SLAF</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SLAF.__init__">SLAF</a>
                        </li>
                        <li>
                                <a class="variable" href="#SLAF.top">top</a>
                        </li>
                        <li>
                                <a class="variable" href="#SLAF.bottom">bottom</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Observer">Observer</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Observer.__init__">Observer</a>
                        </li>
                        <li>
                                <a class="function" href="#Observer.get_delta">get_delta</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../macq.html">macq</a><wbr>.extract    </h1>

                        <div class="docstring"><h1 id="extract">Extract</h1>

<h2 id="usage">Usage</h2>

<blockquote>
  <p>See a specific technique below.</p>
</blockquote>

<h2 id="debugging">Debugging</h2>

<p>Include the argument <code>debug=True</code> to <code><a href="#Extract">Extract</a></code> to enable debugging for any
extraction technique.</p>

<p>_Note: debugging output and interfaces are unique to each method._</p>

<h2 id="extraction-techniques">Extraction Techniques</h2>

<ul>
<li><a href="#observer">Observer</a></li>
<li><a href="#slaf">SLAF</a></li>
<li><a href="#arms">ARMS</a></li>
<li><a href="#amdn">AMDN</a></li>
<li><a href="#locm">LOCM</a></li>
</ul>

<h1 id="observer">Observer</h1>

<h2 id="usage-2">Usage</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">macq</span> <span class="kn">import</span> <span class="n">generate</span><span class="p">,</span> <span class="n">extract</span>
<span class="kn">from</span> <span class="nn"><a href="observation.html">macq.observation</a></span> <span class="kn">import</span> <span class="n">IdentityObservation</span>

<span class="n">traces</span> <span class="o">=</span> <span class="n">generate</span><span class="o">.</span><span class="n">pddl</span><span class="o">.</span><span class="n">VanillaSampling</span><span class="p">(</span><span class="n">problem_id</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">plan_len</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">num_traces</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">traces</span>
<span class="n">observations</span> <span class="o">=</span> <span class="n">traces</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">IdentityObservation</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">Extract</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">extract</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">OBSERVER</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</code></pre>
</div>

<p><strong>Output:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>Model:
  Fluents: at stone stone-03 location pos-04-06, at stone stone-01 location pos-04-06, at stone stone-02 location pos-05-06, at stone stone-06 location pos-07-04, at stone stone-11 ...
  Actions:
    push-to-goal stone stone-04 location pos-04-05 location pos-04-06 direction dir-up location pos-04-04 player player-01:
      precond:
        at player player-01 location pos-04-06
        at stone stone-04 location pos-04-05
        clear location pos-05-06
        ...
      add:
        at stone stone-04 location pos-04-04
        clear location pos-04-06
        at-goal stone stone-04
        at player player-01 location pos-04-05
      delete:
        at stone stone-04 location pos-04-05
        clear location pos-04-04
        at player player-01 location pos-04-06
  ...
</code></pre>
</div>

<hr />

<h1 id="slaf">SLAF</h1>

<h2 id="usage-3">Usage</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">macq</span> <span class="kn">import</span> <span class="n">generate</span><span class="p">,</span> <span class="n">extract</span>
<span class="kn">from</span> <span class="nn"><a href="observation.html">macq.observation</a></span> <span class="kn">import</span> <span class="n">AtomicPartialObservation</span>

<span class="n">traces</span> <span class="o">=</span> <span class="n">generate</span><span class="o">.</span><span class="n">pddl</span><span class="o">.</span><span class="n">VanillaSampling</span><span class="p">(</span><span class="n">problem_id</span><span class="o">=</span><span class="mi">4398</span><span class="p">,</span> <span class="n">plan_len</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_traces</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">traces</span>
<span class="n">observations</span> <span class="o">=</span> <span class="n">traces</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">AtomicPartialObservation</span><span class="p">,</span> <span class="n">percent_missing</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Extract</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">extract</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">SLAF</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</code></pre>
</div>

<p><strong>Output:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>Model:
  Fluents: clear location pos-06-09, clear location pos-02-05, clear location pos-08-08, clear location pos-10-05, ...
  Actions:
    move player player-01 direction dir-left location pos-05-02 location pos-06-02:
      precond:
      add:
      delete:
        (clear location pos-05-02)
        (at player player-01 location pos-06-02)
        ...
    ...
</code></pre>
</div>

<hr />

<h1 id="arms">ARMS</h1>

<h2 id="usage-4">Usage</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">macq</span> <span class="kn">import</span> <span class="n">generate</span><span class="p">,</span> <span class="n">extract</span>
<span class="kn">from</span> <span class="nn"><a href="trace.html">macq.trace</a></span> <span class="kn">import</span> <span class="n">PlanningObject</span><span class="p">,</span> <span class="n">Fluent</span><span class="p">,</span> <span class="n">TraceList</span>
<span class="kn">from</span> <span class="nn"><a href="observation.html">macq.observation</a></span> <span class="kn">import</span> <span class="n">PartialObservation</span>

<span class="k">def</span> <span class="nf">get_fluent</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">PlanningObject</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">o</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Fluent</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">objects</span><span class="p">)</span>

<span class="n">traces</span> <span class="o">=</span> <span class="n">TraceList</span><span class="p">()</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">generate</span><span class="o">.</span><span class="n">pddl</span><span class="o">.</span><span class="n">TraceFromGoal</span><span class="p">(</span><span class="n">problem_id</span><span class="o">=</span><span class="mi">1801</span><span class="p">)</span>

<span class="n">generator</span><span class="o">.</span><span class="n">change_goal</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">get_fluent</span><span class="p">(</span><span class="s2">&quot;communicated_soil_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;waypoint waypoint2&quot;</span><span class="p">]),</span>
        <span class="n">get_fluent</span><span class="p">(</span><span class="s2">&quot;communicated_rock_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;waypoint waypoint3&quot;</span><span class="p">]),</span>
        <span class="n">get_fluent</span><span class="p">(</span>
            <span class="s2">&quot;communicated_image_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;objective objective1&quot;</span><span class="p">,</span> <span class="s2">&quot;mode high_res&quot;</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">generate_trace</span><span class="p">())</span>

<span class="n">generator</span><span class="o">.</span><span class="n">change_goal</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">get_fluent</span><span class="p">(</span><span class="s2">&quot;communicated_soil_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;waypoint waypoint2&quot;</span><span class="p">]),</span>
        <span class="n">get_fluent</span><span class="p">(</span><span class="s2">&quot;communicated_rock_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;waypoint waypoint3&quot;</span><span class="p">]),</span>
        <span class="n">get_fluent</span><span class="p">(</span>
            <span class="s2">&quot;communicated_image_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;objective objective1&quot;</span><span class="p">,</span> <span class="s2">&quot;mode high_res&quot;</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">generate_trace</span><span class="p">())</span>

<span class="n">observations</span> <span class="o">=</span> <span class="n">traces</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">PartialObservation</span><span class="p">,</span> <span class="n">percent_missing</span><span class="o">=</span><span class="mf">0.60</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">Extract</span><span class="p">(</span>
    <span class="n">observations</span><span class="p">,</span>
    <span class="n">extract</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">ARMS</span><span class="p">,</span>
    <span class="n">upper_bound</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">min_support</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">action_weight</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span>
    <span class="n">info_weight</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">info3_default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">plan_default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</code></pre>
</div>

<p><strong>Output:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>Model:
  Fluents: (at rover rover0 waypoint waypoint2), (have_soil_analysis rover rover0 waypoint waypoint2), (have_soil_analysis rover rover0 waypoint waypoint3), ...
  Actions:
    (communicate_image_data rover waypoint mode objective lander waypoint):
      precond:
        calibrated camera rover
        have_rock_analysis rover waypoint
        communicated_rock_data waypoint
        channel_free lander
        at_soil_sample waypoint
        at_rock_sample waypoint
      add:
        calibrated camera rover
        at rover waypoint
        have_image rover objective mode
        channel_free lander
        communicated_image_data objective mode
      delete:
        calibrated camera rover
    ...
</code></pre>
</div>

<hr />

<h1 id="amdn">AMDN</h1>

<h2 id="usage-5">Usage</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">macq</span> <span class="kn">import</span> <span class="n">generate</span><span class="p">,</span> <span class="n">extract</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</code></pre>
</div>

<p><strong>Output:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>
</code></pre>
</div>

<hr />

<h1 id="locm">LOCM</h1>

<hr />

<h1 id="api-documentation">API Documentation</h1>
</div>

                        <input id="mod-extract-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-extract-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;.. include:: ../../docs/templates/extract/extract.md&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="c1"># isort: skip_file</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">.learned_fluent</span> <span class="kn">import</span> <span class="n">LearnedFluent</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">.learned_action</span> <span class="kn">import</span> <span class="n">LearnedAction</span><span class="p">,</span> <span class="n">LearnedLiftedAction</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.model</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">LearnedAction</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.extract</span> <span class="kn">import</span> <span class="n">Extract</span><span class="p">,</span> <span class="n">modes</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">IncompatibleObservationToken</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">.model</span> <span class="kn">import</span> <span class="n">Model</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">.amdn</span> <span class="kn">import</span> <span class="n">AMDN</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">.arms</span> <span class="kn">import</span> <span class="n">ARMS</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">.locm</span> <span class="kn">import</span> <span class="n">LOCM</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span> <span class="nn">.slaf</span> <span class="kn">import</span> <span class="n">SLAF</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span> <span class="nn">.observer</span> <span class="kn">import</span> <span class="n">Observer</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;LearnedAction&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;LearnedLiftedAction&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;LearnedFluent&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;LearnedLiftedFluent&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;Extract&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;modes&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;IncompatibleObservationToken&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;ARMS&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;AMDN&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;LOCM&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;SLAF&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;Observer&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="LearnedAction">
                            <input id="LearnedAction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LearnedAction</span>:

                <label class="view-source-button" for="LearnedAction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction-9"><a href="#LearnedAction-9"><span class="linenos">  9</span></a><span class="k">class</span> <span class="nc">LearnedAction</span><span class="p">:</span>
</span><span id="LearnedAction-10"><a href="#LearnedAction-10"><span class="linenos"> 10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="LearnedAction-11"><a href="#LearnedAction-11"><span class="linenos"> 11</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedAction-12"><a href="#LearnedAction-12"><span class="linenos"> 12</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span> <span class="o">=</span> <span class="n">obj_params</span>
</span><span id="LearnedAction-13"><a href="#LearnedAction-13"><span class="linenos"> 13</span></a>        <span class="k">if</span> <span class="s2">&quot;cost&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="LearnedAction-14"><a href="#LearnedAction-14"><span class="linenos"> 14</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]</span>
</span><span id="LearnedAction-15"><a href="#LearnedAction-15"><span class="linenos"> 15</span></a>
</span><span id="LearnedAction-16"><a href="#LearnedAction-16"><span class="linenos"> 16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;precond&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precond&quot;</span><span class="p">]</span>
</span><span id="LearnedAction-17"><a href="#LearnedAction-17"><span class="linenos"> 17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;add&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">]</span>
</span><span id="LearnedAction-18"><a href="#LearnedAction-18"><span class="linenos"> 18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;delete&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">]</span>
</span><span id="LearnedAction-19"><a href="#LearnedAction-19"><span class="linenos"> 19</span></a>
</span><span id="LearnedAction-20"><a href="#LearnedAction-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="LearnedAction-21"><a href="#LearnedAction-21"><span class="linenos"> 21</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="LearnedAction-22"><a href="#LearnedAction-22"><span class="linenos"> 22</span></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">)</span>
</span><span id="LearnedAction-23"><a href="#LearnedAction-23"><span class="linenos"> 23</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</span><span id="LearnedAction-24"><a href="#LearnedAction-24"><span class="linenos"> 24</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">obj_params</span>
</span><span id="LearnedAction-25"><a href="#LearnedAction-25"><span class="linenos"> 25</span></a>        <span class="p">)</span>
</span><span id="LearnedAction-26"><a href="#LearnedAction-26"><span class="linenos"> 26</span></a>
</span><span id="LearnedAction-27"><a href="#LearnedAction-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedAction-28"><a href="#LearnedAction-28"><span class="linenos"> 28</span></a>        <span class="c1"># Order of obj_params is important!</span>
</span><span id="LearnedAction-29"><a href="#LearnedAction-29"><span class="linenos"> 29</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</span><span id="LearnedAction-30"><a href="#LearnedAction-30"><span class="linenos"> 30</span></a>
</span><span id="LearnedAction-31"><a href="#LearnedAction-31"><span class="linenos"> 31</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedAction-32"><a href="#LearnedAction-32"><span class="linenos"> 32</span></a>        <span class="c1"># obj_params can be either a list of strings or a list of PlanningObject depending on the token type and extraction method used to learn the action</span>
</span><span id="LearnedAction-33"><a href="#LearnedAction-33"><span class="linenos"> 33</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LearnedAction-34"><a href="#LearnedAction-34"><span class="linenos"> 34</span></a>            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedAction-35"><a href="#LearnedAction-35"><span class="linenos"> 35</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="LearnedAction-36"><a href="#LearnedAction-36"><span class="linenos"> 36</span></a>            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedAction-37"><a href="#LearnedAction-37"><span class="linenos"> 37</span></a>
</span><span id="LearnedAction-38"><a href="#LearnedAction-38"><span class="linenos"> 38</span></a>        <span class="k">return</span> <span class="n">string</span>
</span><span id="LearnedAction-39"><a href="#LearnedAction-39"><span class="linenos"> 39</span></a>
</span><span id="LearnedAction-40"><a href="#LearnedAction-40"><span class="linenos"> 40</span></a>    <span class="k">def</span> <span class="nf">update_precond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="LearnedAction-41"><a href="#LearnedAction-41"><span class="linenos"> 41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds preconditions to the action.</span>
</span><span id="LearnedAction-42"><a href="#LearnedAction-42"><span class="linenos"> 42</span></a>
</span><span id="LearnedAction-43"><a href="#LearnedAction-43"><span class="linenos"> 43</span></a><span class="sd">        Args:</span>
</span><span id="LearnedAction-44"><a href="#LearnedAction-44"><span class="linenos"> 44</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedAction-45"><a href="#LearnedAction-45"><span class="linenos"> 45</span></a><span class="sd">                The set of fluents to be added to the action&#39;s preconditions.</span>
</span><span id="LearnedAction-46"><a href="#LearnedAction-46"><span class="linenos"> 46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedAction-47"><a href="#LearnedAction-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span><span id="LearnedAction-48"><a href="#LearnedAction-48"><span class="linenos"> 48</span></a>
</span><span id="LearnedAction-49"><a href="#LearnedAction-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="nf">update_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="LearnedAction-50"><a href="#LearnedAction-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds add effects to the action.</span>
</span><span id="LearnedAction-51"><a href="#LearnedAction-51"><span class="linenos"> 51</span></a>
</span><span id="LearnedAction-52"><a href="#LearnedAction-52"><span class="linenos"> 52</span></a><span class="sd">        Args:</span>
</span><span id="LearnedAction-53"><a href="#LearnedAction-53"><span class="linenos"> 53</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedAction-54"><a href="#LearnedAction-54"><span class="linenos"> 54</span></a><span class="sd">                The set of fluents to be added to the action&#39;s add effects.</span>
</span><span id="LearnedAction-55"><a href="#LearnedAction-55"><span class="linenos"> 55</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedAction-56"><a href="#LearnedAction-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span><span id="LearnedAction-57"><a href="#LearnedAction-57"><span class="linenos"> 57</span></a>
</span><span id="LearnedAction-58"><a href="#LearnedAction-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">update_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="LearnedAction-59"><a href="#LearnedAction-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds delete effects to the action.</span>
</span><span id="LearnedAction-60"><a href="#LearnedAction-60"><span class="linenos"> 60</span></a>
</span><span id="LearnedAction-61"><a href="#LearnedAction-61"><span class="linenos"> 61</span></a><span class="sd">        Args:</span>
</span><span id="LearnedAction-62"><a href="#LearnedAction-62"><span class="linenos"> 62</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedAction-63"><a href="#LearnedAction-63"><span class="linenos"> 63</span></a><span class="sd">                The set of fluents to be added to the action&#39;s delete effects.</span>
</span><span id="LearnedAction-64"><a href="#LearnedAction-64"><span class="linenos"> 64</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedAction-65"><a href="#LearnedAction-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span><span id="LearnedAction-66"><a href="#LearnedAction-66"><span class="linenos"> 66</span></a>
</span><span id="LearnedAction-67"><a href="#LearnedAction-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedAction-68"><a href="#LearnedAction-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LearnedAction-69"><a href="#LearnedAction-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LearnedAction-70"><a href="#LearnedAction-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LearnedAction-71"><a href="#LearnedAction-71"><span class="linenos"> 71</span></a>
</span><span id="LearnedAction-72"><a href="#LearnedAction-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_action</span><span class="p">:</span> <span class="n">LearnedAction</span><span class="p">):</span>
</span><span id="LearnedAction-73"><a href="#LearnedAction-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compares the learned action to an original, ground truth action.&quot;&quot;&quot;</span>
</span><span id="LearnedAction-74"><a href="#LearnedAction-74"><span class="linenos"> 74</span></a>        <span class="n">precond_diff</span> <span class="o">=</span> <span class="n">orig_action</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span>
</span><span id="LearnedAction-75"><a href="#LearnedAction-75"><span class="linenos"> 75</span></a>        <span class="n">add_diff</span> <span class="o">=</span> <span class="n">orig_action</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="LearnedAction-76"><a href="#LearnedAction-76"><span class="linenos"> 76</span></a>        <span class="n">delete_diff</span> <span class="o">=</span> <span class="n">orig_action</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
</span><span id="LearnedAction-77"><a href="#LearnedAction-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="n">precond_diff</span><span class="p">,</span> <span class="n">add_diff</span><span class="p">,</span> <span class="n">delete_diff</span>
</span><span id="LearnedAction-78"><a href="#LearnedAction-78"><span class="linenos"> 78</span></a>
</span><span id="LearnedAction-79"><a href="#LearnedAction-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedAction-80"><a href="#LearnedAction-80"><span class="linenos"> 80</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="LearnedAction-81"><a href="#LearnedAction-81"><span class="linenos"> 81</span></a>            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="LearnedAction-82"><a href="#LearnedAction-82"><span class="linenos"> 82</span></a>            <span class="n">obj_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span><span class="p">,</span>
</span><span id="LearnedAction-83"><a href="#LearnedAction-83"><span class="linenos"> 83</span></a>            <span class="n">cost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
</span><span id="LearnedAction-84"><a href="#LearnedAction-84"><span class="linenos"> 84</span></a>            <span class="n">precond</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="p">),</span>
</span><span id="LearnedAction-85"><a href="#LearnedAction-85"><span class="linenos"> 85</span></a>            <span class="n">add</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">),</span>
</span><span id="LearnedAction-86"><a href="#LearnedAction-86"><span class="linenos"> 86</span></a>            <span class="n">delete</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">),</span>
</span><span id="LearnedAction-87"><a href="#LearnedAction-87"><span class="linenos"> 87</span></a>        <span class="p">)</span>
</span><span id="LearnedAction-88"><a href="#LearnedAction-88"><span class="linenos"> 88</span></a>
</span><span id="LearnedAction-89"><a href="#LearnedAction-89"><span class="linenos"> 89</span></a>    <span class="nd">@classmethod</span>
</span><span id="LearnedAction-90"><a href="#LearnedAction-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="LearnedAction-91"><a href="#LearnedAction-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a json object to an Action.&quot;&quot;&quot;</span>
</span><span id="LearnedAction-92"><a href="#LearnedAction-92"><span class="linenos"> 92</span></a>        <span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;precond&quot;</span><span class="p">])</span>
</span><span id="LearnedAction-93"><a href="#LearnedAction-93"><span class="linenos"> 93</span></a>        <span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">])</span>
</span><span id="LearnedAction-94"><a href="#LearnedAction-94"><span class="linenos"> 94</span></a>        <span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">])</span>
</span><span id="LearnedAction-95"><a href="#LearnedAction-95"><span class="linenos"> 95</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="LearnedAction-96"><a href="#LearnedAction-96"><span class="linenos"> 96</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="LearnedAction-97"><a href="#LearnedAction-97"><span class="linenos"> 97</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;obj_params&quot;</span><span class="p">],</span>
</span><span id="LearnedAction-98"><a href="#LearnedAction-98"><span class="linenos"> 98</span></a>            <span class="n">cost</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">],</span>
</span><span id="LearnedAction-99"><a href="#LearnedAction-99"><span class="linenos"> 99</span></a>            <span class="n">precond</span><span class="o">=</span><span class="n">precond</span><span class="p">,</span>
</span><span id="LearnedAction-100"><a href="#LearnedAction-100"><span class="linenos">100</span></a>            <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">,</span>
</span><span id="LearnedAction-101"><a href="#LearnedAction-101"><span class="linenos">101</span></a>            <span class="n">delete</span><span class="o">=</span><span class="n">delete</span><span class="p">,</span>
</span><span id="LearnedAction-102"><a href="#LearnedAction-102"><span class="linenos">102</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            <div id="LearnedAction.__init__" class="classattr">
                                        <input id="LearnedAction.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LearnedAction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">obj_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="LearnedAction.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.__init__-10"><a href="#LearnedAction.__init__-10"><span class="linenos">10</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="LearnedAction.__init__-11"><a href="#LearnedAction.__init__-11"><span class="linenos">11</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedAction.__init__-12"><a href="#LearnedAction.__init__-12"><span class="linenos">12</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span> <span class="o">=</span> <span class="n">obj_params</span>
</span><span id="LearnedAction.__init__-13"><a href="#LearnedAction.__init__-13"><span class="linenos">13</span></a>        <span class="k">if</span> <span class="s2">&quot;cost&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="LearnedAction.__init__-14"><a href="#LearnedAction.__init__-14"><span class="linenos">14</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]</span>
</span><span id="LearnedAction.__init__-15"><a href="#LearnedAction.__init__-15"><span class="linenos">15</span></a>
</span><span id="LearnedAction.__init__-16"><a href="#LearnedAction.__init__-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;precond&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precond&quot;</span><span class="p">]</span>
</span><span id="LearnedAction.__init__-17"><a href="#LearnedAction.__init__-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;add&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">]</span>
</span><span id="LearnedAction.__init__-18"><a href="#LearnedAction.__init__-18"><span class="linenos">18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;delete&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedAction.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#LearnedAction.name"></a>
    
    

                            </div>
                            <div id="LearnedAction.obj_params" class="classattr">
                                <div class="attr variable">
            <span class="name">obj_params</span>

        
    </div>
    <a class="headerlink" href="#LearnedAction.obj_params"></a>
    
    

                            </div>
                            <div id="LearnedAction.precond" class="classattr">
                                <div class="attr variable">
            <span class="name">precond</span>

        
    </div>
    <a class="headerlink" href="#LearnedAction.precond"></a>
    
    

                            </div>
                            <div id="LearnedAction.add" class="classattr">
                                <div class="attr variable">
            <span class="name">add</span>

        
    </div>
    <a class="headerlink" href="#LearnedAction.add"></a>
    
    

                            </div>
                            <div id="LearnedAction.delete" class="classattr">
                                <div class="attr variable">
            <span class="name">delete</span>

        
    </div>
    <a class="headerlink" href="#LearnedAction.delete"></a>
    
    

                            </div>
                            <div id="LearnedAction.details" class="classattr">
                                        <input id="LearnedAction.details-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">details</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedAction.details-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.details"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.details-31"><a href="#LearnedAction.details-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedAction.details-32"><a href="#LearnedAction.details-32"><span class="linenos">32</span></a>        <span class="c1"># obj_params can be either a list of strings or a list of PlanningObject depending on the token type and extraction method used to learn the action</span>
</span><span id="LearnedAction.details-33"><a href="#LearnedAction.details-33"><span class="linenos">33</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LearnedAction.details-34"><a href="#LearnedAction.details-34"><span class="linenos">34</span></a>            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedAction.details-35"><a href="#LearnedAction.details-35"><span class="linenos">35</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="LearnedAction.details-36"><a href="#LearnedAction.details-36"><span class="linenos">36</span></a>            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">obj_params</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedAction.details-37"><a href="#LearnedAction.details-37"><span class="linenos">37</span></a>
</span><span id="LearnedAction.details-38"><a href="#LearnedAction.details-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="n">string</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedAction.update_precond" class="classattr">
                                        <input id="LearnedAction.update_precond-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_precond</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedAction.update_precond-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.update_precond"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.update_precond-40"><a href="#LearnedAction.update_precond-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">update_precond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="LearnedAction.update_precond-41"><a href="#LearnedAction.update_precond-41"><span class="linenos">41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds preconditions to the action.</span>
</span><span id="LearnedAction.update_precond-42"><a href="#LearnedAction.update_precond-42"><span class="linenos">42</span></a>
</span><span id="LearnedAction.update_precond-43"><a href="#LearnedAction.update_precond-43"><span class="linenos">43</span></a><span class="sd">        Args:</span>
</span><span id="LearnedAction.update_precond-44"><a href="#LearnedAction.update_precond-44"><span class="linenos">44</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedAction.update_precond-45"><a href="#LearnedAction.update_precond-45"><span class="linenos">45</span></a><span class="sd">                The set of fluents to be added to the action&#39;s preconditions.</span>
</span><span id="LearnedAction.update_precond-46"><a href="#LearnedAction.update_precond-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedAction.update_precond-47"><a href="#LearnedAction.update_precond-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds preconditions to the action.</p>

<p>Args:
    fluents (set):
        The set of fluents to be added to the action's preconditions.</p>
</div>


                            </div>
                            <div id="LearnedAction.update_add" class="classattr">
                                        <input id="LearnedAction.update_add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_add</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedAction.update_add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.update_add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.update_add-49"><a href="#LearnedAction.update_add-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="nf">update_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="LearnedAction.update_add-50"><a href="#LearnedAction.update_add-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds add effects to the action.</span>
</span><span id="LearnedAction.update_add-51"><a href="#LearnedAction.update_add-51"><span class="linenos">51</span></a>
</span><span id="LearnedAction.update_add-52"><a href="#LearnedAction.update_add-52"><span class="linenos">52</span></a><span class="sd">        Args:</span>
</span><span id="LearnedAction.update_add-53"><a href="#LearnedAction.update_add-53"><span class="linenos">53</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedAction.update_add-54"><a href="#LearnedAction.update_add-54"><span class="linenos">54</span></a><span class="sd">                The set of fluents to be added to the action&#39;s add effects.</span>
</span><span id="LearnedAction.update_add-55"><a href="#LearnedAction.update_add-55"><span class="linenos">55</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedAction.update_add-56"><a href="#LearnedAction.update_add-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds add effects to the action.</p>

<p>Args:
    fluents (set):
        The set of fluents to be added to the action's add effects.</p>
</div>


                            </div>
                            <div id="LearnedAction.update_delete" class="classattr">
                                        <input id="LearnedAction.update_delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_delete</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedAction.update_delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.update_delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.update_delete-58"><a href="#LearnedAction.update_delete-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">update_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="LearnedAction.update_delete-59"><a href="#LearnedAction.update_delete-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds delete effects to the action.</span>
</span><span id="LearnedAction.update_delete-60"><a href="#LearnedAction.update_delete-60"><span class="linenos">60</span></a>
</span><span id="LearnedAction.update_delete-61"><a href="#LearnedAction.update_delete-61"><span class="linenos">61</span></a><span class="sd">        Args:</span>
</span><span id="LearnedAction.update_delete-62"><a href="#LearnedAction.update_delete-62"><span class="linenos">62</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedAction.update_delete-63"><a href="#LearnedAction.update_delete-63"><span class="linenos">63</span></a><span class="sd">                The set of fluents to be added to the action&#39;s delete effects.</span>
</span><span id="LearnedAction.update_delete-64"><a href="#LearnedAction.update_delete-64"><span class="linenos">64</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedAction.update_delete-65"><a href="#LearnedAction.update_delete-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds delete effects to the action.</p>

<p>Args:
    fluents (set):
        The set of fluents to be added to the action's delete effects.</p>
</div>


                            </div>
                            <div id="LearnedAction.clear" class="classattr">
                                        <input id="LearnedAction.clear-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedAction.clear-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.clear"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.clear-67"><a href="#LearnedAction.clear-67"><span class="linenos">67</span></a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedAction.clear-68"><a href="#LearnedAction.clear-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LearnedAction.clear-69"><a href="#LearnedAction.clear-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LearnedAction.clear-70"><a href="#LearnedAction.clear-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedAction.compare" class="classattr">
                                        <input id="LearnedAction.compare-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compare</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">orig_action</span><span class="p">:</span> <span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedAction.compare-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedAction.compare"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedAction.compare-72"><a href="#LearnedAction.compare-72"><span class="linenos">72</span></a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_action</span><span class="p">:</span> <span class="n">LearnedAction</span><span class="p">):</span>
</span><span id="LearnedAction.compare-73"><a href="#LearnedAction.compare-73"><span class="linenos">73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compares the learned action to an original, ground truth action.&quot;&quot;&quot;</span>
</span><span id="LearnedAction.compare-74"><a href="#LearnedAction.compare-74"><span class="linenos">74</span></a>        <span class="n">precond_diff</span> <span class="o">=</span> <span class="n">orig_action</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span>
</span><span id="LearnedAction.compare-75"><a href="#LearnedAction.compare-75"><span class="linenos">75</span></a>        <span class="n">add_diff</span> <span class="o">=</span> <span class="n">orig_action</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="LearnedAction.compare-76"><a href="#LearnedAction.compare-76"><span class="linenos">76</span></a>        <span class="n">delete_diff</span> <span class="o">=</span> <span class="n">orig_action</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
</span><span id="LearnedAction.compare-77"><a href="#LearnedAction.compare-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="n">precond_diff</span><span class="p">,</span> <span class="n">add_diff</span><span class="p">,</span> <span class="n">delete_diff</span>
</span></pre></div>


            <div class="docstring"><p>Compares the learned action to an original, ground truth action.</p>
</div>


                            </div>
                </section>
                <section id="LearnedLiftedAction">
                            <input id="LearnedLiftedAction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LearnedLiftedAction</span>:

                <label class="view-source-button" for="LearnedLiftedAction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedAction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedAction-105"><a href="#LearnedLiftedAction-105"><span class="linenos">105</span></a><span class="k">class</span> <span class="nc">LearnedLiftedAction</span><span class="p">:</span>
</span><span id="LearnedLiftedAction-106"><a href="#LearnedLiftedAction-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_sorts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-107"><a href="#LearnedLiftedAction-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedLiftedAction-108"><a href="#LearnedLiftedAction-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span> <span class="o">=</span> <span class="n">param_sorts</span>
</span><span id="LearnedLiftedAction-109"><a href="#LearnedLiftedAction-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;precond&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precond&quot;</span><span class="p">]</span>
</span><span id="LearnedLiftedAction-110"><a href="#LearnedLiftedAction-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;add&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">]</span>
</span><span id="LearnedLiftedAction-111"><a href="#LearnedLiftedAction-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;delete&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">]</span>
</span><span id="LearnedLiftedAction-112"><a href="#LearnedLiftedAction-112"><span class="linenos">112</span></a>
</span><span id="LearnedLiftedAction-113"><a href="#LearnedLiftedAction-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-114"><a href="#LearnedLiftedAction-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="LearnedLiftedAction-115"><a href="#LearnedLiftedAction-115"><span class="linenos">115</span></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LearnedLiftedAction</span><span class="p">)</span>
</span><span id="LearnedLiftedAction-116"><a href="#LearnedLiftedAction-116"><span class="linenos">116</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</span><span id="LearnedLiftedAction-117"><a href="#LearnedLiftedAction-117"><span class="linenos">117</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">param_sorts</span>
</span><span id="LearnedLiftedAction-118"><a href="#LearnedLiftedAction-118"><span class="linenos">118</span></a>        <span class="p">)</span>
</span><span id="LearnedLiftedAction-119"><a href="#LearnedLiftedAction-119"><span class="linenos">119</span></a>
</span><span id="LearnedLiftedAction-120"><a href="#LearnedLiftedAction-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-121"><a href="#LearnedLiftedAction-121"><span class="linenos">121</span></a>        <span class="c1"># Order of param_sorts is important!</span>
</span><span id="LearnedLiftedAction-122"><a href="#LearnedLiftedAction-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</span><span id="LearnedLiftedAction-123"><a href="#LearnedLiftedAction-123"><span class="linenos">123</span></a>
</span><span id="LearnedLiftedAction-124"><a href="#LearnedLiftedAction-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="LearnedLiftedAction-125"><a href="#LearnedLiftedAction-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
</span><span id="LearnedLiftedAction-126"><a href="#LearnedLiftedAction-126"><span class="linenos">126</span></a>
</span><span id="LearnedLiftedAction-127"><a href="#LearnedLiftedAction-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-128"><a href="#LearnedLiftedAction-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedLiftedAction-129"><a href="#LearnedLiftedAction-129"><span class="linenos">129</span></a>
</span><span id="LearnedLiftedAction-130"><a href="#LearnedLiftedAction-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">update_precond</span><span class="p">(</span>
</span><span id="LearnedLiftedAction-131"><a href="#LearnedLiftedAction-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]]</span>
</span><span id="LearnedLiftedAction-132"><a href="#LearnedLiftedAction-132"><span class="linenos">132</span></a>    <span class="p">):</span>
</span><span id="LearnedLiftedAction-133"><a href="#LearnedLiftedAction-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds preconditions to the action.</span>
</span><span id="LearnedLiftedAction-134"><a href="#LearnedLiftedAction-134"><span class="linenos">134</span></a>
</span><span id="LearnedLiftedAction-135"><a href="#LearnedLiftedAction-135"><span class="linenos">135</span></a><span class="sd">        Args:</span>
</span><span id="LearnedLiftedAction-136"><a href="#LearnedLiftedAction-136"><span class="linenos">136</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedLiftedAction-137"><a href="#LearnedLiftedAction-137"><span class="linenos">137</span></a><span class="sd">                The set of fluents to be added to the action&#39;s preconditions.</span>
</span><span id="LearnedLiftedAction-138"><a href="#LearnedLiftedAction-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedLiftedAction-139"><a href="#LearnedLiftedAction-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-140"><a href="#LearnedLiftedAction-140"><span class="linenos">140</span></a>            <span class="n">fluents</span> <span class="o">=</span> <span class="p">{</span><span class="n">fluents</span><span class="p">}</span>
</span><span id="LearnedLiftedAction-141"><a href="#LearnedLiftedAction-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span><span id="LearnedLiftedAction-142"><a href="#LearnedLiftedAction-142"><span class="linenos">142</span></a>
</span><span id="LearnedLiftedAction-143"><a href="#LearnedLiftedAction-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">update_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]]):</span>
</span><span id="LearnedLiftedAction-144"><a href="#LearnedLiftedAction-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds add effects to the action.</span>
</span><span id="LearnedLiftedAction-145"><a href="#LearnedLiftedAction-145"><span class="linenos">145</span></a>
</span><span id="LearnedLiftedAction-146"><a href="#LearnedLiftedAction-146"><span class="linenos">146</span></a><span class="sd">        Args:</span>
</span><span id="LearnedLiftedAction-147"><a href="#LearnedLiftedAction-147"><span class="linenos">147</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedLiftedAction-148"><a href="#LearnedLiftedAction-148"><span class="linenos">148</span></a><span class="sd">                The set of fluents to be added to the action&#39;s add effects.</span>
</span><span id="LearnedLiftedAction-149"><a href="#LearnedLiftedAction-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedLiftedAction-150"><a href="#LearnedLiftedAction-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-151"><a href="#LearnedLiftedAction-151"><span class="linenos">151</span></a>            <span class="n">fluents</span> <span class="o">=</span> <span class="p">{</span><span class="n">fluents</span><span class="p">}</span>
</span><span id="LearnedLiftedAction-152"><a href="#LearnedLiftedAction-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span><span id="LearnedLiftedAction-153"><a href="#LearnedLiftedAction-153"><span class="linenos">153</span></a>
</span><span id="LearnedLiftedAction-154"><a href="#LearnedLiftedAction-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">update_delete</span><span class="p">(</span>
</span><span id="LearnedLiftedAction-155"><a href="#LearnedLiftedAction-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]]</span>
</span><span id="LearnedLiftedAction-156"><a href="#LearnedLiftedAction-156"><span class="linenos">156</span></a>    <span class="p">):</span>
</span><span id="LearnedLiftedAction-157"><a href="#LearnedLiftedAction-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds delete effects to the action.</span>
</span><span id="LearnedLiftedAction-158"><a href="#LearnedLiftedAction-158"><span class="linenos">158</span></a>
</span><span id="LearnedLiftedAction-159"><a href="#LearnedLiftedAction-159"><span class="linenos">159</span></a><span class="sd">        Args:</span>
</span><span id="LearnedLiftedAction-160"><a href="#LearnedLiftedAction-160"><span class="linenos">160</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedLiftedAction-161"><a href="#LearnedLiftedAction-161"><span class="linenos">161</span></a><span class="sd">                The set of fluents to be added to the action&#39;s delete effects.</span>
</span><span id="LearnedLiftedAction-162"><a href="#LearnedLiftedAction-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedLiftedAction-163"><a href="#LearnedLiftedAction-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">):</span>
</span><span id="LearnedLiftedAction-164"><a href="#LearnedLiftedAction-164"><span class="linenos">164</span></a>            <span class="n">fluents</span> <span class="o">=</span> <span class="p">{</span><span class="n">fluents</span><span class="p">}</span>
</span><span id="LearnedLiftedAction-165"><a href="#LearnedLiftedAction-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="LearnedLiftedAction.__init__" class="classattr">
                                        <input id="LearnedLiftedAction.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LearnedLiftedAction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">param_sorts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="LearnedLiftedAction.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedAction.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedAction.__init__-106"><a href="#LearnedLiftedAction.__init__-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_sorts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="LearnedLiftedAction.__init__-107"><a href="#LearnedLiftedAction.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedLiftedAction.__init__-108"><a href="#LearnedLiftedAction.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span> <span class="o">=</span> <span class="n">param_sorts</span>
</span><span id="LearnedLiftedAction.__init__-109"><a href="#LearnedLiftedAction.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;precond&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;precond&quot;</span><span class="p">]</span>
</span><span id="LearnedLiftedAction.__init__-110"><a href="#LearnedLiftedAction.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;add&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">]</span>
</span><span id="LearnedLiftedAction.__init__-111"><a href="#LearnedLiftedAction.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;delete&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedLiftedAction.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedAction.name"></a>
    
    

                            </div>
                            <div id="LearnedLiftedAction.param_sorts" class="classattr">
                                <div class="attr variable">
            <span class="name">param_sorts</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedAction.param_sorts"></a>
    
    

                            </div>
                            <div id="LearnedLiftedAction.precond" class="classattr">
                                <div class="attr variable">
            <span class="name">precond</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedAction.precond"></a>
    
    

                            </div>
                            <div id="LearnedLiftedAction.add" class="classattr">
                                <div class="attr variable">
            <span class="name">add</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedAction.add"></a>
    
    

                            </div>
                            <div id="LearnedLiftedAction.delete" class="classattr">
                                <div class="attr variable">
            <span class="name">delete</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedAction.delete"></a>
    
    

                            </div>
                            <div id="LearnedLiftedAction.details" class="classattr">
                                        <input id="LearnedLiftedAction.details-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">details</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedLiftedAction.details-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedAction.details"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedAction.details-127"><a href="#LearnedLiftedAction.details-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedAction.details-128"><a href="#LearnedLiftedAction.details-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedLiftedAction.update_precond" class="classattr">
                                        <input id="LearnedLiftedAction.update_precond-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_precond</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedLiftedAction.update_precond-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedAction.update_precond"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedAction.update_precond-130"><a href="#LearnedLiftedAction.update_precond-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">update_precond</span><span class="p">(</span>
</span><span id="LearnedLiftedAction.update_precond-131"><a href="#LearnedLiftedAction.update_precond-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]]</span>
</span><span id="LearnedLiftedAction.update_precond-132"><a href="#LearnedLiftedAction.update_precond-132"><span class="linenos">132</span></a>    <span class="p">):</span>
</span><span id="LearnedLiftedAction.update_precond-133"><a href="#LearnedLiftedAction.update_precond-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds preconditions to the action.</span>
</span><span id="LearnedLiftedAction.update_precond-134"><a href="#LearnedLiftedAction.update_precond-134"><span class="linenos">134</span></a>
</span><span id="LearnedLiftedAction.update_precond-135"><a href="#LearnedLiftedAction.update_precond-135"><span class="linenos">135</span></a><span class="sd">        Args:</span>
</span><span id="LearnedLiftedAction.update_precond-136"><a href="#LearnedLiftedAction.update_precond-136"><span class="linenos">136</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedLiftedAction.update_precond-137"><a href="#LearnedLiftedAction.update_precond-137"><span class="linenos">137</span></a><span class="sd">                The set of fluents to be added to the action&#39;s preconditions.</span>
</span><span id="LearnedLiftedAction.update_precond-138"><a href="#LearnedLiftedAction.update_precond-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedLiftedAction.update_precond-139"><a href="#LearnedLiftedAction.update_precond-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">):</span>
</span><span id="LearnedLiftedAction.update_precond-140"><a href="#LearnedLiftedAction.update_precond-140"><span class="linenos">140</span></a>            <span class="n">fluents</span> <span class="o">=</span> <span class="p">{</span><span class="n">fluents</span><span class="p">}</span>
</span><span id="LearnedLiftedAction.update_precond-141"><a href="#LearnedLiftedAction.update_precond-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds preconditions to the action.</p>

<p>Args:
    fluents (set):
        The set of fluents to be added to the action's preconditions.</p>
</div>


                            </div>
                            <div id="LearnedLiftedAction.update_add" class="classattr">
                                        <input id="LearnedLiftedAction.update_add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_add</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedLiftedAction.update_add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedAction.update_add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedAction.update_add-143"><a href="#LearnedLiftedAction.update_add-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">update_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]]):</span>
</span><span id="LearnedLiftedAction.update_add-144"><a href="#LearnedLiftedAction.update_add-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds add effects to the action.</span>
</span><span id="LearnedLiftedAction.update_add-145"><a href="#LearnedLiftedAction.update_add-145"><span class="linenos">145</span></a>
</span><span id="LearnedLiftedAction.update_add-146"><a href="#LearnedLiftedAction.update_add-146"><span class="linenos">146</span></a><span class="sd">        Args:</span>
</span><span id="LearnedLiftedAction.update_add-147"><a href="#LearnedLiftedAction.update_add-147"><span class="linenos">147</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedLiftedAction.update_add-148"><a href="#LearnedLiftedAction.update_add-148"><span class="linenos">148</span></a><span class="sd">                The set of fluents to be added to the action&#39;s add effects.</span>
</span><span id="LearnedLiftedAction.update_add-149"><a href="#LearnedLiftedAction.update_add-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedLiftedAction.update_add-150"><a href="#LearnedLiftedAction.update_add-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">):</span>
</span><span id="LearnedLiftedAction.update_add-151"><a href="#LearnedLiftedAction.update_add-151"><span class="linenos">151</span></a>            <span class="n">fluents</span> <span class="o">=</span> <span class="p">{</span><span class="n">fluents</span><span class="p">}</span>
</span><span id="LearnedLiftedAction.update_add-152"><a href="#LearnedLiftedAction.update_add-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds add effects to the action.</p>

<p>Args:
    fluents (set):
        The set of fluents to be added to the action's add effects.</p>
</div>


                            </div>
                            <div id="LearnedLiftedAction.update_delete" class="classattr">
                                        <input id="LearnedLiftedAction.update_delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_delete</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedLiftedAction.update_delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedAction.update_delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedAction.update_delete-154"><a href="#LearnedLiftedAction.update_delete-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">update_delete</span><span class="p">(</span>
</span><span id="LearnedLiftedAction.update_delete-155"><a href="#LearnedLiftedAction.update_delete-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]]</span>
</span><span id="LearnedLiftedAction.update_delete-156"><a href="#LearnedLiftedAction.update_delete-156"><span class="linenos">156</span></a>    <span class="p">):</span>
</span><span id="LearnedLiftedAction.update_delete-157"><a href="#LearnedLiftedAction.update_delete-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds delete effects to the action.</span>
</span><span id="LearnedLiftedAction.update_delete-158"><a href="#LearnedLiftedAction.update_delete-158"><span class="linenos">158</span></a>
</span><span id="LearnedLiftedAction.update_delete-159"><a href="#LearnedLiftedAction.update_delete-159"><span class="linenos">159</span></a><span class="sd">        Args:</span>
</span><span id="LearnedLiftedAction.update_delete-160"><a href="#LearnedLiftedAction.update_delete-160"><span class="linenos">160</span></a><span class="sd">            fluents (set):</span>
</span><span id="LearnedLiftedAction.update_delete-161"><a href="#LearnedLiftedAction.update_delete-161"><span class="linenos">161</span></a><span class="sd">                The set of fluents to be added to the action&#39;s delete effects.</span>
</span><span id="LearnedLiftedAction.update_delete-162"><a href="#LearnedLiftedAction.update_delete-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LearnedLiftedAction.update_delete-163"><a href="#LearnedLiftedAction.update_delete-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">):</span>
</span><span id="LearnedLiftedAction.update_delete-164"><a href="#LearnedLiftedAction.update_delete-164"><span class="linenos">164</span></a>            <span class="n">fluents</span> <span class="o">=</span> <span class="p">{</span><span class="n">fluents</span><span class="p">}</span>
</span><span id="LearnedLiftedAction.update_delete-165"><a href="#LearnedLiftedAction.update_delete-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fluents</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds delete effects to the action.</p>

<p>Args:
    fluents (set):
        The set of fluents to be added to the action's delete effects.</p>
</div>


                            </div>
                </section>
                <section id="LearnedFluent">
                            <input id="LearnedFluent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LearnedFluent</span>:

                <label class="view-source-button" for="LearnedFluent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedFluent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedFluent-7"><a href="#LearnedFluent-7"><span class="linenos"> 7</span></a><span class="k">class</span> <span class="nc">LearnedFluent</span><span class="p">:</span>
</span><span id="LearnedFluent-8"><a href="#LearnedFluent-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PlanningObject</span><span class="p">]):</span>
</span><span id="LearnedFluent-9"><a href="#LearnedFluent-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedFluent-10"><a href="#LearnedFluent-10"><span class="linenos">10</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
</span><span id="LearnedFluent-11"><a href="#LearnedFluent-11"><span class="linenos">11</span></a>
</span><span id="LearnedFluent-12"><a href="#LearnedFluent-12"><span class="linenos">12</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="LearnedFluent-13"><a href="#LearnedFluent-13"><span class="linenos">13</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LearnedFluent</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="LearnedFluent-14"><a href="#LearnedFluent-14"><span class="linenos">14</span></a>
</span><span id="LearnedFluent-15"><a href="#LearnedFluent-15"><span class="linenos">15</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedFluent-16"><a href="#LearnedFluent-16"><span class="linenos">16</span></a>        <span class="c1"># Order of objects is important!</span>
</span><span id="LearnedFluent-17"><a href="#LearnedFluent-17"><span class="linenos">17</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</span><span id="LearnedFluent-18"><a href="#LearnedFluent-18"><span class="linenos">18</span></a>
</span><span id="LearnedFluent-19"><a href="#LearnedFluent-19"><span class="linenos">19</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedFluent-20"><a href="#LearnedFluent-20"><span class="linenos">20</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
</span><span id="LearnedFluent-21"><a href="#LearnedFluent-21"><span class="linenos">21</span></a>
</span><span id="LearnedFluent-22"><a href="#LearnedFluent-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedFluent-23"><a href="#LearnedFluent-23"><span class="linenos">23</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
</span><span id="LearnedFluent-24"><a href="#LearnedFluent-24"><span class="linenos">24</span></a>
</span><span id="LearnedFluent-25"><a href="#LearnedFluent-25"><span class="linenos">25</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedFluent-26"><a href="#LearnedFluent-26"><span class="linenos">26</span></a>        <span class="c1"># objects can be either a list of strings or a list of PlanningObject depending on the token type and extraction method used to learn the fluent</span>
</span><span id="LearnedFluent-27"><a href="#LearnedFluent-27"><span class="linenos">27</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LearnedFluent-28"><a href="#LearnedFluent-28"><span class="linenos">28</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LearnedFluent-29"><a href="#LearnedFluent-29"><span class="linenos">29</span></a>                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">o</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LearnedFluent-30"><a href="#LearnedFluent-30"><span class="linenos">30</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="LearnedFluent-31"><a href="#LearnedFluent-31"><span class="linenos">31</span></a>                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LearnedFluent-32"><a href="#LearnedFluent-32"><span class="linenos">32</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LearnedFluent-33"><a href="#LearnedFluent-33"><span class="linenos">33</span></a>            <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="LearnedFluent-34"><a href="#LearnedFluent-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedFluent-35"><a href="#LearnedFluent-35"><span class="linenos">35</span></a>
</span><span id="LearnedFluent-36"><a href="#LearnedFluent-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedFluent-37"><a href="#LearnedFluent-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="LearnedFluent.__init__" class="classattr">
                                        <input id="LearnedFluent.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LearnedFluent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">fluent</span><span class="o">.</span><span class="n">PlanningObject</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="LearnedFluent.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedFluent.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedFluent.__init__-8"><a href="#LearnedFluent.__init__-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PlanningObject</span><span class="p">]):</span>
</span><span id="LearnedFluent.__init__-9"><a href="#LearnedFluent.__init__-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedFluent.__init__-10"><a href="#LearnedFluent.__init__-10"><span class="linenos">10</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedFluent.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#LearnedFluent.name"></a>
    
    

                            </div>
                            <div id="LearnedFluent.objects" class="classattr">
                                <div class="attr variable">
            <span class="name">objects</span>

        
    </div>
    <a class="headerlink" href="#LearnedFluent.objects"></a>
    
    

                            </div>
                            <div id="LearnedFluent.details" class="classattr">
                                        <input id="LearnedFluent.details-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">details</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedFluent.details-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedFluent.details"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedFluent.details-25"><a href="#LearnedFluent.details-25"><span class="linenos">25</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedFluent.details-26"><a href="#LearnedFluent.details-26"><span class="linenos">26</span></a>        <span class="c1"># objects can be either a list of strings or a list of PlanningObject depending on the token type and extraction method used to learn the fluent</span>
</span><span id="LearnedFluent.details-27"><a href="#LearnedFluent.details-27"><span class="linenos">27</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LearnedFluent.details-28"><a href="#LearnedFluent.details-28"><span class="linenos">28</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LearnedFluent.details-29"><a href="#LearnedFluent.details-29"><span class="linenos">29</span></a>                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">o</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LearnedFluent.details-30"><a href="#LearnedFluent.details-30"><span class="linenos">30</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="LearnedFluent.details-31"><a href="#LearnedFluent.details-31"><span class="linenos">31</span></a>                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LearnedFluent.details-32"><a href="#LearnedFluent.details-32"><span class="linenos">32</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LearnedFluent.details-33"><a href="#LearnedFluent.details-33"><span class="linenos">33</span></a>            <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="LearnedFluent.details-34"><a href="#LearnedFluent.details-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="LearnedLiftedFluent">
                            <input id="LearnedLiftedFluent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LearnedLiftedFluent</span>:

                <label class="view-source-button" for="LearnedLiftedFluent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedFluent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedFluent-40"><a href="#LearnedLiftedFluent-40"><span class="linenos">40</span></a><span class="k">class</span> <span class="nc">LearnedLiftedFluent</span><span class="p">:</span>
</span><span id="LearnedLiftedFluent-41"><a href="#LearnedLiftedFluent-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_sorts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">param_act_inds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="LearnedLiftedFluent-42"><a href="#LearnedLiftedFluent-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedLiftedFluent-43"><a href="#LearnedLiftedFluent-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span> <span class="o">=</span> <span class="n">param_sorts</span>
</span><span id="LearnedLiftedFluent-44"><a href="#LearnedLiftedFluent-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_act_inds</span> <span class="o">=</span> <span class="n">param_act_inds</span>
</span><span id="LearnedLiftedFluent-45"><a href="#LearnedLiftedFluent-45"><span class="linenos">45</span></a>
</span><span id="LearnedLiftedFluent-46"><a href="#LearnedLiftedFluent-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent-47"><a href="#LearnedLiftedFluent-47"><span class="linenos">47</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LearnedLiftedFluent</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="LearnedLiftedFluent-48"><a href="#LearnedLiftedFluent-48"><span class="linenos">48</span></a>
</span><span id="LearnedLiftedFluent-49"><a href="#LearnedLiftedFluent-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent-50"><a href="#LearnedLiftedFluent-50"><span class="linenos">50</span></a>        <span class="c1"># Order of objects is important!</span>
</span><span id="LearnedLiftedFluent-51"><a href="#LearnedLiftedFluent-51"><span class="linenos">51</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</span><span id="LearnedLiftedFluent-52"><a href="#LearnedLiftedFluent-52"><span class="linenos">52</span></a>
</span><span id="LearnedLiftedFluent-53"><a href="#LearnedLiftedFluent-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent-54"><a href="#LearnedLiftedFluent-54"><span class="linenos">54</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_act_inds</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LearnedLiftedFluent-55"><a href="#LearnedLiftedFluent-55"><span class="linenos">55</span></a>
</span><span id="LearnedLiftedFluent-56"><a href="#LearnedLiftedFluent-56"><span class="linenos">56</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent-57"><a href="#LearnedLiftedFluent-57"><span class="linenos">57</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
</span><span id="LearnedLiftedFluent-58"><a href="#LearnedLiftedFluent-58"><span class="linenos">58</span></a>
</span><span id="LearnedLiftedFluent-59"><a href="#LearnedLiftedFluent-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent-60"><a href="#LearnedLiftedFluent-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LearnedLiftedFluent-61"><a href="#LearnedLiftedFluent-61"><span class="linenos">61</span></a>
</span><span id="LearnedLiftedFluent-62"><a href="#LearnedLiftedFluent-62"><span class="linenos">62</span></a>    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent-63"><a href="#LearnedLiftedFluent-63"><span class="linenos">63</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="LearnedLiftedFluent.__init__" class="classattr">
                                        <input id="LearnedLiftedFluent.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LearnedLiftedFluent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">param_sorts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="n">param_act_inds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="LearnedLiftedFluent.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedFluent.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedFluent.__init__-41"><a href="#LearnedLiftedFluent.__init__-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_sorts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">param_act_inds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="LearnedLiftedFluent.__init__-42"><a href="#LearnedLiftedFluent.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="LearnedLiftedFluent.__init__-43"><a href="#LearnedLiftedFluent.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span> <span class="o">=</span> <span class="n">param_sorts</span>
</span><span id="LearnedLiftedFluent.__init__-44"><a href="#LearnedLiftedFluent.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_act_inds</span> <span class="o">=</span> <span class="n">param_act_inds</span>
</span></pre></div>


    

                            </div>
                            <div id="LearnedLiftedFluent.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedFluent.name"></a>
    
    

                            </div>
                            <div id="LearnedLiftedFluent.param_sorts" class="classattr">
                                <div class="attr variable">
            <span class="name">param_sorts</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedFluent.param_sorts"></a>
    
    

                            </div>
                            <div id="LearnedLiftedFluent.param_act_inds" class="classattr">
                                <div class="attr variable">
            <span class="name">param_act_inds</span>

        
    </div>
    <a class="headerlink" href="#LearnedLiftedFluent.param_act_inds"></a>
    
    

                            </div>
                            <div id="LearnedLiftedFluent.details" class="classattr">
                                        <input id="LearnedLiftedFluent.details-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">details</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LearnedLiftedFluent.details-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LearnedLiftedFluent.details"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LearnedLiftedFluent.details-59"><a href="#LearnedLiftedFluent.details-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LearnedLiftedFluent.details-60"><a href="#LearnedLiftedFluent.details-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Model">
                            <input id="Model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Model</span>:

                <label class="view-source-button" for="Model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model-18"><a href="#Model-18"><span class="linenos"> 18</span></a><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>
</span><span id="Model-19"><a href="#Model-19"><span class="linenos"> 19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Action model.</span>
</span><span id="Model-20"><a href="#Model-20"><span class="linenos"> 20</span></a>
</span><span id="Model-21"><a href="#Model-21"><span class="linenos"> 21</span></a><span class="sd">    An action model representing a planning domain. The characteristics of the</span>
</span><span id="Model-22"><a href="#Model-22"><span class="linenos"> 22</span></a><span class="sd">    model are dependent on the extraction technique used to obtain the model.</span>
</span><span id="Model-23"><a href="#Model-23"><span class="linenos"> 23</span></a>
</span><span id="Model-24"><a href="#Model-24"><span class="linenos"> 24</span></a><span class="sd">    Attributes:</span>
</span><span id="Model-25"><a href="#Model-25"><span class="linenos"> 25</span></a><span class="sd">        fluents (set):</span>
</span><span id="Model-26"><a href="#Model-26"><span class="linenos"> 26</span></a><span class="sd">            The set of fluents in the domain.</span>
</span><span id="Model-27"><a href="#Model-27"><span class="linenos"> 27</span></a><span class="sd">        actions (set):</span>
</span><span id="Model-28"><a href="#Model-28"><span class="linenos"> 28</span></a><span class="sd">            The set of actions in the domain. Actions include their</span>
</span><span id="Model-29"><a href="#Model-29"><span class="linenos"> 29</span></a><span class="sd">            preconditions, add effects, and delete effects. The nature of the</span>
</span><span id="Model-30"><a href="#Model-30"><span class="linenos"> 30</span></a><span class="sd">            action attributes characterize the model.</span>
</span><span id="Model-31"><a href="#Model-31"><span class="linenos"> 31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Model-32"><a href="#Model-32"><span class="linenos"> 32</span></a>
</span><span id="Model-33"><a href="#Model-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Model-34"><a href="#Model-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model-35"><a href="#Model-35"><span class="linenos"> 35</span></a>        <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">LearnedFluent</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]],</span>
</span><span id="Model-36"><a href="#Model-36"><span class="linenos"> 36</span></a>        <span class="n">actions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedAction</span><span class="p">]],</span>
</span><span id="Model-37"><a href="#Model-37"><span class="linenos"> 37</span></a>    <span class="p">):</span>
</span><span id="Model-38"><a href="#Model-38"><span class="linenos"> 38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes a Model with a set of fluents and a set of actions.</span>
</span><span id="Model-39"><a href="#Model-39"><span class="linenos"> 39</span></a>
</span><span id="Model-40"><a href="#Model-40"><span class="linenos"> 40</span></a><span class="sd">        Args:</span>
</span><span id="Model-41"><a href="#Model-41"><span class="linenos"> 41</span></a><span class="sd">            fluents (Union[Set[LearnedFluent], Set[str]]):</span>
</span><span id="Model-42"><a href="#Model-42"><span class="linenos"> 42</span></a><span class="sd">                The set of fluents in the model.</span>
</span><span id="Model-43"><a href="#Model-43"><span class="linenos"> 43</span></a><span class="sd">            actions (Set[LearnedAction]):</span>
</span><span id="Model-44"><a href="#Model-44"><span class="linenos"> 44</span></a><span class="sd">                The set of actions in the model.</span>
</span><span id="Model-45"><a href="#Model-45"><span class="linenos"> 45</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-46"><a href="#Model-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span> <span class="o">=</span> <span class="n">fluents</span>
</span><span id="Model-47"><a href="#Model-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
</span><span id="Model-48"><a href="#Model-48"><span class="linenos"> 48</span></a>
</span><span id="Model-49"><a href="#Model-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Model-50"><a href="#Model-50"><span class="linenos"> 50</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
</span><span id="Model-51"><a href="#Model-51"><span class="linenos"> 51</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Model-52"><a href="#Model-52"><span class="linenos"> 52</span></a>        <span class="n">self_fluent_type</span><span class="p">,</span> <span class="n">other_fluent_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">type</span><span class="p">(</span>
</span><span id="Model-53"><a href="#Model-53"><span class="linenos"> 53</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">fluents</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Model-54"><a href="#Model-54"><span class="linenos"> 54</span></a>        <span class="p">)</span>
</span><span id="Model-55"><a href="#Model-55"><span class="linenos"> 55</span></a>        <span class="k">if</span> <span class="n">self_fluent_type</span> <span class="o">==</span> <span class="n">other_fluent_type</span><span class="p">:</span>
</span><span id="Model-56"><a href="#Model-56"><span class="linenos"> 56</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">fluents</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">actions</span>
</span><span id="Model-57"><a href="#Model-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="n">self_fluent_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Model-58"><a href="#Model-58"><span class="linenos"> 58</span></a>            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">fluents</span><span class="p">))</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span>
</span><span id="Model-59"><a href="#Model-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="n">other_fluent_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Model-60"><a href="#Model-60"><span class="linenos"> 60</span></a>            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">))</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">fluents</span>
</span><span id="Model-61"><a href="#Model-61"><span class="linenos"> 61</span></a>
</span><span id="Model-62"><a href="#Model-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model-63"><a href="#Model-63"><span class="linenos"> 63</span></a>        <span class="c1"># Set the indent width</span>
</span><span id="Model-64"><a href="#Model-64"><span class="linenos"> 64</span></a>        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Model-65"><a href="#Model-65"><span class="linenos"> 65</span></a>        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Model:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-66"><a href="#Model-66"><span class="linenos"> 66</span></a>        <span class="c1"># Map fluents to a comma separated string of the fluent names</span>
</span><span id="Model-67"><a href="#Model-67"><span class="linenos"> 67</span></a>        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">Fluents: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">))</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-68"><a href="#Model-68"><span class="linenos"> 68</span></a>
</span><span id="Model-69"><a href="#Model-69"><span class="linenos"> 69</span></a>        <span class="c1"># Map the actions to a summary of their names, preconditions, add</span>
</span><span id="Model-70"><a href="#Model-70"><span class="linenos"> 70</span></a>        <span class="c1"># effects and delete effects</span>
</span><span id="Model-71"><a href="#Model-71"><span class="linenos"> 71</span></a>        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">Actions:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-72"><a href="#Model-72"><span class="linenos"> 72</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_details</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
</span><span id="Model-73"><a href="#Model-73"><span class="linenos"> 73</span></a>            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-74"><a href="#Model-74"><span class="linenos"> 74</span></a>        <span class="k">return</span> <span class="n">string</span>
</span><span id="Model-75"><a href="#Model-75"><span class="linenos"> 75</span></a>
</span><span id="Model-76"><a href="#Model-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">_get_action_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model-77"><a href="#Model-77"><span class="linenos"> 77</span></a>        <span class="c1"># Set the indent width</span>
</span><span id="Model-78"><a href="#Model-78"><span class="linenos"> 78</span></a>        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Model-79"><a href="#Model-79"><span class="linenos"> 79</span></a>        <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Model-80"><a href="#Model-80"><span class="linenos"> 80</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model-81"><a href="#Model-81"><span class="linenos"> 81</span></a>            <span class="n">details</span> <span class="o">+=</span> <span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-82"><a href="#Model-82"><span class="linenos"> 82</span></a>            <span class="n">details</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">precond:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-83"><a href="#Model-83"><span class="linenos"> 83</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">precond</span><span class="p">:</span>
</span><span id="Model-84"><a href="#Model-84"><span class="linenos"> 84</span></a>                <span class="n">details</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}{</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-85"><a href="#Model-85"><span class="linenos"> 85</span></a>            <span class="n">details</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">add:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-86"><a href="#Model-86"><span class="linenos"> 86</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
</span><span id="Model-87"><a href="#Model-87"><span class="linenos"> 87</span></a>                <span class="n">details</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}{</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-88"><a href="#Model-88"><span class="linenos"> 88</span></a>            <span class="n">details</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">delete:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-89"><a href="#Model-89"><span class="linenos"> 89</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span>
</span><span id="Model-90"><a href="#Model-90"><span class="linenos"> 90</span></a>                <span class="n">details</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}{</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model-91"><a href="#Model-91"><span class="linenos"> 91</span></a>
</span><span id="Model-92"><a href="#Model-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="n">details</span>
</span><span id="Model-93"><a href="#Model-93"><span class="linenos"> 93</span></a>
</span><span id="Model-94"><a href="#Model-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Model-95"><a href="#Model-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Serializes the model into a json string.</span>
</span><span id="Model-96"><a href="#Model-96"><span class="linenos"> 96</span></a>
</span><span id="Model-97"><a href="#Model-97"><span class="linenos"> 97</span></a><span class="sd">        Args:</span>
</span><span id="Model-98"><a href="#Model-98"><span class="linenos"> 98</span></a><span class="sd">            filepath (str):</span>
</span><span id="Model-99"><a href="#Model-99"><span class="linenos"> 99</span></a><span class="sd">                Optional; If supplied, the json string will be written to the</span>
</span><span id="Model-100"><a href="#Model-100"><span class="linenos">100</span></a><span class="sd">                filepath.</span>
</span><span id="Model-101"><a href="#Model-101"><span class="linenos">101</span></a>
</span><span id="Model-102"><a href="#Model-102"><span class="linenos">102</span></a><span class="sd">        Returns:</span>
</span><span id="Model-103"><a href="#Model-103"><span class="linenos">103</span></a><span class="sd">            A string in json format representing the model.</span>
</span><span id="Model-104"><a href="#Model-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-105"><a href="#Model-105"><span class="linenos">105</span></a>
</span><span id="Model-106"><a href="#Model-106"><span class="linenos">106</span></a>        <span class="n">serial</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">=</span><span class="n">ComplexEncoder</span><span class="p">)</span>
</span><span id="Model-107"><a href="#Model-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Model-108"><a href="#Model-108"><span class="linenos">108</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="Model-109"><a href="#Model-109"><span class="linenos">109</span></a>                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serial</span><span class="p">)</span>
</span><span id="Model-110"><a href="#Model-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="n">serial</span>
</span><span id="Model-111"><a href="#Model-111"><span class="linenos">111</span></a>
</span><span id="Model-112"><a href="#Model-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">__to_tarski_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">lang</span><span class="p">:</span> <span class="n">FirstOrderLanguage</span><span class="p">):</span>
</span><span id="Model-113"><a href="#Model-113"><span class="linenos">113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a set of strings (referencing an attribute of a LearnedAction, i.e. its preconditions)</span>
</span><span id="Model-114"><a href="#Model-114"><span class="linenos">114</span></a><span class="sd">        to an Atom or CompoundFormula, in order to set up a tarski action.</span>
</span><span id="Model-115"><a href="#Model-115"><span class="linenos">115</span></a>
</span><span id="Model-116"><a href="#Model-116"><span class="linenos">116</span></a><span class="sd">        Args:</span>
</span><span id="Model-117"><a href="#Model-117"><span class="linenos">117</span></a><span class="sd">            attribute (Set[str]):</span>
</span><span id="Model-118"><a href="#Model-118"><span class="linenos">118</span></a><span class="sd">                The attribute to be converted to an Atom or CompoundFormula.</span>
</span><span id="Model-119"><a href="#Model-119"><span class="linenos">119</span></a><span class="sd">            lang (FirstOrderLanguage):</span>
</span><span id="Model-120"><a href="#Model-120"><span class="linenos">120</span></a><span class="sd">                The relevant language.</span>
</span><span id="Model-121"><a href="#Model-121"><span class="linenos">121</span></a>
</span><span id="Model-122"><a href="#Model-122"><span class="linenos">122</span></a><span class="sd">        Returns:</span>
</span><span id="Model-123"><a href="#Model-123"><span class="linenos">123</span></a><span class="sd">            The attribute of the LearnedAction, converted to an Atom or CompoundFormula.</span>
</span><span id="Model-124"><a href="#Model-124"><span class="linenos">124</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-125"><a href="#Model-125"><span class="linenos">125</span></a>        <span class="c1"># return top if there are no constraints</span>
</span><span id="Model-126"><a href="#Model-126"><span class="linenos">126</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">attribute</span><span class="p">:</span>
</span><span id="Model-127"><a href="#Model-127"><span class="linenos">127</span></a>            <span class="k">return</span> <span class="n">top</span>
</span><span id="Model-128"><a href="#Model-128"><span class="linenos">128</span></a>        <span class="c1"># creates Atom</span>
</span><span id="Model-129"><a href="#Model-129"><span class="linenos">129</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Model-130"><a href="#Model-130"><span class="linenos">130</span></a>            <span class="k">return</span> <span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">attribute</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))()</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-131"><a href="#Model-131"><span class="linenos">131</span></a>        <span class="c1"># creates CompoundFormula</span>
</span><span id="Model-132"><a href="#Model-132"><span class="linenos">132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Model-133"><a href="#Model-133"><span class="linenos">133</span></a>            <span class="k">return</span> <span class="n">CompoundFormula</span><span class="p">(</span>
</span><span id="Model-134"><a href="#Model-134"><span class="linenos">134</span></a>                <span class="n">Connective</span><span class="o">.</span><span class="n">And</span><span class="p">,</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attribute</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-135"><a href="#Model-135"><span class="linenos">135</span></a>            <span class="p">)</span>
</span><span id="Model-136"><a href="#Model-136"><span class="linenos">136</span></a>
</span><span id="Model-137"><a href="#Model-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">to_pddl</span><span class="p">(</span>
</span><span id="Model-138"><a href="#Model-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model-139"><a href="#Model-139"><span class="linenos">139</span></a>        <span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-140"><a href="#Model-140"><span class="linenos">140</span></a>        <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Model-141"><a href="#Model-141"><span class="linenos">141</span></a>        <span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Model-142"><a href="#Model-142"><span class="linenos">142</span></a>        <span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Model-143"><a href="#Model-143"><span class="linenos">143</span></a>    <span class="p">):</span>
</span><span id="Model-144"><a href="#Model-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_name</span><span class="p">:</span>
</span><span id="Model-145"><a href="#Model-145"><span class="linenos">145</span></a>            <span class="n">problem_name</span> <span class="o">=</span> <span class="n">domain_name</span> <span class="o">+</span> <span class="s2">&quot;_problem&quot;</span>
</span><span id="Model-146"><a href="#Model-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_filename</span><span class="p">:</span>
</span><span id="Model-147"><a href="#Model-147"><span class="linenos">147</span></a>            <span class="n">domain_filename</span> <span class="o">=</span> <span class="n">domain_name</span> <span class="o">+</span> <span class="s2">&quot;.pddl&quot;</span>
</span><span id="Model-148"><a href="#Model-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_filename</span><span class="p">:</span>
</span><span id="Model-149"><a href="#Model-149"><span class="linenos">149</span></a>            <span class="n">problem_filename</span> <span class="o">=</span> <span class="n">problem_name</span> <span class="o">+</span> <span class="s2">&quot;.pddl&quot;</span>
</span><span id="Model-150"><a href="#Model-150"><span class="linenos">150</span></a>
</span><span id="Model-151"><a href="#Model-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LearnedLiftedAction</span><span class="p">):</span>
</span><span id="Model-152"><a href="#Model-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">to_pddl_lifted</span><span class="p">(</span>
</span><span id="Model-153"><a href="#Model-153"><span class="linenos">153</span></a>                <span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="p">,</span> <span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span>
</span><span id="Model-154"><a href="#Model-154"><span class="linenos">154</span></a>            <span class="p">)</span>
</span><span id="Model-155"><a href="#Model-155"><span class="linenos">155</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LearnedAction</span><span class="p">):</span>
</span><span id="Model-156"><a href="#Model-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">to_pddl_grounded</span><span class="p">(</span>
</span><span id="Model-157"><a href="#Model-157"><span class="linenos">157</span></a>                <span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="p">,</span> <span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span>
</span><span id="Model-158"><a href="#Model-158"><span class="linenos">158</span></a>            <span class="p">)</span>
</span><span id="Model-159"><a href="#Model-159"><span class="linenos">159</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Model-160"><a href="#Model-160"><span class="linenos">160</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Model-161"><a href="#Model-161"><span class="linenos">161</span></a>                <span class="sa">f</span><span class="s2">&quot;Could not determine whether the model is grounded or lifted. Fluents are of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> while actions are of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Model-162"><a href="#Model-162"><span class="linenos">162</span></a>            <span class="p">)</span>
</span><span id="Model-163"><a href="#Model-163"><span class="linenos">163</span></a>
</span><span id="Model-164"><a href="#Model-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">to_pddl_lifted</span><span class="p">(</span>
</span><span id="Model-165"><a href="#Model-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model-166"><a href="#Model-166"><span class="linenos">166</span></a>        <span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-167"><a href="#Model-167"><span class="linenos">167</span></a>        <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-168"><a href="#Model-168"><span class="linenos">168</span></a>        <span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-169"><a href="#Model-169"><span class="linenos">169</span></a>        <span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-170"><a href="#Model-170"><span class="linenos">170</span></a>    <span class="p">):</span>
</span><span id="Model-171"><a href="#Model-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dumps a Model with typed lifted actions &amp; fluents to PDDL files.</span>
</span><span id="Model-172"><a href="#Model-172"><span class="linenos">172</span></a>
</span><span id="Model-173"><a href="#Model-173"><span class="linenos">173</span></a><span class="sd">        Args:</span>
</span><span id="Model-174"><a href="#Model-174"><span class="linenos">174</span></a><span class="sd">            domain_name (str):</span>
</span><span id="Model-175"><a href="#Model-175"><span class="linenos">175</span></a><span class="sd">                The name of the domain to be generated.</span>
</span><span id="Model-176"><a href="#Model-176"><span class="linenos">176</span></a><span class="sd">            problem_name (str):</span>
</span><span id="Model-177"><a href="#Model-177"><span class="linenos">177</span></a><span class="sd">                The name of the problem to be generated.</span>
</span><span id="Model-178"><a href="#Model-178"><span class="linenos">178</span></a><span class="sd">            domain_filename (str):</span>
</span><span id="Model-179"><a href="#Model-179"><span class="linenos">179</span></a><span class="sd">                The name of the domain file to be generated.</span>
</span><span id="Model-180"><a href="#Model-180"><span class="linenos">180</span></a><span class="sd">            problem_filename (str):</span>
</span><span id="Model-181"><a href="#Model-181"><span class="linenos">181</span></a><span class="sd">                The name of the problem file to be generated.</span>
</span><span id="Model-182"><a href="#Model-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-183"><a href="#Model-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]</span>
</span><span id="Model-184"><a href="#Model-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedAction</span><span class="p">]</span>
</span><span id="Model-185"><a href="#Model-185"><span class="linenos">185</span></a>
</span><span id="Model-186"><a href="#Model-186"><span class="linenos">186</span></a>        <span class="n">lang</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">language</span><span class="p">(</span><span class="n">domain_name</span><span class="p">)</span>
</span><span id="Model-187"><a href="#Model-187"><span class="linenos">187</span></a>        <span class="n">problem</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">fstrips</span><span class="o">.</span><span class="n">create_fstrips_problem</span><span class="p">(</span>
</span><span id="Model-188"><a href="#Model-188"><span class="linenos">188</span></a>            <span class="n">domain_name</span><span class="o">=</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="o">=</span><span class="n">problem_name</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">lang</span>
</span><span id="Model-189"><a href="#Model-189"><span class="linenos">189</span></a>        <span class="p">)</span>
</span><span id="Model-190"><a href="#Model-190"><span class="linenos">190</span></a>        <span class="n">sorts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Model-191"><a href="#Model-191"><span class="linenos">191</span></a>
</span><span id="Model-192"><a href="#Model-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model-193"><a href="#Model-193"><span class="linenos">193</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model-194"><a href="#Model-194"><span class="linenos">194</span></a>                <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">:</span>
</span><span id="Model-195"><a href="#Model-195"><span class="linenos">195</span></a>                    <span class="k">if</span> <span class="n">sort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sorts</span><span class="p">:</span>
</span><span id="Model-196"><a href="#Model-196"><span class="linenos">196</span></a>                        <span class="n">lang</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
</span><span id="Model-197"><a href="#Model-197"><span class="linenos">197</span></a>                        <span class="n">sorts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
</span><span id="Model-198"><a href="#Model-198"><span class="linenos">198</span></a>
</span><span id="Model-199"><a href="#Model-199"><span class="linenos">199</span></a>                <span class="n">lang</span><span class="o">.</span><span class="n">predicate</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)</span>
</span><span id="Model-200"><a href="#Model-200"><span class="linenos">200</span></a>
</span><span id="Model-201"><a href="#Model-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model-202"><a href="#Model-202"><span class="linenos">202</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model-203"><a href="#Model-203"><span class="linenos">203</span></a>                <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)]</span>
</span><span id="Model-204"><a href="#Model-204"><span class="linenos">204</span></a>
</span><span id="Model-205"><a href="#Model-205"><span class="linenos">205</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Model-206"><a href="#Model-206"><span class="linenos">206</span></a>                    <span class="n">precond</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-207"><a href="#Model-207"><span class="linenos">207</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Model-208"><a href="#Model-208"><span class="linenos">208</span></a>                    <span class="n">precond</span> <span class="o">=</span> <span class="n">CompoundFormula</span><span class="p">(</span>
</span><span id="Model-209"><a href="#Model-209"><span class="linenos">209</span></a>                        <span class="n">Connective</span><span class="o">.</span><span class="n">And</span><span class="p">,</span>
</span><span id="Model-210"><a href="#Model-210"><span class="linenos">210</span></a>                        <span class="p">[</span>
</span><span id="Model-211"><a href="#Model-211"><span class="linenos">211</span></a>                            <span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-212"><a href="#Model-212"><span class="linenos">212</span></a>                            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">precond</span>
</span><span id="Model-213"><a href="#Model-213"><span class="linenos">213</span></a>                        <span class="p">],</span>
</span><span id="Model-214"><a href="#Model-214"><span class="linenos">214</span></a>                    <span class="p">)</span>
</span><span id="Model-215"><a href="#Model-215"><span class="linenos">215</span></a>
</span><span id="Model-216"><a href="#Model-216"><span class="linenos">216</span></a>                <span class="n">adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-217"><a href="#Model-217"><span class="linenos">217</span></a>                <span class="n">dels</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">delete</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-218"><a href="#Model-218"><span class="linenos">218</span></a>                <span class="n">effects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="o">.</span><span class="n">AddEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">adds</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">fs</span><span class="o">.</span><span class="n">DelEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dels</span><span class="p">]</span>  <span class="c1"># fmt: skip</span>
</span><span id="Model-219"><a href="#Model-219"><span class="linenos">219</span></a>
</span><span id="Model-220"><a href="#Model-220"><span class="linenos">220</span></a>                <span class="n">problem</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
</span><span id="Model-221"><a href="#Model-221"><span class="linenos">221</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Model-222"><a href="#Model-222"><span class="linenos">222</span></a>                    <span class="n">parameters</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span>
</span><span id="Model-223"><a href="#Model-223"><span class="linenos">223</span></a>                    <span class="n">precondition</span><span class="o">=</span><span class="n">precond</span><span class="p">,</span>
</span><span id="Model-224"><a href="#Model-224"><span class="linenos">224</span></a>                    <span class="n">effects</span><span class="o">=</span><span class="n">effects</span><span class="p">,</span>
</span><span id="Model-225"><a href="#Model-225"><span class="linenos">225</span></a>                <span class="p">)</span>
</span><span id="Model-226"><a href="#Model-226"><span class="linenos">226</span></a>
</span><span id="Model-227"><a href="#Model-227"><span class="linenos">227</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-228"><a href="#Model-228"><span class="linenos">228</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">land</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Model-229"><a href="#Model-229"><span class="linenos">229</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">iofs</span><span class="o">.</span><span class="n">FstripsWriter</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</span><span id="Model-230"><a href="#Model-230"><span class="linenos">230</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span><span class="p">)</span>
</span><span id="Model-231"><a href="#Model-231"><span class="linenos">231</span></a>
</span><span id="Model-232"><a href="#Model-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">to_pddl_grounded</span><span class="p">(</span>
</span><span id="Model-233"><a href="#Model-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model-234"><a href="#Model-234"><span class="linenos">234</span></a>        <span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-235"><a href="#Model-235"><span class="linenos">235</span></a>        <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-236"><a href="#Model-236"><span class="linenos">236</span></a>        <span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-237"><a href="#Model-237"><span class="linenos">237</span></a>        <span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model-238"><a href="#Model-238"><span class="linenos">238</span></a>    <span class="p">):</span>
</span><span id="Model-239"><a href="#Model-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dumps a Model to two PDDL files. The conversion only uses 0-arity predicates, and no types, objects,</span>
</span><span id="Model-240"><a href="#Model-240"><span class="linenos">240</span></a><span class="sd">        or parameters of any kind are used. Actions are represented as ground actions with no parameters.</span>
</span><span id="Model-241"><a href="#Model-241"><span class="linenos">241</span></a>
</span><span id="Model-242"><a href="#Model-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="Model-243"><a href="#Model-243"><span class="linenos">243</span></a><span class="sd">            domain_name (str):</span>
</span><span id="Model-244"><a href="#Model-244"><span class="linenos">244</span></a><span class="sd">                The name of the domain to be generated.</span>
</span><span id="Model-245"><a href="#Model-245"><span class="linenos">245</span></a><span class="sd">            problem_name (str):</span>
</span><span id="Model-246"><a href="#Model-246"><span class="linenos">246</span></a><span class="sd">                The name of the problem to be generated.</span>
</span><span id="Model-247"><a href="#Model-247"><span class="linenos">247</span></a><span class="sd">            domain_filename (str):</span>
</span><span id="Model-248"><a href="#Model-248"><span class="linenos">248</span></a><span class="sd">                The name of the domain file to be generated.</span>
</span><span id="Model-249"><a href="#Model-249"><span class="linenos">249</span></a><span class="sd">            problem_filename (str):</span>
</span><span id="Model-250"><a href="#Model-250"><span class="linenos">250</span></a><span class="sd">                The name of the problem file to be generated.</span>
</span><span id="Model-251"><a href="#Model-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-252"><a href="#Model-252"><span class="linenos">252</span></a>        <span class="n">lang</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">language</span><span class="p">(</span><span class="n">domain_name</span><span class="p">)</span>
</span><span id="Model-253"><a href="#Model-253"><span class="linenos">253</span></a>        <span class="n">problem</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">fstrips</span><span class="o">.</span><span class="n">create_fstrips_problem</span><span class="p">(</span>
</span><span id="Model-254"><a href="#Model-254"><span class="linenos">254</span></a>            <span class="n">domain_name</span><span class="o">=</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="o">=</span><span class="n">problem_name</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">lang</span>
</span><span id="Model-255"><a href="#Model-255"><span class="linenos">255</span></a>        <span class="p">)</span>
</span><span id="Model-256"><a href="#Model-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model-257"><a href="#Model-257"><span class="linenos">257</span></a>            <span class="c1"># create 0-arity predicates</span>
</span><span id="Model-258"><a href="#Model-258"><span class="linenos">258</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model-259"><a href="#Model-259"><span class="linenos">259</span></a>                <span class="c1"># NOTE: want there to be no brackets in any fluents referenced as tarski adds these later.</span>
</span><span id="Model-260"><a href="#Model-260"><span class="linenos">260</span></a>                <span class="c1"># fluents (their string conversion) must be in the following format: (on object a object b)</span>
</span><span id="Model-261"><a href="#Model-261"><span class="linenos">261</span></a>                <span class="n">test</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Model-262"><a href="#Model-262"><span class="linenos">262</span></a>                <span class="n">lang</span><span class="o">.</span><span class="n">predicate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
</span><span id="Model-263"><a href="#Model-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model-264"><a href="#Model-264"><span class="linenos">264</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model-265"><a href="#Model-265"><span class="linenos">265</span></a>                <span class="c1"># fetch all the relevant 0-arity predicates and create formulas to set up the ground actions</span>
</span><span id="Model-266"><a href="#Model-266"><span class="linenos">266</span></a>                <span class="n">preconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__to_tarski_formula</span><span class="p">({</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">},</span> <span class="n">lang</span><span class="p">)</span>
</span><span id="Model-267"><a href="#Model-267"><span class="linenos">267</span></a>                <span class="n">adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">]</span>
</span><span id="Model-268"><a href="#Model-268"><span class="linenos">268</span></a>                <span class="n">dels</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">delete</span><span class="p">]</span>
</span><span id="Model-269"><a href="#Model-269"><span class="linenos">269</span></a>                <span class="n">effects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="o">.</span><span class="n">AddEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">adds</span><span class="p">]</span>
</span><span id="Model-270"><a href="#Model-270"><span class="linenos">270</span></a>                <span class="n">effects</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">fs</span><span class="o">.</span><span class="n">DelEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dels</span><span class="p">])</span>
</span><span id="Model-271"><a href="#Model-271"><span class="linenos">271</span></a>                <span class="c1"># set up action</span>
</span><span id="Model-272"><a href="#Model-272"><span class="linenos">272</span></a>                <span class="n">problem</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
</span><span id="Model-273"><a href="#Model-273"><span class="linenos">273</span></a>                    <span class="n">name</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
</span><span id="Model-274"><a href="#Model-274"><span class="linenos">274</span></a>                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Model-275"><a href="#Model-275"><span class="linenos">275</span></a>                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Model-276"><a href="#Model-276"><span class="linenos">276</span></a>                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
</span><span id="Model-277"><a href="#Model-277"><span class="linenos">277</span></a>                    <span class="n">parameters</span><span class="o">=</span><span class="p">[],</span>
</span><span id="Model-278"><a href="#Model-278"><span class="linenos">278</span></a>                    <span class="n">precondition</span><span class="o">=</span><span class="n">preconds</span><span class="p">,</span>
</span><span id="Model-279"><a href="#Model-279"><span class="linenos">279</span></a>                    <span class="n">effects</span><span class="o">=</span><span class="n">effects</span><span class="p">,</span>
</span><span id="Model-280"><a href="#Model-280"><span class="linenos">280</span></a>                <span class="p">)</span>
</span><span id="Model-281"><a href="#Model-281"><span class="linenos">281</span></a>        <span class="c1"># create empty init and goal</span>
</span><span id="Model-282"><a href="#Model-282"><span class="linenos">282</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
</span><span id="Model-283"><a href="#Model-283"><span class="linenos">283</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">land</span><span class="p">()</span>
</span><span id="Model-284"><a href="#Model-284"><span class="linenos">284</span></a>        <span class="c1"># write to files</span>
</span><span id="Model-285"><a href="#Model-285"><span class="linenos">285</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">iofs</span><span class="o">.</span><span class="n">FstripsWriter</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</span><span id="Model-286"><a href="#Model-286"><span class="linenos">286</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span><span class="p">)</span>
</span><span id="Model-287"><a href="#Model-287"><span class="linenos">287</span></a>
</span><span id="Model-288"><a href="#Model-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model-289"><a href="#Model-289"><span class="linenos">289</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fluents</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">),</span> <span class="n">actions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">))</span>
</span><span id="Model-290"><a href="#Model-290"><span class="linenos">290</span></a>
</span><span id="Model-291"><a href="#Model-291"><span class="linenos">291</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Model-292"><a href="#Model-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Model-293"><a href="#Model-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deserializes a json string into a Model.</span>
</span><span id="Model-294"><a href="#Model-294"><span class="linenos">294</span></a>
</span><span id="Model-295"><a href="#Model-295"><span class="linenos">295</span></a><span class="sd">        Args:</span>
</span><span id="Model-296"><a href="#Model-296"><span class="linenos">296</span></a><span class="sd">            string (str):</span>
</span><span id="Model-297"><a href="#Model-297"><span class="linenos">297</span></a><span class="sd">                The json string representing a model.</span>
</span><span id="Model-298"><a href="#Model-298"><span class="linenos">298</span></a>
</span><span id="Model-299"><a href="#Model-299"><span class="linenos">299</span></a><span class="sd">        Returns:</span>
</span><span id="Model-300"><a href="#Model-300"><span class="linenos">300</span></a><span class="sd">            A Model object matching the one specified by `string`.</span>
</span><span id="Model-301"><a href="#Model-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-302"><a href="#Model-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="o">.</span><span class="n">_from_json</span><span class="p">(</span><span class="n">loads</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</span><span id="Model-303"><a href="#Model-303"><span class="linenos">303</span></a>
</span><span id="Model-304"><a href="#Model-304"><span class="linenos">304</span></a>    <span class="nd">@classmethod</span>
</span><span id="Model-305"><a href="#Model-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">_from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Model-306"><a href="#Model-306"><span class="linenos">306</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">LearnedAction</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]))</span>
</span><span id="Model-307"><a href="#Model-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fluents&quot;</span><span class="p">]),</span> <span class="n">actions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Action model.</p>

<p>An action model representing a planning domain. The characteristics of the
model are dependent on the extraction technique used to obtain the model.</p>

<p>Attributes:
    fluents (set):
        The set of fluents in the domain.
    actions (set):
        The set of actions in the domain. Actions include their
        preconditions, add effects, and delete effects. The nature of the
        action attributes characterize the model.</p>
</div>


                            <div id="Model.__init__" class="classattr">
                                        <input id="Model.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Model</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedFluent">macq.extract.LearnedFluent</a></span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedFluent">macq.extract.LearnedLiftedFluent</a></span><span class="p">]]</span>,</span><span class="param">	<span class="n">actions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n"><a href="#LearnedLiftedAction">macq.extract.LearnedLiftedAction</a></span><span class="p">]]</span></span>)</span>

                <label class="view-source-button" for="Model.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.__init__-33"><a href="#Model.__init__-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Model.__init__-34"><a href="#Model.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model.__init__-35"><a href="#Model.__init__-35"><span class="linenos">35</span></a>        <span class="n">fluents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">LearnedFluent</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]],</span>
</span><span id="Model.__init__-36"><a href="#Model.__init__-36"><span class="linenos">36</span></a>        <span class="n">actions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedAction</span><span class="p">]],</span>
</span><span id="Model.__init__-37"><a href="#Model.__init__-37"><span class="linenos">37</span></a>    <span class="p">):</span>
</span><span id="Model.__init__-38"><a href="#Model.__init__-38"><span class="linenos">38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes a Model with a set of fluents and a set of actions.</span>
</span><span id="Model.__init__-39"><a href="#Model.__init__-39"><span class="linenos">39</span></a>
</span><span id="Model.__init__-40"><a href="#Model.__init__-40"><span class="linenos">40</span></a><span class="sd">        Args:</span>
</span><span id="Model.__init__-41"><a href="#Model.__init__-41"><span class="linenos">41</span></a><span class="sd">            fluents (Union[Set[LearnedFluent], Set[str]]):</span>
</span><span id="Model.__init__-42"><a href="#Model.__init__-42"><span class="linenos">42</span></a><span class="sd">                The set of fluents in the model.</span>
</span><span id="Model.__init__-43"><a href="#Model.__init__-43"><span class="linenos">43</span></a><span class="sd">            actions (Set[LearnedAction]):</span>
</span><span id="Model.__init__-44"><a href="#Model.__init__-44"><span class="linenos">44</span></a><span class="sd">                The set of actions in the model.</span>
</span><span id="Model.__init__-45"><a href="#Model.__init__-45"><span class="linenos">45</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.__init__-46"><a href="#Model.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span> <span class="o">=</span> <span class="n">fluents</span>
</span><span id="Model.__init__-47"><a href="#Model.__init__-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a Model with a set of fluents and a set of actions.</p>

<p>Args:
    fluents (Union[Set[LearnedFluent], Set[str]]):
        The set of fluents in the model.
    actions (Set[LearnedAction]):
        The set of actions in the model.</p>
</div>


                            </div>
                            <div id="Model.fluents" class="classattr">
                                <div class="attr variable">
            <span class="name">fluents</span>

        
    </div>
    <a class="headerlink" href="#Model.fluents"></a>
    
    

                            </div>
                            <div id="Model.actions" class="classattr">
                                <div class="attr variable">
            <span class="name">actions</span>

        
    </div>
    <a class="headerlink" href="#Model.actions"></a>
    
    

                            </div>
                            <div id="Model.details" class="classattr">
                                        <input id="Model.details-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">details</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.details-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.details"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.details-62"><a href="#Model.details-62"><span class="linenos">62</span></a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model.details-63"><a href="#Model.details-63"><span class="linenos">63</span></a>        <span class="c1"># Set the indent width</span>
</span><span id="Model.details-64"><a href="#Model.details-64"><span class="linenos">64</span></a>        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Model.details-65"><a href="#Model.details-65"><span class="linenos">65</span></a>        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Model:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model.details-66"><a href="#Model.details-66"><span class="linenos">66</span></a>        <span class="c1"># Map fluents to a comma separated string of the fluent names</span>
</span><span id="Model.details-67"><a href="#Model.details-67"><span class="linenos">67</span></a>        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">Fluents: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">))</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model.details-68"><a href="#Model.details-68"><span class="linenos">68</span></a>
</span><span id="Model.details-69"><a href="#Model.details-69"><span class="linenos">69</span></a>        <span class="c1"># Map the actions to a summary of their names, preconditions, add</span>
</span><span id="Model.details-70"><a href="#Model.details-70"><span class="linenos">70</span></a>        <span class="c1"># effects and delete effects</span>
</span><span id="Model.details-71"><a href="#Model.details-71"><span class="linenos">71</span></a>        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">Actions:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model.details-72"><a href="#Model.details-72"><span class="linenos">72</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_details</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
</span><span id="Model.details-73"><a href="#Model.details-73"><span class="linenos">73</span></a>            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Model.details-74"><a href="#Model.details-74"><span class="linenos">74</span></a>        <span class="k">return</span> <span class="n">string</span>
</span></pre></div>


    

                            </div>
                            <div id="Model.serialize" class="classattr">
                                        <input id="Model.serialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">serialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.serialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.serialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.serialize-94"><a href="#Model.serialize-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Model.serialize-95"><a href="#Model.serialize-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Serializes the model into a json string.</span>
</span><span id="Model.serialize-96"><a href="#Model.serialize-96"><span class="linenos"> 96</span></a>
</span><span id="Model.serialize-97"><a href="#Model.serialize-97"><span class="linenos"> 97</span></a><span class="sd">        Args:</span>
</span><span id="Model.serialize-98"><a href="#Model.serialize-98"><span class="linenos"> 98</span></a><span class="sd">            filepath (str):</span>
</span><span id="Model.serialize-99"><a href="#Model.serialize-99"><span class="linenos"> 99</span></a><span class="sd">                Optional; If supplied, the json string will be written to the</span>
</span><span id="Model.serialize-100"><a href="#Model.serialize-100"><span class="linenos">100</span></a><span class="sd">                filepath.</span>
</span><span id="Model.serialize-101"><a href="#Model.serialize-101"><span class="linenos">101</span></a>
</span><span id="Model.serialize-102"><a href="#Model.serialize-102"><span class="linenos">102</span></a><span class="sd">        Returns:</span>
</span><span id="Model.serialize-103"><a href="#Model.serialize-103"><span class="linenos">103</span></a><span class="sd">            A string in json format representing the model.</span>
</span><span id="Model.serialize-104"><a href="#Model.serialize-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.serialize-105"><a href="#Model.serialize-105"><span class="linenos">105</span></a>
</span><span id="Model.serialize-106"><a href="#Model.serialize-106"><span class="linenos">106</span></a>        <span class="n">serial</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">=</span><span class="n">ComplexEncoder</span><span class="p">)</span>
</span><span id="Model.serialize-107"><a href="#Model.serialize-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Model.serialize-108"><a href="#Model.serialize-108"><span class="linenos">108</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="Model.serialize-109"><a href="#Model.serialize-109"><span class="linenos">109</span></a>                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serial</span><span class="p">)</span>
</span><span id="Model.serialize-110"><a href="#Model.serialize-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="n">serial</span>
</span></pre></div>


            <div class="docstring"><p>Serializes the model into a json string.</p>

<p>Args:
    filepath (str):
        Optional; If supplied, the json string will be written to the
        filepath.</p>

<p>Returns:
    A string in json format representing the model.</p>
</div>


                            </div>
                            <div id="Model.to_pddl" class="classattr">
                                        <input id="Model.to_pddl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_pddl</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.to_pddl-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.to_pddl"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.to_pddl-137"><a href="#Model.to_pddl-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">to_pddl</span><span class="p">(</span>
</span><span id="Model.to_pddl-138"><a href="#Model.to_pddl-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model.to_pddl-139"><a href="#Model.to_pddl-139"><span class="linenos">139</span></a>        <span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl-140"><a href="#Model.to_pddl-140"><span class="linenos">140</span></a>        <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Model.to_pddl-141"><a href="#Model.to_pddl-141"><span class="linenos">141</span></a>        <span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Model.to_pddl-142"><a href="#Model.to_pddl-142"><span class="linenos">142</span></a>        <span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Model.to_pddl-143"><a href="#Model.to_pddl-143"><span class="linenos">143</span></a>    <span class="p">):</span>
</span><span id="Model.to_pddl-144"><a href="#Model.to_pddl-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_name</span><span class="p">:</span>
</span><span id="Model.to_pddl-145"><a href="#Model.to_pddl-145"><span class="linenos">145</span></a>            <span class="n">problem_name</span> <span class="o">=</span> <span class="n">domain_name</span> <span class="o">+</span> <span class="s2">&quot;_problem&quot;</span>
</span><span id="Model.to_pddl-146"><a href="#Model.to_pddl-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_filename</span><span class="p">:</span>
</span><span id="Model.to_pddl-147"><a href="#Model.to_pddl-147"><span class="linenos">147</span></a>            <span class="n">domain_filename</span> <span class="o">=</span> <span class="n">domain_name</span> <span class="o">+</span> <span class="s2">&quot;.pddl&quot;</span>
</span><span id="Model.to_pddl-148"><a href="#Model.to_pddl-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_filename</span><span class="p">:</span>
</span><span id="Model.to_pddl-149"><a href="#Model.to_pddl-149"><span class="linenos">149</span></a>            <span class="n">problem_filename</span> <span class="o">=</span> <span class="n">problem_name</span> <span class="o">+</span> <span class="s2">&quot;.pddl&quot;</span>
</span><span id="Model.to_pddl-150"><a href="#Model.to_pddl-150"><span class="linenos">150</span></a>
</span><span id="Model.to_pddl-151"><a href="#Model.to_pddl-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LearnedLiftedAction</span><span class="p">):</span>
</span><span id="Model.to_pddl-152"><a href="#Model.to_pddl-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">to_pddl_lifted</span><span class="p">(</span>
</span><span id="Model.to_pddl-153"><a href="#Model.to_pddl-153"><span class="linenos">153</span></a>                <span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="p">,</span> <span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span>
</span><span id="Model.to_pddl-154"><a href="#Model.to_pddl-154"><span class="linenos">154</span></a>            <span class="p">)</span>
</span><span id="Model.to_pddl-155"><a href="#Model.to_pddl-155"><span class="linenos">155</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LearnedAction</span><span class="p">):</span>
</span><span id="Model.to_pddl-156"><a href="#Model.to_pddl-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">to_pddl_grounded</span><span class="p">(</span>
</span><span id="Model.to_pddl-157"><a href="#Model.to_pddl-157"><span class="linenos">157</span></a>                <span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="p">,</span> <span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span>
</span><span id="Model.to_pddl-158"><a href="#Model.to_pddl-158"><span class="linenos">158</span></a>            <span class="p">)</span>
</span><span id="Model.to_pddl-159"><a href="#Model.to_pddl-159"><span class="linenos">159</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Model.to_pddl-160"><a href="#Model.to_pddl-160"><span class="linenos">160</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Model.to_pddl-161"><a href="#Model.to_pddl-161"><span class="linenos">161</span></a>                <span class="sa">f</span><span class="s2">&quot;Could not determine whether the model is grounded or lifted. Fluents are of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> while actions are of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Model.to_pddl-162"><a href="#Model.to_pddl-162"><span class="linenos">162</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Model.to_pddl_lifted" class="classattr">
                                        <input id="Model.to_pddl_lifted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_pddl_lifted</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.to_pddl_lifted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.to_pddl_lifted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.to_pddl_lifted-164"><a href="#Model.to_pddl_lifted-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">to_pddl_lifted</span><span class="p">(</span>
</span><span id="Model.to_pddl_lifted-165"><a href="#Model.to_pddl_lifted-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-166"><a href="#Model.to_pddl_lifted-166"><span class="linenos">166</span></a>        <span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-167"><a href="#Model.to_pddl_lifted-167"><span class="linenos">167</span></a>        <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-168"><a href="#Model.to_pddl_lifted-168"><span class="linenos">168</span></a>        <span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-169"><a href="#Model.to_pddl_lifted-169"><span class="linenos">169</span></a>        <span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-170"><a href="#Model.to_pddl_lifted-170"><span class="linenos">170</span></a>    <span class="p">):</span>
</span><span id="Model.to_pddl_lifted-171"><a href="#Model.to_pddl_lifted-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dumps a Model with typed lifted actions &amp; fluents to PDDL files.</span>
</span><span id="Model.to_pddl_lifted-172"><a href="#Model.to_pddl_lifted-172"><span class="linenos">172</span></a>
</span><span id="Model.to_pddl_lifted-173"><a href="#Model.to_pddl_lifted-173"><span class="linenos">173</span></a><span class="sd">        Args:</span>
</span><span id="Model.to_pddl_lifted-174"><a href="#Model.to_pddl_lifted-174"><span class="linenos">174</span></a><span class="sd">            domain_name (str):</span>
</span><span id="Model.to_pddl_lifted-175"><a href="#Model.to_pddl_lifted-175"><span class="linenos">175</span></a><span class="sd">                The name of the domain to be generated.</span>
</span><span id="Model.to_pddl_lifted-176"><a href="#Model.to_pddl_lifted-176"><span class="linenos">176</span></a><span class="sd">            problem_name (str):</span>
</span><span id="Model.to_pddl_lifted-177"><a href="#Model.to_pddl_lifted-177"><span class="linenos">177</span></a><span class="sd">                The name of the problem to be generated.</span>
</span><span id="Model.to_pddl_lifted-178"><a href="#Model.to_pddl_lifted-178"><span class="linenos">178</span></a><span class="sd">            domain_filename (str):</span>
</span><span id="Model.to_pddl_lifted-179"><a href="#Model.to_pddl_lifted-179"><span class="linenos">179</span></a><span class="sd">                The name of the domain file to be generated.</span>
</span><span id="Model.to_pddl_lifted-180"><a href="#Model.to_pddl_lifted-180"><span class="linenos">180</span></a><span class="sd">            problem_filename (str):</span>
</span><span id="Model.to_pddl_lifted-181"><a href="#Model.to_pddl_lifted-181"><span class="linenos">181</span></a><span class="sd">                The name of the problem file to be generated.</span>
</span><span id="Model.to_pddl_lifted-182"><a href="#Model.to_pddl_lifted-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.to_pddl_lifted-183"><a href="#Model.to_pddl_lifted-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">]</span>
</span><span id="Model.to_pddl_lifted-184"><a href="#Model.to_pddl_lifted-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedAction</span><span class="p">]</span>
</span><span id="Model.to_pddl_lifted-185"><a href="#Model.to_pddl_lifted-185"><span class="linenos">185</span></a>
</span><span id="Model.to_pddl_lifted-186"><a href="#Model.to_pddl_lifted-186"><span class="linenos">186</span></a>        <span class="n">lang</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">language</span><span class="p">(</span><span class="n">domain_name</span><span class="p">)</span>
</span><span id="Model.to_pddl_lifted-187"><a href="#Model.to_pddl_lifted-187"><span class="linenos">187</span></a>        <span class="n">problem</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">fstrips</span><span class="o">.</span><span class="n">create_fstrips_problem</span><span class="p">(</span>
</span><span id="Model.to_pddl_lifted-188"><a href="#Model.to_pddl_lifted-188"><span class="linenos">188</span></a>            <span class="n">domain_name</span><span class="o">=</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="o">=</span><span class="n">problem_name</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">lang</span>
</span><span id="Model.to_pddl_lifted-189"><a href="#Model.to_pddl_lifted-189"><span class="linenos">189</span></a>        <span class="p">)</span>
</span><span id="Model.to_pddl_lifted-190"><a href="#Model.to_pddl_lifted-190"><span class="linenos">190</span></a>        <span class="n">sorts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Model.to_pddl_lifted-191"><a href="#Model.to_pddl_lifted-191"><span class="linenos">191</span></a>
</span><span id="Model.to_pddl_lifted-192"><a href="#Model.to_pddl_lifted-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-193"><a href="#Model.to_pddl_lifted-193"><span class="linenos">193</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-194"><a href="#Model.to_pddl_lifted-194"><span class="linenos">194</span></a>                <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-195"><a href="#Model.to_pddl_lifted-195"><span class="linenos">195</span></a>                    <span class="k">if</span> <span class="n">sort</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sorts</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-196"><a href="#Model.to_pddl_lifted-196"><span class="linenos">196</span></a>                        <span class="n">lang</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
</span><span id="Model.to_pddl_lifted-197"><a href="#Model.to_pddl_lifted-197"><span class="linenos">197</span></a>                        <span class="n">sorts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
</span><span id="Model.to_pddl_lifted-198"><a href="#Model.to_pddl_lifted-198"><span class="linenos">198</span></a>
</span><span id="Model.to_pddl_lifted-199"><a href="#Model.to_pddl_lifted-199"><span class="linenos">199</span></a>                <span class="n">lang</span><span class="o">.</span><span class="n">predicate</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)</span>
</span><span id="Model.to_pddl_lifted-200"><a href="#Model.to_pddl_lifted-200"><span class="linenos">200</span></a>
</span><span id="Model.to_pddl_lifted-201"><a href="#Model.to_pddl_lifted-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-202"><a href="#Model.to_pddl_lifted-202"><span class="linenos">202</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-203"><a href="#Model.to_pddl_lifted-203"><span class="linenos">203</span></a>                <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">)]</span>
</span><span id="Model.to_pddl_lifted-204"><a href="#Model.to_pddl_lifted-204"><span class="linenos">204</span></a>
</span><span id="Model.to_pddl_lifted-205"><a href="#Model.to_pddl_lifted-205"><span class="linenos">205</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-206"><a href="#Model.to_pddl_lifted-206"><span class="linenos">206</span></a>                    <span class="n">precond</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
</span><span id="Model.to_pddl_lifted-207"><a href="#Model.to_pddl_lifted-207"><span class="linenos">207</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Model.to_pddl_lifted-208"><a href="#Model.to_pddl_lifted-208"><span class="linenos">208</span></a>                    <span class="n">precond</span> <span class="o">=</span> <span class="n">CompoundFormula</span><span class="p">(</span>
</span><span id="Model.to_pddl_lifted-209"><a href="#Model.to_pddl_lifted-209"><span class="linenos">209</span></a>                        <span class="n">Connective</span><span class="o">.</span><span class="n">And</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-210"><a href="#Model.to_pddl_lifted-210"><span class="linenos">210</span></a>                        <span class="p">[</span>
</span><span id="Model.to_pddl_lifted-211"><a href="#Model.to_pddl_lifted-211"><span class="linenos">211</span></a>                            <span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
</span><span id="Model.to_pddl_lifted-212"><a href="#Model.to_pddl_lifted-212"><span class="linenos">212</span></a>                            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">precond</span>
</span><span id="Model.to_pddl_lifted-213"><a href="#Model.to_pddl_lifted-213"><span class="linenos">213</span></a>                        <span class="p">],</span>
</span><span id="Model.to_pddl_lifted-214"><a href="#Model.to_pddl_lifted-214"><span class="linenos">214</span></a>                    <span class="p">)</span>
</span><span id="Model.to_pddl_lifted-215"><a href="#Model.to_pddl_lifted-215"><span class="linenos">215</span></a>
</span><span id="Model.to_pddl_lifted-216"><a href="#Model.to_pddl_lifted-216"><span class="linenos">216</span></a>                <span class="n">adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Model.to_pddl_lifted-217"><a href="#Model.to_pddl_lifted-217"><span class="linenos">217</span></a>                <span class="n">dels</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">param_act_inds</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">delete</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Model.to_pddl_lifted-218"><a href="#Model.to_pddl_lifted-218"><span class="linenos">218</span></a>                <span class="n">effects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="o">.</span><span class="n">AddEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">adds</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">fs</span><span class="o">.</span><span class="n">DelEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dels</span><span class="p">]</span>  <span class="c1"># fmt: skip</span>
</span><span id="Model.to_pddl_lifted-219"><a href="#Model.to_pddl_lifted-219"><span class="linenos">219</span></a>
</span><span id="Model.to_pddl_lifted-220"><a href="#Model.to_pddl_lifted-220"><span class="linenos">220</span></a>                <span class="n">problem</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
</span><span id="Model.to_pddl_lifted-221"><a href="#Model.to_pddl_lifted-221"><span class="linenos">221</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-222"><a href="#Model.to_pddl_lifted-222"><span class="linenos">222</span></a>                    <span class="n">parameters</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-223"><a href="#Model.to_pddl_lifted-223"><span class="linenos">223</span></a>                    <span class="n">precondition</span><span class="o">=</span><span class="n">precond</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-224"><a href="#Model.to_pddl_lifted-224"><span class="linenos">224</span></a>                    <span class="n">effects</span><span class="o">=</span><span class="n">effects</span><span class="p">,</span>
</span><span id="Model.to_pddl_lifted-225"><a href="#Model.to_pddl_lifted-225"><span class="linenos">225</span></a>                <span class="p">)</span>
</span><span id="Model.to_pddl_lifted-226"><a href="#Model.to_pddl_lifted-226"><span class="linenos">226</span></a>
</span><span id="Model.to_pddl_lifted-227"><a href="#Model.to_pddl_lifted-227"><span class="linenos">227</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Model.to_pddl_lifted-228"><a href="#Model.to_pddl_lifted-228"><span class="linenos">228</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">land</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Model.to_pddl_lifted-229"><a href="#Model.to_pddl_lifted-229"><span class="linenos">229</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">iofs</span><span class="o">.</span><span class="n">FstripsWriter</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</span><span id="Model.to_pddl_lifted-230"><a href="#Model.to_pddl_lifted-230"><span class="linenos">230</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Dumps a Model with typed lifted actions &amp; fluents to PDDL files.</p>

<p>Args:
    domain_name (str):
        The name of the domain to be generated.
    problem_name (str):
        The name of the problem to be generated.
    domain_filename (str):
        The name of the domain file to be generated.
    problem_filename (str):
        The name of the problem file to be generated.</p>
</div>


                            </div>
                            <div id="Model.to_pddl_grounded" class="classattr">
                                        <input id="Model.to_pddl_grounded-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_pddl_grounded</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.to_pddl_grounded-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.to_pddl_grounded"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.to_pddl_grounded-232"><a href="#Model.to_pddl_grounded-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">to_pddl_grounded</span><span class="p">(</span>
</span><span id="Model.to_pddl_grounded-233"><a href="#Model.to_pddl_grounded-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-234"><a href="#Model.to_pddl_grounded-234"><span class="linenos">234</span></a>        <span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-235"><a href="#Model.to_pddl_grounded-235"><span class="linenos">235</span></a>        <span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-236"><a href="#Model.to_pddl_grounded-236"><span class="linenos">236</span></a>        <span class="n">domain_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-237"><a href="#Model.to_pddl_grounded-237"><span class="linenos">237</span></a>        <span class="n">problem_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-238"><a href="#Model.to_pddl_grounded-238"><span class="linenos">238</span></a>    <span class="p">):</span>
</span><span id="Model.to_pddl_grounded-239"><a href="#Model.to_pddl_grounded-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dumps a Model to two PDDL files. The conversion only uses 0-arity predicates, and no types, objects,</span>
</span><span id="Model.to_pddl_grounded-240"><a href="#Model.to_pddl_grounded-240"><span class="linenos">240</span></a><span class="sd">        or parameters of any kind are used. Actions are represented as ground actions with no parameters.</span>
</span><span id="Model.to_pddl_grounded-241"><a href="#Model.to_pddl_grounded-241"><span class="linenos">241</span></a>
</span><span id="Model.to_pddl_grounded-242"><a href="#Model.to_pddl_grounded-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="Model.to_pddl_grounded-243"><a href="#Model.to_pddl_grounded-243"><span class="linenos">243</span></a><span class="sd">            domain_name (str):</span>
</span><span id="Model.to_pddl_grounded-244"><a href="#Model.to_pddl_grounded-244"><span class="linenos">244</span></a><span class="sd">                The name of the domain to be generated.</span>
</span><span id="Model.to_pddl_grounded-245"><a href="#Model.to_pddl_grounded-245"><span class="linenos">245</span></a><span class="sd">            problem_name (str):</span>
</span><span id="Model.to_pddl_grounded-246"><a href="#Model.to_pddl_grounded-246"><span class="linenos">246</span></a><span class="sd">                The name of the problem to be generated.</span>
</span><span id="Model.to_pddl_grounded-247"><a href="#Model.to_pddl_grounded-247"><span class="linenos">247</span></a><span class="sd">            domain_filename (str):</span>
</span><span id="Model.to_pddl_grounded-248"><a href="#Model.to_pddl_grounded-248"><span class="linenos">248</span></a><span class="sd">                The name of the domain file to be generated.</span>
</span><span id="Model.to_pddl_grounded-249"><a href="#Model.to_pddl_grounded-249"><span class="linenos">249</span></a><span class="sd">            problem_filename (str):</span>
</span><span id="Model.to_pddl_grounded-250"><a href="#Model.to_pddl_grounded-250"><span class="linenos">250</span></a><span class="sd">                The name of the problem file to be generated.</span>
</span><span id="Model.to_pddl_grounded-251"><a href="#Model.to_pddl_grounded-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.to_pddl_grounded-252"><a href="#Model.to_pddl_grounded-252"><span class="linenos">252</span></a>        <span class="n">lang</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">language</span><span class="p">(</span><span class="n">domain_name</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-253"><a href="#Model.to_pddl_grounded-253"><span class="linenos">253</span></a>        <span class="n">problem</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">fstrips</span><span class="o">.</span><span class="n">create_fstrips_problem</span><span class="p">(</span>
</span><span id="Model.to_pddl_grounded-254"><a href="#Model.to_pddl_grounded-254"><span class="linenos">254</span></a>            <span class="n">domain_name</span><span class="o">=</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">problem_name</span><span class="o">=</span><span class="n">problem_name</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">lang</span>
</span><span id="Model.to_pddl_grounded-255"><a href="#Model.to_pddl_grounded-255"><span class="linenos">255</span></a>        <span class="p">)</span>
</span><span id="Model.to_pddl_grounded-256"><a href="#Model.to_pddl_grounded-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model.to_pddl_grounded-257"><a href="#Model.to_pddl_grounded-257"><span class="linenos">257</span></a>            <span class="c1"># create 0-arity predicates</span>
</span><span id="Model.to_pddl_grounded-258"><a href="#Model.to_pddl_grounded-258"><span class="linenos">258</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluents</span><span class="p">:</span>
</span><span id="Model.to_pddl_grounded-259"><a href="#Model.to_pddl_grounded-259"><span class="linenos">259</span></a>                <span class="c1"># NOTE: want there to be no brackets in any fluents referenced as tarski adds these later.</span>
</span><span id="Model.to_pddl_grounded-260"><a href="#Model.to_pddl_grounded-260"><span class="linenos">260</span></a>                <span class="c1"># fluents (their string conversion) must be in the following format: (on object a object b)</span>
</span><span id="Model.to_pddl_grounded-261"><a href="#Model.to_pddl_grounded-261"><span class="linenos">261</span></a>                <span class="n">test</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-262"><a href="#Model.to_pddl_grounded-262"><span class="linenos">262</span></a>                <span class="n">lang</span><span class="o">.</span><span class="n">predicate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
</span><span id="Model.to_pddl_grounded-263"><a href="#Model.to_pddl_grounded-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model.to_pddl_grounded-264"><a href="#Model.to_pddl_grounded-264"><span class="linenos">264</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Model.to_pddl_grounded-265"><a href="#Model.to_pddl_grounded-265"><span class="linenos">265</span></a>                <span class="c1"># fetch all the relevant 0-arity predicates and create formulas to set up the ground actions</span>
</span><span id="Model.to_pddl_grounded-266"><a href="#Model.to_pddl_grounded-266"><span class="linenos">266</span></a>                <span class="n">preconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__to_tarski_formula</span><span class="p">({</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">precond</span><span class="p">},</span> <span class="n">lang</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-267"><a href="#Model.to_pddl_grounded-267"><span class="linenos">267</span></a>                <span class="n">adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">]</span>
</span><span id="Model.to_pddl_grounded-268"><a href="#Model.to_pddl_grounded-268"><span class="linenos">268</span></a>                <span class="n">dels</span> <span class="o">=</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">delete</span><span class="p">]</span>
</span><span id="Model.to_pddl_grounded-269"><a href="#Model.to_pddl_grounded-269"><span class="linenos">269</span></a>                <span class="n">effects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="o">.</span><span class="n">AddEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">adds</span><span class="p">]</span>
</span><span id="Model.to_pddl_grounded-270"><a href="#Model.to_pddl_grounded-270"><span class="linenos">270</span></a>                <span class="n">effects</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">fs</span><span class="o">.</span><span class="n">DelEffect</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dels</span><span class="p">])</span>
</span><span id="Model.to_pddl_grounded-271"><a href="#Model.to_pddl_grounded-271"><span class="linenos">271</span></a>                <span class="c1"># set up action</span>
</span><span id="Model.to_pddl_grounded-272"><a href="#Model.to_pddl_grounded-272"><span class="linenos">272</span></a>                <span class="n">problem</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
</span><span id="Model.to_pddl_grounded-273"><a href="#Model.to_pddl_grounded-273"><span class="linenos">273</span></a>                    <span class="n">name</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
</span><span id="Model.to_pddl_grounded-274"><a href="#Model.to_pddl_grounded-274"><span class="linenos">274</span></a>                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-275"><a href="#Model.to_pddl_grounded-275"><span class="linenos">275</span></a>                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-276"><a href="#Model.to_pddl_grounded-276"><span class="linenos">276</span></a>                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
</span><span id="Model.to_pddl_grounded-277"><a href="#Model.to_pddl_grounded-277"><span class="linenos">277</span></a>                    <span class="n">parameters</span><span class="o">=</span><span class="p">[],</span>
</span><span id="Model.to_pddl_grounded-278"><a href="#Model.to_pddl_grounded-278"><span class="linenos">278</span></a>                    <span class="n">precondition</span><span class="o">=</span><span class="n">preconds</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-279"><a href="#Model.to_pddl_grounded-279"><span class="linenos">279</span></a>                    <span class="n">effects</span><span class="o">=</span><span class="n">effects</span><span class="p">,</span>
</span><span id="Model.to_pddl_grounded-280"><a href="#Model.to_pddl_grounded-280"><span class="linenos">280</span></a>                <span class="p">)</span>
</span><span id="Model.to_pddl_grounded-281"><a href="#Model.to_pddl_grounded-281"><span class="linenos">281</span></a>        <span class="c1"># create empty init and goal</span>
</span><span id="Model.to_pddl_grounded-282"><a href="#Model.to_pddl_grounded-282"><span class="linenos">282</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">tarski</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-283"><a href="#Model.to_pddl_grounded-283"><span class="linenos">283</span></a>        <span class="n">problem</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">land</span><span class="p">()</span>
</span><span id="Model.to_pddl_grounded-284"><a href="#Model.to_pddl_grounded-284"><span class="linenos">284</span></a>        <span class="c1"># write to files</span>
</span><span id="Model.to_pddl_grounded-285"><a href="#Model.to_pddl_grounded-285"><span class="linenos">285</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">iofs</span><span class="o">.</span><span class="n">FstripsWriter</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</span><span id="Model.to_pddl_grounded-286"><a href="#Model.to_pddl_grounded-286"><span class="linenos">286</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">domain_filename</span><span class="p">,</span> <span class="n">problem_filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Dumps a Model to two PDDL files. The conversion only uses 0-arity predicates, and no types, objects,
or parameters of any kind are used. Actions are represented as ground actions with no parameters.</p>

<p>Args:
    domain_name (str):
        The name of the domain to be generated.
    problem_name (str):
        The name of the problem to be generated.
    domain_filename (str):
        The name of the domain file to be generated.
    problem_filename (str):
        The name of the problem file to be generated.</p>
</div>


                            </div>
                            <div id="Model.deserialize" class="classattr">
                                        <input id="Model.deserialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">deserialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">string</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.deserialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.deserialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.deserialize-291"><a href="#Model.deserialize-291"><span class="linenos">291</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Model.deserialize-292"><a href="#Model.deserialize-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Model.deserialize-293"><a href="#Model.deserialize-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deserializes a json string into a Model.</span>
</span><span id="Model.deserialize-294"><a href="#Model.deserialize-294"><span class="linenos">294</span></a>
</span><span id="Model.deserialize-295"><a href="#Model.deserialize-295"><span class="linenos">295</span></a><span class="sd">        Args:</span>
</span><span id="Model.deserialize-296"><a href="#Model.deserialize-296"><span class="linenos">296</span></a><span class="sd">            string (str):</span>
</span><span id="Model.deserialize-297"><a href="#Model.deserialize-297"><span class="linenos">297</span></a><span class="sd">                The json string representing a model.</span>
</span><span id="Model.deserialize-298"><a href="#Model.deserialize-298"><span class="linenos">298</span></a>
</span><span id="Model.deserialize-299"><a href="#Model.deserialize-299"><span class="linenos">299</span></a><span class="sd">        Returns:</span>
</span><span id="Model.deserialize-300"><a href="#Model.deserialize-300"><span class="linenos">300</span></a><span class="sd">            A Model object matching the one specified by `string`.</span>
</span><span id="Model.deserialize-301"><a href="#Model.deserialize-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.deserialize-302"><a href="#Model.deserialize-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="o">.</span><span class="n">_from_json</span><span class="p">(</span><span class="n">loads</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Deserializes a json string into a Model.</p>

<p>Args:
    string (str):
        The json string representing a model.</p>

<p>Returns:
    A Model object matching the one specified by <code>string</code>.</p>
</div>


                            </div>
                </section>
                <section id="Extract">
                            <input id="Extract-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Extract</span>:

                <label class="view-source-button" for="Extract-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Extract"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Extract-38"><a href="#Extract-38"><span class="linenos">38</span></a><span class="k">class</span> <span class="nc">Extract</span><span class="p">:</span>
</span><span id="Extract-39"><a href="#Extract-39"><span class="linenos">39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts models from observations.</span>
</span><span id="Extract-40"><a href="#Extract-40"><span class="linenos">40</span></a>
</span><span id="Extract-41"><a href="#Extract-41"><span class="linenos">41</span></a><span class="sd">    The Extract class uses an extraction method to retrieve an action Model</span>
</span><span id="Extract-42"><a href="#Extract-42"><span class="linenos">42</span></a><span class="sd">    from state observations.</span>
</span><span id="Extract-43"><a href="#Extract-43"><span class="linenos">43</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Extract-44"><a href="#Extract-44"><span class="linenos">44</span></a>
</span><span id="Extract-45"><a href="#Extract-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Extract-46"><a href="#Extract-46"><span class="linenos">46</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="Extract-47"><a href="#Extract-47"><span class="linenos">47</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="Extract-48"><a href="#Extract-48"><span class="linenos">48</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">modes</span><span class="p">,</span>
</span><span id="Extract-49"><a href="#Extract-49"><span class="linenos">49</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Extract-50"><a href="#Extract-50"><span class="linenos">50</span></a>        <span class="o">**</span><span class="n">kwargs</span>
</span><span id="Extract-51"><a href="#Extract-51"><span class="linenos">51</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
</span><span id="Extract-52"><a href="#Extract-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts a Model object.</span>
</span><span id="Extract-53"><a href="#Extract-53"><span class="linenos">53</span></a>
</span><span id="Extract-54"><a href="#Extract-54"><span class="linenos">54</span></a><span class="sd">        Extracts a model from the observations using the specified extraction</span>
</span><span id="Extract-55"><a href="#Extract-55"><span class="linenos">55</span></a><span class="sd">        technique.</span>
</span><span id="Extract-56"><a href="#Extract-56"><span class="linenos">56</span></a>
</span><span id="Extract-57"><a href="#Extract-57"><span class="linenos">57</span></a><span class="sd">        Args:</span>
</span><span id="Extract-58"><a href="#Extract-58"><span class="linenos">58</span></a><span class="sd">            obs_tracelist (ObservationList):</span>
</span><span id="Extract-59"><a href="#Extract-59"><span class="linenos">59</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="Extract-60"><a href="#Extract-60"><span class="linenos">60</span></a><span class="sd">            mode (Enum):</span>
</span><span id="Extract-61"><a href="#Extract-61"><span class="linenos">61</span></a><span class="sd">                The extraction technique to use.</span>
</span><span id="Extract-62"><a href="#Extract-62"><span class="linenos">62</span></a><span class="sd">            debug (bool, dict, list):</span>
</span><span id="Extract-63"><a href="#Extract-63"><span class="linenos">63</span></a><span class="sd">                Model specific debugging options. Either a boolean, or a list/dict indicating the functions to debug.</span>
</span><span id="Extract-64"><a href="#Extract-64"><span class="linenos">64</span></a><span class="sd">            **kwargs: (keyword arguments)</span>
</span><span id="Extract-65"><a href="#Extract-65"><span class="linenos">65</span></a><span class="sd">                Any extra arguments to supply to the extraction technique.</span>
</span><span id="Extract-66"><a href="#Extract-66"><span class="linenos">66</span></a>
</span><span id="Extract-67"><a href="#Extract-67"><span class="linenos">67</span></a><span class="sd">        Returns:</span>
</span><span id="Extract-68"><a href="#Extract-68"><span class="linenos">68</span></a><span class="sd">            A Model object. The model&#39;s characteristics are determined by the</span>
</span><span id="Extract-69"><a href="#Extract-69"><span class="linenos">69</span></a><span class="sd">            extraction technique used.</span>
</span><span id="Extract-70"><a href="#Extract-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Extract-71"><a href="#Extract-71"><span class="linenos">71</span></a>
</span><span id="Extract-72"><a href="#Extract-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Extract-73"><a href="#Extract-73"><span class="linenos">73</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ObservationList is empty. Nothing to extract from.&quot;</span><span class="p">)</span>
</span><span id="Extract-74"><a href="#Extract-74"><span class="linenos">74</span></a>
</span><span id="Extract-75"><a href="#Extract-75"><span class="linenos">75</span></a>        <span class="n">techniques</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Extract-76"><a href="#Extract-76"><span class="linenos">76</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">OBSERVER</span><span class="p">:</span> <span class="n">Observer</span><span class="p">,</span>
</span><span id="Extract-77"><a href="#Extract-77"><span class="linenos">77</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">SLAF</span><span class="p">:</span> <span class="n">SLAF</span><span class="p">,</span>
</span><span id="Extract-78"><a href="#Extract-78"><span class="linenos">78</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">AMDN</span><span class="p">:</span> <span class="n">AMDN</span><span class="p">,</span>
</span><span id="Extract-79"><a href="#Extract-79"><span class="linenos">79</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">ARMS</span><span class="p">:</span> <span class="n">ARMS</span><span class="p">,</span>
</span><span id="Extract-80"><a href="#Extract-80"><span class="linenos">80</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">LOCM</span><span class="p">:</span> <span class="n">LOCM</span><span class="p">,</span>
</span><span id="Extract-81"><a href="#Extract-81"><span class="linenos">81</span></a>        <span class="p">}</span>
</span><span id="Extract-82"><a href="#Extract-82"><span class="linenos">82</span></a>        <span class="k">return</span> <span class="n">techniques</span><span class="p">[</span><span class="n">mode</span><span class="p">](</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts models from observations.</p>

<p>The Extract class uses an extraction method to retrieve an action Model
from state observations.</p>
</div>


                            <div id="Extract.__init__" class="classattr">
                                        <input id="Extract.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Extract</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n"><a href="#modes">macq.extract.modes</a></span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="Extract.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Extract.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Extract.__init__-45"><a href="#Extract.__init__-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Extract.__init__-46"><a href="#Extract.__init__-46"><span class="linenos">46</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="Extract.__init__-47"><a href="#Extract.__init__-47"><span class="linenos">47</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="Extract.__init__-48"><a href="#Extract.__init__-48"><span class="linenos">48</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">modes</span><span class="p">,</span>
</span><span id="Extract.__init__-49"><a href="#Extract.__init__-49"><span class="linenos">49</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Extract.__init__-50"><a href="#Extract.__init__-50"><span class="linenos">50</span></a>        <span class="o">**</span><span class="n">kwargs</span>
</span><span id="Extract.__init__-51"><a href="#Extract.__init__-51"><span class="linenos">51</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
</span><span id="Extract.__init__-52"><a href="#Extract.__init__-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts a Model object.</span>
</span><span id="Extract.__init__-53"><a href="#Extract.__init__-53"><span class="linenos">53</span></a>
</span><span id="Extract.__init__-54"><a href="#Extract.__init__-54"><span class="linenos">54</span></a><span class="sd">        Extracts a model from the observations using the specified extraction</span>
</span><span id="Extract.__init__-55"><a href="#Extract.__init__-55"><span class="linenos">55</span></a><span class="sd">        technique.</span>
</span><span id="Extract.__init__-56"><a href="#Extract.__init__-56"><span class="linenos">56</span></a>
</span><span id="Extract.__init__-57"><a href="#Extract.__init__-57"><span class="linenos">57</span></a><span class="sd">        Args:</span>
</span><span id="Extract.__init__-58"><a href="#Extract.__init__-58"><span class="linenos">58</span></a><span class="sd">            obs_tracelist (ObservationList):</span>
</span><span id="Extract.__init__-59"><a href="#Extract.__init__-59"><span class="linenos">59</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="Extract.__init__-60"><a href="#Extract.__init__-60"><span class="linenos">60</span></a><span class="sd">            mode (Enum):</span>
</span><span id="Extract.__init__-61"><a href="#Extract.__init__-61"><span class="linenos">61</span></a><span class="sd">                The extraction technique to use.</span>
</span><span id="Extract.__init__-62"><a href="#Extract.__init__-62"><span class="linenos">62</span></a><span class="sd">            debug (bool, dict, list):</span>
</span><span id="Extract.__init__-63"><a href="#Extract.__init__-63"><span class="linenos">63</span></a><span class="sd">                Model specific debugging options. Either a boolean, or a list/dict indicating the functions to debug.</span>
</span><span id="Extract.__init__-64"><a href="#Extract.__init__-64"><span class="linenos">64</span></a><span class="sd">            **kwargs: (keyword arguments)</span>
</span><span id="Extract.__init__-65"><a href="#Extract.__init__-65"><span class="linenos">65</span></a><span class="sd">                Any extra arguments to supply to the extraction technique.</span>
</span><span id="Extract.__init__-66"><a href="#Extract.__init__-66"><span class="linenos">66</span></a>
</span><span id="Extract.__init__-67"><a href="#Extract.__init__-67"><span class="linenos">67</span></a><span class="sd">        Returns:</span>
</span><span id="Extract.__init__-68"><a href="#Extract.__init__-68"><span class="linenos">68</span></a><span class="sd">            A Model object. The model&#39;s characteristics are determined by the</span>
</span><span id="Extract.__init__-69"><a href="#Extract.__init__-69"><span class="linenos">69</span></a><span class="sd">            extraction technique used.</span>
</span><span id="Extract.__init__-70"><a href="#Extract.__init__-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Extract.__init__-71"><a href="#Extract.__init__-71"><span class="linenos">71</span></a>
</span><span id="Extract.__init__-72"><a href="#Extract.__init__-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Extract.__init__-73"><a href="#Extract.__init__-73"><span class="linenos">73</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ObservationList is empty. Nothing to extract from.&quot;</span><span class="p">)</span>
</span><span id="Extract.__init__-74"><a href="#Extract.__init__-74"><span class="linenos">74</span></a>
</span><span id="Extract.__init__-75"><a href="#Extract.__init__-75"><span class="linenos">75</span></a>        <span class="n">techniques</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Extract.__init__-76"><a href="#Extract.__init__-76"><span class="linenos">76</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">OBSERVER</span><span class="p">:</span> <span class="n">Observer</span><span class="p">,</span>
</span><span id="Extract.__init__-77"><a href="#Extract.__init__-77"><span class="linenos">77</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">SLAF</span><span class="p">:</span> <span class="n">SLAF</span><span class="p">,</span>
</span><span id="Extract.__init__-78"><a href="#Extract.__init__-78"><span class="linenos">78</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">AMDN</span><span class="p">:</span> <span class="n">AMDN</span><span class="p">,</span>
</span><span id="Extract.__init__-79"><a href="#Extract.__init__-79"><span class="linenos">79</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">ARMS</span><span class="p">:</span> <span class="n">ARMS</span><span class="p">,</span>
</span><span id="Extract.__init__-80"><a href="#Extract.__init__-80"><span class="linenos">80</span></a>            <span class="n">modes</span><span class="o">.</span><span class="n">LOCM</span><span class="p">:</span> <span class="n">LOCM</span><span class="p">,</span>
</span><span id="Extract.__init__-81"><a href="#Extract.__init__-81"><span class="linenos">81</span></a>        <span class="p">}</span>
</span><span id="Extract.__init__-82"><a href="#Extract.__init__-82"><span class="linenos">82</span></a>        <span class="k">return</span> <span class="n">techniques</span><span class="p">[</span><span class="n">mode</span><span class="p">](</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts a Model object.</p>

<p>Extracts a model from the observations using the specified extraction
technique.</p>

<p>Args:
    obs_tracelist (ObservationList):
        The state observations to extract the model from.
    mode (Enum):
        The extraction technique to use.
    debug (bool, dict, list):
        Model specific debugging options. Either a boolean, or a list/dict indicating the functions to debug.
    **kwargs: (keyword arguments)
        Any extra arguments to supply to the extraction technique.</p>

<p>Returns:
    A Model object. The model's characteristics are determined by the
    extraction technique used.</p>
</div>


                            </div>
                </section>
                <section id="modes">
                            <input id="modes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">modes</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="modes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#modes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="modes-25"><a href="#modes-25"><span class="linenos">25</span></a><span class="k">class</span> <span class="nc">modes</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="modes-26"><a href="#modes-26"><span class="linenos">26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Model extraction techniques.</span>
</span><span id="modes-27"><a href="#modes-27"><span class="linenos">27</span></a>
</span><span id="modes-28"><a href="#modes-28"><span class="linenos">28</span></a><span class="sd">    An Enum where each value represents a model extraction technique.</span>
</span><span id="modes-29"><a href="#modes-29"><span class="linenos">29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="modes-30"><a href="#modes-30"><span class="linenos">30</span></a>
</span><span id="modes-31"><a href="#modes-31"><span class="linenos">31</span></a>    <span class="n">OBSERVER</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="modes-32"><a href="#modes-32"><span class="linenos">32</span></a>    <span class="n">SLAF</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="modes-33"><a href="#modes-33"><span class="linenos">33</span></a>    <span class="n">AMDN</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="modes-34"><a href="#modes-34"><span class="linenos">34</span></a>    <span class="n">ARMS</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="modes-35"><a href="#modes-35"><span class="linenos">35</span></a>    <span class="n">LOCM</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Model extraction techniques.</p>

<p>An Enum where each value represents a model extraction technique.</p>
</div>


                            <div id="modes.OBSERVER" class="classattr">
                                <div class="attr variable">
            <span class="name">OBSERVER</span>        =
<span class="default_value">&lt;<a href="#modes.OBSERVER">modes.OBSERVER</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#modes.OBSERVER"></a>
    
    

                            </div>
                            <div id="modes.SLAF" class="classattr">
                                <div class="attr variable">
            <span class="name">SLAF</span>        =
<span class="default_value">&lt;<a href="#modes.SLAF">modes.SLAF</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#modes.SLAF"></a>
    
    

                            </div>
                            <div id="modes.AMDN" class="classattr">
                                <div class="attr variable">
            <span class="name">AMDN</span>        =
<span class="default_value">&lt;<a href="#modes.AMDN">modes.AMDN</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#modes.AMDN"></a>
    
    

                            </div>
                            <div id="modes.ARMS" class="classattr">
                                <div class="attr variable">
            <span class="name">ARMS</span>        =
<span class="default_value">&lt;<a href="#modes.ARMS">modes.ARMS</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#modes.ARMS"></a>
    
    

                            </div>
                            <div id="modes.LOCM" class="classattr">
                                <div class="attr variable">
            <span class="name">LOCM</span>        =
<span class="default_value">&lt;<a href="#modes.LOCM">modes.LOCM</a>: 5&gt;</span>

        
    </div>
    <a class="headerlink" href="#modes.LOCM"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="modes.name" class="variable">name</dd>
                <dd id="modes.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IncompatibleObservationToken">
                            <input id="IncompatibleObservationToken-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IncompatibleObservationToken</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="IncompatibleObservationToken-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IncompatibleObservationToken"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IncompatibleObservationToken-2"><a href="#IncompatibleObservationToken-2"><span class="linenos">2</span></a><span class="k">class</span> <span class="nc">IncompatibleObservationToken</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="IncompatibleObservationToken-3"><a href="#IncompatibleObservationToken-3"><span class="linenos">3</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">technique</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="IncompatibleObservationToken-4"><a href="#IncompatibleObservationToken-4"><span class="linenos">4</span></a>        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="IncompatibleObservationToken-5"><a href="#IncompatibleObservationToken-5"><span class="linenos">5</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Observations of type </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> are not compatible with the </span><span class="si">{</span><span class="n">technique</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> extraction technique.&quot;</span>
</span><span id="IncompatibleObservationToken-6"><a href="#IncompatibleObservationToken-6"><span class="linenos">6</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div id="IncompatibleObservationToken.__init__" class="classattr">
                                        <input id="IncompatibleObservationToken.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">IncompatibleObservationToken</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">token</span>, </span><span class="param"><span class="n">technique</span>, </span><span class="param"><span class="n">message</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="IncompatibleObservationToken.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IncompatibleObservationToken.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IncompatibleObservationToken.__init__-3"><a href="#IncompatibleObservationToken.__init__-3"><span class="linenos">3</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">technique</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="IncompatibleObservationToken.__init__-4"><a href="#IncompatibleObservationToken.__init__-4"><span class="linenos">4</span></a>        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="IncompatibleObservationToken.__init__-5"><a href="#IncompatibleObservationToken.__init__-5"><span class="linenos">5</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Observations of type </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> are not compatible with the </span><span class="si">{</span><span class="n">technique</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> extraction technique.&quot;</span>
</span><span id="IncompatibleObservationToken.__init__-6"><a href="#IncompatibleObservationToken.__init__-6"><span class="linenos">6</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="IncompatibleObservationToken.with_traceback" class="function">with_traceback</dd>
                <dd id="IncompatibleObservationToken.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ARMS">
                            <input id="ARMS-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ARMS</span>:

                <label class="view-source-button" for="ARMS-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS-53"><a href="#ARMS-53"><span class="linenos"> 53</span></a><span class="k">class</span> <span class="nc">ARMS</span><span class="p">:</span>
</span><span id="ARMS-54"><a href="#ARMS-54"><span class="linenos"> 54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ARMS model extraction method.</span>
</span><span id="ARMS-55"><a href="#ARMS-55"><span class="linenos"> 55</span></a>
</span><span id="ARMS-56"><a href="#ARMS-56"><span class="linenos"> 56</span></a><span class="sd">    Extracts a Model from state observations using the ARMS technique. Fluents</span>
</span><span id="ARMS-57"><a href="#ARMS-57"><span class="linenos"> 57</span></a><span class="sd">    are retrieved from the initial state. Actions are learned using the</span>
</span><span id="ARMS-58"><a href="#ARMS-58"><span class="linenos"> 58</span></a><span class="sd">    algorithm.</span>
</span><span id="ARMS-59"><a href="#ARMS-59"><span class="linenos"> 59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ARMS-60"><a href="#ARMS-60"><span class="linenos"> 60</span></a>
</span><span id="ARMS-61"><a href="#ARMS-61"><span class="linenos"> 61</span></a>    <span class="k">class</span> <span class="nc">InvalidThreshold</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="ARMS-62"><a href="#ARMS-62"><span class="linenos"> 62</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="ARMS-63"><a href="#ARMS-63"><span class="linenos"> 63</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ARMS-64"><a href="#ARMS-64"><span class="linenos"> 64</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid threshold value: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">. Threshold must be a float between 0-1 (inclusive).&quot;</span>
</span><span id="ARMS-65"><a href="#ARMS-65"><span class="linenos"> 65</span></a>            <span class="p">)</span>
</span><span id="ARMS-66"><a href="#ARMS-66"><span class="linenos"> 66</span></a>
</span><span id="ARMS-67"><a href="#ARMS-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="ARMS-68"><a href="#ARMS-68"><span class="linenos"> 68</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ARMS-69"><a href="#ARMS-69"><span class="linenos"> 69</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS-70"><a href="#ARMS-70"><span class="linenos"> 70</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-71"><a href="#ARMS-71"><span class="linenos"> 71</span></a>        <span class="n">upper_bound</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-72"><a href="#ARMS-72"><span class="linenos"> 72</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ARMS-73"><a href="#ARMS-73"><span class="linenos"> 73</span></a>        <span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>
</span><span id="ARMS-74"><a href="#ARMS-74"><span class="linenos"> 74</span></a>        <span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="ARMS-75"><a href="#ARMS-75"><span class="linenos"> 75</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="ARMS-76"><a href="#ARMS-76"><span class="linenos"> 76</span></a>        <span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="ARMS-77"><a href="#ARMS-77"><span class="linenos"> 77</span></a>        <span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="ARMS-78"><a href="#ARMS-78"><span class="linenos"> 78</span></a>    <span class="p">):</span>
</span><span id="ARMS-79"><a href="#ARMS-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ARMS-80"><a href="#ARMS-80"><span class="linenos"> 80</span></a><span class="sd">        Arguments:</span>
</span><span id="ARMS-81"><a href="#ARMS-81"><span class="linenos"> 81</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="ARMS-82"><a href="#ARMS-82"><span class="linenos"> 82</span></a><span class="sd">                The observations to extract the model from.</span>
</span><span id="ARMS-83"><a href="#ARMS-83"><span class="linenos"> 83</span></a><span class="sd">            upper_bound (int):</span>
</span><span id="ARMS-84"><a href="#ARMS-84"><span class="linenos"> 84</span></a><span class="sd">                The upper bound for the maximum size of an action&#39;s preconditions and</span>
</span><span id="ARMS-85"><a href="#ARMS-85"><span class="linenos"> 85</span></a><span class="sd">                add/delete lists. Determines when an action schemata is fully learned.</span>
</span><span id="ARMS-86"><a href="#ARMS-86"><span class="linenos"> 86</span></a><span class="sd">            min_support (int):</span>
</span><span id="ARMS-87"><a href="#ARMS-87"><span class="linenos"> 87</span></a><span class="sd">                The minimum support count for an action pair to be considered frequent.</span>
</span><span id="ARMS-88"><a href="#ARMS-88"><span class="linenos"> 88</span></a><span class="sd">            action_weight (int):</span>
</span><span id="ARMS-89"><a href="#ARMS-89"><span class="linenos"> 89</span></a><span class="sd">                The constant weight W_A(a) to assign to each action constraint.</span>
</span><span id="ARMS-90"><a href="#ARMS-90"><span class="linenos"> 90</span></a><span class="sd">                Should be set higher than the weight of information constraints.</span>
</span><span id="ARMS-91"><a href="#ARMS-91"><span class="linenos"> 91</span></a><span class="sd">            info_weight (int):</span>
</span><span id="ARMS-92"><a href="#ARMS-92"><span class="linenos"> 92</span></a><span class="sd">                The constant weight W_I(r) to assign to each information constraint.</span>
</span><span id="ARMS-93"><a href="#ARMS-93"><span class="linenos"> 93</span></a><span class="sd">                Determined empirically, generally the highest in all constraints&#39; weights.</span>
</span><span id="ARMS-94"><a href="#ARMS-94"><span class="linenos"> 94</span></a><span class="sd">            threshold (float):</span>
</span><span id="ARMS-95"><a href="#ARMS-95"><span class="linenos"> 95</span></a><span class="sd">                (0-1). The probability threshold  to determine if an I3/plan constraint</span>
</span><span id="ARMS-96"><a href="#ARMS-96"><span class="linenos"> 96</span></a><span class="sd">                is weighted by its probability or set to a default value.</span>
</span><span id="ARMS-97"><a href="#ARMS-97"><span class="linenos"> 97</span></a><span class="sd">            info3_default (int):</span>
</span><span id="ARMS-98"><a href="#ARMS-98"><span class="linenos"> 98</span></a><span class="sd">                The default weight for I3 constraints with probability below the threshold.</span>
</span><span id="ARMS-99"><a href="#ARMS-99"><span class="linenos"> 99</span></a><span class="sd">            plan_default (int):</span>
</span><span id="ARMS-100"><a href="#ARMS-100"><span class="linenos">100</span></a><span class="sd">                The default weight for plan constraints with probability below the threshold.</span>
</span><span id="ARMS-101"><a href="#ARMS-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS-102"><a href="#ARMS-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">PartialObservation</span><span class="p">:</span>
</span><span id="ARMS-103"><a href="#ARMS-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">ARMS</span><span class="p">)</span>
</span><span id="ARMS-104"><a href="#ARMS-104"><span class="linenos">104</span></a>
</span><span id="ARMS-105"><a href="#ARMS-105"><span class="linenos">105</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="ARMS-106"><a href="#ARMS-106"><span class="linenos">106</span></a>            <span class="k">raise</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">InvalidThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="ARMS-107"><a href="#ARMS-107"><span class="linenos">107</span></a>
</span><span id="ARMS-108"><a href="#ARMS-108"><span class="linenos">108</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">get_fluents</span><span class="p">()</span>
</span><span id="ARMS-109"><a href="#ARMS-109"><span class="linenos">109</span></a>        <span class="c1"># get fluents from initial state</span>
</span><span id="ARMS-110"><a href="#ARMS-110"><span class="linenos">110</span></a>        <span class="c1"># call algorithm to get actions</span>
</span><span id="ARMS-111"><a href="#ARMS-111"><span class="linenos">111</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_arms</span><span class="p">(</span>
</span><span id="ARMS-112"><a href="#ARMS-112"><span class="linenos">112</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span>
</span><span id="ARMS-113"><a href="#ARMS-113"><span class="linenos">113</span></a>            <span class="n">upper_bound</span><span class="p">,</span>
</span><span id="ARMS-114"><a href="#ARMS-114"><span class="linenos">114</span></a>            <span class="n">fluents</span><span class="p">,</span>
</span><span id="ARMS-115"><a href="#ARMS-115"><span class="linenos">115</span></a>            <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS-116"><a href="#ARMS-116"><span class="linenos">116</span></a>            <span class="n">action_weight</span><span class="p">,</span>
</span><span id="ARMS-117"><a href="#ARMS-117"><span class="linenos">117</span></a>            <span class="n">info_weight</span><span class="p">,</span>
</span><span id="ARMS-118"><a href="#ARMS-118"><span class="linenos">118</span></a>            <span class="n">threshold</span><span class="p">,</span>
</span><span id="ARMS-119"><a href="#ARMS-119"><span class="linenos">119</span></a>            <span class="n">info3_default</span><span class="p">,</span>
</span><span id="ARMS-120"><a href="#ARMS-120"><span class="linenos">120</span></a>            <span class="n">plan_default</span><span class="p">,</span>
</span><span id="ARMS-121"><a href="#ARMS-121"><span class="linenos">121</span></a>            <span class="n">debug</span><span class="p">,</span>
</span><span id="ARMS-122"><a href="#ARMS-122"><span class="linenos">122</span></a>        <span class="p">)</span>
</span><span id="ARMS-123"><a href="#ARMS-123"><span class="linenos">123</span></a>
</span><span id="ARMS-124"><a href="#ARMS-124"><span class="linenos">124</span></a>        <span class="c1"># learned_fluents = set(map(lambda f: LearnedFluent(f.name, f.objects), fluents))</span>
</span><span id="ARMS-125"><a href="#ARMS-125"><span class="linenos">125</span></a>        <span class="n">learned_fluents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS-126"><a href="#ARMS-126"><span class="linenos">126</span></a>        <span class="c1"># format</span>
</span><span id="ARMS-127"><a href="#ARMS-127"><span class="linenos">127</span></a>        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
</span><span id="ARMS-128"><a href="#ARMS-128"><span class="linenos">128</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">precond</span><span class="p">}</span>
</span><span id="ARMS-129"><a href="#ARMS-129"><span class="linenos">129</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">add</span><span class="p">}</span>
</span><span id="ARMS-130"><a href="#ARMS-130"><span class="linenos">130</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">delete</span><span class="p">}</span>
</span><span id="ARMS-131"><a href="#ARMS-131"><span class="linenos">131</span></a>            <span class="n">learned_fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span>
</span><span id="ARMS-132"><a href="#ARMS-132"><span class="linenos">132</span></a>            <span class="n">learned_fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="ARMS-133"><a href="#ARMS-133"><span class="linenos">133</span></a>            <span class="n">learned_fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
</span><span id="ARMS-134"><a href="#ARMS-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">learned_fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span><span id="ARMS-135"><a href="#ARMS-135"><span class="linenos">135</span></a>
</span><span id="ARMS-136"><a href="#ARMS-136"><span class="linenos">136</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-137"><a href="#ARMS-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">_arms</span><span class="p">(</span>
</span><span id="ARMS-138"><a href="#ARMS-138"><span class="linenos">138</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS-139"><a href="#ARMS-139"><span class="linenos">139</span></a>        <span class="n">upper_bound</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-140"><a href="#ARMS-140"><span class="linenos">140</span></a>        <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Fluent</span><span class="p">],</span>
</span><span id="ARMS-141"><a href="#ARMS-141"><span class="linenos">141</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-142"><a href="#ARMS-142"><span class="linenos">142</span></a>        <span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-143"><a href="#ARMS-143"><span class="linenos">143</span></a>        <span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-144"><a href="#ARMS-144"><span class="linenos">144</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="ARMS-145"><a href="#ARMS-145"><span class="linenos">145</span></a>        <span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-146"><a href="#ARMS-146"><span class="linenos">146</span></a>        <span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-147"><a href="#ARMS-147"><span class="linenos">147</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-148"><a href="#ARMS-148"><span class="linenos">148</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">]:</span>
</span><span id="ARMS-149"><a href="#ARMS-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The main driver for the ARMS algorithm.&quot;&quot;&quot;</span>
</span><span id="ARMS-150"><a href="#ARMS-150"><span class="linenos">150</span></a>        <span class="n">learned_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># The set of learned action models </span>
</span><span id="ARMS-151"><a href="#ARMS-151"><span class="linenos">151</span></a>        <span class="c1"># pointers to the earliest unlearned action for each observation list</span>
</span><span id="ARMS-152"><a href="#ARMS-152"><span class="linenos">152</span></a>        <span class="n">early_actions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="ARMS-153"><a href="#ARMS-153"><span class="linenos">153</span></a>
</span><span id="ARMS-154"><a href="#ARMS-154"><span class="linenos">154</span></a>        <span class="n">debug1</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug step 1?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-155"><a href="#ARMS-155"><span class="linenos">155</span></a>        <span class="n">connected_actions</span><span class="p">,</span> <span class="n">action_map</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step1</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">debug1</span><span class="p">)</span>
</span><span id="ARMS-156"><a href="#ARMS-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">debug1</span><span class="p">:</span>
</span><span id="ARMS-157"><a href="#ARMS-157"><span class="linenos">157</span></a>            <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to continue...&quot;</span><span class="p">)</span>
</span><span id="ARMS-158"><a href="#ARMS-158"><span class="linenos">158</span></a>
</span><span id="ARMS-159"><a href="#ARMS-159"><span class="linenos">159</span></a>        <span class="n">action_map_rev</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Action</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="ARMS-160"><a href="#ARMS-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">obs_action</span><span class="p">,</span> <span class="n">learned_action</span> <span class="ow">in</span> <span class="n">action_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ARMS-161"><a href="#ARMS-161"><span class="linenos">161</span></a>            <span class="n">action_map_rev</span><span class="p">[</span><span class="n">learned_action</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs_action</span><span class="p">)</span>
</span><span id="ARMS-162"><a href="#ARMS-162"><span class="linenos">162</span></a>
</span><span id="ARMS-163"><a href="#ARMS-163"><span class="linenos">163</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ARMS-164"><a href="#ARMS-164"><span class="linenos">164</span></a>        <span class="k">while</span> <span class="n">action_map_rev</span><span class="p">:</span>
</span><span id="ARMS-165"><a href="#ARMS-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-166"><a href="#ARMS-166"><span class="linenos">166</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="ARMS-167"><a href="#ARMS-167"><span class="linenos">167</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS-168"><a href="#ARMS-168"><span class="linenos">168</span></a>
</span><span id="ARMS-169"><a href="#ARMS-169"><span class="linenos">169</span></a>            <span class="n">debug2</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug step 2?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-170"><a href="#ARMS-170"><span class="linenos">170</span></a>            <span class="n">constraints</span><span class="p">,</span> <span class="n">relation_map</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2</span><span class="p">(</span>
</span><span id="ARMS-171"><a href="#ARMS-171"><span class="linenos">171</span></a>                <span class="n">obs_tracelist</span><span class="p">,</span>
</span><span id="ARMS-172"><a href="#ARMS-172"><span class="linenos">172</span></a>                <span class="n">connected_actions</span><span class="p">,</span>
</span><span id="ARMS-173"><a href="#ARMS-173"><span class="linenos">173</span></a>                <span class="n">action_map</span><span class="p">,</span>
</span><span id="ARMS-174"><a href="#ARMS-174"><span class="linenos">174</span></a>                <span class="n">fluents</span><span class="p">,</span>
</span><span id="ARMS-175"><a href="#ARMS-175"><span class="linenos">175</span></a>                <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS-176"><a href="#ARMS-176"><span class="linenos">176</span></a>                <span class="n">debug2</span><span class="p">,</span>
</span><span id="ARMS-177"><a href="#ARMS-177"><span class="linenos">177</span></a>            <span class="p">)</span>
</span><span id="ARMS-178"><a href="#ARMS-178"><span class="linenos">178</span></a>            <span class="k">if</span> <span class="n">debug2</span><span class="p">:</span>
</span><span id="ARMS-179"><a href="#ARMS-179"><span class="linenos">179</span></a>                <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to continue...&quot;</span><span class="p">)</span>
</span><span id="ARMS-180"><a href="#ARMS-180"><span class="linenos">180</span></a>
</span><span id="ARMS-181"><a href="#ARMS-181"><span class="linenos">181</span></a>            <span class="n">relation_map_rev</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Relation</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Fluent</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="ARMS-182"><a href="#ARMS-182"><span class="linenos">182</span></a>            <span class="k">for</span> <span class="n">fluent</span><span class="p">,</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">relation_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ARMS-183"><a href="#ARMS-183"><span class="linenos">183</span></a>                <span class="n">relation_map_rev</span><span class="p">[</span><span class="n">relation</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluent</span><span class="p">)</span>
</span><span id="ARMS-184"><a href="#ARMS-184"><span class="linenos">184</span></a>
</span><span id="ARMS-185"><a href="#ARMS-185"><span class="linenos">185</span></a>            <span class="n">debug3</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug step 3?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-186"><a href="#ARMS-186"><span class="linenos">186</span></a>            <span class="n">max_sat</span><span class="p">,</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step3</span><span class="p">(</span>
</span><span id="ARMS-187"><a href="#ARMS-187"><span class="linenos">187</span></a>                <span class="n">constraints</span><span class="p">,</span>
</span><span id="ARMS-188"><a href="#ARMS-188"><span class="linenos">188</span></a>                <span class="n">action_weight</span><span class="p">,</span>
</span><span id="ARMS-189"><a href="#ARMS-189"><span class="linenos">189</span></a>                <span class="n">info_weight</span><span class="p">,</span>
</span><span id="ARMS-190"><a href="#ARMS-190"><span class="linenos">190</span></a>                <span class="n">threshold</span><span class="p">,</span>
</span><span id="ARMS-191"><a href="#ARMS-191"><span class="linenos">191</span></a>                <span class="n">info3_default</span><span class="p">,</span>
</span><span id="ARMS-192"><a href="#ARMS-192"><span class="linenos">192</span></a>                <span class="n">plan_default</span><span class="p">,</span>
</span><span id="ARMS-193"><a href="#ARMS-193"><span class="linenos">193</span></a>                <span class="n">debug3</span><span class="p">,</span>
</span><span id="ARMS-194"><a href="#ARMS-194"><span class="linenos">194</span></a>            <span class="p">)</span>
</span><span id="ARMS-195"><a href="#ARMS-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="n">debug3</span><span class="p">:</span>
</span><span id="ARMS-196"><a href="#ARMS-196"><span class="linenos">196</span></a>                <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to continue...&quot;</span><span class="p">)</span>
</span><span id="ARMS-197"><a href="#ARMS-197"><span class="linenos">197</span></a>
</span><span id="ARMS-198"><a href="#ARMS-198"><span class="linenos">198</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step4</span><span class="p">(</span><span class="n">max_sat</span><span class="p">,</span> <span class="n">decode</span><span class="p">)</span>
</span><span id="ARMS-199"><a href="#ARMS-199"><span class="linenos">199</span></a>
</span><span id="ARMS-200"><a href="#ARMS-200"><span class="linenos">200</span></a>            <span class="n">debug5</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug step 5?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-201"><a href="#ARMS-201"><span class="linenos">201</span></a>            <span class="c1"># Mutates the LearnedAction (keys) of action_map_rev</span>
</span><span id="ARMS-202"><a href="#ARMS-202"><span class="linenos">202</span></a>            <span class="n">ARMS</span><span class="o">.</span><span class="n">step5</span><span class="p">(</span>
</span><span id="ARMS-203"><a href="#ARMS-203"><span class="linenos">203</span></a>                <span class="n">model</span><span class="p">,</span>
</span><span id="ARMS-204"><a href="#ARMS-204"><span class="linenos">204</span></a>                <span class="nb">list</span><span class="p">(</span><span class="n">action_map_rev</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
</span><span id="ARMS-205"><a href="#ARMS-205"><span class="linenos">205</span></a>                <span class="n">debug5</span><span class="p">,</span>
</span><span id="ARMS-206"><a href="#ARMS-206"><span class="linenos">206</span></a>            <span class="p">)</span>
</span><span id="ARMS-207"><a href="#ARMS-207"><span class="linenos">207</span></a>
</span><span id="ARMS-208"><a href="#ARMS-208"><span class="linenos">208</span></a>            <span class="c1"># Step 5 updates</span>
</span><span id="ARMS-209"><a href="#ARMS-209"><span class="linenos">209</span></a>
</span><span id="ARMS-210"><a href="#ARMS-210"><span class="linenos">210</span></a>            <span class="c1"># Progress observed states if early actions have been learned</span>
</span><span id="ARMS-211"><a href="#ARMS-211"><span class="linenos">211</span></a>            <span class="n">setA</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS-212"><a href="#ARMS-212"><span class="linenos">212</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">action_map_rev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ARMS-213"><a href="#ARMS-213"><span class="linenos">213</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">):</span>
</span><span id="ARMS-214"><a href="#ARMS-214"><span class="linenos">214</span></a>                    <span class="n">obs_action</span><span class="p">:</span> <span class="n">Action</span> <span class="o">=</span> <span class="n">obs_trace</span><span class="p">[</span><span class="n">early_actions</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">action</span>
</span><span id="ARMS-215"><a href="#ARMS-215"><span class="linenos">215</span></a>                    <span class="c1"># if current action is the early action for obs_trace i,</span>
</span><span id="ARMS-216"><a href="#ARMS-216"><span class="linenos">216</span></a>                    <span class="c1"># update the next state with the effects and update the</span>
</span><span id="ARMS-217"><a href="#ARMS-217"><span class="linenos">217</span></a>                    <span class="c1"># early action pointer</span>
</span><span id="ARMS-218"><a href="#ARMS-218"><span class="linenos">218</span></a>                    <span class="k">if</span> <span class="n">obs_action</span> <span class="ow">in</span> <span class="n">action_map</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">action_map</span><span class="p">[</span><span class="n">obs_action</span><span class="p">]:</span>
</span><span id="ARMS-219"><a href="#ARMS-219"><span class="linenos">219</span></a>                        <span class="nb">print</span><span class="p">()</span>
</span><span id="ARMS-220"><a href="#ARMS-220"><span class="linenos">220</span></a>                        <span class="c1"># Set add effects true</span>
</span><span id="ARMS-221"><a href="#ARMS-221"><span class="linenos">221</span></a>                        <span class="k">for</span> <span class="n">add</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
</span><span id="ARMS-222"><a href="#ARMS-222"><span class="linenos">222</span></a>                            <span class="c1"># get candidate fluents from add relation</span>
</span><span id="ARMS-223"><a href="#ARMS-223"><span class="linenos">223</span></a>                            <span class="c1"># get fluent by cross referencing obs_trace.action params</span>
</span><span id="ARMS-224"><a href="#ARMS-224"><span class="linenos">224</span></a>                            <span class="n">candidates</span> <span class="o">=</span> <span class="n">relation_map_rev</span><span class="p">[</span><span class="n">add</span><span class="p">]</span>
</span><span id="ARMS-225"><a href="#ARMS-225"><span class="linenos">225</span></a>                            <span class="k">for</span> <span class="n">fluent</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
</span><span id="ARMS-226"><a href="#ARMS-226"><span class="linenos">226</span></a>                                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">fluent</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">obs_action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">):</span>
</span><span id="ARMS-227"><a href="#ARMS-227"><span class="linenos">227</span></a>                                    <span class="n">obs_trace</span><span class="p">[</span><span class="n">early_actions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">fluent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ARMS-228"><a href="#ARMS-228"><span class="linenos">228</span></a>                                    <span class="n">early_actions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS-229"><a href="#ARMS-229"><span class="linenos">229</span></a>                        <span class="c1"># Set del effects false</span>
</span><span id="ARMS-230"><a href="#ARMS-230"><span class="linenos">230</span></a>                        <span class="k">for</span> <span class="n">delete</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span>
</span><span id="ARMS-231"><a href="#ARMS-231"><span class="linenos">231</span></a>                            <span class="n">candidates</span> <span class="o">=</span> <span class="n">relation_map_rev</span><span class="p">[</span><span class="n">delete</span><span class="p">]</span>
</span><span id="ARMS-232"><a href="#ARMS-232"><span class="linenos">232</span></a>                            <span class="k">for</span> <span class="n">fluent</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
</span><span id="ARMS-233"><a href="#ARMS-233"><span class="linenos">233</span></a>                                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">fluent</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">obs_action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">):</span>
</span><span id="ARMS-234"><a href="#ARMS-234"><span class="linenos">234</span></a>                                    <span class="n">obs_trace</span><span class="p">[</span><span class="n">early_actions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">[</span>
</span><span id="ARMS-235"><a href="#ARMS-235"><span class="linenos">235</span></a>                                        <span class="n">fluent</span>
</span><span id="ARMS-236"><a href="#ARMS-236"><span class="linenos">236</span></a>                                    <span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ARMS-237"><a href="#ARMS-237"><span class="linenos">237</span></a>                                    <span class="n">early_actions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS-238"><a href="#ARMS-238"><span class="linenos">238</span></a>
</span><span id="ARMS-239"><a href="#ARMS-239"><span class="linenos">239</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-240"><a href="#ARMS-240"><span class="linenos">240</span></a>                    <span class="nb">print</span><span class="p">()</span>
</span><span id="ARMS-241"><a href="#ARMS-241"><span class="linenos">241</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">())</span>
</span><span id="ARMS-242"><a href="#ARMS-242"><span class="linenos">242</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;precond:&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span>
</span><span id="ARMS-243"><a href="#ARMS-243"><span class="linenos">243</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;add:&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="ARMS-244"><a href="#ARMS-244"><span class="linenos">244</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;delete:&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
</span><span id="ARMS-245"><a href="#ARMS-245"><span class="linenos">245</span></a>
</span><span id="ARMS-246"><a href="#ARMS-246"><span class="linenos">246</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="ARMS-247"><a href="#ARMS-247"><span class="linenos">247</span></a>                    <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">precond</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">add</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">delete</span><span class="p">)])</span>
</span><span id="ARMS-248"><a href="#ARMS-248"><span class="linenos">248</span></a>                    <span class="o">&gt;=</span> <span class="n">upper_bound</span>
</span><span id="ARMS-249"><a href="#ARMS-249"><span class="linenos">249</span></a>                <span class="p">):</span>
</span><span id="ARMS-250"><a href="#ARMS-250"><span class="linenos">250</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-251"><a href="#ARMS-251"><span class="linenos">251</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-252"><a href="#ARMS-252"><span class="linenos">252</span></a>                            <span class="sa">f</span><span class="s2">&quot;Action schemata for </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> has been fully learned.&quot;</span>
</span><span id="ARMS-253"><a href="#ARMS-253"><span class="linenos">253</span></a>                        <span class="p">)</span>
</span><span id="ARMS-254"><a href="#ARMS-254"><span class="linenos">254</span></a>                    <span class="n">setA</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="ARMS-255"><a href="#ARMS-255"><span class="linenos">255</span></a>
</span><span id="ARMS-256"><a href="#ARMS-256"><span class="linenos">256</span></a>            <span class="c1"># Update  by   A</span>
</span><span id="ARMS-257"><a href="#ARMS-257"><span class="linenos">257</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">setA</span><span class="p">:</span>
</span><span id="ARMS-258"><a href="#ARMS-258"><span class="linenos">258</span></a>                <span class="n">action_keys</span> <span class="o">=</span> <span class="n">action_map_rev</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS-259"><a href="#ARMS-259"><span class="linenos">259</span></a>                <span class="k">for</span> <span class="n">obs_action</span> <span class="ow">in</span> <span class="n">action_keys</span><span class="p">:</span>
</span><span id="ARMS-260"><a href="#ARMS-260"><span class="linenos">260</span></a>                    <span class="k">del</span> <span class="n">action_map</span><span class="p">[</span><span class="n">obs_action</span><span class="p">]</span>
</span><span id="ARMS-261"><a href="#ARMS-261"><span class="linenos">261</span></a>                <span class="k">del</span> <span class="n">action_map_rev</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS-262"><a href="#ARMS-262"><span class="linenos">262</span></a>                <span class="k">del</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS-263"><a href="#ARMS-263"><span class="linenos">263</span></a>                <span class="n">action_keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ARMS-264"><a href="#ARMS-264"><span class="linenos">264</span></a>                    <span class="n">a1</span> <span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">connected_actions</span> <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span>
</span><span id="ARMS-265"><a href="#ARMS-265"><span class="linenos">265</span></a>                <span class="p">]</span>
</span><span id="ARMS-266"><a href="#ARMS-266"><span class="linenos">266</span></a>                <span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">action_keys</span><span class="p">:</span>
</span><span id="ARMS-267"><a href="#ARMS-267"><span class="linenos">267</span></a>                    <span class="k">del</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">a1</span><span class="p">][</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS-268"><a href="#ARMS-268"><span class="linenos">268</span></a>
</span><span id="ARMS-269"><a href="#ARMS-269"><span class="linenos">269</span></a>                <span class="c1"># Update  by adding A</span>
</span><span id="ARMS-270"><a href="#ARMS-270"><span class="linenos">270</span></a>                <span class="n">learned_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="ARMS-271"><a href="#ARMS-271"><span class="linenos">271</span></a>
</span><span id="ARMS-272"><a href="#ARMS-272"><span class="linenos">272</span></a>            <span class="k">if</span> <span class="n">debug5</span><span class="p">:</span>
</span><span id="ARMS-273"><a href="#ARMS-273"><span class="linenos">273</span></a>                <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to continue...&quot;</span><span class="p">)</span>
</span><span id="ARMS-274"><a href="#ARMS-274"><span class="linenos">274</span></a>
</span><span id="ARMS-275"><a href="#ARMS-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="n">learned_actions</span>
</span><span id="ARMS-276"><a href="#ARMS-276"><span class="linenos">276</span></a>
</span><span id="ARMS-277"><a href="#ARMS-277"><span class="linenos">277</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-278"><a href="#ARMS-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">step1</span><span class="p">(</span>
</span><span id="ARMS-279"><a href="#ARMS-279"><span class="linenos">279</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="ARMS-280"><a href="#ARMS-280"><span class="linenos">280</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
</span><span id="ARMS-281"><a href="#ARMS-281"><span class="linenos">281</span></a>        <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
</span><span id="ARMS-282"><a href="#ARMS-282"><span class="linenos">282</span></a>        <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS-283"><a href="#ARMS-283"><span class="linenos">283</span></a>    <span class="p">]:</span>
</span><span id="ARMS-284"><a href="#ARMS-284"><span class="linenos">284</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 1) Substitute instantiated objects in each action instance with the object type.&quot;&quot;&quot;</span>
</span><span id="ARMS-285"><a href="#ARMS-285"><span class="linenos">285</span></a>
</span><span id="ARMS-286"><a href="#ARMS-286"><span class="linenos">286</span></a>        <span class="n">learned_actions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS-287"><a href="#ARMS-287"><span class="linenos">287</span></a>        <span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS-288"><a href="#ARMS-288"><span class="linenos">288</span></a>        <span class="k">for</span> <span class="n">obs_action</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">get_actions</span><span class="p">():</span>
</span><span id="ARMS-289"><a href="#ARMS-289"><span class="linenos">289</span></a>            <span class="c1"># We don&#39;t support objects with multiple types right now, so no</span>
</span><span id="ARMS-290"><a href="#ARMS-290"><span class="linenos">290</span></a>            <span class="c1"># multiple type clauses need to be generated.</span>
</span><span id="ARMS-291"><a href="#ARMS-291"><span class="linenos">291</span></a>
</span><span id="ARMS-292"><a href="#ARMS-292"><span class="linenos">292</span></a>            <span class="c1"># Create LearnedActions for each action, replacing instantiated</span>
</span><span id="ARMS-293"><a href="#ARMS-293"><span class="linenos">293</span></a>            <span class="c1"># objects with the object type.</span>
</span><span id="ARMS-294"><a href="#ARMS-294"><span class="linenos">294</span></a>            <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">obj_type</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">obs_action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">]</span>
</span><span id="ARMS-295"><a href="#ARMS-295"><span class="linenos">295</span></a>            <span class="n">learned_action</span> <span class="o">=</span> <span class="n">LearnedAction</span><span class="p">(</span><span class="n">obs_action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
</span><span id="ARMS-296"><a href="#ARMS-296"><span class="linenos">296</span></a>            <span class="n">learned_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">learned_action</span><span class="p">)</span>
</span><span id="ARMS-297"><a href="#ARMS-297"><span class="linenos">297</span></a>            <span class="n">action_map</span><span class="p">[</span><span class="n">obs_action</span><span class="p">]</span> <span class="o">=</span> <span class="n">learned_action</span>
</span><span id="ARMS-298"><a href="#ARMS-298"><span class="linenos">298</span></a>
</span><span id="ARMS-299"><a href="#ARMS-299"><span class="linenos">299</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS-300"><a href="#ARMS-300"><span class="linenos">300</span></a>        <span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">learned_actions</span><span class="p">:</span>
</span><span id="ARMS-301"><a href="#ARMS-301"><span class="linenos">301</span></a>            <span class="n">connected_actions</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS-302"><a href="#ARMS-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">learned_actions</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">a1</span><span class="p">}):</span>  <span class="c1"># includes connecting with self</span>
</span><span id="ARMS-303"><a href="#ARMS-303"><span class="linenos">303</span></a>                <span class="n">intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">obj_params</span><span class="p">))</span>
</span><span id="ARMS-304"><a href="#ARMS-304"><span class="linenos">304</span></a>                <span class="k">if</span> <span class="n">intersection</span><span class="p">:</span>
</span><span id="ARMS-305"><a href="#ARMS-305"><span class="linenos">305</span></a>                    <span class="n">connected_actions</span><span class="p">[</span><span class="n">a1</span><span class="p">][</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">intersection</span>
</span><span id="ARMS-306"><a href="#ARMS-306"><span class="linenos">306</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-307"><a href="#ARMS-307"><span class="linenos">307</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-308"><a href="#ARMS-308"><span class="linenos">308</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> is connected to </span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">intersection</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-309"><a href="#ARMS-309"><span class="linenos">309</span></a>                        <span class="p">)</span>
</span><span id="ARMS-310"><a href="#ARMS-310"><span class="linenos">310</span></a>
</span><span id="ARMS-311"><a href="#ARMS-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="n">connected_actions</span><span class="p">,</span> <span class="n">action_map</span>
</span><span id="ARMS-312"><a href="#ARMS-312"><span class="linenos">312</span></a>
</span><span id="ARMS-313"><a href="#ARMS-313"><span class="linenos">313</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-314"><a href="#ARMS-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">step2</span><span class="p">(</span>
</span><span id="ARMS-315"><a href="#ARMS-315"><span class="linenos">315</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS-316"><a href="#ARMS-316"><span class="linenos">316</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
</span><span id="ARMS-317"><a href="#ARMS-317"><span class="linenos">317</span></a>        <span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS-318"><a href="#ARMS-318"><span class="linenos">318</span></a>        <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Fluent</span><span class="p">],</span>
</span><span id="ARMS-319"><a href="#ARMS-319"><span class="linenos">319</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-320"><a href="#ARMS-320"><span class="linenos">320</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-321"><a href="#ARMS-321"><span class="linenos">321</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ARMSConstraints</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">Relation</span><span class="p">]]:</span>
</span><span id="ARMS-322"><a href="#ARMS-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 2) Generate action constraints, information constraints, and plan constraints.</span>
</span><span id="ARMS-323"><a href="#ARMS-323"><span class="linenos">323</span></a>
</span><span id="ARMS-324"><a href="#ARMS-324"><span class="linenos">324</span></a><span class="sd">        For the unexplained actions, build a set of information and action</span>
</span><span id="ARMS-325"><a href="#ARMS-325"><span class="linenos">325</span></a><span class="sd">        constraints based on individual actions. Apply a frequent-set</span>
</span><span id="ARMS-326"><a href="#ARMS-326"><span class="linenos">326</span></a><span class="sd">        mining algorithm to find the frequent sets of connected actions and</span>
</span><span id="ARMS-327"><a href="#ARMS-327"><span class="linenos">327</span></a><span class="sd">        relations. Here connected means the actions and relations must share</span>
</span><span id="ARMS-328"><a href="#ARMS-328"><span class="linenos">328</span></a><span class="sd">        some common parameters.</span>
</span><span id="ARMS-329"><a href="#ARMS-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS-330"><a href="#ARMS-330"><span class="linenos">330</span></a>
</span><span id="ARMS-331"><a href="#ARMS-331"><span class="linenos">331</span></a>        <span class="c1"># Map fluents to relations</span>
</span><span id="ARMS-332"><a href="#ARMS-332"><span class="linenos">332</span></a>        <span class="c1"># relations are fluents but with instantiated objects replaced by the object type</span>
</span><span id="ARMS-333"><a href="#ARMS-333"><span class="linenos">333</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">Relation</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="ARMS-334"><a href="#ARMS-334"><span class="linenos">334</span></a>            <span class="nb">map</span><span class="p">(</span>
</span><span id="ARMS-335"><a href="#ARMS-335"><span class="linenos">335</span></a>                <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="p">(</span>
</span><span id="ARMS-336"><a href="#ARMS-336"><span class="linenos">336</span></a>                    <span class="n">f</span><span class="p">,</span>
</span><span id="ARMS-337"><a href="#ARMS-337"><span class="linenos">337</span></a>                    <span class="n">Relation</span><span class="p">(</span>
</span><span id="ARMS-338"><a href="#ARMS-338"><span class="linenos">338</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="ARMS-339"><a href="#ARMS-339"><span class="linenos">339</span></a>                        <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">obj_type</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">objects</span><span class="p">],</span>
</span><span id="ARMS-340"><a href="#ARMS-340"><span class="linenos">340</span></a>                    <span class="p">),</span>
</span><span id="ARMS-341"><a href="#ARMS-341"><span class="linenos">341</span></a>                <span class="p">),</span>
</span><span id="ARMS-342"><a href="#ARMS-342"><span class="linenos">342</span></a>                <span class="n">fluents</span><span class="p">,</span>
</span><span id="ARMS-343"><a href="#ARMS-343"><span class="linenos">343</span></a>            <span class="p">)</span>
</span><span id="ARMS-344"><a href="#ARMS-344"><span class="linenos">344</span></a>        <span class="p">)</span>
</span><span id="ARMS-345"><a href="#ARMS-345"><span class="linenos">345</span></a>
</span><span id="ARMS-346"><a href="#ARMS-346"><span class="linenos">346</span></a>        <span class="n">debuga</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug action constraints?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-347"><a href="#ARMS-347"><span class="linenos">347</span></a>
</span><span id="ARMS-348"><a href="#ARMS-348"><span class="linenos">348</span></a>        <span class="n">action_constraints</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2A</span><span class="p">(</span>
</span><span id="ARMS-349"><a href="#ARMS-349"><span class="linenos">349</span></a>            <span class="n">connected_actions</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">relations</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">debuga</span>
</span><span id="ARMS-350"><a href="#ARMS-350"><span class="linenos">350</span></a>        <span class="p">)</span>
</span><span id="ARMS-351"><a href="#ARMS-351"><span class="linenos">351</span></a>
</span><span id="ARMS-352"><a href="#ARMS-352"><span class="linenos">352</span></a>        <span class="n">debugi</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug info constraints?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-353"><a href="#ARMS-353"><span class="linenos">353</span></a>        <span class="n">info_constraints</span><span class="p">,</span> <span class="n">info_support_counts</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2I</span><span class="p">(</span>
</span><span id="ARMS-354"><a href="#ARMS-354"><span class="linenos">354</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">relations</span><span class="p">,</span> <span class="n">action_map</span><span class="p">,</span> <span class="n">debugi</span>
</span><span id="ARMS-355"><a href="#ARMS-355"><span class="linenos">355</span></a>        <span class="p">)</span>
</span><span id="ARMS-356"><a href="#ARMS-356"><span class="linenos">356</span></a>
</span><span id="ARMS-357"><a href="#ARMS-357"><span class="linenos">357</span></a>        <span class="n">debugp</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug plan constraints?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS-358"><a href="#ARMS-358"><span class="linenos">358</span></a>        <span class="n">plan_constraints</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2P</span><span class="p">(</span>
</span><span id="ARMS-359"><a href="#ARMS-359"><span class="linenos">359</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span>
</span><span id="ARMS-360"><a href="#ARMS-360"><span class="linenos">360</span></a>            <span class="n">connected_actions</span><span class="p">,</span>
</span><span id="ARMS-361"><a href="#ARMS-361"><span class="linenos">361</span></a>            <span class="n">action_map</span><span class="p">,</span>
</span><span id="ARMS-362"><a href="#ARMS-362"><span class="linenos">362</span></a>            <span class="nb">set</span><span class="p">(</span><span class="n">relations</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
</span><span id="ARMS-363"><a href="#ARMS-363"><span class="linenos">363</span></a>            <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS-364"><a href="#ARMS-364"><span class="linenos">364</span></a>            <span class="n">debugp</span><span class="p">,</span>
</span><span id="ARMS-365"><a href="#ARMS-365"><span class="linenos">365</span></a>        <span class="p">)</span>
</span><span id="ARMS-366"><a href="#ARMS-366"><span class="linenos">366</span></a>
</span><span id="ARMS-367"><a href="#ARMS-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="ARMS-368"><a href="#ARMS-368"><span class="linenos">368</span></a>            <span class="n">ARMSConstraints</span><span class="p">(</span>
</span><span id="ARMS-369"><a href="#ARMS-369"><span class="linenos">369</span></a>                <span class="n">action_constraints</span><span class="p">,</span>
</span><span id="ARMS-370"><a href="#ARMS-370"><span class="linenos">370</span></a>                <span class="n">info_constraints</span><span class="p">,</span>
</span><span id="ARMS-371"><a href="#ARMS-371"><span class="linenos">371</span></a>                <span class="n">info_support_counts</span><span class="p">,</span>
</span><span id="ARMS-372"><a href="#ARMS-372"><span class="linenos">372</span></a>                <span class="n">plan_constraints</span><span class="p">,</span>
</span><span id="ARMS-373"><a href="#ARMS-373"><span class="linenos">373</span></a>            <span class="p">),</span>
</span><span id="ARMS-374"><a href="#ARMS-374"><span class="linenos">374</span></a>            <span class="n">relations</span><span class="p">,</span>
</span><span id="ARMS-375"><a href="#ARMS-375"><span class="linenos">375</span></a>        <span class="p">)</span>
</span><span id="ARMS-376"><a href="#ARMS-376"><span class="linenos">376</span></a>
</span><span id="ARMS-377"><a href="#ARMS-377"><span class="linenos">377</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-378"><a href="#ARMS-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">step2A</span><span class="p">(</span>
</span><span id="ARMS-379"><a href="#ARMS-379"><span class="linenos">379</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">]],</span>
</span><span id="ARMS-380"><a href="#ARMS-380"><span class="linenos">380</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Relation</span><span class="p">],</span>
</span><span id="ARMS-381"><a href="#ARMS-381"><span class="linenos">381</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-382"><a href="#ARMS-382"><span class="linenos">382</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]:</span>
</span><span id="ARMS-383"><a href="#ARMS-383"><span class="linenos">383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Action constraints.</span>
</span><span id="ARMS-384"><a href="#ARMS-384"><span class="linenos">384</span></a>
</span><span id="ARMS-385"><a href="#ARMS-385"><span class="linenos">385</span></a><span class="sd">        A1. The intersection of the precondition and add lists of all actions must be empty.</span>
</span><span id="ARMS-386"><a href="#ARMS-386"><span class="linenos">386</span></a>
</span><span id="ARMS-387"><a href="#ARMS-387"><span class="linenos">387</span></a><span class="sd">        A2. In addition, if an actions delete list includes a relation, this relation is</span>
</span><span id="ARMS-388"><a href="#ARMS-388"><span class="linenos">388</span></a><span class="sd">        in the actions precondition list. Thus, for every action, we require that</span>
</span><span id="ARMS-389"><a href="#ARMS-389"><span class="linenos">389</span></a><span class="sd">        the delete list is a subset of the precondition list.</span>
</span><span id="ARMS-390"><a href="#ARMS-390"><span class="linenos">390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS-391"><a href="#ARMS-391"><span class="linenos">391</span></a>
</span><span id="ARMS-392"><a href="#ARMS-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-393"><a href="#ARMS-393"><span class="linenos">393</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Building action constraints...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ARMS-394"><a href="#ARMS-394"><span class="linenos">394</span></a>
</span><span id="ARMS-395"><a href="#ARMS-395"><span class="linenos">395</span></a>        <span class="k">def</span> <span class="nf">implication</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Var</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Var</span><span class="p">):</span>
</span><span id="ARMS-396"><a href="#ARMS-396"><span class="linenos">396</span></a>            <span class="k">return</span> <span class="n">Or</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">negate</span><span class="p">(),</span> <span class="n">b</span><span class="p">])</span>
</span><span id="ARMS-397"><a href="#ARMS-397"><span class="linenos">397</span></a>
</span><span id="ARMS-398"><a href="#ARMS-398"><span class="linenos">398</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS-399"><a href="#ARMS-399"><span class="linenos">399</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">connected_actions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS-400"><a href="#ARMS-400"><span class="linenos">400</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
</span><span id="ARMS-401"><a href="#ARMS-401"><span class="linenos">401</span></a>            <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">relations</span><span class="p">:</span>
</span><span id="ARMS-402"><a href="#ARMS-402"><span class="linenos">402</span></a>                <span class="c1"># A relation is relevant to an action if they share parameter types</span>
</span><span id="ARMS-403"><a href="#ARMS-403"><span class="linenos">403</span></a>                <span class="k">if</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
</span><span id="ARMS-404"><a href="#ARMS-404"><span class="linenos">404</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-405"><a href="#ARMS-405"><span class="linenos">405</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-406"><a href="#ARMS-406"><span class="linenos">406</span></a>                            <span class="sa">f</span><span class="s1">&#39;relation (</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s1">) is relevant to action &quot;</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="ARMS-407"><a href="#ARMS-407"><span class="linenos">407</span></a>                            <span class="s2">&quot;A1:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS-408"><a href="#ARMS-408"><span class="linenos">408</span></a>                            <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> add  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> pre</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS-409"><a href="#ARMS-409"><span class="linenos">409</span></a>                            <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> pre  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> add</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS-410"><a href="#ARMS-410"><span class="linenos">410</span></a>                            <span class="s2">&quot;A2:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS-411"><a href="#ARMS-411"><span class="linenos">411</span></a>                            <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> del  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> pre</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS-412"><a href="#ARMS-412"><span class="linenos">412</span></a>                        <span class="p">)</span>
</span><span id="ARMS-413"><a href="#ARMS-413"><span class="linenos">413</span></a>
</span><span id="ARMS-414"><a href="#ARMS-414"><span class="linenos">414</span></a>                    <span class="c1"># A1</span>
</span><span id="ARMS-415"><a href="#ARMS-415"><span class="linenos">415</span></a>                    <span class="c1"># relation in action.add =&gt; relation not in action.precond</span>
</span><span id="ARMS-416"><a href="#ARMS-416"><span class="linenos">416</span></a>                    <span class="c1"># relation in action.precond =&gt; relation not in action.add</span>
</span><span id="ARMS-417"><a href="#ARMS-417"><span class="linenos">417</span></a>
</span><span id="ARMS-418"><a href="#ARMS-418"><span class="linenos">418</span></a>                    <span class="c1"># (BREAK) marks unambiguous breakpoints for parsing later</span>
</span><span id="ARMS-419"><a href="#ARMS-419"><span class="linenos">419</span></a>                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS-420"><a href="#ARMS-420"><span class="linenos">420</span></a>                        <span class="n">implication</span><span class="p">(</span>
</span><span id="ARMS-421"><a href="#ARMS-421"><span class="linenos">421</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-422"><a href="#ARMS-422"><span class="linenos">422</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-423"><a href="#ARMS-423"><span class="linenos">423</span></a>                            <span class="p">),</span>
</span><span id="ARMS-424"><a href="#ARMS-424"><span class="linenos">424</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-425"><a href="#ARMS-425"><span class="linenos">425</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-426"><a href="#ARMS-426"><span class="linenos">426</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">negate</span><span class="p">(),</span>
</span><span id="ARMS-427"><a href="#ARMS-427"><span class="linenos">427</span></a>                        <span class="p">)</span>
</span><span id="ARMS-428"><a href="#ARMS-428"><span class="linenos">428</span></a>                    <span class="p">)</span>
</span><span id="ARMS-429"><a href="#ARMS-429"><span class="linenos">429</span></a>                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS-430"><a href="#ARMS-430"><span class="linenos">430</span></a>                        <span class="n">implication</span><span class="p">(</span>
</span><span id="ARMS-431"><a href="#ARMS-431"><span class="linenos">431</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-432"><a href="#ARMS-432"><span class="linenos">432</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-433"><a href="#ARMS-433"><span class="linenos">433</span></a>                            <span class="p">),</span>
</span><span id="ARMS-434"><a href="#ARMS-434"><span class="linenos">434</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-435"><a href="#ARMS-435"><span class="linenos">435</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-436"><a href="#ARMS-436"><span class="linenos">436</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">negate</span><span class="p">(),</span>
</span><span id="ARMS-437"><a href="#ARMS-437"><span class="linenos">437</span></a>                        <span class="p">)</span>
</span><span id="ARMS-438"><a href="#ARMS-438"><span class="linenos">438</span></a>                    <span class="p">)</span>
</span><span id="ARMS-439"><a href="#ARMS-439"><span class="linenos">439</span></a>
</span><span id="ARMS-440"><a href="#ARMS-440"><span class="linenos">440</span></a>                    <span class="c1"># A2</span>
</span><span id="ARMS-441"><a href="#ARMS-441"><span class="linenos">441</span></a>                    <span class="c1"># relation in action.del =&gt; relation in action.precond</span>
</span><span id="ARMS-442"><a href="#ARMS-442"><span class="linenos">442</span></a>                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS-443"><a href="#ARMS-443"><span class="linenos">443</span></a>                        <span class="n">implication</span><span class="p">(</span>
</span><span id="ARMS-444"><a href="#ARMS-444"><span class="linenos">444</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-445"><a href="#ARMS-445"><span class="linenos">445</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) del (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-446"><a href="#ARMS-446"><span class="linenos">446</span></a>                            <span class="p">),</span>
</span><span id="ARMS-447"><a href="#ARMS-447"><span class="linenos">447</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-448"><a href="#ARMS-448"><span class="linenos">448</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-449"><a href="#ARMS-449"><span class="linenos">449</span></a>                            <span class="p">),</span>
</span><span id="ARMS-450"><a href="#ARMS-450"><span class="linenos">450</span></a>                        <span class="p">)</span>
</span><span id="ARMS-451"><a href="#ARMS-451"><span class="linenos">451</span></a>                    <span class="p">)</span>
</span><span id="ARMS-452"><a href="#ARMS-452"><span class="linenos">452</span></a>
</span><span id="ARMS-453"><a href="#ARMS-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="n">constraints</span>
</span><span id="ARMS-454"><a href="#ARMS-454"><span class="linenos">454</span></a>
</span><span id="ARMS-455"><a href="#ARMS-455"><span class="linenos">455</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-456"><a href="#ARMS-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">step2I</span><span class="p">(</span>
</span><span id="ARMS-457"><a href="#ARMS-457"><span class="linenos">457</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS-458"><a href="#ARMS-458"><span class="linenos">458</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">Relation</span><span class="p">],</span>
</span><span id="ARMS-459"><a href="#ARMS-459"><span class="linenos">459</span></a>        <span class="n">actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS-460"><a href="#ARMS-460"><span class="linenos">460</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-461"><a href="#ARMS-461"><span class="linenos">461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="ARMS-462"><a href="#ARMS-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Information constraints.</span>
</span><span id="ARMS-463"><a href="#ARMS-463"><span class="linenos">463</span></a>
</span><span id="ARMS-464"><a href="#ARMS-464"><span class="linenos">464</span></a><span class="sd">        Suppose we observe a relation p to be true between two actions</span>
</span><span id="ARMS-465"><a href="#ARMS-465"><span class="linenos">465</span></a><span class="sd">        \(a_n\) and \(a_{n+1}\) , and \(p, a_{i_1} , ... ,\) and \(a_{i_k}\) share</span>
</span><span id="ARMS-466"><a href="#ARMS-466"><span class="linenos">466</span></a><span class="sd">        the same parameter types. We can represent this fact by the following clauses,</span>
</span><span id="ARMS-467"><a href="#ARMS-467"><span class="linenos">467</span></a><span class="sd">        given that \(a_{i_1} , ... ,\) and \(a_{i_k}\) appear in that order.</span>
</span><span id="ARMS-468"><a href="#ARMS-468"><span class="linenos">468</span></a>
</span><span id="ARMS-469"><a href="#ARMS-469"><span class="linenos">469</span></a><span class="sd">        I1. The relation \(p\) must be generated by an action \(a_{i_k} (0 \le i_k \le n)\),</span>
</span><span id="ARMS-470"><a href="#ARMS-470"><span class="linenos">470</span></a><span class="sd">        that is, \(p\) is selected to be in the add-list of \(a_{i_k}\).</span>
</span><span id="ARMS-471"><a href="#ARMS-471"><span class="linenos">471</span></a><span class="sd">        \(p (add_{i_1}  add_{i_2}  \dots  add_{i_k}) \), where  means logical or.</span>
</span><span id="ARMS-472"><a href="#ARMS-472"><span class="linenos">472</span></a>
</span><span id="ARMS-473"><a href="#ARMS-473"><span class="linenos">473</span></a><span class="sd">        I2. The last action \(a_{i_k}\) must not delete the relation p; that is,</span>
</span><span id="ARMS-474"><a href="#ARMS-474"><span class="linenos">474</span></a><span class="sd">        \(p\) must not be selected to be in the delete list of \(a_{i_k}\): \(p \\not\in del_{i_k}\).</span>
</span><span id="ARMS-475"><a href="#ARMS-475"><span class="linenos">475</span></a>
</span><span id="ARMS-476"><a href="#ARMS-476"><span class="linenos">476</span></a><span class="sd">        I3. We define the weight value of a relation-action pair \((p, a)\) as the</span>
</span><span id="ARMS-477"><a href="#ARMS-477"><span class="linenos">477</span></a><span class="sd">        occurrence probability of this pair in all plan examples. If the probability</span>
</span><span id="ARMS-478"><a href="#ARMS-478"><span class="linenos">478</span></a><span class="sd">        of a relation-action pair is higher than the probability threshold  ,</span>
</span><span id="ARMS-479"><a href="#ARMS-479"><span class="linenos">479</span></a><span class="sd">        then we set a corresponding relation constraint \(p  \\text{PRECOND}_a\), which</span>
</span><span id="ARMS-480"><a href="#ARMS-480"><span class="linenos">480</span></a><span class="sd">        receives a weight value equal to its prior probability.</span>
</span><span id="ARMS-481"><a href="#ARMS-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS-482"><a href="#ARMS-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-483"><a href="#ARMS-483"><span class="linenos">483</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Building information constraints...&quot;</span><span class="p">)</span>
</span><span id="ARMS-484"><a href="#ARMS-484"><span class="linenos">484</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS-485"><a href="#ARMS-485"><span class="linenos">485</span></a>        <span class="n">support_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="ARMS-486"><a href="#ARMS-486"><span class="linenos">486</span></a>        <span class="n">obs_trace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Observation</span><span class="p">]</span>
</span><span id="ARMS-487"><a href="#ARMS-487"><span class="linenos">487</span></a>        <span class="k">for</span> <span class="n">obs_trace_i</span><span class="p">,</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">):</span>
</span><span id="ARMS-488"><a href="#ARMS-488"><span class="linenos">488</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">):</span>
</span><span id="ARMS-489"><a href="#ARMS-489"><span class="linenos">489</span></a>                <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ARMS-490"><a href="#ARMS-490"><span class="linenos">490</span></a>                    <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ARMS-491"><a href="#ARMS-491"><span class="linenos">491</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-492"><a href="#ARMS-492"><span class="linenos">492</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-493"><a href="#ARMS-493"><span class="linenos">493</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of observation list </span><span class="si">{</span><span class="n">obs_trace_i</span><span class="si">}</span><span class="s2"> contains state information.&quot;</span>
</span><span id="ARMS-494"><a href="#ARMS-494"><span class="linenos">494</span></a>                        <span class="p">)</span>
</span><span id="ARMS-495"><a href="#ARMS-495"><span class="linenos">495</span></a>                    <span class="k">for</span> <span class="n">fluent</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">obs</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ARMS-496"><a href="#ARMS-496"><span class="linenos">496</span></a>                        <span class="n">relation</span> <span class="o">=</span> <span class="n">relations</span><span class="p">[</span><span class="n">fluent</span><span class="p">]</span>
</span><span id="ARMS-497"><a href="#ARMS-497"><span class="linenos">497</span></a>                        <span class="c1"># Information constraints only apply to true relations</span>
</span><span id="ARMS-498"><a href="#ARMS-498"><span class="linenos">498</span></a>                        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
</span><span id="ARMS-499"><a href="#ARMS-499"><span class="linenos">499</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-500"><a href="#ARMS-500"><span class="linenos">500</span></a>                                <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-501"><a href="#ARMS-501"><span class="linenos">501</span></a>                                    <span class="sa">f</span><span class="s2">&quot;  Fluent </span><span class="si">{</span><span class="n">fluent</span><span class="si">}</span><span class="s2"> is true.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS-502"><a href="#ARMS-502"><span class="linenos">502</span></a>                                    <span class="sa">f</span><span class="s2">&quot;    (</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2">) (&quot;</span>
</span><span id="ARMS-503"><a href="#ARMS-503"><span class="linenos">503</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;add_</span><span class="se">{{</span><span class="s1"> </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">obs_trace</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s1"> </span><span class="se">}}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ik</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">obs_trace</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">actions</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore</span>
</span><span id="ARMS-504"><a href="#ARMS-504"><span class="linenos">504</span></a>                                    <span class="s2">&quot;)&quot;</span>
</span><span id="ARMS-505"><a href="#ARMS-505"><span class="linenos">505</span></a>                                <span class="p">)</span>
</span><span id="ARMS-506"><a href="#ARMS-506"><span class="linenos">506</span></a>                            <span class="c1"># I1</span>
</span><span id="ARMS-507"><a href="#ARMS-507"><span class="linenos">507</span></a>                            <span class="c1"># relation in the add list of an action &lt;= n (i-1)</span>
</span><span id="ARMS-508"><a href="#ARMS-508"><span class="linenos">508</span></a>                            <span class="n">i1</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS-509"><a href="#ARMS-509"><span class="linenos">509</span></a>                            <span class="k">for</span> <span class="n">obs_i</span> <span class="ow">in</span> <span class="n">obs_trace</span><span class="p">[:</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="ARMS-510"><a href="#ARMS-510"><span class="linenos">510</span></a>                                <span class="k">if</span> <span class="n">obs_i</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span> <span class="ow">and</span> <span class="n">obs_i</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ARMS-511"><a href="#ARMS-511"><span class="linenos">511</span></a>                                    <span class="n">ai</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">obs_i</span><span class="o">.</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS-512"><a href="#ARMS-512"><span class="linenos">512</span></a>                                    <span class="k">if</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">ai</span><span class="p">):</span>
</span><span id="ARMS-513"><a href="#ARMS-513"><span class="linenos">513</span></a>                                        <span class="n">i1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS-514"><a href="#ARMS-514"><span class="linenos">514</span></a>                                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-515"><a href="#ARMS-515"><span class="linenos">515</span></a>                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">ai</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-516"><a href="#ARMS-516"><span class="linenos">516</span></a>                                            <span class="p">)</span>
</span><span id="ARMS-517"><a href="#ARMS-517"><span class="linenos">517</span></a>                                        <span class="p">)</span>
</span><span id="ARMS-518"><a href="#ARMS-518"><span class="linenos">518</span></a>
</span><span id="ARMS-519"><a href="#ARMS-519"><span class="linenos">519</span></a>                            <span class="c1"># I2</span>
</span><span id="ARMS-520"><a href="#ARMS-520"><span class="linenos">520</span></a>                            <span class="c1"># relation not in del list of action n (i-1)</span>
</span><span id="ARMS-521"><a href="#ARMS-521"><span class="linenos">521</span></a>                            <span class="n">i2</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ARMS-522"><a href="#ARMS-522"><span class="linenos">522</span></a>                            <span class="n">a_n</span> <span class="o">=</span> <span class="n">obs_trace</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">action</span>
</span><span id="ARMS-523"><a href="#ARMS-523"><span class="linenos">523</span></a>                            <span class="k">if</span> <span class="n">a_n</span> <span class="ow">in</span> <span class="n">actions</span> <span class="ow">and</span> <span class="n">a_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ARMS-524"><a href="#ARMS-524"><span class="linenos">524</span></a>                                <span class="n">i2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-525"><a href="#ARMS-525"><span class="linenos">525</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) del (BREAK) </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">a_n</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-526"><a href="#ARMS-526"><span class="linenos">526</span></a>                                <span class="p">)</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
</span><span id="ARMS-527"><a href="#ARMS-527"><span class="linenos">527</span></a>
</span><span id="ARMS-528"><a href="#ARMS-528"><span class="linenos">528</span></a>                            <span class="k">if</span> <span class="n">i1</span><span class="p">:</span>
</span><span id="ARMS-529"><a href="#ARMS-529"><span class="linenos">529</span></a>                                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span>
</span><span id="ARMS-530"><a href="#ARMS-530"><span class="linenos">530</span></a>                            <span class="k">if</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="ARMS-531"><a href="#ARMS-531"><span class="linenos">531</span></a>                                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Or</span><span class="p">([</span><span class="n">i2</span><span class="p">]))</span>
</span><span id="ARMS-532"><a href="#ARMS-532"><span class="linenos">532</span></a>
</span><span id="ARMS-533"><a href="#ARMS-533"><span class="linenos">533</span></a>                            <span class="c1"># I3</span>
</span><span id="ARMS-534"><a href="#ARMS-534"><span class="linenos">534</span></a>                            <span class="c1"># count occurences</span>
</span><span id="ARMS-535"><a href="#ARMS-535"><span class="linenos">535</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="ARMS-536"><a href="#ARMS-536"><span class="linenos">536</span></a>                                <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ARMS-537"><a href="#ARMS-537"><span class="linenos">537</span></a>                                <span class="ow">and</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span>
</span><span id="ARMS-538"><a href="#ARMS-538"><span class="linenos">538</span></a>                                <span class="ow">and</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for the linter</span>
</span><span id="ARMS-539"><a href="#ARMS-539"><span class="linenos">539</span></a>                                <span class="ow">and</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">action</span><span class="p">])</span>
</span><span id="ARMS-540"><a href="#ARMS-540"><span class="linenos">540</span></a>                            <span class="p">):</span>
</span><span id="ARMS-541"><a href="#ARMS-541"><span class="linenos">541</span></a>                                <span class="c1"># corresponding constraint is related to the current action&#39;s precondition list</span>
</span><span id="ARMS-542"><a href="#ARMS-542"><span class="linenos">542</span></a>                                <span class="n">support_counts</span><span class="p">[</span>
</span><span id="ARMS-543"><a href="#ARMS-543"><span class="linenos">543</span></a>                                    <span class="n">Or</span><span class="p">(</span>
</span><span id="ARMS-544"><a href="#ARMS-544"><span class="linenos">544</span></a>                                        <span class="p">[</span>
</span><span id="ARMS-545"><a href="#ARMS-545"><span class="linenos">545</span></a>                                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-546"><a href="#ARMS-546"><span class="linenos">546</span></a>                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-547"><a href="#ARMS-547"><span class="linenos">547</span></a>                                            <span class="p">)</span>
</span><span id="ARMS-548"><a href="#ARMS-548"><span class="linenos">548</span></a>                                        <span class="p">]</span>
</span><span id="ARMS-549"><a href="#ARMS-549"><span class="linenos">549</span></a>                                    <span class="p">)</span>
</span><span id="ARMS-550"><a href="#ARMS-550"><span class="linenos">550</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS-551"><a href="#ARMS-551"><span class="linenos">551</span></a>                            <span class="k">elif</span> <span class="p">(</span>
</span><span id="ARMS-552"><a href="#ARMS-552"><span class="linenos">552</span></a>                                <span class="n">a_n</span> <span class="ow">in</span> <span class="n">actions</span>
</span><span id="ARMS-553"><a href="#ARMS-553"><span class="linenos">553</span></a>                                <span class="ow">and</span> <span class="n">a_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ARMS-554"><a href="#ARMS-554"><span class="linenos">554</span></a>                                <span class="ow">and</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="n">a_n</span><span class="p">])</span>
</span><span id="ARMS-555"><a href="#ARMS-555"><span class="linenos">555</span></a>                            <span class="p">):</span>
</span><span id="ARMS-556"><a href="#ARMS-556"><span class="linenos">556</span></a>                                <span class="c1"># corresponding constraint is related to the previous action&#39;s add list</span>
</span><span id="ARMS-557"><a href="#ARMS-557"><span class="linenos">557</span></a>                                <span class="n">support_counts</span><span class="p">[</span>
</span><span id="ARMS-558"><a href="#ARMS-558"><span class="linenos">558</span></a>                                    <span class="n">Or</span><span class="p">(</span>
</span><span id="ARMS-559"><a href="#ARMS-559"><span class="linenos">559</span></a>                                        <span class="p">[</span>
</span><span id="ARMS-560"><a href="#ARMS-560"><span class="linenos">560</span></a>                                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-561"><a href="#ARMS-561"><span class="linenos">561</span></a>                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">a_n</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-562"><a href="#ARMS-562"><span class="linenos">562</span></a>                                            <span class="p">)</span>
</span><span id="ARMS-563"><a href="#ARMS-563"><span class="linenos">563</span></a>                                        <span class="p">]</span>
</span><span id="ARMS-564"><a href="#ARMS-564"><span class="linenos">564</span></a>                                    <span class="p">)</span>
</span><span id="ARMS-565"><a href="#ARMS-565"><span class="linenos">565</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS-566"><a href="#ARMS-566"><span class="linenos">566</span></a>
</span><span id="ARMS-567"><a href="#ARMS-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">support_counts</span>
</span><span id="ARMS-568"><a href="#ARMS-568"><span class="linenos">568</span></a>
</span><span id="ARMS-569"><a href="#ARMS-569"><span class="linenos">569</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-570"><a href="#ARMS-570"><span class="linenos">570</span></a>    <span class="k">def</span> <span class="nf">_apriori</span><span class="p">(</span>
</span><span id="ARMS-571"><a href="#ARMS-571"><span class="linenos">571</span></a>        <span class="n">action_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">]],</span> <span class="n">minsup</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ARMS-572"><a href="#ARMS-572"><span class="linenos">572</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="ARMS-573"><a href="#ARMS-573"><span class="linenos">573</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;An implementation of the Apriori algorithm to find frequent ordered pairs of actions.&quot;&quot;&quot;</span>
</span><span id="ARMS-574"><a href="#ARMS-574"><span class="linenos">574</span></a>        <span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
</span><span id="ARMS-575"><a href="#ARMS-575"><span class="linenos">575</span></a>            <span class="p">[</span><span class="n">action</span> <span class="k">for</span> <span class="n">action_list</span> <span class="ow">in</span> <span class="n">action_lists</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">]</span>
</span><span id="ARMS-576"><a href="#ARMS-576"><span class="linenos">576</span></a>        <span class="p">)</span>
</span><span id="ARMS-577"><a href="#ARMS-577"><span class="linenos">577</span></a>        <span class="c1"># L1 = {actions that appear &gt;minsup}</span>
</span><span id="ARMS-578"><a href="#ARMS-578"><span class="linenos">578</span></a>        <span class="n">L1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="ARMS-579"><a href="#ARMS-579"><span class="linenos">579</span></a>            <span class="nb">frozenset</span><span class="p">([</span><span class="n">action</span><span class="p">])</span>
</span><span id="ARMS-580"><a href="#ARMS-580"><span class="linenos">580</span></a>            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minsup</span><span class="p">,</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS-581"><a href="#ARMS-581"><span class="linenos">581</span></a>        <span class="p">)</span>  <span class="c1"># large 1-itemsets</span>
</span><span id="ARMS-582"><a href="#ARMS-582"><span class="linenos">582</span></a>
</span><span id="ARMS-583"><a href="#ARMS-583"><span class="linenos">583</span></a>        <span class="c1"># Only going up to L2, so no loop or generalized algorithm needed</span>
</span><span id="ARMS-584"><a href="#ARMS-584"><span class="linenos">584</span></a>        <span class="c1"># apriori-gen step</span>
</span><span id="ARMS-585"><a href="#ARMS-585"><span class="linenos">585</span></a>        <span class="n">C2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">L1</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">L1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="ARMS-586"><a href="#ARMS-586"><span class="linenos">586</span></a>        <span class="c1"># Since L1 contains 1-itemsets where each item is frequent, C2 can</span>
</span><span id="ARMS-587"><a href="#ARMS-587"><span class="linenos">587</span></a>        <span class="c1"># only contain valid sets and pruning is not required</span>
</span><span id="ARMS-588"><a href="#ARMS-588"><span class="linenos">588</span></a>
</span><span id="ARMS-589"><a href="#ARMS-589"><span class="linenos">589</span></a>        <span class="c1"># Get all possible ordered action pairs</span>
</span><span id="ARMS-590"><a href="#ARMS-590"><span class="linenos">590</span></a>        <span class="n">C2_ordered</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS-591"><a href="#ARMS-591"><span class="linenos">591</span></a>        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">C2</span><span class="p">:</span>
</span><span id="ARMS-592"><a href="#ARMS-592"><span class="linenos">592</span></a>            <span class="n">pair</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
</span><span id="ARMS-593"><a href="#ARMS-593"><span class="linenos">593</span></a>            <span class="n">C2_ordered</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="ARMS-594"><a href="#ARMS-594"><span class="linenos">594</span></a>            <span class="n">C2_ordered</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="ARMS-595"><a href="#ARMS-595"><span class="linenos">595</span></a>
</span><span id="ARMS-596"><a href="#ARMS-596"><span class="linenos">596</span></a>        <span class="c1"># Count pair occurences and generate L2</span>
</span><span id="ARMS-597"><a href="#ARMS-597"><span class="linenos">597</span></a>        <span class="n">frequent_pairs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS-598"><a href="#ARMS-598"><span class="linenos">598</span></a>        <span class="k">for</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">C2_ordered</span><span class="p">:</span>
</span><span id="ARMS-599"><a href="#ARMS-599"><span class="linenos">599</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ARMS-600"><a href="#ARMS-600"><span class="linenos">600</span></a>            <span class="k">for</span> <span class="n">action_list</span> <span class="ow">in</span> <span class="n">action_lists</span><span class="p">:</span>
</span><span id="ARMS-601"><a href="#ARMS-601"><span class="linenos">601</span></a>                <span class="n">a1_indecies</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">action_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">ai</span><span class="p">]</span>
</span><span id="ARMS-602"><a href="#ARMS-602"><span class="linenos">602</span></a>                <span class="k">if</span> <span class="n">a1_indecies</span><span class="p">:</span>
</span><span id="ARMS-603"><a href="#ARMS-603"><span class="linenos">603</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a1_indecies</span><span class="p">:</span>
</span><span id="ARMS-604"><a href="#ARMS-604"><span class="linenos">604</span></a>                        <span class="k">if</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]:</span>
</span><span id="ARMS-605"><a href="#ARMS-605"><span class="linenos">605</span></a>                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS-606"><a href="#ARMS-606"><span class="linenos">606</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">minsup</span><span class="p">:</span>
</span><span id="ARMS-607"><a href="#ARMS-607"><span class="linenos">607</span></a>                <span class="n">frequent_pairs</span><span class="p">[(</span><span class="n">ai</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="ARMS-608"><a href="#ARMS-608"><span class="linenos">608</span></a>
</span><span id="ARMS-609"><a href="#ARMS-609"><span class="linenos">609</span></a>        <span class="k">return</span> <span class="n">frequent_pairs</span>
</span><span id="ARMS-610"><a href="#ARMS-610"><span class="linenos">610</span></a>
</span><span id="ARMS-611"><a href="#ARMS-611"><span class="linenos">611</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-612"><a href="#ARMS-612"><span class="linenos">612</span></a>    <span class="k">def</span> <span class="nf">step2P</span><span class="p">(</span>
</span><span id="ARMS-613"><a href="#ARMS-613"><span class="linenos">613</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS-614"><a href="#ARMS-614"><span class="linenos">614</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">]],</span>
</span><span id="ARMS-615"><a href="#ARMS-615"><span class="linenos">615</span></a>        <span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS-616"><a href="#ARMS-616"><span class="linenos">616</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Relation</span><span class="p">],</span>
</span><span id="ARMS-617"><a href="#ARMS-617"><span class="linenos">617</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-618"><a href="#ARMS-618"><span class="linenos">618</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-619"><a href="#ARMS-619"><span class="linenos">619</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="ARMS-620"><a href="#ARMS-620"><span class="linenos">620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plan constraints.</span>
</span><span id="ARMS-621"><a href="#ARMS-621"><span class="linenos">621</span></a>
</span><span id="ARMS-622"><a href="#ARMS-622"><span class="linenos">622</span></a><span class="sd">        P1. Every precondition \(p\) of every action \(b\) must be in the add</span>
</span><span id="ARMS-623"><a href="#ARMS-623"><span class="linenos">623</span></a><span class="sd">        list of a preceding action \(a\) and is not deleted by any actions between</span>
</span><span id="ARMS-624"><a href="#ARMS-624"><span class="linenos">624</span></a><span class="sd">        \(a\) and \(b\).</span>
</span><span id="ARMS-625"><a href="#ARMS-625"><span class="linenos">625</span></a>
</span><span id="ARMS-626"><a href="#ARMS-626"><span class="linenos">626</span></a><span class="sd">        P2. In addition, at least one relation \(r\) in the add list of an action</span>
</span><span id="ARMS-627"><a href="#ARMS-627"><span class="linenos">627</span></a><span class="sd">        must be useful in achieving a precondition of a later action. That is, for</span>
</span><span id="ARMS-628"><a href="#ARMS-628"><span class="linenos">628</span></a><span class="sd">        every action \(a\), an add list relation \(r\) must be in the precondition of a</span>
</span><span id="ARMS-629"><a href="#ARMS-629"><span class="linenos">629</span></a><span class="sd">        later action \(b\), and there is no other action between \(a\) and \(b\)</span>
</span><span id="ARMS-630"><a href="#ARMS-630"><span class="linenos">630</span></a><span class="sd">        that either adds or deletes \(r\).</span>
</span><span id="ARMS-631"><a href="#ARMS-631"><span class="linenos">631</span></a>
</span><span id="ARMS-632"><a href="#ARMS-632"><span class="linenos">632</span></a><span class="sd">        &quot;While constraints P1 and P2 provide the general guiding principle for</span>
</span><span id="ARMS-633"><a href="#ARMS-633"><span class="linenos">633</span></a><span class="sd">        ensuring a plans correctness, in practice there are too many</span>
</span><span id="ARMS-634"><a href="#ARMS-634"><span class="linenos">634</span></a><span class="sd">        instantiations of these constraints.&quot; (more information on the</span>
</span><span id="ARMS-635"><a href="#ARMS-635"><span class="linenos">635</span></a><span class="sd">        rationelle in the paper) Thus, they are replaced with the following</span>
</span><span id="ARMS-636"><a href="#ARMS-636"><span class="linenos">636</span></a><span class="sd">        constraints:</span>
</span><span id="ARMS-637"><a href="#ARMS-637"><span class="linenos">637</span></a>
</span><span id="ARMS-638"><a href="#ARMS-638"><span class="linenos">638</span></a><span class="sd">        Let there be an action pair \(\langle a_i, a_j \\rangle, 0 \le i &lt; j \le n-1\).</span>
</span><span id="ARMS-639"><a href="#ARMS-639"><span class="linenos">639</span></a>
</span><span id="ARMS-640"><a href="#ARMS-640"><span class="linenos">640</span></a><span class="sd">        P3. One of the relevant relations \(p\) must be chosen to be in the</span>
</span><span id="ARMS-641"><a href="#ARMS-641"><span class="linenos">641</span></a><span class="sd">        preconditions of both \(a_i\) and \(a_j\), but not in the delete list</span>
</span><span id="ARMS-642"><a href="#ARMS-642"><span class="linenos">642</span></a><span class="sd">        of \(a_i\).</span>
</span><span id="ARMS-643"><a href="#ARMS-643"><span class="linenos">643</span></a>
</span><span id="ARMS-644"><a href="#ARMS-644"><span class="linenos">644</span></a><span class="sd">        P4. The first action \(a_i\) adds a relevant relation that is in the</span>
</span><span id="ARMS-645"><a href="#ARMS-645"><span class="linenos">645</span></a><span class="sd">        precondition list of the second action \(a_j\) in the pair.</span>
</span><span id="ARMS-646"><a href="#ARMS-646"><span class="linenos">646</span></a>
</span><span id="ARMS-647"><a href="#ARMS-647"><span class="linenos">647</span></a><span class="sd">        P5. A relevant relation \(p\) that is deleted by the first action</span>
</span><span id="ARMS-648"><a href="#ARMS-648"><span class="linenos">648</span></a><span class="sd">        \(a_i\) is added by \(a_j\). The second clause is designed for the event</span>
</span><span id="ARMS-649"><a href="#ARMS-649"><span class="linenos">649</span></a><span class="sd">        when an action re-establishes a fact that is deleted by a previous action.</span>
</span><span id="ARMS-650"><a href="#ARMS-650"><span class="linenos">650</span></a>
</span><span id="ARMS-651"><a href="#ARMS-651"><span class="linenos">651</span></a><span class="sd">        The above constraints can be combined into one constraint:</span>
</span><span id="ARMS-652"><a href="#ARMS-652"><span class="linenos">652</span></a><span class="sd">        $$\exists p ((p \in (pre_i \cap pre_j) \land p \\not \in (del_i)) \lor (p \in (add_i \cap pre_j)) \lor (p \in (del_i \cap add_j)))$$</span>
</span><span id="ARMS-653"><a href="#ARMS-653"><span class="linenos">653</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS-654"><a href="#ARMS-654"><span class="linenos">654</span></a>        <span class="n">frequent_pairs</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_apriori</span><span class="p">(</span>
</span><span id="ARMS-655"><a href="#ARMS-655"><span class="linenos">655</span></a>            <span class="p">[</span>
</span><span id="ARMS-656"><a href="#ARMS-656"><span class="linenos">656</span></a>                <span class="p">[</span>
</span><span id="ARMS-657"><a href="#ARMS-657"><span class="linenos">657</span></a>                    <span class="n">action_map</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS-658"><a href="#ARMS-658"><span class="linenos">658</span></a>                    <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obs_trace</span>
</span><span id="ARMS-659"><a href="#ARMS-659"><span class="linenos">659</span></a>                    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="n">action_map</span>
</span><span id="ARMS-660"><a href="#ARMS-660"><span class="linenos">660</span></a>                <span class="p">]</span>
</span><span id="ARMS-661"><a href="#ARMS-661"><span class="linenos">661</span></a>                <span class="k">for</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="n">obs_tracelist</span>
</span><span id="ARMS-662"><a href="#ARMS-662"><span class="linenos">662</span></a>            <span class="p">],</span>
</span><span id="ARMS-663"><a href="#ARMS-663"><span class="linenos">663</span></a>            <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS-664"><a href="#ARMS-664"><span class="linenos">664</span></a>        <span class="p">)</span>
</span><span id="ARMS-665"><a href="#ARMS-665"><span class="linenos">665</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-666"><a href="#ARMS-666"><span class="linenos">666</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequent pairs:&quot;</span><span class="p">)</span>
</span><span id="ARMS-667"><a href="#ARMS-667"><span class="linenos">667</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">frequent_pairs</span><span class="p">)</span>
</span><span id="ARMS-668"><a href="#ARMS-668"><span class="linenos">668</span></a>
</span><span id="ARMS-669"><a href="#ARMS-669"><span class="linenos">669</span></a>        <span class="c1"># constraints: Dict[And[Or[Var]], int] = {}</span>
</span><span id="ARMS-670"><a href="#ARMS-670"><span class="linenos">670</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS-671"><a href="#ARMS-671"><span class="linenos">671</span></a>        <span class="k">for</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">frequent_pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ARMS-672"><a href="#ARMS-672"><span class="linenos">672</span></a>            <span class="n">connectors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS-673"><a href="#ARMS-673"><span class="linenos">673</span></a>            <span class="c1"># get list of relevant relations from connected_actions</span>
</span><span id="ARMS-674"><a href="#ARMS-674"><span class="linenos">674</span></a>            <span class="k">if</span> <span class="n">ai</span> <span class="ow">in</span> <span class="n">connected_actions</span> <span class="ow">and</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">ai</span><span class="p">]:</span>
</span><span id="ARMS-675"><a href="#ARMS-675"><span class="linenos">675</span></a>                <span class="n">connectors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">connected_actions</span><span class="p">[</span><span class="n">ai</span><span class="p">][</span><span class="n">aj</span><span class="p">])</span>
</span><span id="ARMS-676"><a href="#ARMS-676"><span class="linenos">676</span></a>            <span class="k">if</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">connected_actions</span> <span class="ow">and</span> <span class="n">ai</span> <span class="ow">in</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">aj</span><span class="p">]:</span>
</span><span id="ARMS-677"><a href="#ARMS-677"><span class="linenos">677</span></a>                <span class="n">connectors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">connected_actions</span><span class="p">[</span><span class="n">aj</span><span class="p">][</span><span class="n">ai</span><span class="p">])</span>
</span><span id="ARMS-678"><a href="#ARMS-678"><span class="linenos">678</span></a>
</span><span id="ARMS-679"><a href="#ARMS-679"><span class="linenos">679</span></a>            <span class="c1"># if the actions are not related they are not a valid pair for a plan constraint.</span>
</span><span id="ARMS-680"><a href="#ARMS-680"><span class="linenos">680</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">connectors</span><span class="p">:</span>
</span><span id="ARMS-681"><a href="#ARMS-681"><span class="linenos">681</span></a>                <span class="k">continue</span>
</span><span id="ARMS-682"><a href="#ARMS-682"><span class="linenos">682</span></a>
</span><span id="ARMS-683"><a href="#ARMS-683"><span class="linenos">683</span></a>            <span class="c1"># for each relation, save constraint</span>
</span><span id="ARMS-684"><a href="#ARMS-684"><span class="linenos">684</span></a>            <span class="n">relevant_relations</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">connectors</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">types</span><span class="p">)}</span>
</span><span id="ARMS-685"><a href="#ARMS-685"><span class="linenos">685</span></a>            <span class="c1"># relation_constraints: List[Or[And[Var]]] = []</span>
</span><span id="ARMS-686"><a href="#ARMS-686"><span class="linenos">686</span></a>            <span class="n">relation_constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS-687"><a href="#ARMS-687"><span class="linenos">687</span></a>            <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">relevant_relations</span><span class="p">:</span>
</span><span id="ARMS-688"><a href="#ARMS-688"><span class="linenos">688</span></a>                <span class="n">relation_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS-689"><a href="#ARMS-689"><span class="linenos">689</span></a>                    <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS-690"><a href="#ARMS-690"><span class="linenos">690</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) relevant (BREAK) </span><span class="si">{</span><span class="n">ai</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) </span><span class="si">{</span><span class="n">aj</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-691"><a href="#ARMS-691"><span class="linenos">691</span></a>                    <span class="p">)</span>
</span><span id="ARMS-692"><a href="#ARMS-692"><span class="linenos">692</span></a>                <span class="p">)</span>
</span><span id="ARMS-693"><a href="#ARMS-693"><span class="linenos">693</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-694"><a href="#ARMS-694"><span class="linenos">694</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-695"><a href="#ARMS-695"><span class="linenos">695</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> might explain action pair (</span><span class="si">{</span><span class="n">ai</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">aj</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ARMS-696"><a href="#ARMS-696"><span class="linenos">696</span></a>                    <span class="p">)</span>
</span><span id="ARMS-697"><a href="#ARMS-697"><span class="linenos">697</span></a>            <span class="n">constraints</span><span class="p">[</span><span class="n">Or</span><span class="p">(</span><span class="n">relation_constraints</span><span class="p">)]</span> <span class="o">=</span> <span class="n">frequent_pairs</span><span class="p">[(</span><span class="n">ai</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS-698"><a href="#ARMS-698"><span class="linenos">698</span></a>
</span><span id="ARMS-699"><a href="#ARMS-699"><span class="linenos">699</span></a>        <span class="k">return</span> <span class="n">constraints</span>
</span><span id="ARMS-700"><a href="#ARMS-700"><span class="linenos">700</span></a>
</span><span id="ARMS-701"><a href="#ARMS-701"><span class="linenos">701</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-702"><a href="#ARMS-702"><span class="linenos">702</span></a>    <span class="k">def</span> <span class="nf">step3</span><span class="p">(</span>
</span><span id="ARMS-703"><a href="#ARMS-703"><span class="linenos">703</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">ARMSConstraints</span><span class="p">,</span>
</span><span id="ARMS-704"><a href="#ARMS-704"><span class="linenos">704</span></a>        <span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-705"><a href="#ARMS-705"><span class="linenos">705</span></a>        <span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-706"><a href="#ARMS-706"><span class="linenos">706</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="ARMS-707"><a href="#ARMS-707"><span class="linenos">707</span></a>        <span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-708"><a href="#ARMS-708"><span class="linenos">708</span></a>        <span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS-709"><a href="#ARMS-709"><span class="linenos">709</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-710"><a href="#ARMS-710"><span class="linenos">710</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">WCNF</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]]:</span>
</span><span id="ARMS-711"><a href="#ARMS-711"><span class="linenos">711</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 3) Construct the weighted MAX-SAT problem based on the constraints and weight information found in Step 2.&quot;&quot;&quot;</span>
</span><span id="ARMS-712"><a href="#ARMS-712"><span class="linenos">712</span></a>
</span><span id="ARMS-713"><a href="#ARMS-713"><span class="linenos">713</span></a>        <span class="n">action_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">action_weight</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
</span><span id="ARMS-714"><a href="#ARMS-714"><span class="linenos">714</span></a>        <span class="n">info_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">info_weight</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</span><span id="ARMS-715"><a href="#ARMS-715"><span class="linenos">715</span></a>        <span class="n">info3_weights</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_calculate_support_rates</span><span class="p">(</span>
</span><span id="ARMS-716"><a href="#ARMS-716"><span class="linenos">716</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">info3</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">info3_default</span>
</span><span id="ARMS-717"><a href="#ARMS-717"><span class="linenos">717</span></a>        <span class="p">)</span>
</span><span id="ARMS-718"><a href="#ARMS-718"><span class="linenos">718</span></a>        <span class="n">plan_weights</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_calculate_support_rates</span><span class="p">(</span>
</span><span id="ARMS-719"><a href="#ARMS-719"><span class="linenos">719</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">plan_default</span>
</span><span id="ARMS-720"><a href="#ARMS-720"><span class="linenos">720</span></a>        <span class="p">)</span>
</span><span id="ARMS-721"><a href="#ARMS-721"><span class="linenos">721</span></a>        <span class="n">all_weights</span> <span class="o">=</span> <span class="n">action_weights</span> <span class="o">+</span> <span class="n">info_weights</span> <span class="o">+</span> <span class="n">info3_weights</span> <span class="o">+</span> <span class="n">plan_weights</span>
</span><span id="ARMS-722"><a href="#ARMS-722"><span class="linenos">722</span></a>
</span><span id="ARMS-723"><a href="#ARMS-723"><span class="linenos">723</span></a>        <span class="n">info3_constraints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">info3</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS-724"><a href="#ARMS-724"><span class="linenos">724</span></a>        <span class="n">plan_constraints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS-725"><a href="#ARMS-725"><span class="linenos">725</span></a>        <span class="n">all_constraints</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ARMS-726"><a href="#ARMS-726"><span class="linenos">726</span></a>            <span class="n">constraints</span><span class="o">.</span><span class="n">action</span> <span class="o">+</span> <span class="n">constraints</span><span class="o">.</span><span class="n">info</span> <span class="o">+</span> <span class="n">info3_constraints</span> <span class="o">+</span> <span class="n">plan_constraints</span>
</span><span id="ARMS-727"><a href="#ARMS-727"><span class="linenos">727</span></a>        <span class="p">)</span>
</span><span id="ARMS-728"><a href="#ARMS-728"><span class="linenos">728</span></a>
</span><span id="ARMS-729"><a href="#ARMS-729"><span class="linenos">729</span></a>        <span class="n">constraints_w_weights</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS-730"><a href="#ARMS-730"><span class="linenos">730</span></a>        <span class="k">for</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_constraints</span><span class="p">,</span> <span class="n">all_weights</span><span class="p">):</span>
</span><span id="ARMS-731"><a href="#ARMS-731"><span class="linenos">731</span></a>            <span class="k">if</span> <span class="n">constraint</span> <span class="o">==</span> <span class="n">nnffalse</span><span class="p">:</span>
</span><span id="ARMS-732"><a href="#ARMS-732"><span class="linenos">732</span></a>                <span class="k">continue</span>
</span><span id="ARMS-733"><a href="#ARMS-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="n">constraint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constraints_w_weights</span><span class="p">:</span>
</span><span id="ARMS-734"><a href="#ARMS-734"><span class="linenos">734</span></a>                <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</span><span id="ARMS-735"><a href="#ARMS-735"><span class="linenos">735</span></a>            <span class="k">elif</span> <span class="n">weight</span> <span class="o">!=</span> <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]:</span>
</span><span id="ARMS-736"><a href="#ARMS-736"><span class="linenos">736</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-737"><a href="#ARMS-737"><span class="linenos">737</span></a>                    <span class="n">warn</span><span class="p">(</span>
</span><span id="ARMS-738"><a href="#ARMS-738"><span class="linenos">738</span></a>                        <span class="sa">f</span><span class="s2">&quot;The constraint </span><span class="si">{</span><span class="n">constraint</span><span class="si">}</span><span class="s2"> has conflicting weights (</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span><span class="si">}</span><span class="s2">). Choosing the smaller weight.&quot;</span>
</span><span id="ARMS-739"><a href="#ARMS-739"><span class="linenos">739</span></a>                    <span class="p">)</span>
</span><span id="ARMS-740"><a href="#ARMS-740"><span class="linenos">740</span></a>                <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="ARMS-741"><a href="#ARMS-741"><span class="linenos">741</span></a>                    <span class="n">weight</span><span class="p">,</span> <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span>
</span><span id="ARMS-742"><a href="#ARMS-742"><span class="linenos">742</span></a>                <span class="p">)</span>
</span><span id="ARMS-743"><a href="#ARMS-743"><span class="linenos">743</span></a>
</span><span id="ARMS-744"><a href="#ARMS-744"><span class="linenos">744</span></a>        <span class="n">problem</span><span class="p">:</span> <span class="n">And</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">constraints_w_weights</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="ARMS-745"><a href="#ARMS-745"><span class="linenos">745</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints_w_weights</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="ARMS-746"><a href="#ARMS-746"><span class="linenos">746</span></a>
</span><span id="ARMS-747"><a href="#ARMS-747"><span class="linenos">747</span></a>        <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">to_wcnf</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="ARMS-748"><a href="#ARMS-748"><span class="linenos">748</span></a>        <span class="k">return</span> <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span>
</span><span id="ARMS-749"><a href="#ARMS-749"><span class="linenos">749</span></a>
</span><span id="ARMS-750"><a href="#ARMS-750"><span class="linenos">750</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-751"><a href="#ARMS-751"><span class="linenos">751</span></a>    <span class="k">def</span> <span class="nf">_calculate_support_rates</span><span class="p">(</span>
</span><span id="ARMS-752"><a href="#ARMS-752"><span class="linenos">752</span></a>        <span class="n">support_counts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ARMS-753"><a href="#ARMS-753"><span class="linenos">753</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ARMS-754"><a href="#ARMS-754"><span class="linenos">754</span></a>        <span class="c1"># NOTE:</span>
</span><span id="ARMS-755"><a href="#ARMS-755"><span class="linenos">755</span></a>        <span class="c1"># In the paper, Z__P (denominator of the support rate formula) is</span>
</span><span id="ARMS-756"><a href="#ARMS-756"><span class="linenos">756</span></a>        <span class="c1"># defined as the &quot;total pairs&quot; in the set of plans. However, in the</span>
</span><span id="ARMS-757"><a href="#ARMS-757"><span class="linenos">757</span></a>        <span class="c1"># examples it appears that they use the max support count as the</span>
</span><span id="ARMS-758"><a href="#ARMS-758"><span class="linenos">758</span></a>        <span class="c1"># denominator. My best interpretation is then to use the max support</span>
</span><span id="ARMS-759"><a href="#ARMS-759"><span class="linenos">759</span></a>        <span class="c1"># count as the denominator to calculate the support rate.</span>
</span><span id="ARMS-760"><a href="#ARMS-760"><span class="linenos">760</span></a>
</span><span id="ARMS-761"><a href="#ARMS-761"><span class="linenos">761</span></a>        <span class="n">z_sigma_p</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">support_counts</span><span class="p">)</span>
</span><span id="ARMS-762"><a href="#ARMS-762"><span class="linenos">762</span></a>
</span><span id="ARMS-763"><a href="#ARMS-763"><span class="linenos">763</span></a>        <span class="k">def</span> <span class="nf">get_support_rate</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span id="ARMS-764"><a href="#ARMS-764"><span class="linenos">764</span></a>            <span class="n">probability</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">z_sigma_p</span>
</span><span id="ARMS-765"><a href="#ARMS-765"><span class="linenos">765</span></a>            <span class="k">return</span> <span class="n">probability</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">probability</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="n">default</span>
</span><span id="ARMS-766"><a href="#ARMS-766"><span class="linenos">766</span></a>
</span><span id="ARMS-767"><a href="#ARMS-767"><span class="linenos">767</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">get_support_rate</span><span class="p">,</span> <span class="n">support_counts</span><span class="p">))</span>
</span><span id="ARMS-768"><a href="#ARMS-768"><span class="linenos">768</span></a>
</span><span id="ARMS-769"><a href="#ARMS-769"><span class="linenos">769</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-770"><a href="#ARMS-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">step4</span><span class="p">(</span><span class="n">max_sat</span><span class="p">:</span> <span class="n">WCNF</span><span class="p">,</span> <span class="n">decode</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="ARMS-771"><a href="#ARMS-771"><span class="linenos">771</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 4) Solve the MAX-SAT problem built in Step 3.&quot;&quot;&quot;</span>
</span><span id="ARMS-772"><a href="#ARMS-772"><span class="linenos">772</span></a>        <span class="n">solver</span> <span class="o">=</span> <span class="n">RC2</span><span class="p">(</span><span class="n">max_sat</span><span class="p">)</span>
</span><span id="ARMS-773"><a href="#ARMS-773"><span class="linenos">773</span></a>
</span><span id="ARMS-774"><a href="#ARMS-774"><span class="linenos">774</span></a>        <span class="n">encoded_model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="ARMS-775"><a href="#ARMS-775"><span class="linenos">775</span></a>
</span><span id="ARMS-776"><a href="#ARMS-776"><span class="linenos">776</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">encoded_model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ARMS-777"><a href="#ARMS-777"><span class="linenos">777</span></a>            <span class="c1"># should never be reached</span>
</span><span id="ARMS-778"><a href="#ARMS-778"><span class="linenos">778</span></a>            <span class="k">raise</span> <span class="n">InvalidMaxSATModel</span><span class="p">(</span><span class="n">encoded_model</span><span class="p">)</span>
</span><span id="ARMS-779"><a href="#ARMS-779"><span class="linenos">779</span></a>
</span><span id="ARMS-780"><a href="#ARMS-780"><span class="linenos">780</span></a>        <span class="c1"># decode the model (back to nnf vars)</span>
</span><span id="ARMS-781"><a href="#ARMS-781"><span class="linenos">781</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ARMS-782"><a href="#ARMS-782"><span class="linenos">782</span></a>            <span class="n">decode</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">clause</span><span class="p">)]:</span> <span class="n">clause</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">encoded_model</span>
</span><span id="ARMS-783"><a href="#ARMS-783"><span class="linenos">783</span></a>        <span class="p">}</span>
</span><span id="ARMS-784"><a href="#ARMS-784"><span class="linenos">784</span></a>
</span><span id="ARMS-785"><a href="#ARMS-785"><span class="linenos">785</span></a>        <span class="k">return</span> <span class="n">model</span>
</span><span id="ARMS-786"><a href="#ARMS-786"><span class="linenos">786</span></a>
</span><span id="ARMS-787"><a href="#ARMS-787"><span class="linenos">787</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-788"><a href="#ARMS-788"><span class="linenos">788</span></a>    <span class="k">def</span> <span class="nf">step5</span><span class="p">(</span>
</span><span id="ARMS-789"><a href="#ARMS-789"><span class="linenos">789</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
</span><span id="ARMS-790"><a href="#ARMS-790"><span class="linenos">790</span></a>        <span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS-791"><a href="#ARMS-791"><span class="linenos">791</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS-792"><a href="#ARMS-792"><span class="linenos">792</span></a>    <span class="p">):</span>
</span><span id="ARMS-793"><a href="#ARMS-793"><span class="linenos">793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 5) Extract the learned action effects from the solved model.&quot;&quot;&quot;</span>
</span><span id="ARMS-794"><a href="#ARMS-794"><span class="linenos">794</span></a>        <span class="n">action_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">details</span><span class="p">():</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">}</span>
</span><span id="ARMS-795"><a href="#ARMS-795"><span class="linenos">795</span></a>        <span class="n">negative_constraints</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
</span><span id="ARMS-796"><a href="#ARMS-796"><span class="linenos">796</span></a>        <span class="n">plan_constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS-797"><a href="#ARMS-797"><span class="linenos">797</span></a>
</span><span id="ARMS-798"><a href="#ARMS-798"><span class="linenos">798</span></a>        <span class="c1"># NOTE: only taking the top n (optimal number varies, determine</span>
</span><span id="ARMS-799"><a href="#ARMS-799"><span class="linenos">799</span></a>        <span class="c1"># empirically) constraints usually results in more accurate action</span>
</span><span id="ARMS-800"><a href="#ARMS-800"><span class="linenos">800</span></a>        <span class="c1"># models, however this is not a part of the paper and therefore not</span>
</span><span id="ARMS-801"><a href="#ARMS-801"><span class="linenos">801</span></a>        <span class="c1"># implemented.</span>
</span><span id="ARMS-802"><a href="#ARMS-802"><span class="linenos">802</span></a>        <span class="k">for</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ARMS-803"><a href="#ARMS-803"><span class="linenos">803</span></a>            <span class="n">constraint</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; (BREAK) &quot;</span><span class="p">)</span>
</span><span id="ARMS-804"><a href="#ARMS-804"><span class="linenos">804</span></a>            <span class="n">relation</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ARMS-805"><a href="#ARMS-805"><span class="linenos">805</span></a>            <span class="n">ctype</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># constraint type</span>
</span><span id="ARMS-806"><a href="#ARMS-806"><span class="linenos">806</span></a>            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
</span><span id="ARMS-807"><a href="#ARMS-807"><span class="linenos">807</span></a>                <span class="n">effect</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ARMS-808"><a href="#ARMS-808"><span class="linenos">808</span></a>                <span class="n">action</span> <span class="o">=</span> <span class="n">action_map</span><span class="p">[</span><span class="n">constraint</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="ARMS-809"><a href="#ARMS-809"><span class="linenos">809</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-810"><a href="#ARMS-810"><span class="linenos">810</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS-811"><a href="#ARMS-811"><span class="linenos">811</span></a>                        <span class="sa">f</span><span class="s2">&quot;Learned constraint: </span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">effect</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-812"><a href="#ARMS-812"><span class="linenos">812</span></a>                    <span class="p">)</span>
</span><span id="ARMS-813"><a href="#ARMS-813"><span class="linenos">813</span></a>                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
</span><span id="ARMS-814"><a href="#ARMS-814"><span class="linenos">814</span></a>                    <span class="n">action_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ARMS-815"><a href="#ARMS-815"><span class="linenos">815</span></a>                        <span class="s2">&quot;pre&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">update_precond</span><span class="p">,</span>
</span><span id="ARMS-816"><a href="#ARMS-816"><span class="linenos">816</span></a>                        <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">update_add</span><span class="p">,</span>
</span><span id="ARMS-817"><a href="#ARMS-817"><span class="linenos">817</span></a>                        <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">update_delete</span><span class="p">,</span>
</span><span id="ARMS-818"><a href="#ARMS-818"><span class="linenos">818</span></a>                    <span class="p">}[</span><span class="n">effect</span><span class="p">]</span>
</span><span id="ARMS-819"><a href="#ARMS-819"><span class="linenos">819</span></a>                    <span class="n">action_update</span><span class="p">({</span><span class="n">relation</span><span class="p">})</span>
</span><span id="ARMS-820"><a href="#ARMS-820"><span class="linenos">820</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ARMS-821"><a href="#ARMS-821"><span class="linenos">821</span></a>                    <span class="n">action_effect</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ARMS-822"><a href="#ARMS-822"><span class="linenos">822</span></a>                        <span class="s2">&quot;pre&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">precond</span><span class="p">,</span>
</span><span id="ARMS-823"><a href="#ARMS-823"><span class="linenos">823</span></a>                        <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
</span><span id="ARMS-824"><a href="#ARMS-824"><span class="linenos">824</span></a>                        <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span>
</span><span id="ARMS-825"><a href="#ARMS-825"><span class="linenos">825</span></a>                    <span class="p">}[</span><span class="n">effect</span><span class="p">]</span>
</span><span id="ARMS-826"><a href="#ARMS-826"><span class="linenos">826</span></a>                    <span class="k">if</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">action_effect</span><span class="p">:</span>
</span><span id="ARMS-827"><a href="#ARMS-827"><span class="linenos">827</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-828"><a href="#ARMS-828"><span class="linenos">828</span></a>                            <span class="n">warn</span><span class="p">(</span>
</span><span id="ARMS-829"><a href="#ARMS-829"><span class="linenos">829</span></a>                                <span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">effect</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS-830"><a href="#ARMS-830"><span class="linenos">830</span></a>                            <span class="p">)</span>
</span><span id="ARMS-831"><a href="#ARMS-831"><span class="linenos">831</span></a>                        <span class="n">action_effect</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>
</span><span id="ARMS-832"><a href="#ARMS-832"><span class="linenos">832</span></a>                    <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">relation</span><span class="p">,</span> <span class="n">action</span><span class="p">)]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</span><span id="ARMS-833"><a href="#ARMS-833"><span class="linenos">833</span></a>
</span><span id="ARMS-834"><a href="#ARMS-834"><span class="linenos">834</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># store plan constraint</span>
</span><span id="ARMS-835"><a href="#ARMS-835"><span class="linenos">835</span></a>                <span class="n">ai</span> <span class="o">=</span> <span class="n">action_map</span><span class="p">[</span><span class="n">constraint</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="ARMS-836"><a href="#ARMS-836"><span class="linenos">836</span></a>                <span class="n">aj</span> <span class="o">=</span> <span class="n">action_map</span><span class="p">[</span><span class="n">constraint</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="ARMS-837"><a href="#ARMS-837"><span class="linenos">837</span></a>                <span class="n">plan_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">relation</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span><span class="p">))</span>
</span><span id="ARMS-838"><a href="#ARMS-838"><span class="linenos">838</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS-839"><a href="#ARMS-839"><span class="linenos">839</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> possibly explains action pair (</span><span class="si">{</span><span class="n">ai</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">aj</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ARMS-840"><a href="#ARMS-840"><span class="linenos">840</span></a>
</span><span id="ARMS-841"><a href="#ARMS-841"><span class="linenos">841</span></a>        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">plan_constraints</span><span class="p">:</span>
</span><span id="ARMS-842"><a href="#ARMS-842"><span class="linenos">842</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="ARMS-843"><a href="#ARMS-843"><span class="linenos">843</span></a>                <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-844"><a href="#ARMS-844"><span class="linenos">844</span></a>                    <span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span>
</span><span id="ARMS-845"><a href="#ARMS-845"><span class="linenos">845</span></a>                <span class="p">)</span>  <span class="c1"># P3</span>
</span><span id="ARMS-846"><a href="#ARMS-846"><span class="linenos">846</span></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">))</span>  <span class="c1"># P4</span>
</span><span id="ARMS-847"><a href="#ARMS-847"><span class="linenos">847</span></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">add</span><span class="p">))</span>  <span class="c1"># P5</span>
</span><span id="ARMS-848"><a href="#ARMS-848"><span class="linenos">848</span></a>            <span class="p">):</span>
</span><span id="ARMS-849"><a href="#ARMS-849"><span class="linenos">849</span></a>                <span class="c1"># check if either P3 or P4 are partially fulfilled and can be satisfied</span>
</span><span id="ARMS-850"><a href="#ARMS-850"><span class="linenos">850</span></a>                <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">):</span>
</span><span id="ARMS-851"><a href="#ARMS-851"><span class="linenos">851</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">:</span>
</span><span id="ARMS-852"><a href="#ARMS-852"><span class="linenos">852</span></a>                        <span class="c1"># if P3 isn&#39;t contradicted, add p to ai.precond</span>
</span><span id="ARMS-853"><a href="#ARMS-853"><span class="linenos">853</span></a>                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-854"><a href="#ARMS-854"><span class="linenos">854</span></a>                            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-855"><a href="#ARMS-855"><span class="linenos">855</span></a>                            <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS-856"><a href="#ARMS-856"><span class="linenos">856</span></a>                        <span class="p">):</span>
</span><span id="ARMS-857"><a href="#ARMS-857"><span class="linenos">857</span></a>                            <span class="n">ai</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-858"><a href="#ARMS-858"><span class="linenos">858</span></a>
</span><span id="ARMS-859"><a href="#ARMS-859"><span class="linenos">859</span></a>                        <span class="c1"># if P4 isn&#39;t contradicted, add p to ai.add</span>
</span><span id="ARMS-860"><a href="#ARMS-860"><span class="linenos">860</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-861"><a href="#ARMS-861"><span class="linenos">861</span></a>                            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-862"><a href="#ARMS-862"><span class="linenos">862</span></a>                            <span class="ow">and</span> <span class="s2">&quot;add&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS-863"><a href="#ARMS-863"><span class="linenos">863</span></a>                        <span class="p">):</span>
</span><span id="ARMS-864"><a href="#ARMS-864"><span class="linenos">864</span></a>                            <span class="n">ai</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-865"><a href="#ARMS-865"><span class="linenos">865</span></a>
</span><span id="ARMS-866"><a href="#ARMS-866"><span class="linenos">866</span></a>                    <span class="c1"># p in ai.precond and P3 not contradicted, add p to aj.precond</span>
</span><span id="ARMS-867"><a href="#ARMS-867"><span class="linenos">867</span></a>                    <span class="k">elif</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-868"><a href="#ARMS-868"><span class="linenos">868</span></a>                        <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-869"><a href="#ARMS-869"><span class="linenos">869</span></a>                        <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS-870"><a href="#ARMS-870"><span class="linenos">870</span></a>                    <span class="p">):</span>
</span><span id="ARMS-871"><a href="#ARMS-871"><span class="linenos">871</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-872"><a href="#ARMS-872"><span class="linenos">872</span></a>
</span><span id="ARMS-873"><a href="#ARMS-873"><span class="linenos">873</span></a>                <span class="c1"># check if either P3 or P4 can be satisfied</span>
</span><span id="ARMS-874"><a href="#ARMS-874"><span class="linenos">874</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-875"><a href="#ARMS-875"><span class="linenos">875</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-876"><a href="#ARMS-876"><span class="linenos">876</span></a>                    <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS-877"><a href="#ARMS-877"><span class="linenos">877</span></a>                <span class="p">):</span>
</span><span id="ARMS-878"><a href="#ARMS-878"><span class="linenos">878</span></a>                    <span class="c1"># if P3 isn&#39;t contradicted, add p to both ai and aj preconds</span>
</span><span id="ARMS-879"><a href="#ARMS-879"><span class="linenos">879</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-880"><a href="#ARMS-880"><span class="linenos">880</span></a>                        <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-881"><a href="#ARMS-881"><span class="linenos">881</span></a>                        <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS-882"><a href="#ARMS-882"><span class="linenos">882</span></a>                    <span class="p">):</span>
</span><span id="ARMS-883"><a href="#ARMS-883"><span class="linenos">883</span></a>                        <span class="n">ai</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-884"><a href="#ARMS-884"><span class="linenos">884</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-885"><a href="#ARMS-885"><span class="linenos">885</span></a>
</span><span id="ARMS-886"><a href="#ARMS-886"><span class="linenos">886</span></a>                    <span class="c1"># if P4 isn&#39;t contradicted, add p to ai.add and aj.precond</span>
</span><span id="ARMS-887"><a href="#ARMS-887"><span class="linenos">887</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-888"><a href="#ARMS-888"><span class="linenos">888</span></a>                        <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-889"><a href="#ARMS-889"><span class="linenos">889</span></a>                        <span class="ow">and</span> <span class="s2">&quot;add&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS-890"><a href="#ARMS-890"><span class="linenos">890</span></a>                    <span class="p">):</span>
</span><span id="ARMS-891"><a href="#ARMS-891"><span class="linenos">891</span></a>                        <span class="n">ai</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-892"><a href="#ARMS-892"><span class="linenos">892</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-893"><a href="#ARMS-893"><span class="linenos">893</span></a>
</span><span id="ARMS-894"><a href="#ARMS-894"><span class="linenos">894</span></a>                <span class="c1"># check if P5 can be satisfied</span>
</span><span id="ARMS-895"><a href="#ARMS-895"><span class="linenos">895</span></a>                <span class="c1"># if P5 isn&#39;t contradicted, add p wherever it is missing</span>
</span><span id="ARMS-896"><a href="#ARMS-896"><span class="linenos">896</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-897"><a href="#ARMS-897"><span class="linenos">897</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-898"><a href="#ARMS-898"><span class="linenos">898</span></a>                    <span class="ow">and</span> <span class="s2">&quot;del&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS-899"><a href="#ARMS-899"><span class="linenos">899</span></a>                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS-900"><a href="#ARMS-900"><span class="linenos">900</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS-901"><a href="#ARMS-901"><span class="linenos">901</span></a>                    <span class="ow">and</span> <span class="s2">&quot;add&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS-902"><a href="#ARMS-902"><span class="linenos">902</span></a>                <span class="p">):</span>
</span><span id="ARMS-903"><a href="#ARMS-903"><span class="linenos">903</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span>
</span><span id="ARMS-904"><a href="#ARMS-904"><span class="linenos">904</span></a>                        <span class="n">ai</span><span class="o">.</span><span class="n">update_delete</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-905"><a href="#ARMS-905"><span class="linenos">905</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aj</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
</span><span id="ARMS-906"><a href="#ARMS-906"><span class="linenos">906</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS-907"><a href="#ARMS-907"><span class="linenos">907</span></a>
</span><span id="ARMS-908"><a href="#ARMS-908"><span class="linenos">908</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS-909"><a href="#ARMS-909"><span class="linenos">909</span></a>    <span class="k">def</span> <span class="nf">debug_menu</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ARMS-910"><a href="#ARMS-910"><span class="linenos">910</span></a>        <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="s2">&quot; (y/n): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="ARMS-911"><a href="#ARMS-911"><span class="linenos">911</span></a>        <span class="k">while</span> <span class="n">choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]:</span>
</span><span id="ARMS-912"><a href="#ARMS-912"><span class="linenos">912</span></a>            <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="s2">&quot; (y/n): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="ARMS-913"><a href="#ARMS-913"><span class="linenos">913</span></a>        <span class="k">return</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span>
</span></pre></div>


            <div class="docstring"><p>ARMS model extraction method.</p>

<p>Extracts a Model from state observations using the ARMS technique. Fluents
are retrieved from the initial state. Actions are learned using the
algorithm.</p>
</div>


                            <div id="ARMS.__init__" class="classattr">
                                        <input id="ARMS.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ARMS</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">upper_bound</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">110</span>,</span><span class="param">	<span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span>,</span><span class="param">	<span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span></span>)</span>

                <label class="view-source-button" for="ARMS.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.__init__-67"><a href="#ARMS.__init__-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="ARMS.__init__-68"><a href="#ARMS.__init__-68"><span class="linenos"> 68</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ARMS.__init__-69"><a href="#ARMS.__init__-69"><span class="linenos"> 69</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS.__init__-70"><a href="#ARMS.__init__-70"><span class="linenos"> 70</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.__init__-71"><a href="#ARMS.__init__-71"><span class="linenos"> 71</span></a>        <span class="n">upper_bound</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.__init__-72"><a href="#ARMS.__init__-72"><span class="linenos"> 72</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ARMS.__init__-73"><a href="#ARMS.__init__-73"><span class="linenos"> 73</span></a>        <span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>
</span><span id="ARMS.__init__-74"><a href="#ARMS.__init__-74"><span class="linenos"> 74</span></a>        <span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="ARMS.__init__-75"><a href="#ARMS.__init__-75"><span class="linenos"> 75</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="ARMS.__init__-76"><a href="#ARMS.__init__-76"><span class="linenos"> 76</span></a>        <span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="ARMS.__init__-77"><a href="#ARMS.__init__-77"><span class="linenos"> 77</span></a>        <span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="ARMS.__init__-78"><a href="#ARMS.__init__-78"><span class="linenos"> 78</span></a>    <span class="p">):</span>
</span><span id="ARMS.__init__-79"><a href="#ARMS.__init__-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ARMS.__init__-80"><a href="#ARMS.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        Arguments:</span>
</span><span id="ARMS.__init__-81"><a href="#ARMS.__init__-81"><span class="linenos"> 81</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="ARMS.__init__-82"><a href="#ARMS.__init__-82"><span class="linenos"> 82</span></a><span class="sd">                The observations to extract the model from.</span>
</span><span id="ARMS.__init__-83"><a href="#ARMS.__init__-83"><span class="linenos"> 83</span></a><span class="sd">            upper_bound (int):</span>
</span><span id="ARMS.__init__-84"><a href="#ARMS.__init__-84"><span class="linenos"> 84</span></a><span class="sd">                The upper bound for the maximum size of an action&#39;s preconditions and</span>
</span><span id="ARMS.__init__-85"><a href="#ARMS.__init__-85"><span class="linenos"> 85</span></a><span class="sd">                add/delete lists. Determines when an action schemata is fully learned.</span>
</span><span id="ARMS.__init__-86"><a href="#ARMS.__init__-86"><span class="linenos"> 86</span></a><span class="sd">            min_support (int):</span>
</span><span id="ARMS.__init__-87"><a href="#ARMS.__init__-87"><span class="linenos"> 87</span></a><span class="sd">                The minimum support count for an action pair to be considered frequent.</span>
</span><span id="ARMS.__init__-88"><a href="#ARMS.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            action_weight (int):</span>
</span><span id="ARMS.__init__-89"><a href="#ARMS.__init__-89"><span class="linenos"> 89</span></a><span class="sd">                The constant weight W_A(a) to assign to each action constraint.</span>
</span><span id="ARMS.__init__-90"><a href="#ARMS.__init__-90"><span class="linenos"> 90</span></a><span class="sd">                Should be set higher than the weight of information constraints.</span>
</span><span id="ARMS.__init__-91"><a href="#ARMS.__init__-91"><span class="linenos"> 91</span></a><span class="sd">            info_weight (int):</span>
</span><span id="ARMS.__init__-92"><a href="#ARMS.__init__-92"><span class="linenos"> 92</span></a><span class="sd">                The constant weight W_I(r) to assign to each information constraint.</span>
</span><span id="ARMS.__init__-93"><a href="#ARMS.__init__-93"><span class="linenos"> 93</span></a><span class="sd">                Determined empirically, generally the highest in all constraints&#39; weights.</span>
</span><span id="ARMS.__init__-94"><a href="#ARMS.__init__-94"><span class="linenos"> 94</span></a><span class="sd">            threshold (float):</span>
</span><span id="ARMS.__init__-95"><a href="#ARMS.__init__-95"><span class="linenos"> 95</span></a><span class="sd">                (0-1). The probability threshold  to determine if an I3/plan constraint</span>
</span><span id="ARMS.__init__-96"><a href="#ARMS.__init__-96"><span class="linenos"> 96</span></a><span class="sd">                is weighted by its probability or set to a default value.</span>
</span><span id="ARMS.__init__-97"><a href="#ARMS.__init__-97"><span class="linenos"> 97</span></a><span class="sd">            info3_default (int):</span>
</span><span id="ARMS.__init__-98"><a href="#ARMS.__init__-98"><span class="linenos"> 98</span></a><span class="sd">                The default weight for I3 constraints with probability below the threshold.</span>
</span><span id="ARMS.__init__-99"><a href="#ARMS.__init__-99"><span class="linenos"> 99</span></a><span class="sd">            plan_default (int):</span>
</span><span id="ARMS.__init__-100"><a href="#ARMS.__init__-100"><span class="linenos">100</span></a><span class="sd">                The default weight for plan constraints with probability below the threshold.</span>
</span><span id="ARMS.__init__-101"><a href="#ARMS.__init__-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS.__init__-102"><a href="#ARMS.__init__-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">PartialObservation</span><span class="p">:</span>
</span><span id="ARMS.__init__-103"><a href="#ARMS.__init__-103"><span class="linenos">103</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">ARMS</span><span class="p">)</span>
</span><span id="ARMS.__init__-104"><a href="#ARMS.__init__-104"><span class="linenos">104</span></a>
</span><span id="ARMS.__init__-105"><a href="#ARMS.__init__-105"><span class="linenos">105</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="ARMS.__init__-106"><a href="#ARMS.__init__-106"><span class="linenos">106</span></a>            <span class="k">raise</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">InvalidThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="ARMS.__init__-107"><a href="#ARMS.__init__-107"><span class="linenos">107</span></a>
</span><span id="ARMS.__init__-108"><a href="#ARMS.__init__-108"><span class="linenos">108</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">get_fluents</span><span class="p">()</span>
</span><span id="ARMS.__init__-109"><a href="#ARMS.__init__-109"><span class="linenos">109</span></a>        <span class="c1"># get fluents from initial state</span>
</span><span id="ARMS.__init__-110"><a href="#ARMS.__init__-110"><span class="linenos">110</span></a>        <span class="c1"># call algorithm to get actions</span>
</span><span id="ARMS.__init__-111"><a href="#ARMS.__init__-111"><span class="linenos">111</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_arms</span><span class="p">(</span>
</span><span id="ARMS.__init__-112"><a href="#ARMS.__init__-112"><span class="linenos">112</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span>
</span><span id="ARMS.__init__-113"><a href="#ARMS.__init__-113"><span class="linenos">113</span></a>            <span class="n">upper_bound</span><span class="p">,</span>
</span><span id="ARMS.__init__-114"><a href="#ARMS.__init__-114"><span class="linenos">114</span></a>            <span class="n">fluents</span><span class="p">,</span>
</span><span id="ARMS.__init__-115"><a href="#ARMS.__init__-115"><span class="linenos">115</span></a>            <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS.__init__-116"><a href="#ARMS.__init__-116"><span class="linenos">116</span></a>            <span class="n">action_weight</span><span class="p">,</span>
</span><span id="ARMS.__init__-117"><a href="#ARMS.__init__-117"><span class="linenos">117</span></a>            <span class="n">info_weight</span><span class="p">,</span>
</span><span id="ARMS.__init__-118"><a href="#ARMS.__init__-118"><span class="linenos">118</span></a>            <span class="n">threshold</span><span class="p">,</span>
</span><span id="ARMS.__init__-119"><a href="#ARMS.__init__-119"><span class="linenos">119</span></a>            <span class="n">info3_default</span><span class="p">,</span>
</span><span id="ARMS.__init__-120"><a href="#ARMS.__init__-120"><span class="linenos">120</span></a>            <span class="n">plan_default</span><span class="p">,</span>
</span><span id="ARMS.__init__-121"><a href="#ARMS.__init__-121"><span class="linenos">121</span></a>            <span class="n">debug</span><span class="p">,</span>
</span><span id="ARMS.__init__-122"><a href="#ARMS.__init__-122"><span class="linenos">122</span></a>        <span class="p">)</span>
</span><span id="ARMS.__init__-123"><a href="#ARMS.__init__-123"><span class="linenos">123</span></a>
</span><span id="ARMS.__init__-124"><a href="#ARMS.__init__-124"><span class="linenos">124</span></a>        <span class="c1"># learned_fluents = set(map(lambda f: LearnedFluent(f.name, f.objects), fluents))</span>
</span><span id="ARMS.__init__-125"><a href="#ARMS.__init__-125"><span class="linenos">125</span></a>        <span class="n">learned_fluents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS.__init__-126"><a href="#ARMS.__init__-126"><span class="linenos">126</span></a>        <span class="c1"># format</span>
</span><span id="ARMS.__init__-127"><a href="#ARMS.__init__-127"><span class="linenos">127</span></a>        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
</span><span id="ARMS.__init__-128"><a href="#ARMS.__init__-128"><span class="linenos">128</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">precond</span><span class="p">}</span>
</span><span id="ARMS.__init__-129"><a href="#ARMS.__init__-129"><span class="linenos">129</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">add</span><span class="p">}</span>
</span><span id="ARMS.__init__-130"><a href="#ARMS.__init__-130"><span class="linenos">130</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">delete</span><span class="p">}</span>
</span><span id="ARMS.__init__-131"><a href="#ARMS.__init__-131"><span class="linenos">131</span></a>            <span class="n">learned_fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span>
</span><span id="ARMS.__init__-132"><a href="#ARMS.__init__-132"><span class="linenos">132</span></a>            <span class="n">learned_fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="ARMS.__init__-133"><a href="#ARMS.__init__-133"><span class="linenos">133</span></a>            <span class="n">learned_fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">delete</span><span class="p">)</span>
</span><span id="ARMS.__init__-134"><a href="#ARMS.__init__-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">learned_fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Arguments:
    obs_tracelist (ObservationLists):
        The observations to extract the model from.
    upper_bound (int):
        The upper bound for the maximum size of an action's preconditions and
        add/delete lists. Determines when an action schemata is fully learned.
    min_support (int):
        The minimum support count for an action pair to be considered frequent.
    action_weight (int):
        The constant weight W_A(a) to assign to each action constraint.
        Should be set higher than the weight of information constraints.
    info_weight (int):
        The constant weight W_I(r) to assign to each information constraint.
        Determined empirically, generally the highest in all constraints' weights.
    threshold (float):
        (0-1). The probability threshold  to determine if an I3/plan constraint
        is weighted by its probability or set to a default value.
    info3_default (int):
        The default weight for I3 constraints with probability below the threshold.
    plan_default (int):
        The default weight for plan constraints with probability below the threshold.</p>
</div>


                            </div>
                            <div id="ARMS.step1" class="classattr">
                                        <input id="ARMS.step1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step1</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span> <span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step1-277"><a href="#ARMS.step1-277"><span class="linenos">277</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step1-278"><a href="#ARMS.step1-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">step1</span><span class="p">(</span>
</span><span id="ARMS.step1-279"><a href="#ARMS.step1-279"><span class="linenos">279</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="ARMS.step1-280"><a href="#ARMS.step1-280"><span class="linenos">280</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
</span><span id="ARMS.step1-281"><a href="#ARMS.step1-281"><span class="linenos">281</span></a>        <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
</span><span id="ARMS.step1-282"><a href="#ARMS.step1-282"><span class="linenos">282</span></a>        <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS.step1-283"><a href="#ARMS.step1-283"><span class="linenos">283</span></a>    <span class="p">]:</span>
</span><span id="ARMS.step1-284"><a href="#ARMS.step1-284"><span class="linenos">284</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 1) Substitute instantiated objects in each action instance with the object type.&quot;&quot;&quot;</span>
</span><span id="ARMS.step1-285"><a href="#ARMS.step1-285"><span class="linenos">285</span></a>
</span><span id="ARMS.step1-286"><a href="#ARMS.step1-286"><span class="linenos">286</span></a>        <span class="n">learned_actions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS.step1-287"><a href="#ARMS.step1-287"><span class="linenos">287</span></a>        <span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS.step1-288"><a href="#ARMS.step1-288"><span class="linenos">288</span></a>        <span class="k">for</span> <span class="n">obs_action</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">get_actions</span><span class="p">():</span>
</span><span id="ARMS.step1-289"><a href="#ARMS.step1-289"><span class="linenos">289</span></a>            <span class="c1"># We don&#39;t support objects with multiple types right now, so no</span>
</span><span id="ARMS.step1-290"><a href="#ARMS.step1-290"><span class="linenos">290</span></a>            <span class="c1"># multiple type clauses need to be generated.</span>
</span><span id="ARMS.step1-291"><a href="#ARMS.step1-291"><span class="linenos">291</span></a>
</span><span id="ARMS.step1-292"><a href="#ARMS.step1-292"><span class="linenos">292</span></a>            <span class="c1"># Create LearnedActions for each action, replacing instantiated</span>
</span><span id="ARMS.step1-293"><a href="#ARMS.step1-293"><span class="linenos">293</span></a>            <span class="c1"># objects with the object type.</span>
</span><span id="ARMS.step1-294"><a href="#ARMS.step1-294"><span class="linenos">294</span></a>            <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">obj_type</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">obs_action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">]</span>
</span><span id="ARMS.step1-295"><a href="#ARMS.step1-295"><span class="linenos">295</span></a>            <span class="n">learned_action</span> <span class="o">=</span> <span class="n">LearnedAction</span><span class="p">(</span><span class="n">obs_action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
</span><span id="ARMS.step1-296"><a href="#ARMS.step1-296"><span class="linenos">296</span></a>            <span class="n">learned_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">learned_action</span><span class="p">)</span>
</span><span id="ARMS.step1-297"><a href="#ARMS.step1-297"><span class="linenos">297</span></a>            <span class="n">action_map</span><span class="p">[</span><span class="n">obs_action</span><span class="p">]</span> <span class="o">=</span> <span class="n">learned_action</span>
</span><span id="ARMS.step1-298"><a href="#ARMS.step1-298"><span class="linenos">298</span></a>
</span><span id="ARMS.step1-299"><a href="#ARMS.step1-299"><span class="linenos">299</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS.step1-300"><a href="#ARMS.step1-300"><span class="linenos">300</span></a>        <span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">learned_actions</span><span class="p">:</span>
</span><span id="ARMS.step1-301"><a href="#ARMS.step1-301"><span class="linenos">301</span></a>            <span class="n">connected_actions</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS.step1-302"><a href="#ARMS.step1-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">learned_actions</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">a1</span><span class="p">}):</span>  <span class="c1"># includes connecting with self</span>
</span><span id="ARMS.step1-303"><a href="#ARMS.step1-303"><span class="linenos">303</span></a>                <span class="n">intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">obj_params</span><span class="p">))</span>
</span><span id="ARMS.step1-304"><a href="#ARMS.step1-304"><span class="linenos">304</span></a>                <span class="k">if</span> <span class="n">intersection</span><span class="p">:</span>
</span><span id="ARMS.step1-305"><a href="#ARMS.step1-305"><span class="linenos">305</span></a>                    <span class="n">connected_actions</span><span class="p">[</span><span class="n">a1</span><span class="p">][</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">intersection</span>
</span><span id="ARMS.step1-306"><a href="#ARMS.step1-306"><span class="linenos">306</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step1-307"><a href="#ARMS.step1-307"><span class="linenos">307</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS.step1-308"><a href="#ARMS.step1-308"><span class="linenos">308</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> is connected to </span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">intersection</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step1-309"><a href="#ARMS.step1-309"><span class="linenos">309</span></a>                        <span class="p">)</span>
</span><span id="ARMS.step1-310"><a href="#ARMS.step1-310"><span class="linenos">310</span></a>
</span><span id="ARMS.step1-311"><a href="#ARMS.step1-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="n">connected_actions</span><span class="p">,</span> <span class="n">action_map</span>
</span></pre></div>


            <div class="docstring"><p>(Step 1) Substitute instantiated objects in each action instance with the object type.</p>
</div>


                            </div>
                            <div id="ARMS.step2" class="classattr">
                                        <input id="ARMS.step2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step2</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>,</span><span class="param">	<span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span> <span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">fluent</span><span class="o">.</span><span class="n">Fluent</span><span class="p">]</span>,</span><span class="param">	<span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">extract</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">ARMSConstraints</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">fluent</span><span class="o">.</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">macq</span><span class="o">.</span><span class="n">extract</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">Relation</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step2-313"><a href="#ARMS.step2-313"><span class="linenos">313</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step2-314"><a href="#ARMS.step2-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">step2</span><span class="p">(</span>
</span><span id="ARMS.step2-315"><a href="#ARMS.step2-315"><span class="linenos">315</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS.step2-316"><a href="#ARMS.step2-316"><span class="linenos">316</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
</span><span id="ARMS.step2-317"><a href="#ARMS.step2-317"><span class="linenos">317</span></a>        <span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS.step2-318"><a href="#ARMS.step2-318"><span class="linenos">318</span></a>        <span class="n">fluents</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Fluent</span><span class="p">],</span>
</span><span id="ARMS.step2-319"><a href="#ARMS.step2-319"><span class="linenos">319</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.step2-320"><a href="#ARMS.step2-320"><span class="linenos">320</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.step2-321"><a href="#ARMS.step2-321"><span class="linenos">321</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ARMSConstraints</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">Relation</span><span class="p">]]:</span>
</span><span id="ARMS.step2-322"><a href="#ARMS.step2-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 2) Generate action constraints, information constraints, and plan constraints.</span>
</span><span id="ARMS.step2-323"><a href="#ARMS.step2-323"><span class="linenos">323</span></a>
</span><span id="ARMS.step2-324"><a href="#ARMS.step2-324"><span class="linenos">324</span></a><span class="sd">        For the unexplained actions, build a set of information and action</span>
</span><span id="ARMS.step2-325"><a href="#ARMS.step2-325"><span class="linenos">325</span></a><span class="sd">        constraints based on individual actions. Apply a frequent-set</span>
</span><span id="ARMS.step2-326"><a href="#ARMS.step2-326"><span class="linenos">326</span></a><span class="sd">        mining algorithm to find the frequent sets of connected actions and</span>
</span><span id="ARMS.step2-327"><a href="#ARMS.step2-327"><span class="linenos">327</span></a><span class="sd">        relations. Here connected means the actions and relations must share</span>
</span><span id="ARMS.step2-328"><a href="#ARMS.step2-328"><span class="linenos">328</span></a><span class="sd">        some common parameters.</span>
</span><span id="ARMS.step2-329"><a href="#ARMS.step2-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS.step2-330"><a href="#ARMS.step2-330"><span class="linenos">330</span></a>
</span><span id="ARMS.step2-331"><a href="#ARMS.step2-331"><span class="linenos">331</span></a>        <span class="c1"># Map fluents to relations</span>
</span><span id="ARMS.step2-332"><a href="#ARMS.step2-332"><span class="linenos">332</span></a>        <span class="c1"># relations are fluents but with instantiated objects replaced by the object type</span>
</span><span id="ARMS.step2-333"><a href="#ARMS.step2-333"><span class="linenos">333</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">Relation</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="ARMS.step2-334"><a href="#ARMS.step2-334"><span class="linenos">334</span></a>            <span class="nb">map</span><span class="p">(</span>
</span><span id="ARMS.step2-335"><a href="#ARMS.step2-335"><span class="linenos">335</span></a>                <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="p">(</span>
</span><span id="ARMS.step2-336"><a href="#ARMS.step2-336"><span class="linenos">336</span></a>                    <span class="n">f</span><span class="p">,</span>
</span><span id="ARMS.step2-337"><a href="#ARMS.step2-337"><span class="linenos">337</span></a>                    <span class="n">Relation</span><span class="p">(</span>
</span><span id="ARMS.step2-338"><a href="#ARMS.step2-338"><span class="linenos">338</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="ARMS.step2-339"><a href="#ARMS.step2-339"><span class="linenos">339</span></a>                        <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">obj_type</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">objects</span><span class="p">],</span>
</span><span id="ARMS.step2-340"><a href="#ARMS.step2-340"><span class="linenos">340</span></a>                    <span class="p">),</span>
</span><span id="ARMS.step2-341"><a href="#ARMS.step2-341"><span class="linenos">341</span></a>                <span class="p">),</span>
</span><span id="ARMS.step2-342"><a href="#ARMS.step2-342"><span class="linenos">342</span></a>                <span class="n">fluents</span><span class="p">,</span>
</span><span id="ARMS.step2-343"><a href="#ARMS.step2-343"><span class="linenos">343</span></a>            <span class="p">)</span>
</span><span id="ARMS.step2-344"><a href="#ARMS.step2-344"><span class="linenos">344</span></a>        <span class="p">)</span>
</span><span id="ARMS.step2-345"><a href="#ARMS.step2-345"><span class="linenos">345</span></a>
</span><span id="ARMS.step2-346"><a href="#ARMS.step2-346"><span class="linenos">346</span></a>        <span class="n">debuga</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug action constraints?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS.step2-347"><a href="#ARMS.step2-347"><span class="linenos">347</span></a>
</span><span id="ARMS.step2-348"><a href="#ARMS.step2-348"><span class="linenos">348</span></a>        <span class="n">action_constraints</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2A</span><span class="p">(</span>
</span><span id="ARMS.step2-349"><a href="#ARMS.step2-349"><span class="linenos">349</span></a>            <span class="n">connected_actions</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">relations</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">debuga</span>
</span><span id="ARMS.step2-350"><a href="#ARMS.step2-350"><span class="linenos">350</span></a>        <span class="p">)</span>
</span><span id="ARMS.step2-351"><a href="#ARMS.step2-351"><span class="linenos">351</span></a>
</span><span id="ARMS.step2-352"><a href="#ARMS.step2-352"><span class="linenos">352</span></a>        <span class="n">debugi</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug info constraints?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS.step2-353"><a href="#ARMS.step2-353"><span class="linenos">353</span></a>        <span class="n">info_constraints</span><span class="p">,</span> <span class="n">info_support_counts</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2I</span><span class="p">(</span>
</span><span id="ARMS.step2-354"><a href="#ARMS.step2-354"><span class="linenos">354</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">relations</span><span class="p">,</span> <span class="n">action_map</span><span class="p">,</span> <span class="n">debugi</span>
</span><span id="ARMS.step2-355"><a href="#ARMS.step2-355"><span class="linenos">355</span></a>        <span class="p">)</span>
</span><span id="ARMS.step2-356"><a href="#ARMS.step2-356"><span class="linenos">356</span></a>
</span><span id="ARMS.step2-357"><a href="#ARMS.step2-357"><span class="linenos">357</span></a>        <span class="n">debugp</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">debug_menu</span><span class="p">(</span><span class="s2">&quot;Debug plan constraints?&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="ARMS.step2-358"><a href="#ARMS.step2-358"><span class="linenos">358</span></a>        <span class="n">plan_constraints</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">step2P</span><span class="p">(</span>
</span><span id="ARMS.step2-359"><a href="#ARMS.step2-359"><span class="linenos">359</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span>
</span><span id="ARMS.step2-360"><a href="#ARMS.step2-360"><span class="linenos">360</span></a>            <span class="n">connected_actions</span><span class="p">,</span>
</span><span id="ARMS.step2-361"><a href="#ARMS.step2-361"><span class="linenos">361</span></a>            <span class="n">action_map</span><span class="p">,</span>
</span><span id="ARMS.step2-362"><a href="#ARMS.step2-362"><span class="linenos">362</span></a>            <span class="nb">set</span><span class="p">(</span><span class="n">relations</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
</span><span id="ARMS.step2-363"><a href="#ARMS.step2-363"><span class="linenos">363</span></a>            <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS.step2-364"><a href="#ARMS.step2-364"><span class="linenos">364</span></a>            <span class="n">debugp</span><span class="p">,</span>
</span><span id="ARMS.step2-365"><a href="#ARMS.step2-365"><span class="linenos">365</span></a>        <span class="p">)</span>
</span><span id="ARMS.step2-366"><a href="#ARMS.step2-366"><span class="linenos">366</span></a>
</span><span id="ARMS.step2-367"><a href="#ARMS.step2-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="ARMS.step2-368"><a href="#ARMS.step2-368"><span class="linenos">368</span></a>            <span class="n">ARMSConstraints</span><span class="p">(</span>
</span><span id="ARMS.step2-369"><a href="#ARMS.step2-369"><span class="linenos">369</span></a>                <span class="n">action_constraints</span><span class="p">,</span>
</span><span id="ARMS.step2-370"><a href="#ARMS.step2-370"><span class="linenos">370</span></a>                <span class="n">info_constraints</span><span class="p">,</span>
</span><span id="ARMS.step2-371"><a href="#ARMS.step2-371"><span class="linenos">371</span></a>                <span class="n">info_support_counts</span><span class="p">,</span>
</span><span id="ARMS.step2-372"><a href="#ARMS.step2-372"><span class="linenos">372</span></a>                <span class="n">plan_constraints</span><span class="p">,</span>
</span><span id="ARMS.step2-373"><a href="#ARMS.step2-373"><span class="linenos">373</span></a>            <span class="p">),</span>
</span><span id="ARMS.step2-374"><a href="#ARMS.step2-374"><span class="linenos">374</span></a>            <span class="n">relations</span><span class="p">,</span>
</span><span id="ARMS.step2-375"><a href="#ARMS.step2-375"><span class="linenos">375</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>(Step 2) Generate action constraints, information constraints, and plan constraints.</p>

<p>For the unexplained actions, build a set of information and action
constraints based on individual actions. Apply a frequent-set
mining algorithm to find the frequent sets of connected actions and
relations. Here connected means the actions and relations must share
some common parameters.</p>
</div>


                            </div>
                            <div id="ARMS.step2A" class="classattr">
                                        <input id="ARMS.step2A-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step2A</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">]]</span>,</span><span class="param">	<span class="n">relations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">extract</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">Relation</span><span class="p">]</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Or</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Var</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step2A-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step2A"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step2A-377"><a href="#ARMS.step2A-377"><span class="linenos">377</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step2A-378"><a href="#ARMS.step2A-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">step2A</span><span class="p">(</span>
</span><span id="ARMS.step2A-379"><a href="#ARMS.step2A-379"><span class="linenos">379</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">]],</span>
</span><span id="ARMS.step2A-380"><a href="#ARMS.step2A-380"><span class="linenos">380</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Relation</span><span class="p">],</span>
</span><span id="ARMS.step2A-381"><a href="#ARMS.step2A-381"><span class="linenos">381</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.step2A-382"><a href="#ARMS.step2A-382"><span class="linenos">382</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]:</span>
</span><span id="ARMS.step2A-383"><a href="#ARMS.step2A-383"><span class="linenos">383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Action constraints.</span>
</span><span id="ARMS.step2A-384"><a href="#ARMS.step2A-384"><span class="linenos">384</span></a>
</span><span id="ARMS.step2A-385"><a href="#ARMS.step2A-385"><span class="linenos">385</span></a><span class="sd">        A1. The intersection of the precondition and add lists of all actions must be empty.</span>
</span><span id="ARMS.step2A-386"><a href="#ARMS.step2A-386"><span class="linenos">386</span></a>
</span><span id="ARMS.step2A-387"><a href="#ARMS.step2A-387"><span class="linenos">387</span></a><span class="sd">        A2. In addition, if an actions delete list includes a relation, this relation is</span>
</span><span id="ARMS.step2A-388"><a href="#ARMS.step2A-388"><span class="linenos">388</span></a><span class="sd">        in the actions precondition list. Thus, for every action, we require that</span>
</span><span id="ARMS.step2A-389"><a href="#ARMS.step2A-389"><span class="linenos">389</span></a><span class="sd">        the delete list is a subset of the precondition list.</span>
</span><span id="ARMS.step2A-390"><a href="#ARMS.step2A-390"><span class="linenos">390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS.step2A-391"><a href="#ARMS.step2A-391"><span class="linenos">391</span></a>
</span><span id="ARMS.step2A-392"><a href="#ARMS.step2A-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2A-393"><a href="#ARMS.step2A-393"><span class="linenos">393</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Building action constraints...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ARMS.step2A-394"><a href="#ARMS.step2A-394"><span class="linenos">394</span></a>
</span><span id="ARMS.step2A-395"><a href="#ARMS.step2A-395"><span class="linenos">395</span></a>        <span class="k">def</span> <span class="nf">implication</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Var</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Var</span><span class="p">):</span>
</span><span id="ARMS.step2A-396"><a href="#ARMS.step2A-396"><span class="linenos">396</span></a>            <span class="k">return</span> <span class="n">Or</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">negate</span><span class="p">(),</span> <span class="n">b</span><span class="p">])</span>
</span><span id="ARMS.step2A-397"><a href="#ARMS.step2A-397"><span class="linenos">397</span></a>
</span><span id="ARMS.step2A-398"><a href="#ARMS.step2A-398"><span class="linenos">398</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS.step2A-399"><a href="#ARMS.step2A-399"><span class="linenos">399</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">connected_actions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS.step2A-400"><a href="#ARMS.step2A-400"><span class="linenos">400</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
</span><span id="ARMS.step2A-401"><a href="#ARMS.step2A-401"><span class="linenos">401</span></a>            <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">relations</span><span class="p">:</span>
</span><span id="ARMS.step2A-402"><a href="#ARMS.step2A-402"><span class="linenos">402</span></a>                <span class="c1"># A relation is relevant to an action if they share parameter types</span>
</span><span id="ARMS.step2A-403"><a href="#ARMS.step2A-403"><span class="linenos">403</span></a>                <span class="k">if</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
</span><span id="ARMS.step2A-404"><a href="#ARMS.step2A-404"><span class="linenos">404</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2A-405"><a href="#ARMS.step2A-405"><span class="linenos">405</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS.step2A-406"><a href="#ARMS.step2A-406"><span class="linenos">406</span></a>                            <span class="sa">f</span><span class="s1">&#39;relation (</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s1">) is relevant to action &quot;</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="ARMS.step2A-407"><a href="#ARMS.step2A-407"><span class="linenos">407</span></a>                            <span class="s2">&quot;A1:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-408"><a href="#ARMS.step2A-408"><span class="linenos">408</span></a>                            <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> add  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> pre</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-409"><a href="#ARMS.step2A-409"><span class="linenos">409</span></a>                            <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> pre  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> add</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-410"><a href="#ARMS.step2A-410"><span class="linenos">410</span></a>                            <span class="s2">&quot;A2:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-411"><a href="#ARMS.step2A-411"><span class="linenos">411</span></a>                            <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> del  </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> pre</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-412"><a href="#ARMS.step2A-412"><span class="linenos">412</span></a>                        <span class="p">)</span>
</span><span id="ARMS.step2A-413"><a href="#ARMS.step2A-413"><span class="linenos">413</span></a>
</span><span id="ARMS.step2A-414"><a href="#ARMS.step2A-414"><span class="linenos">414</span></a>                    <span class="c1"># A1</span>
</span><span id="ARMS.step2A-415"><a href="#ARMS.step2A-415"><span class="linenos">415</span></a>                    <span class="c1"># relation in action.add =&gt; relation not in action.precond</span>
</span><span id="ARMS.step2A-416"><a href="#ARMS.step2A-416"><span class="linenos">416</span></a>                    <span class="c1"># relation in action.precond =&gt; relation not in action.add</span>
</span><span id="ARMS.step2A-417"><a href="#ARMS.step2A-417"><span class="linenos">417</span></a>
</span><span id="ARMS.step2A-418"><a href="#ARMS.step2A-418"><span class="linenos">418</span></a>                    <span class="c1"># (BREAK) marks unambiguous breakpoints for parsing later</span>
</span><span id="ARMS.step2A-419"><a href="#ARMS.step2A-419"><span class="linenos">419</span></a>                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS.step2A-420"><a href="#ARMS.step2A-420"><span class="linenos">420</span></a>                        <span class="n">implication</span><span class="p">(</span>
</span><span id="ARMS.step2A-421"><a href="#ARMS.step2A-421"><span class="linenos">421</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2A-422"><a href="#ARMS.step2A-422"><span class="linenos">422</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-423"><a href="#ARMS.step2A-423"><span class="linenos">423</span></a>                            <span class="p">),</span>
</span><span id="ARMS.step2A-424"><a href="#ARMS.step2A-424"><span class="linenos">424</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2A-425"><a href="#ARMS.step2A-425"><span class="linenos">425</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-426"><a href="#ARMS.step2A-426"><span class="linenos">426</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">negate</span><span class="p">(),</span>
</span><span id="ARMS.step2A-427"><a href="#ARMS.step2A-427"><span class="linenos">427</span></a>                        <span class="p">)</span>
</span><span id="ARMS.step2A-428"><a href="#ARMS.step2A-428"><span class="linenos">428</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step2A-429"><a href="#ARMS.step2A-429"><span class="linenos">429</span></a>                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS.step2A-430"><a href="#ARMS.step2A-430"><span class="linenos">430</span></a>                        <span class="n">implication</span><span class="p">(</span>
</span><span id="ARMS.step2A-431"><a href="#ARMS.step2A-431"><span class="linenos">431</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2A-432"><a href="#ARMS.step2A-432"><span class="linenos">432</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-433"><a href="#ARMS.step2A-433"><span class="linenos">433</span></a>                            <span class="p">),</span>
</span><span id="ARMS.step2A-434"><a href="#ARMS.step2A-434"><span class="linenos">434</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2A-435"><a href="#ARMS.step2A-435"><span class="linenos">435</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-436"><a href="#ARMS.step2A-436"><span class="linenos">436</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">negate</span><span class="p">(),</span>
</span><span id="ARMS.step2A-437"><a href="#ARMS.step2A-437"><span class="linenos">437</span></a>                        <span class="p">)</span>
</span><span id="ARMS.step2A-438"><a href="#ARMS.step2A-438"><span class="linenos">438</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step2A-439"><a href="#ARMS.step2A-439"><span class="linenos">439</span></a>
</span><span id="ARMS.step2A-440"><a href="#ARMS.step2A-440"><span class="linenos">440</span></a>                    <span class="c1"># A2</span>
</span><span id="ARMS.step2A-441"><a href="#ARMS.step2A-441"><span class="linenos">441</span></a>                    <span class="c1"># relation in action.del =&gt; relation in action.precond</span>
</span><span id="ARMS.step2A-442"><a href="#ARMS.step2A-442"><span class="linenos">442</span></a>                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS.step2A-443"><a href="#ARMS.step2A-443"><span class="linenos">443</span></a>                        <span class="n">implication</span><span class="p">(</span>
</span><span id="ARMS.step2A-444"><a href="#ARMS.step2A-444"><span class="linenos">444</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2A-445"><a href="#ARMS.step2A-445"><span class="linenos">445</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) del (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-446"><a href="#ARMS.step2A-446"><span class="linenos">446</span></a>                            <span class="p">),</span>
</span><span id="ARMS.step2A-447"><a href="#ARMS.step2A-447"><span class="linenos">447</span></a>                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2A-448"><a href="#ARMS.step2A-448"><span class="linenos">448</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2A-449"><a href="#ARMS.step2A-449"><span class="linenos">449</span></a>                            <span class="p">),</span>
</span><span id="ARMS.step2A-450"><a href="#ARMS.step2A-450"><span class="linenos">450</span></a>                        <span class="p">)</span>
</span><span id="ARMS.step2A-451"><a href="#ARMS.step2A-451"><span class="linenos">451</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step2A-452"><a href="#ARMS.step2A-452"><span class="linenos">452</span></a>
</span><span id="ARMS.step2A-453"><a href="#ARMS.step2A-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="n">constraints</span>
</span></pre></div>


            <div class="docstring"><p>Action constraints.</p>

<p>A1. The intersection of the precondition and add lists of all actions must be empty.</p>

<p>A2. In addition, if an actions delete list includes a relation, this relation is
in the actions precondition list. Thus, for every action, we require that
the delete list is a subset of the precondition list.</p>
</div>


                            </div>
                            <div id="ARMS.step2I" class="classattr">
                                        <input id="ARMS.step2I-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step2I</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">fluent</span><span class="o">.</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">macq</span><span class="o">.</span><span class="n">extract</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">Relation</span><span class="p">]</span>,</span><span class="param">	<span class="n">actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span> <span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Or</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Var</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Or</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step2I-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step2I"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step2I-455"><a href="#ARMS.step2I-455"><span class="linenos">455</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step2I-456"><a href="#ARMS.step2I-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">step2I</span><span class="p">(</span>
</span><span id="ARMS.step2I-457"><a href="#ARMS.step2I-457"><span class="linenos">457</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS.step2I-458"><a href="#ARMS.step2I-458"><span class="linenos">458</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Fluent</span><span class="p">,</span> <span class="n">Relation</span><span class="p">],</span>
</span><span id="ARMS.step2I-459"><a href="#ARMS.step2I-459"><span class="linenos">459</span></a>        <span class="n">actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS.step2I-460"><a href="#ARMS.step2I-460"><span class="linenos">460</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.step2I-461"><a href="#ARMS.step2I-461"><span class="linenos">461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="ARMS.step2I-462"><a href="#ARMS.step2I-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Information constraints.</span>
</span><span id="ARMS.step2I-463"><a href="#ARMS.step2I-463"><span class="linenos">463</span></a>
</span><span id="ARMS.step2I-464"><a href="#ARMS.step2I-464"><span class="linenos">464</span></a><span class="sd">        Suppose we observe a relation p to be true between two actions</span>
</span><span id="ARMS.step2I-465"><a href="#ARMS.step2I-465"><span class="linenos">465</span></a><span class="sd">        \(a_n\) and \(a_{n+1}\) , and \(p, a_{i_1} , ... ,\) and \(a_{i_k}\) share</span>
</span><span id="ARMS.step2I-466"><a href="#ARMS.step2I-466"><span class="linenos">466</span></a><span class="sd">        the same parameter types. We can represent this fact by the following clauses,</span>
</span><span id="ARMS.step2I-467"><a href="#ARMS.step2I-467"><span class="linenos">467</span></a><span class="sd">        given that \(a_{i_1} , ... ,\) and \(a_{i_k}\) appear in that order.</span>
</span><span id="ARMS.step2I-468"><a href="#ARMS.step2I-468"><span class="linenos">468</span></a>
</span><span id="ARMS.step2I-469"><a href="#ARMS.step2I-469"><span class="linenos">469</span></a><span class="sd">        I1. The relation \(p\) must be generated by an action \(a_{i_k} (0 \le i_k \le n)\),</span>
</span><span id="ARMS.step2I-470"><a href="#ARMS.step2I-470"><span class="linenos">470</span></a><span class="sd">        that is, \(p\) is selected to be in the add-list of \(a_{i_k}\).</span>
</span><span id="ARMS.step2I-471"><a href="#ARMS.step2I-471"><span class="linenos">471</span></a><span class="sd">        \(p (add_{i_1}  add_{i_2}  \dots  add_{i_k}) \), where  means logical or.</span>
</span><span id="ARMS.step2I-472"><a href="#ARMS.step2I-472"><span class="linenos">472</span></a>
</span><span id="ARMS.step2I-473"><a href="#ARMS.step2I-473"><span class="linenos">473</span></a><span class="sd">        I2. The last action \(a_{i_k}\) must not delete the relation p; that is,</span>
</span><span id="ARMS.step2I-474"><a href="#ARMS.step2I-474"><span class="linenos">474</span></a><span class="sd">        \(p\) must not be selected to be in the delete list of \(a_{i_k}\): \(p \\not\in del_{i_k}\).</span>
</span><span id="ARMS.step2I-475"><a href="#ARMS.step2I-475"><span class="linenos">475</span></a>
</span><span id="ARMS.step2I-476"><a href="#ARMS.step2I-476"><span class="linenos">476</span></a><span class="sd">        I3. We define the weight value of a relation-action pair \((p, a)\) as the</span>
</span><span id="ARMS.step2I-477"><a href="#ARMS.step2I-477"><span class="linenos">477</span></a><span class="sd">        occurrence probability of this pair in all plan examples. If the probability</span>
</span><span id="ARMS.step2I-478"><a href="#ARMS.step2I-478"><span class="linenos">478</span></a><span class="sd">        of a relation-action pair is higher than the probability threshold  ,</span>
</span><span id="ARMS.step2I-479"><a href="#ARMS.step2I-479"><span class="linenos">479</span></a><span class="sd">        then we set a corresponding relation constraint \(p  \\text{PRECOND}_a\), which</span>
</span><span id="ARMS.step2I-480"><a href="#ARMS.step2I-480"><span class="linenos">480</span></a><span class="sd">        receives a weight value equal to its prior probability.</span>
</span><span id="ARMS.step2I-481"><a href="#ARMS.step2I-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS.step2I-482"><a href="#ARMS.step2I-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2I-483"><a href="#ARMS.step2I-483"><span class="linenos">483</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Building information constraints...&quot;</span><span class="p">)</span>
</span><span id="ARMS.step2I-484"><a href="#ARMS.step2I-484"><span class="linenos">484</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS.step2I-485"><a href="#ARMS.step2I-485"><span class="linenos">485</span></a>        <span class="n">support_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="ARMS.step2I-486"><a href="#ARMS.step2I-486"><span class="linenos">486</span></a>        <span class="n">obs_trace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Observation</span><span class="p">]</span>
</span><span id="ARMS.step2I-487"><a href="#ARMS.step2I-487"><span class="linenos">487</span></a>        <span class="k">for</span> <span class="n">obs_trace_i</span><span class="p">,</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">):</span>
</span><span id="ARMS.step2I-488"><a href="#ARMS.step2I-488"><span class="linenos">488</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">):</span>
</span><span id="ARMS.step2I-489"><a href="#ARMS.step2I-489"><span class="linenos">489</span></a>                <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ARMS.step2I-490"><a href="#ARMS.step2I-490"><span class="linenos">490</span></a>                    <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ARMS.step2I-491"><a href="#ARMS.step2I-491"><span class="linenos">491</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2I-492"><a href="#ARMS.step2I-492"><span class="linenos">492</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS.step2I-493"><a href="#ARMS.step2I-493"><span class="linenos">493</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of observation list </span><span class="si">{</span><span class="n">obs_trace_i</span><span class="si">}</span><span class="s2"> contains state information.&quot;</span>
</span><span id="ARMS.step2I-494"><a href="#ARMS.step2I-494"><span class="linenos">494</span></a>                        <span class="p">)</span>
</span><span id="ARMS.step2I-495"><a href="#ARMS.step2I-495"><span class="linenos">495</span></a>                    <span class="k">for</span> <span class="n">fluent</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">obs</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ARMS.step2I-496"><a href="#ARMS.step2I-496"><span class="linenos">496</span></a>                        <span class="n">relation</span> <span class="o">=</span> <span class="n">relations</span><span class="p">[</span><span class="n">fluent</span><span class="p">]</span>
</span><span id="ARMS.step2I-497"><a href="#ARMS.step2I-497"><span class="linenos">497</span></a>                        <span class="c1"># Information constraints only apply to true relations</span>
</span><span id="ARMS.step2I-498"><a href="#ARMS.step2I-498"><span class="linenos">498</span></a>                        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
</span><span id="ARMS.step2I-499"><a href="#ARMS.step2I-499"><span class="linenos">499</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2I-500"><a href="#ARMS.step2I-500"><span class="linenos">500</span></a>                                <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS.step2I-501"><a href="#ARMS.step2I-501"><span class="linenos">501</span></a>                                    <span class="sa">f</span><span class="s2">&quot;  Fluent </span><span class="si">{</span><span class="n">fluent</span><span class="si">}</span><span class="s2"> is true.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2I-502"><a href="#ARMS.step2I-502"><span class="linenos">502</span></a>                                    <span class="sa">f</span><span class="s2">&quot;    (</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2">) (&quot;</span>
</span><span id="ARMS.step2I-503"><a href="#ARMS.step2I-503"><span class="linenos">503</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;add_</span><span class="se">{{</span><span class="s1"> </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">obs_trace</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s1"> </span><span class="se">}}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ik</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">obs_trace</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">actions</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore</span>
</span><span id="ARMS.step2I-504"><a href="#ARMS.step2I-504"><span class="linenos">504</span></a>                                    <span class="s2">&quot;)&quot;</span>
</span><span id="ARMS.step2I-505"><a href="#ARMS.step2I-505"><span class="linenos">505</span></a>                                <span class="p">)</span>
</span><span id="ARMS.step2I-506"><a href="#ARMS.step2I-506"><span class="linenos">506</span></a>                            <span class="c1"># I1</span>
</span><span id="ARMS.step2I-507"><a href="#ARMS.step2I-507"><span class="linenos">507</span></a>                            <span class="c1"># relation in the add list of an action &lt;= n (i-1)</span>
</span><span id="ARMS.step2I-508"><a href="#ARMS.step2I-508"><span class="linenos">508</span></a>                            <span class="n">i1</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS.step2I-509"><a href="#ARMS.step2I-509"><span class="linenos">509</span></a>                            <span class="k">for</span> <span class="n">obs_i</span> <span class="ow">in</span> <span class="n">obs_trace</span><span class="p">[:</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="ARMS.step2I-510"><a href="#ARMS.step2I-510"><span class="linenos">510</span></a>                                <span class="k">if</span> <span class="n">obs_i</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span> <span class="ow">and</span> <span class="n">obs_i</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ARMS.step2I-511"><a href="#ARMS.step2I-511"><span class="linenos">511</span></a>                                    <span class="n">ai</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">obs_i</span><span class="o">.</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS.step2I-512"><a href="#ARMS.step2I-512"><span class="linenos">512</span></a>                                    <span class="k">if</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">ai</span><span class="p">):</span>
</span><span id="ARMS.step2I-513"><a href="#ARMS.step2I-513"><span class="linenos">513</span></a>                                        <span class="n">i1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS.step2I-514"><a href="#ARMS.step2I-514"><span class="linenos">514</span></a>                                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2I-515"><a href="#ARMS.step2I-515"><span class="linenos">515</span></a>                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">ai</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2I-516"><a href="#ARMS.step2I-516"><span class="linenos">516</span></a>                                            <span class="p">)</span>
</span><span id="ARMS.step2I-517"><a href="#ARMS.step2I-517"><span class="linenos">517</span></a>                                        <span class="p">)</span>
</span><span id="ARMS.step2I-518"><a href="#ARMS.step2I-518"><span class="linenos">518</span></a>
</span><span id="ARMS.step2I-519"><a href="#ARMS.step2I-519"><span class="linenos">519</span></a>                            <span class="c1"># I2</span>
</span><span id="ARMS.step2I-520"><a href="#ARMS.step2I-520"><span class="linenos">520</span></a>                            <span class="c1"># relation not in del list of action n (i-1)</span>
</span><span id="ARMS.step2I-521"><a href="#ARMS.step2I-521"><span class="linenos">521</span></a>                            <span class="n">i2</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ARMS.step2I-522"><a href="#ARMS.step2I-522"><span class="linenos">522</span></a>                            <span class="n">a_n</span> <span class="o">=</span> <span class="n">obs_trace</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">action</span>
</span><span id="ARMS.step2I-523"><a href="#ARMS.step2I-523"><span class="linenos">523</span></a>                            <span class="k">if</span> <span class="n">a_n</span> <span class="ow">in</span> <span class="n">actions</span> <span class="ow">and</span> <span class="n">a_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ARMS.step2I-524"><a href="#ARMS.step2I-524"><span class="linenos">524</span></a>                                <span class="n">i2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2I-525"><a href="#ARMS.step2I-525"><span class="linenos">525</span></a>                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) del (BREAK) </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">a_n</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2I-526"><a href="#ARMS.step2I-526"><span class="linenos">526</span></a>                                <span class="p">)</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
</span><span id="ARMS.step2I-527"><a href="#ARMS.step2I-527"><span class="linenos">527</span></a>
</span><span id="ARMS.step2I-528"><a href="#ARMS.step2I-528"><span class="linenos">528</span></a>                            <span class="k">if</span> <span class="n">i1</span><span class="p">:</span>
</span><span id="ARMS.step2I-529"><a href="#ARMS.step2I-529"><span class="linenos">529</span></a>                                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span>
</span><span id="ARMS.step2I-530"><a href="#ARMS.step2I-530"><span class="linenos">530</span></a>                            <span class="k">if</span> <span class="n">i2</span><span class="p">:</span>
</span><span id="ARMS.step2I-531"><a href="#ARMS.step2I-531"><span class="linenos">531</span></a>                                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Or</span><span class="p">([</span><span class="n">i2</span><span class="p">]))</span>
</span><span id="ARMS.step2I-532"><a href="#ARMS.step2I-532"><span class="linenos">532</span></a>
</span><span id="ARMS.step2I-533"><a href="#ARMS.step2I-533"><span class="linenos">533</span></a>                            <span class="c1"># I3</span>
</span><span id="ARMS.step2I-534"><a href="#ARMS.step2I-534"><span class="linenos">534</span></a>                            <span class="c1"># count occurences</span>
</span><span id="ARMS.step2I-535"><a href="#ARMS.step2I-535"><span class="linenos">535</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="ARMS.step2I-536"><a href="#ARMS.step2I-536"><span class="linenos">536</span></a>                                <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ARMS.step2I-537"><a href="#ARMS.step2I-537"><span class="linenos">537</span></a>                                <span class="ow">and</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span>
</span><span id="ARMS.step2I-538"><a href="#ARMS.step2I-538"><span class="linenos">538</span></a>                                <span class="ow">and</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># for the linter</span>
</span><span id="ARMS.step2I-539"><a href="#ARMS.step2I-539"><span class="linenos">539</span></a>                                <span class="ow">and</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">action</span><span class="p">])</span>
</span><span id="ARMS.step2I-540"><a href="#ARMS.step2I-540"><span class="linenos">540</span></a>                            <span class="p">):</span>
</span><span id="ARMS.step2I-541"><a href="#ARMS.step2I-541"><span class="linenos">541</span></a>                                <span class="c1"># corresponding constraint is related to the current action&#39;s precondition list</span>
</span><span id="ARMS.step2I-542"><a href="#ARMS.step2I-542"><span class="linenos">542</span></a>                                <span class="n">support_counts</span><span class="p">[</span>
</span><span id="ARMS.step2I-543"><a href="#ARMS.step2I-543"><span class="linenos">543</span></a>                                    <span class="n">Or</span><span class="p">(</span>
</span><span id="ARMS.step2I-544"><a href="#ARMS.step2I-544"><span class="linenos">544</span></a>                                        <span class="p">[</span>
</span><span id="ARMS.step2I-545"><a href="#ARMS.step2I-545"><span class="linenos">545</span></a>                                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2I-546"><a href="#ARMS.step2I-546"><span class="linenos">546</span></a>                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) pre (BREAK) </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2I-547"><a href="#ARMS.step2I-547"><span class="linenos">547</span></a>                                            <span class="p">)</span>
</span><span id="ARMS.step2I-548"><a href="#ARMS.step2I-548"><span class="linenos">548</span></a>                                        <span class="p">]</span>
</span><span id="ARMS.step2I-549"><a href="#ARMS.step2I-549"><span class="linenos">549</span></a>                                    <span class="p">)</span>
</span><span id="ARMS.step2I-550"><a href="#ARMS.step2I-550"><span class="linenos">550</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS.step2I-551"><a href="#ARMS.step2I-551"><span class="linenos">551</span></a>                            <span class="k">elif</span> <span class="p">(</span>
</span><span id="ARMS.step2I-552"><a href="#ARMS.step2I-552"><span class="linenos">552</span></a>                                <span class="n">a_n</span> <span class="ow">in</span> <span class="n">actions</span>
</span><span id="ARMS.step2I-553"><a href="#ARMS.step2I-553"><span class="linenos">553</span></a>                                <span class="ow">and</span> <span class="n">a_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ARMS.step2I-554"><a href="#ARMS.step2I-554"><span class="linenos">554</span></a>                                <span class="ow">and</span> <span class="n">relation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="n">a_n</span><span class="p">])</span>
</span><span id="ARMS.step2I-555"><a href="#ARMS.step2I-555"><span class="linenos">555</span></a>                            <span class="p">):</span>
</span><span id="ARMS.step2I-556"><a href="#ARMS.step2I-556"><span class="linenos">556</span></a>                                <span class="c1"># corresponding constraint is related to the previous action&#39;s add list</span>
</span><span id="ARMS.step2I-557"><a href="#ARMS.step2I-557"><span class="linenos">557</span></a>                                <span class="n">support_counts</span><span class="p">[</span>
</span><span id="ARMS.step2I-558"><a href="#ARMS.step2I-558"><span class="linenos">558</span></a>                                    <span class="n">Or</span><span class="p">(</span>
</span><span id="ARMS.step2I-559"><a href="#ARMS.step2I-559"><span class="linenos">559</span></a>                                        <span class="p">[</span>
</span><span id="ARMS.step2I-560"><a href="#ARMS.step2I-560"><span class="linenos">560</span></a>                                            <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2I-561"><a href="#ARMS.step2I-561"><span class="linenos">561</span></a>                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) in (BREAK) add (BREAK) </span><span class="si">{</span><span class="n">actions</span><span class="p">[</span><span class="n">a_n</span><span class="p">]</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2I-562"><a href="#ARMS.step2I-562"><span class="linenos">562</span></a>                                            <span class="p">)</span>
</span><span id="ARMS.step2I-563"><a href="#ARMS.step2I-563"><span class="linenos">563</span></a>                                        <span class="p">]</span>
</span><span id="ARMS.step2I-564"><a href="#ARMS.step2I-564"><span class="linenos">564</span></a>                                    <span class="p">)</span>
</span><span id="ARMS.step2I-565"><a href="#ARMS.step2I-565"><span class="linenos">565</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ARMS.step2I-566"><a href="#ARMS.step2I-566"><span class="linenos">566</span></a>
</span><span id="ARMS.step2I-567"><a href="#ARMS.step2I-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">support_counts</span>
</span></pre></div>


            <div class="docstring"><p>Information constraints.</p>

<p>Suppose we observe a relation p to be true between two actions
(a_n) and (a_{n+1}) , and (p, a_{i_1} , ... ,) and (a_{i_k}) share
the same parameter types. We can represent this fact by the following clauses,
given that (a_{i_1} , ... ,) and (a_{i_k}) appear in that order.</p>

<p>I1. The relation (p) must be generated by an action (a_{i_k} (0 \le i_k \le n)),
that is, (p) is selected to be in the add-list of (a_{i_k}).
(p (add_{i_1}  add_{i_2}  \dots  add_{i_k}) ), where  means logical or.</p>

<p>I2. The last action (a_{i_k}) must not delete the relation p; that is,
(p) must not be selected to be in the delete list of (a_{i_k}): (p \not\in del_{i_k}).</p>

<p>I3. We define the weight value of a relation-action pair ((p, a)) as the
occurrence probability of this pair in all plan examples. If the probability
of a relation-action pair is higher than the probability threshold  ,
then we set a corresponding relation constraint (p  \text{PRECOND}_a), which
receives a weight value equal to its prior probability.</p>
</div>


                            </div>
                            <div id="ARMS.step2P" class="classattr">
                                        <input id="ARMS.step2P-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step2P</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">,</span> <span class="n">Set</span><span class="p">]]</span>,</span><span class="param">	<span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span> <span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">relations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">macq</span><span class="o">.</span><span class="n">extract</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">Relation</span><span class="p">]</span>,</span><span class="param">	<span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Or</span><span class="p">[</span><span class="n">nnf</span><span class="o">.</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step2P-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step2P"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step2P-611"><a href="#ARMS.step2P-611"><span class="linenos">611</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step2P-612"><a href="#ARMS.step2P-612"><span class="linenos">612</span></a>    <span class="k">def</span> <span class="nf">step2P</span><span class="p">(</span>
</span><span id="ARMS.step2P-613"><a href="#ARMS.step2P-613"><span class="linenos">613</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="ARMS.step2P-614"><a href="#ARMS.step2P-614"><span class="linenos">614</span></a>        <span class="n">connected_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">,</span> <span class="n">Set</span><span class="p">]],</span>
</span><span id="ARMS.step2P-615"><a href="#ARMS.step2P-615"><span class="linenos">615</span></a>        <span class="n">action_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS.step2P-616"><a href="#ARMS.step2P-616"><span class="linenos">616</span></a>        <span class="n">relations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Relation</span><span class="p">],</span>
</span><span id="ARMS.step2P-617"><a href="#ARMS.step2P-617"><span class="linenos">617</span></a>        <span class="n">min_support</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.step2P-618"><a href="#ARMS.step2P-618"><span class="linenos">618</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.step2P-619"><a href="#ARMS.step2P-619"><span class="linenos">619</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="ARMS.step2P-620"><a href="#ARMS.step2P-620"><span class="linenos">620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plan constraints.</span>
</span><span id="ARMS.step2P-621"><a href="#ARMS.step2P-621"><span class="linenos">621</span></a>
</span><span id="ARMS.step2P-622"><a href="#ARMS.step2P-622"><span class="linenos">622</span></a><span class="sd">        P1. Every precondition \(p\) of every action \(b\) must be in the add</span>
</span><span id="ARMS.step2P-623"><a href="#ARMS.step2P-623"><span class="linenos">623</span></a><span class="sd">        list of a preceding action \(a\) and is not deleted by any actions between</span>
</span><span id="ARMS.step2P-624"><a href="#ARMS.step2P-624"><span class="linenos">624</span></a><span class="sd">        \(a\) and \(b\).</span>
</span><span id="ARMS.step2P-625"><a href="#ARMS.step2P-625"><span class="linenos">625</span></a>
</span><span id="ARMS.step2P-626"><a href="#ARMS.step2P-626"><span class="linenos">626</span></a><span class="sd">        P2. In addition, at least one relation \(r\) in the add list of an action</span>
</span><span id="ARMS.step2P-627"><a href="#ARMS.step2P-627"><span class="linenos">627</span></a><span class="sd">        must be useful in achieving a precondition of a later action. That is, for</span>
</span><span id="ARMS.step2P-628"><a href="#ARMS.step2P-628"><span class="linenos">628</span></a><span class="sd">        every action \(a\), an add list relation \(r\) must be in the precondition of a</span>
</span><span id="ARMS.step2P-629"><a href="#ARMS.step2P-629"><span class="linenos">629</span></a><span class="sd">        later action \(b\), and there is no other action between \(a\) and \(b\)</span>
</span><span id="ARMS.step2P-630"><a href="#ARMS.step2P-630"><span class="linenos">630</span></a><span class="sd">        that either adds or deletes \(r\).</span>
</span><span id="ARMS.step2P-631"><a href="#ARMS.step2P-631"><span class="linenos">631</span></a>
</span><span id="ARMS.step2P-632"><a href="#ARMS.step2P-632"><span class="linenos">632</span></a><span class="sd">        &quot;While constraints P1 and P2 provide the general guiding principle for</span>
</span><span id="ARMS.step2P-633"><a href="#ARMS.step2P-633"><span class="linenos">633</span></a><span class="sd">        ensuring a plans correctness, in practice there are too many</span>
</span><span id="ARMS.step2P-634"><a href="#ARMS.step2P-634"><span class="linenos">634</span></a><span class="sd">        instantiations of these constraints.&quot; (more information on the</span>
</span><span id="ARMS.step2P-635"><a href="#ARMS.step2P-635"><span class="linenos">635</span></a><span class="sd">        rationelle in the paper) Thus, they are replaced with the following</span>
</span><span id="ARMS.step2P-636"><a href="#ARMS.step2P-636"><span class="linenos">636</span></a><span class="sd">        constraints:</span>
</span><span id="ARMS.step2P-637"><a href="#ARMS.step2P-637"><span class="linenos">637</span></a>
</span><span id="ARMS.step2P-638"><a href="#ARMS.step2P-638"><span class="linenos">638</span></a><span class="sd">        Let there be an action pair \(\langle a_i, a_j \\rangle, 0 \le i &lt; j \le n-1\).</span>
</span><span id="ARMS.step2P-639"><a href="#ARMS.step2P-639"><span class="linenos">639</span></a>
</span><span id="ARMS.step2P-640"><a href="#ARMS.step2P-640"><span class="linenos">640</span></a><span class="sd">        P3. One of the relevant relations \(p\) must be chosen to be in the</span>
</span><span id="ARMS.step2P-641"><a href="#ARMS.step2P-641"><span class="linenos">641</span></a><span class="sd">        preconditions of both \(a_i\) and \(a_j\), but not in the delete list</span>
</span><span id="ARMS.step2P-642"><a href="#ARMS.step2P-642"><span class="linenos">642</span></a><span class="sd">        of \(a_i\).</span>
</span><span id="ARMS.step2P-643"><a href="#ARMS.step2P-643"><span class="linenos">643</span></a>
</span><span id="ARMS.step2P-644"><a href="#ARMS.step2P-644"><span class="linenos">644</span></a><span class="sd">        P4. The first action \(a_i\) adds a relevant relation that is in the</span>
</span><span id="ARMS.step2P-645"><a href="#ARMS.step2P-645"><span class="linenos">645</span></a><span class="sd">        precondition list of the second action \(a_j\) in the pair.</span>
</span><span id="ARMS.step2P-646"><a href="#ARMS.step2P-646"><span class="linenos">646</span></a>
</span><span id="ARMS.step2P-647"><a href="#ARMS.step2P-647"><span class="linenos">647</span></a><span class="sd">        P5. A relevant relation \(p\) that is deleted by the first action</span>
</span><span id="ARMS.step2P-648"><a href="#ARMS.step2P-648"><span class="linenos">648</span></a><span class="sd">        \(a_i\) is added by \(a_j\). The second clause is designed for the event</span>
</span><span id="ARMS.step2P-649"><a href="#ARMS.step2P-649"><span class="linenos">649</span></a><span class="sd">        when an action re-establishes a fact that is deleted by a previous action.</span>
</span><span id="ARMS.step2P-650"><a href="#ARMS.step2P-650"><span class="linenos">650</span></a>
</span><span id="ARMS.step2P-651"><a href="#ARMS.step2P-651"><span class="linenos">651</span></a><span class="sd">        The above constraints can be combined into one constraint:</span>
</span><span id="ARMS.step2P-652"><a href="#ARMS.step2P-652"><span class="linenos">652</span></a><span class="sd">        $$\exists p ((p \in (pre_i \cap pre_j) \land p \\not \in (del_i)) \lor (p \in (add_i \cap pre_j)) \lor (p \in (del_i \cap add_j)))$$</span>
</span><span id="ARMS.step2P-653"><a href="#ARMS.step2P-653"><span class="linenos">653</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ARMS.step2P-654"><a href="#ARMS.step2P-654"><span class="linenos">654</span></a>        <span class="n">frequent_pairs</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_apriori</span><span class="p">(</span>
</span><span id="ARMS.step2P-655"><a href="#ARMS.step2P-655"><span class="linenos">655</span></a>            <span class="p">[</span>
</span><span id="ARMS.step2P-656"><a href="#ARMS.step2P-656"><span class="linenos">656</span></a>                <span class="p">[</span>
</span><span id="ARMS.step2P-657"><a href="#ARMS.step2P-657"><span class="linenos">657</span></a>                    <span class="n">action_map</span><span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">action</span><span class="p">]</span>
</span><span id="ARMS.step2P-658"><a href="#ARMS.step2P-658"><span class="linenos">658</span></a>                    <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obs_trace</span>
</span><span id="ARMS.step2P-659"><a href="#ARMS.step2P-659"><span class="linenos">659</span></a>                    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="n">action_map</span>
</span><span id="ARMS.step2P-660"><a href="#ARMS.step2P-660"><span class="linenos">660</span></a>                <span class="p">]</span>
</span><span id="ARMS.step2P-661"><a href="#ARMS.step2P-661"><span class="linenos">661</span></a>                <span class="k">for</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="n">obs_tracelist</span>
</span><span id="ARMS.step2P-662"><a href="#ARMS.step2P-662"><span class="linenos">662</span></a>            <span class="p">],</span>
</span><span id="ARMS.step2P-663"><a href="#ARMS.step2P-663"><span class="linenos">663</span></a>            <span class="n">min_support</span><span class="p">,</span>
</span><span id="ARMS.step2P-664"><a href="#ARMS.step2P-664"><span class="linenos">664</span></a>        <span class="p">)</span>
</span><span id="ARMS.step2P-665"><a href="#ARMS.step2P-665"><span class="linenos">665</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2P-666"><a href="#ARMS.step2P-666"><span class="linenos">666</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequent pairs:&quot;</span><span class="p">)</span>
</span><span id="ARMS.step2P-667"><a href="#ARMS.step2P-667"><span class="linenos">667</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">frequent_pairs</span><span class="p">)</span>
</span><span id="ARMS.step2P-668"><a href="#ARMS.step2P-668"><span class="linenos">668</span></a>
</span><span id="ARMS.step2P-669"><a href="#ARMS.step2P-669"><span class="linenos">669</span></a>        <span class="c1"># constraints: Dict[And[Or[Var]], int] = {}</span>
</span><span id="ARMS.step2P-670"><a href="#ARMS.step2P-670"><span class="linenos">670</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS.step2P-671"><a href="#ARMS.step2P-671"><span class="linenos">671</span></a>        <span class="k">for</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">frequent_pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ARMS.step2P-672"><a href="#ARMS.step2P-672"><span class="linenos">672</span></a>            <span class="n">connectors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ARMS.step2P-673"><a href="#ARMS.step2P-673"><span class="linenos">673</span></a>            <span class="c1"># get list of relevant relations from connected_actions</span>
</span><span id="ARMS.step2P-674"><a href="#ARMS.step2P-674"><span class="linenos">674</span></a>            <span class="k">if</span> <span class="n">ai</span> <span class="ow">in</span> <span class="n">connected_actions</span> <span class="ow">and</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">ai</span><span class="p">]:</span>
</span><span id="ARMS.step2P-675"><a href="#ARMS.step2P-675"><span class="linenos">675</span></a>                <span class="n">connectors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">connected_actions</span><span class="p">[</span><span class="n">ai</span><span class="p">][</span><span class="n">aj</span><span class="p">])</span>
</span><span id="ARMS.step2P-676"><a href="#ARMS.step2P-676"><span class="linenos">676</span></a>            <span class="k">if</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">connected_actions</span> <span class="ow">and</span> <span class="n">ai</span> <span class="ow">in</span> <span class="n">connected_actions</span><span class="p">[</span><span class="n">aj</span><span class="p">]:</span>
</span><span id="ARMS.step2P-677"><a href="#ARMS.step2P-677"><span class="linenos">677</span></a>                <span class="n">connectors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">connected_actions</span><span class="p">[</span><span class="n">aj</span><span class="p">][</span><span class="n">ai</span><span class="p">])</span>
</span><span id="ARMS.step2P-678"><a href="#ARMS.step2P-678"><span class="linenos">678</span></a>
</span><span id="ARMS.step2P-679"><a href="#ARMS.step2P-679"><span class="linenos">679</span></a>            <span class="c1"># if the actions are not related they are not a valid pair for a plan constraint.</span>
</span><span id="ARMS.step2P-680"><a href="#ARMS.step2P-680"><span class="linenos">680</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">connectors</span><span class="p">:</span>
</span><span id="ARMS.step2P-681"><a href="#ARMS.step2P-681"><span class="linenos">681</span></a>                <span class="k">continue</span>
</span><span id="ARMS.step2P-682"><a href="#ARMS.step2P-682"><span class="linenos">682</span></a>
</span><span id="ARMS.step2P-683"><a href="#ARMS.step2P-683"><span class="linenos">683</span></a>            <span class="c1"># for each relation, save constraint</span>
</span><span id="ARMS.step2P-684"><a href="#ARMS.step2P-684"><span class="linenos">684</span></a>            <span class="n">relevant_relations</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">connectors</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">types</span><span class="p">)}</span>
</span><span id="ARMS.step2P-685"><a href="#ARMS.step2P-685"><span class="linenos">685</span></a>            <span class="c1"># relation_constraints: List[Or[And[Var]]] = []</span>
</span><span id="ARMS.step2P-686"><a href="#ARMS.step2P-686"><span class="linenos">686</span></a>            <span class="n">relation_constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS.step2P-687"><a href="#ARMS.step2P-687"><span class="linenos">687</span></a>            <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">relevant_relations</span><span class="p">:</span>
</span><span id="ARMS.step2P-688"><a href="#ARMS.step2P-688"><span class="linenos">688</span></a>                <span class="n">relation_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ARMS.step2P-689"><a href="#ARMS.step2P-689"><span class="linenos">689</span></a>                    <span class="n">Var</span><span class="p">(</span>
</span><span id="ARMS.step2P-690"><a href="#ARMS.step2P-690"><span class="linenos">690</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) relevant (BREAK) </span><span class="si">{</span><span class="n">ai</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2"> (BREAK) </span><span class="si">{</span><span class="n">aj</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step2P-691"><a href="#ARMS.step2P-691"><span class="linenos">691</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step2P-692"><a href="#ARMS.step2P-692"><span class="linenos">692</span></a>                <span class="p">)</span>
</span><span id="ARMS.step2P-693"><a href="#ARMS.step2P-693"><span class="linenos">693</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step2P-694"><a href="#ARMS.step2P-694"><span class="linenos">694</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS.step2P-695"><a href="#ARMS.step2P-695"><span class="linenos">695</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">}</span><span class="s2"> might explain action pair (</span><span class="si">{</span><span class="n">ai</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">aj</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ARMS.step2P-696"><a href="#ARMS.step2P-696"><span class="linenos">696</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step2P-697"><a href="#ARMS.step2P-697"><span class="linenos">697</span></a>            <span class="n">constraints</span><span class="p">[</span><span class="n">Or</span><span class="p">(</span><span class="n">relation_constraints</span><span class="p">)]</span> <span class="o">=</span> <span class="n">frequent_pairs</span><span class="p">[(</span><span class="n">ai</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS.step2P-698"><a href="#ARMS.step2P-698"><span class="linenos">698</span></a>
</span><span id="ARMS.step2P-699"><a href="#ARMS.step2P-699"><span class="linenos">699</span></a>        <span class="k">return</span> <span class="n">constraints</span>
</span></pre></div>


            <div class="docstring"><p>Plan constraints.</p>

<p>P1. Every precondition (p) of every action (b) must be in the add
list of a preceding action (a) and is not deleted by any actions between
(a) and (b).</p>

<p>P2. In addition, at least one relation (r) in the add list of an action
must be useful in achieving a precondition of a later action. That is, for
every action (a), an add list relation (r) must be in the precondition of a
later action (b), and there is no other action between (a) and (b)
that either adds or deletes (r).</p>

<p>"While constraints P1 and P2 provide the general guiding principle for
ensuring a plans correctness, in practice there are too many
instantiations of these constraints." (more information on the
rationelle in the paper) Thus, they are replaced with the following
constraints:</p>

<p>Let there be an action pair (\langle a_i, a_j \rangle, 0 \le i &lt; j \le n-1).</p>

<p>P3. One of the relevant relations (p) must be chosen to be in the
preconditions of both (a_i) and (a_j), but not in the delete list
of (a_i).</p>

<p>P4. The first action (a_i) adds a relevant relation that is in the
precondition list of the second action (a_j) in the pair.</p>

<p>P5. A relevant relation (p) that is deleted by the first action
(a_i) is added by (a_j). The second clause is designed for the event
when an action re-establishes a fact that is deleted by a previous action.</p>

<p>The above constraints can be combined into one constraint:
$$\exists p ((p \in (pre_i \cap pre_j) \land p \not \in (del_i)) \lor (p \in (add_i \cap pre_j)) \lor (p \in (del_i \cap add_j)))$$</p>
</div>


                            </div>
                            <div id="ARMS.step3" class="classattr">
                                        <input id="ARMS.step3-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step3</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">constraints</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">extract</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">ARMSConstraints</span>,</span><span class="param">	<span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">pysat</span><span class="o">.</span><span class="n">formula</span><span class="o">.</span><span class="n">WCNF</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step3-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step3"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step3-701"><a href="#ARMS.step3-701"><span class="linenos">701</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step3-702"><a href="#ARMS.step3-702"><span class="linenos">702</span></a>    <span class="k">def</span> <span class="nf">step3</span><span class="p">(</span>
</span><span id="ARMS.step3-703"><a href="#ARMS.step3-703"><span class="linenos">703</span></a>        <span class="n">constraints</span><span class="p">:</span> <span class="n">ARMSConstraints</span><span class="p">,</span>
</span><span id="ARMS.step3-704"><a href="#ARMS.step3-704"><span class="linenos">704</span></a>        <span class="n">action_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.step3-705"><a href="#ARMS.step3-705"><span class="linenos">705</span></a>        <span class="n">info_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.step3-706"><a href="#ARMS.step3-706"><span class="linenos">706</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="ARMS.step3-707"><a href="#ARMS.step3-707"><span class="linenos">707</span></a>        <span class="n">info3_default</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.step3-708"><a href="#ARMS.step3-708"><span class="linenos">708</span></a>        <span class="n">plan_default</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ARMS.step3-709"><a href="#ARMS.step3-709"><span class="linenos">709</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.step3-710"><a href="#ARMS.step3-710"><span class="linenos">710</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">WCNF</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]]:</span>
</span><span id="ARMS.step3-711"><a href="#ARMS.step3-711"><span class="linenos">711</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 3) Construct the weighted MAX-SAT problem based on the constraints and weight information found in Step 2.&quot;&quot;&quot;</span>
</span><span id="ARMS.step3-712"><a href="#ARMS.step3-712"><span class="linenos">712</span></a>
</span><span id="ARMS.step3-713"><a href="#ARMS.step3-713"><span class="linenos">713</span></a>        <span class="n">action_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">action_weight</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
</span><span id="ARMS.step3-714"><a href="#ARMS.step3-714"><span class="linenos">714</span></a>        <span class="n">info_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">info_weight</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</span><span id="ARMS.step3-715"><a href="#ARMS.step3-715"><span class="linenos">715</span></a>        <span class="n">info3_weights</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_calculate_support_rates</span><span class="p">(</span>
</span><span id="ARMS.step3-716"><a href="#ARMS.step3-716"><span class="linenos">716</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">info3</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">info3_default</span>
</span><span id="ARMS.step3-717"><a href="#ARMS.step3-717"><span class="linenos">717</span></a>        <span class="p">)</span>
</span><span id="ARMS.step3-718"><a href="#ARMS.step3-718"><span class="linenos">718</span></a>        <span class="n">plan_weights</span> <span class="o">=</span> <span class="n">ARMS</span><span class="o">.</span><span class="n">_calculate_support_rates</span><span class="p">(</span>
</span><span id="ARMS.step3-719"><a href="#ARMS.step3-719"><span class="linenos">719</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">plan_default</span>
</span><span id="ARMS.step3-720"><a href="#ARMS.step3-720"><span class="linenos">720</span></a>        <span class="p">)</span>
</span><span id="ARMS.step3-721"><a href="#ARMS.step3-721"><span class="linenos">721</span></a>        <span class="n">all_weights</span> <span class="o">=</span> <span class="n">action_weights</span> <span class="o">+</span> <span class="n">info_weights</span> <span class="o">+</span> <span class="n">info3_weights</span> <span class="o">+</span> <span class="n">plan_weights</span>
</span><span id="ARMS.step3-722"><a href="#ARMS.step3-722"><span class="linenos">722</span></a>
</span><span id="ARMS.step3-723"><a href="#ARMS.step3-723"><span class="linenos">723</span></a>        <span class="n">info3_constraints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">info3</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS.step3-724"><a href="#ARMS.step3-724"><span class="linenos">724</span></a>        <span class="n">plan_constraints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ARMS.step3-725"><a href="#ARMS.step3-725"><span class="linenos">725</span></a>        <span class="n">all_constraints</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ARMS.step3-726"><a href="#ARMS.step3-726"><span class="linenos">726</span></a>            <span class="n">constraints</span><span class="o">.</span><span class="n">action</span> <span class="o">+</span> <span class="n">constraints</span><span class="o">.</span><span class="n">info</span> <span class="o">+</span> <span class="n">info3_constraints</span> <span class="o">+</span> <span class="n">plan_constraints</span>
</span><span id="ARMS.step3-727"><a href="#ARMS.step3-727"><span class="linenos">727</span></a>        <span class="p">)</span>
</span><span id="ARMS.step3-728"><a href="#ARMS.step3-728"><span class="linenos">728</span></a>
</span><span id="ARMS.step3-729"><a href="#ARMS.step3-729"><span class="linenos">729</span></a>        <span class="n">constraints_w_weights</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ARMS.step3-730"><a href="#ARMS.step3-730"><span class="linenos">730</span></a>        <span class="k">for</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_constraints</span><span class="p">,</span> <span class="n">all_weights</span><span class="p">):</span>
</span><span id="ARMS.step3-731"><a href="#ARMS.step3-731"><span class="linenos">731</span></a>            <span class="k">if</span> <span class="n">constraint</span> <span class="o">==</span> <span class="n">nnffalse</span><span class="p">:</span>
</span><span id="ARMS.step3-732"><a href="#ARMS.step3-732"><span class="linenos">732</span></a>                <span class="k">continue</span>
</span><span id="ARMS.step3-733"><a href="#ARMS.step3-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="n">constraint</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constraints_w_weights</span><span class="p">:</span>
</span><span id="ARMS.step3-734"><a href="#ARMS.step3-734"><span class="linenos">734</span></a>                <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</span><span id="ARMS.step3-735"><a href="#ARMS.step3-735"><span class="linenos">735</span></a>            <span class="k">elif</span> <span class="n">weight</span> <span class="o">!=</span> <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]:</span>
</span><span id="ARMS.step3-736"><a href="#ARMS.step3-736"><span class="linenos">736</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step3-737"><a href="#ARMS.step3-737"><span class="linenos">737</span></a>                    <span class="n">warn</span><span class="p">(</span>
</span><span id="ARMS.step3-738"><a href="#ARMS.step3-738"><span class="linenos">738</span></a>                        <span class="sa">f</span><span class="s2">&quot;The constraint </span><span class="si">{</span><span class="n">constraint</span><span class="si">}</span><span class="s2"> has conflicting weights (</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span><span class="si">}</span><span class="s2">). Choosing the smaller weight.&quot;</span>
</span><span id="ARMS.step3-739"><a href="#ARMS.step3-739"><span class="linenos">739</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step3-740"><a href="#ARMS.step3-740"><span class="linenos">740</span></a>                <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="ARMS.step3-741"><a href="#ARMS.step3-741"><span class="linenos">741</span></a>                    <span class="n">weight</span><span class="p">,</span> <span class="n">constraints_w_weights</span><span class="p">[</span><span class="n">constraint</span><span class="p">]</span>
</span><span id="ARMS.step3-742"><a href="#ARMS.step3-742"><span class="linenos">742</span></a>                <span class="p">)</span>
</span><span id="ARMS.step3-743"><a href="#ARMS.step3-743"><span class="linenos">743</span></a>
</span><span id="ARMS.step3-744"><a href="#ARMS.step3-744"><span class="linenos">744</span></a>        <span class="n">problem</span><span class="p">:</span> <span class="n">And</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]]</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">constraints_w_weights</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="ARMS.step3-745"><a href="#ARMS.step3-745"><span class="linenos">745</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints_w_weights</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="ARMS.step3-746"><a href="#ARMS.step3-746"><span class="linenos">746</span></a>
</span><span id="ARMS.step3-747"><a href="#ARMS.step3-747"><span class="linenos">747</span></a>        <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">to_wcnf</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="ARMS.step3-748"><a href="#ARMS.step3-748"><span class="linenos">748</span></a>        <span class="k">return</span> <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span>
</span></pre></div>


            <div class="docstring"><p>(Step 3) Construct the weighted MAX-SAT problem based on the constraints and weight information found in Step 2.</p>
</div>


                            </div>
                            <div id="ARMS.step4" class="classattr">
                                        <input id="ARMS.step4-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step4</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">max_sat</span><span class="p">:</span> <span class="n">pysat</span><span class="o">.</span><span class="n">formula</span><span class="o">.</span><span class="n">WCNF</span>,</span><span class="param">	<span class="n">decode</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ARMS.step4-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step4"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step4-769"><a href="#ARMS.step4-769"><span class="linenos">769</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step4-770"><a href="#ARMS.step4-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">step4</span><span class="p">(</span><span class="n">max_sat</span><span class="p">:</span> <span class="n">WCNF</span><span class="p">,</span> <span class="n">decode</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="ARMS.step4-771"><a href="#ARMS.step4-771"><span class="linenos">771</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 4) Solve the MAX-SAT problem built in Step 3.&quot;&quot;&quot;</span>
</span><span id="ARMS.step4-772"><a href="#ARMS.step4-772"><span class="linenos">772</span></a>        <span class="n">solver</span> <span class="o">=</span> <span class="n">RC2</span><span class="p">(</span><span class="n">max_sat</span><span class="p">)</span>
</span><span id="ARMS.step4-773"><a href="#ARMS.step4-773"><span class="linenos">773</span></a>
</span><span id="ARMS.step4-774"><a href="#ARMS.step4-774"><span class="linenos">774</span></a>        <span class="n">encoded_model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="ARMS.step4-775"><a href="#ARMS.step4-775"><span class="linenos">775</span></a>
</span><span id="ARMS.step4-776"><a href="#ARMS.step4-776"><span class="linenos">776</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">encoded_model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ARMS.step4-777"><a href="#ARMS.step4-777"><span class="linenos">777</span></a>            <span class="c1"># should never be reached</span>
</span><span id="ARMS.step4-778"><a href="#ARMS.step4-778"><span class="linenos">778</span></a>            <span class="k">raise</span> <span class="n">InvalidMaxSATModel</span><span class="p">(</span><span class="n">encoded_model</span><span class="p">)</span>
</span><span id="ARMS.step4-779"><a href="#ARMS.step4-779"><span class="linenos">779</span></a>
</span><span id="ARMS.step4-780"><a href="#ARMS.step4-780"><span class="linenos">780</span></a>        <span class="c1"># decode the model (back to nnf vars)</span>
</span><span id="ARMS.step4-781"><a href="#ARMS.step4-781"><span class="linenos">781</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ARMS.step4-782"><a href="#ARMS.step4-782"><span class="linenos">782</span></a>            <span class="n">decode</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">clause</span><span class="p">)]:</span> <span class="n">clause</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">encoded_model</span>
</span><span id="ARMS.step4-783"><a href="#ARMS.step4-783"><span class="linenos">783</span></a>        <span class="p">}</span>
</span><span id="ARMS.step4-784"><a href="#ARMS.step4-784"><span class="linenos">784</span></a>
</span><span id="ARMS.step4-785"><a href="#ARMS.step4-785"><span class="linenos">785</span></a>        <span class="k">return</span> <span class="n">model</span>
</span></pre></div>


            <div class="docstring"><p>(Step 4) Solve the MAX-SAT problem built in Step 3.</p>
</div>


                            </div>
                            <div id="ARMS.step5" class="classattr">
                                        <input id="ARMS.step5-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">step5</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>,</span><span class="param">	<span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#LearnedAction">macq.extract.LearnedAction</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ARMS.step5-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.step5"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.step5-787"><a href="#ARMS.step5-787"><span class="linenos">787</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.step5-788"><a href="#ARMS.step5-788"><span class="linenos">788</span></a>    <span class="k">def</span> <span class="nf">step5</span><span class="p">(</span>
</span><span id="ARMS.step5-789"><a href="#ARMS.step5-789"><span class="linenos">789</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
</span><span id="ARMS.step5-790"><a href="#ARMS.step5-790"><span class="linenos">790</span></a>        <span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LearnedAction</span><span class="p">],</span>
</span><span id="ARMS.step5-791"><a href="#ARMS.step5-791"><span class="linenos">791</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ARMS.step5-792"><a href="#ARMS.step5-792"><span class="linenos">792</span></a>    <span class="p">):</span>
</span><span id="ARMS.step5-793"><a href="#ARMS.step5-793"><span class="linenos">793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(Step 5) Extract the learned action effects from the solved model.&quot;&quot;&quot;</span>
</span><span id="ARMS.step5-794"><a href="#ARMS.step5-794"><span class="linenos">794</span></a>        <span class="n">action_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">details</span><span class="p">():</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">}</span>
</span><span id="ARMS.step5-795"><a href="#ARMS.step5-795"><span class="linenos">795</span></a>        <span class="n">negative_constraints</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
</span><span id="ARMS.step5-796"><a href="#ARMS.step5-796"><span class="linenos">796</span></a>        <span class="n">plan_constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ARMS.step5-797"><a href="#ARMS.step5-797"><span class="linenos">797</span></a>
</span><span id="ARMS.step5-798"><a href="#ARMS.step5-798"><span class="linenos">798</span></a>        <span class="c1"># NOTE: only taking the top n (optimal number varies, determine</span>
</span><span id="ARMS.step5-799"><a href="#ARMS.step5-799"><span class="linenos">799</span></a>        <span class="c1"># empirically) constraints usually results in more accurate action</span>
</span><span id="ARMS.step5-800"><a href="#ARMS.step5-800"><span class="linenos">800</span></a>        <span class="c1"># models, however this is not a part of the paper and therefore not</span>
</span><span id="ARMS.step5-801"><a href="#ARMS.step5-801"><span class="linenos">801</span></a>        <span class="c1"># implemented.</span>
</span><span id="ARMS.step5-802"><a href="#ARMS.step5-802"><span class="linenos">802</span></a>        <span class="k">for</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ARMS.step5-803"><a href="#ARMS.step5-803"><span class="linenos">803</span></a>            <span class="n">constraint</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; (BREAK) &quot;</span><span class="p">)</span>
</span><span id="ARMS.step5-804"><a href="#ARMS.step5-804"><span class="linenos">804</span></a>            <span class="n">relation</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ARMS.step5-805"><a href="#ARMS.step5-805"><span class="linenos">805</span></a>            <span class="n">ctype</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># constraint type</span>
</span><span id="ARMS.step5-806"><a href="#ARMS.step5-806"><span class="linenos">806</span></a>            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
</span><span id="ARMS.step5-807"><a href="#ARMS.step5-807"><span class="linenos">807</span></a>                <span class="n">effect</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ARMS.step5-808"><a href="#ARMS.step5-808"><span class="linenos">808</span></a>                <span class="n">action</span> <span class="o">=</span> <span class="n">action_map</span><span class="p">[</span><span class="n">constraint</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="ARMS.step5-809"><a href="#ARMS.step5-809"><span class="linenos">809</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step5-810"><a href="#ARMS.step5-810"><span class="linenos">810</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="ARMS.step5-811"><a href="#ARMS.step5-811"><span class="linenos">811</span></a>                        <span class="sa">f</span><span class="s2">&quot;Learned constraint: </span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">effect</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step5-812"><a href="#ARMS.step5-812"><span class="linenos">812</span></a>                    <span class="p">)</span>
</span><span id="ARMS.step5-813"><a href="#ARMS.step5-813"><span class="linenos">813</span></a>                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
</span><span id="ARMS.step5-814"><a href="#ARMS.step5-814"><span class="linenos">814</span></a>                    <span class="n">action_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ARMS.step5-815"><a href="#ARMS.step5-815"><span class="linenos">815</span></a>                        <span class="s2">&quot;pre&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">update_precond</span><span class="p">,</span>
</span><span id="ARMS.step5-816"><a href="#ARMS.step5-816"><span class="linenos">816</span></a>                        <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">update_add</span><span class="p">,</span>
</span><span id="ARMS.step5-817"><a href="#ARMS.step5-817"><span class="linenos">817</span></a>                        <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">update_delete</span><span class="p">,</span>
</span><span id="ARMS.step5-818"><a href="#ARMS.step5-818"><span class="linenos">818</span></a>                    <span class="p">}[</span><span class="n">effect</span><span class="p">]</span>
</span><span id="ARMS.step5-819"><a href="#ARMS.step5-819"><span class="linenos">819</span></a>                    <span class="n">action_update</span><span class="p">({</span><span class="n">relation</span><span class="p">})</span>
</span><span id="ARMS.step5-820"><a href="#ARMS.step5-820"><span class="linenos">820</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ARMS.step5-821"><a href="#ARMS.step5-821"><span class="linenos">821</span></a>                    <span class="n">action_effect</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ARMS.step5-822"><a href="#ARMS.step5-822"><span class="linenos">822</span></a>                        <span class="s2">&quot;pre&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">precond</span><span class="p">,</span>
</span><span id="ARMS.step5-823"><a href="#ARMS.step5-823"><span class="linenos">823</span></a>                        <span class="s2">&quot;add&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
</span><span id="ARMS.step5-824"><a href="#ARMS.step5-824"><span class="linenos">824</span></a>                        <span class="s2">&quot;del&quot;</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span>
</span><span id="ARMS.step5-825"><a href="#ARMS.step5-825"><span class="linenos">825</span></a>                    <span class="p">}[</span><span class="n">effect</span><span class="p">]</span>
</span><span id="ARMS.step5-826"><a href="#ARMS.step5-826"><span class="linenos">826</span></a>                    <span class="k">if</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">action_effect</span><span class="p">:</span>
</span><span id="ARMS.step5-827"><a href="#ARMS.step5-827"><span class="linenos">827</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step5-828"><a href="#ARMS.step5-828"><span class="linenos">828</span></a>                            <span class="n">warn</span><span class="p">(</span>
</span><span id="ARMS.step5-829"><a href="#ARMS.step5-829"><span class="linenos">829</span></a>                                <span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">effect</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">details</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ARMS.step5-830"><a href="#ARMS.step5-830"><span class="linenos">830</span></a>                            <span class="p">)</span>
</span><span id="ARMS.step5-831"><a href="#ARMS.step5-831"><span class="linenos">831</span></a>                        <span class="n">action_effect</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>
</span><span id="ARMS.step5-832"><a href="#ARMS.step5-832"><span class="linenos">832</span></a>                    <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">relation</span><span class="p">,</span> <span class="n">action</span><span class="p">)]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</span><span id="ARMS.step5-833"><a href="#ARMS.step5-833"><span class="linenos">833</span></a>
</span><span id="ARMS.step5-834"><a href="#ARMS.step5-834"><span class="linenos">834</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># store plan constraint</span>
</span><span id="ARMS.step5-835"><a href="#ARMS.step5-835"><span class="linenos">835</span></a>                <span class="n">ai</span> <span class="o">=</span> <span class="n">action_map</span><span class="p">[</span><span class="n">constraint</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="ARMS.step5-836"><a href="#ARMS.step5-836"><span class="linenos">836</span></a>                <span class="n">aj</span> <span class="o">=</span> <span class="n">action_map</span><span class="p">[</span><span class="n">constraint</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="ARMS.step5-837"><a href="#ARMS.step5-837"><span class="linenos">837</span></a>                <span class="n">plan_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">relation</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span><span class="p">))</span>
</span><span id="ARMS.step5-838"><a href="#ARMS.step5-838"><span class="linenos">838</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ARMS.step5-839"><a href="#ARMS.step5-839"><span class="linenos">839</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relation</span><span class="si">}</span><span class="s2"> possibly explains action pair (</span><span class="si">{</span><span class="n">ai</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">aj</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ARMS.step5-840"><a href="#ARMS.step5-840"><span class="linenos">840</span></a>
</span><span id="ARMS.step5-841"><a href="#ARMS.step5-841"><span class="linenos">841</span></a>        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">aj</span> <span class="ow">in</span> <span class="n">plan_constraints</span><span class="p">:</span>
</span><span id="ARMS.step5-842"><a href="#ARMS.step5-842"><span class="linenos">842</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="ARMS.step5-843"><a href="#ARMS.step5-843"><span class="linenos">843</span></a>                <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-844"><a href="#ARMS.step5-844"><span class="linenos">844</span></a>                    <span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span>
</span><span id="ARMS.step5-845"><a href="#ARMS.step5-845"><span class="linenos">845</span></a>                <span class="p">)</span>  <span class="c1"># P3</span>
</span><span id="ARMS.step5-846"><a href="#ARMS.step5-846"><span class="linenos">846</span></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">))</span>  <span class="c1"># P4</span>
</span><span id="ARMS.step5-847"><a href="#ARMS.step5-847"><span class="linenos">847</span></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">add</span><span class="p">))</span>  <span class="c1"># P5</span>
</span><span id="ARMS.step5-848"><a href="#ARMS.step5-848"><span class="linenos">848</span></a>            <span class="p">):</span>
</span><span id="ARMS.step5-849"><a href="#ARMS.step5-849"><span class="linenos">849</span></a>                <span class="c1"># check if either P3 or P4 are partially fulfilled and can be satisfied</span>
</span><span id="ARMS.step5-850"><a href="#ARMS.step5-850"><span class="linenos">850</span></a>                <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">precond</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">):</span>
</span><span id="ARMS.step5-851"><a href="#ARMS.step5-851"><span class="linenos">851</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">aj</span><span class="o">.</span><span class="n">precond</span><span class="p">:</span>
</span><span id="ARMS.step5-852"><a href="#ARMS.step5-852"><span class="linenos">852</span></a>                        <span class="c1"># if P3 isn&#39;t contradicted, add p to ai.precond</span>
</span><span id="ARMS.step5-853"><a href="#ARMS.step5-853"><span class="linenos">853</span></a>                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-854"><a href="#ARMS.step5-854"><span class="linenos">854</span></a>                            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-855"><a href="#ARMS.step5-855"><span class="linenos">855</span></a>                            <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS.step5-856"><a href="#ARMS.step5-856"><span class="linenos">856</span></a>                        <span class="p">):</span>
</span><span id="ARMS.step5-857"><a href="#ARMS.step5-857"><span class="linenos">857</span></a>                            <span class="n">ai</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-858"><a href="#ARMS.step5-858"><span class="linenos">858</span></a>
</span><span id="ARMS.step5-859"><a href="#ARMS.step5-859"><span class="linenos">859</span></a>                        <span class="c1"># if P4 isn&#39;t contradicted, add p to ai.add</span>
</span><span id="ARMS.step5-860"><a href="#ARMS.step5-860"><span class="linenos">860</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-861"><a href="#ARMS.step5-861"><span class="linenos">861</span></a>                            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-862"><a href="#ARMS.step5-862"><span class="linenos">862</span></a>                            <span class="ow">and</span> <span class="s2">&quot;add&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS.step5-863"><a href="#ARMS.step5-863"><span class="linenos">863</span></a>                        <span class="p">):</span>
</span><span id="ARMS.step5-864"><a href="#ARMS.step5-864"><span class="linenos">864</span></a>                            <span class="n">ai</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-865"><a href="#ARMS.step5-865"><span class="linenos">865</span></a>
</span><span id="ARMS.step5-866"><a href="#ARMS.step5-866"><span class="linenos">866</span></a>                    <span class="c1"># p in ai.precond and P3 not contradicted, add p to aj.precond</span>
</span><span id="ARMS.step5-867"><a href="#ARMS.step5-867"><span class="linenos">867</span></a>                    <span class="k">elif</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-868"><a href="#ARMS.step5-868"><span class="linenos">868</span></a>                        <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-869"><a href="#ARMS.step5-869"><span class="linenos">869</span></a>                        <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS.step5-870"><a href="#ARMS.step5-870"><span class="linenos">870</span></a>                    <span class="p">):</span>
</span><span id="ARMS.step5-871"><a href="#ARMS.step5-871"><span class="linenos">871</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-872"><a href="#ARMS.step5-872"><span class="linenos">872</span></a>
</span><span id="ARMS.step5-873"><a href="#ARMS.step5-873"><span class="linenos">873</span></a>                <span class="c1"># check if either P3 or P4 can be satisfied</span>
</span><span id="ARMS.step5-874"><a href="#ARMS.step5-874"><span class="linenos">874</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-875"><a href="#ARMS.step5-875"><span class="linenos">875</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-876"><a href="#ARMS.step5-876"><span class="linenos">876</span></a>                    <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS.step5-877"><a href="#ARMS.step5-877"><span class="linenos">877</span></a>                <span class="p">):</span>
</span><span id="ARMS.step5-878"><a href="#ARMS.step5-878"><span class="linenos">878</span></a>                    <span class="c1"># if P3 isn&#39;t contradicted, add p to both ai and aj preconds</span>
</span><span id="ARMS.step5-879"><a href="#ARMS.step5-879"><span class="linenos">879</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-880"><a href="#ARMS.step5-880"><span class="linenos">880</span></a>                        <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-881"><a href="#ARMS.step5-881"><span class="linenos">881</span></a>                        <span class="ow">and</span> <span class="s2">&quot;pre&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS.step5-882"><a href="#ARMS.step5-882"><span class="linenos">882</span></a>                    <span class="p">):</span>
</span><span id="ARMS.step5-883"><a href="#ARMS.step5-883"><span class="linenos">883</span></a>                        <span class="n">ai</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-884"><a href="#ARMS.step5-884"><span class="linenos">884</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-885"><a href="#ARMS.step5-885"><span class="linenos">885</span></a>
</span><span id="ARMS.step5-886"><a href="#ARMS.step5-886"><span class="linenos">886</span></a>                    <span class="c1"># if P4 isn&#39;t contradicted, add p to ai.add and aj.precond</span>
</span><span id="ARMS.step5-887"><a href="#ARMS.step5-887"><span class="linenos">887</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-888"><a href="#ARMS.step5-888"><span class="linenos">888</span></a>                        <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-889"><a href="#ARMS.step5-889"><span class="linenos">889</span></a>                        <span class="ow">and</span> <span class="s2">&quot;add&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS.step5-890"><a href="#ARMS.step5-890"><span class="linenos">890</span></a>                    <span class="p">):</span>
</span><span id="ARMS.step5-891"><a href="#ARMS.step5-891"><span class="linenos">891</span></a>                        <span class="n">ai</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-892"><a href="#ARMS.step5-892"><span class="linenos">892</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-893"><a href="#ARMS.step5-893"><span class="linenos">893</span></a>
</span><span id="ARMS.step5-894"><a href="#ARMS.step5-894"><span class="linenos">894</span></a>                <span class="c1"># check if P5 can be satisfied</span>
</span><span id="ARMS.step5-895"><a href="#ARMS.step5-895"><span class="linenos">895</span></a>                <span class="c1"># if P5 isn&#39;t contradicted, add p wherever it is missing</span>
</span><span id="ARMS.step5-896"><a href="#ARMS.step5-896"><span class="linenos">896</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-897"><a href="#ARMS.step5-897"><span class="linenos">897</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-898"><a href="#ARMS.step5-898"><span class="linenos">898</span></a>                    <span class="ow">and</span> <span class="s2">&quot;del&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">ai</span><span class="p">)]</span>
</span><span id="ARMS.step5-899"><a href="#ARMS.step5-899"><span class="linenos">899</span></a>                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="ARMS.step5-900"><a href="#ARMS.step5-900"><span class="linenos">900</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">negative_constraints</span>
</span><span id="ARMS.step5-901"><a href="#ARMS.step5-901"><span class="linenos">901</span></a>                    <span class="ow">and</span> <span class="s2">&quot;add&quot;</span> <span class="ow">in</span> <span class="n">negative_constraints</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">aj</span><span class="p">)]</span>
</span><span id="ARMS.step5-902"><a href="#ARMS.step5-902"><span class="linenos">902</span></a>                <span class="p">):</span>
</span><span id="ARMS.step5-903"><a href="#ARMS.step5-903"><span class="linenos">903</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ai</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span>
</span><span id="ARMS.step5-904"><a href="#ARMS.step5-904"><span class="linenos">904</span></a>                        <span class="n">ai</span><span class="o">.</span><span class="n">update_delete</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span><span id="ARMS.step5-905"><a href="#ARMS.step5-905"><span class="linenos">905</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aj</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
</span><span id="ARMS.step5-906"><a href="#ARMS.step5-906"><span class="linenos">906</span></a>                        <span class="n">aj</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">p</span><span class="p">})</span>
</span></pre></div>


            <div class="docstring"><p>(Step 5) Extract the learned action effects from the solved model.</p>
</div>


                            </div>
                            <div id="ARMS.debug_menu" class="classattr">
                                        <input id="ARMS.debug_menu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">debug_menu</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ARMS.debug_menu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.debug_menu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.debug_menu-908"><a href="#ARMS.debug_menu-908"><span class="linenos">908</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ARMS.debug_menu-909"><a href="#ARMS.debug_menu-909"><span class="linenos">909</span></a>    <span class="k">def</span> <span class="nf">debug_menu</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ARMS.debug_menu-910"><a href="#ARMS.debug_menu-910"><span class="linenos">910</span></a>        <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="s2">&quot; (y/n): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="ARMS.debug_menu-911"><a href="#ARMS.debug_menu-911"><span class="linenos">911</span></a>        <span class="k">while</span> <span class="n">choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]:</span>
</span><span id="ARMS.debug_menu-912"><a href="#ARMS.debug_menu-912"><span class="linenos">912</span></a>            <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="s2">&quot; (y/n): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="ARMS.debug_menu-913"><a href="#ARMS.debug_menu-913"><span class="linenos">913</span></a>        <span class="k">return</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="ARMS.InvalidThreshold">
                            <input id="ARMS.InvalidThreshold-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ARMS.InvalidThreshold</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="ARMS.InvalidThreshold-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.InvalidThreshold"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.InvalidThreshold-61"><a href="#ARMS.InvalidThreshold-61"><span class="linenos">61</span></a>    <span class="k">class</span> <span class="nc">InvalidThreshold</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="ARMS.InvalidThreshold-62"><a href="#ARMS.InvalidThreshold-62"><span class="linenos">62</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="ARMS.InvalidThreshold-63"><a href="#ARMS.InvalidThreshold-63"><span class="linenos">63</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ARMS.InvalidThreshold-64"><a href="#ARMS.InvalidThreshold-64"><span class="linenos">64</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid threshold value: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">. Threshold must be a float between 0-1 (inclusive).&quot;</span>
</span><span id="ARMS.InvalidThreshold-65"><a href="#ARMS.InvalidThreshold-65"><span class="linenos">65</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div id="ARMS.InvalidThreshold.__init__" class="classattr">
                                        <input id="ARMS.InvalidThreshold.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ARMS.InvalidThreshold</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">threshold</span></span>)</span>

                <label class="view-source-button" for="ARMS.InvalidThreshold.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ARMS.InvalidThreshold.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ARMS.InvalidThreshold.__init__-62"><a href="#ARMS.InvalidThreshold.__init__-62"><span class="linenos">62</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="ARMS.InvalidThreshold.__init__-63"><a href="#ARMS.InvalidThreshold.__init__-63"><span class="linenos">63</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ARMS.InvalidThreshold.__init__-64"><a href="#ARMS.InvalidThreshold.__init__-64"><span class="linenos">64</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid threshold value: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">. Threshold must be a float between 0-1 (inclusive).&quot;</span>
</span><span id="ARMS.InvalidThreshold.__init__-65"><a href="#ARMS.InvalidThreshold.__init__-65"><span class="linenos">65</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="ARMS.InvalidThreshold.with_traceback" class="function">with_traceback</dd>
                <dd id="ARMS.InvalidThreshold.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AMDN">
                            <input id="AMDN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AMDN</span>:

                <label class="view-source-button" for="AMDN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AMDN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AMDN-68"><a href="#AMDN-68"><span class="linenos"> 68</span></a><span class="k">class</span> <span class="nc">AMDN</span><span class="p">:</span>
</span><span id="AMDN-69"><a href="#AMDN-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="AMDN-70"><a href="#AMDN-70"><span class="linenos"> 70</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AMDN-71"><a href="#AMDN-71"><span class="linenos"> 71</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="AMDN-72"><a href="#AMDN-72"><span class="linenos"> 72</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AMDN-73"><a href="#AMDN-73"><span class="linenos"> 73</span></a>        <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="AMDN-74"><a href="#AMDN-74"><span class="linenos"> 74</span></a>    <span class="p">):</span>
</span><span id="AMDN-75"><a href="#AMDN-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="AMDN-76"><a href="#AMDN-76"><span class="linenos"> 76</span></a>
</span><span id="AMDN-77"><a href="#AMDN-77"><span class="linenos"> 77</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-78"><a href="#AMDN-78"><span class="linenos"> 78</span></a><span class="sd">            obs_tracelist (ObservationList):</span>
</span><span id="AMDN-79"><a href="#AMDN-79"><span class="linenos"> 79</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="AMDN-80"><a href="#AMDN-80"><span class="linenos"> 80</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN-81"><a href="#AMDN-81"><span class="linenos"> 81</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN-82"><a href="#AMDN-82"><span class="linenos"> 82</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-83"><a href="#AMDN-83"><span class="linenos"> 83</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-84"><a href="#AMDN-84"><span class="linenos"> 84</span></a>
</span><span id="AMDN-85"><a href="#AMDN-85"><span class="linenos"> 85</span></a><span class="sd">        Raises:</span>
</span><span id="AMDN-86"><a href="#AMDN-86"><span class="linenos"> 86</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="AMDN-87"><a href="#AMDN-87"><span class="linenos"> 87</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="AMDN-88"><a href="#AMDN-88"><span class="linenos"> 88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-89"><a href="#AMDN-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoisyPartialDisorderedParallelObservation</span><span class="p">:</span>
</span><span id="AMDN-90"><a href="#AMDN-90"><span class="linenos"> 90</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">AMDN</span><span class="p">)</span>
</span><span id="AMDN-91"><a href="#AMDN-91"><span class="linenos"> 91</span></a>
</span><span id="AMDN-92"><a href="#AMDN-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_amdn</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">)</span>
</span><span id="AMDN-93"><a href="#AMDN-93"><span class="linenos"> 93</span></a>
</span><span id="AMDN-94"><a href="#AMDN-94"><span class="linenos"> 94</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-95"><a href="#AMDN-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">_amdn</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AMDN-96"><a href="#AMDN-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Main driver for the entire AMDN algorithm.</span>
</span><span id="AMDN-97"><a href="#AMDN-97"><span class="linenos"> 97</span></a><span class="sd">        The first line contains steps 1-4.</span>
</span><span id="AMDN-98"><a href="#AMDN-98"><span class="linenos"> 98</span></a><span class="sd">        The second line contains step 5.</span>
</span><span id="AMDN-99"><a href="#AMDN-99"><span class="linenos"> 99</span></a><span class="sd">        Finally, the final line corresponds to step 6 (return the model).</span>
</span><span id="AMDN-100"><a href="#AMDN-100"><span class="linenos">100</span></a>
</span><span id="AMDN-101"><a href="#AMDN-101"><span class="linenos">101</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-102"><a href="#AMDN-102"><span class="linenos">102</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-103"><a href="#AMDN-103"><span class="linenos">103</span></a><span class="sd">                The tokens to be fed into the algorithm.</span>
</span><span id="AMDN-104"><a href="#AMDN-104"><span class="linenos">104</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN-105"><a href="#AMDN-105"><span class="linenos">105</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN-106"><a href="#AMDN-106"><span class="linenos">106</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-107"><a href="#AMDN-107"><span class="linenos">107</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-108"><a href="#AMDN-108"><span class="linenos">108</span></a>
</span><span id="AMDN-109"><a href="#AMDN-109"><span class="linenos">109</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-110"><a href="#AMDN-110"><span class="linenos">110</span></a><span class="sd">            The extracted `Model`.</span>
</span><span id="AMDN-111"><a href="#AMDN-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-112"><a href="#AMDN-112"><span class="linenos">112</span></a>        <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_solve_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="AMDN-113"><a href="#AMDN-113"><span class="linenos">113</span></a>        <span class="n">raw_model</span> <span class="o">=</span> <span class="n">extract_raw_model</span><span class="p">(</span><span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span><span class="p">)</span>
</span><span id="AMDN-114"><a href="#AMDN-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_extract_model</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">raw_model</span><span class="p">)</span>
</span><span id="AMDN-115"><a href="#AMDN-115"><span class="linenos">115</span></a>
</span><span id="AMDN-116"><a href="#AMDN-116"><span class="linenos">116</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-117"><a href="#AMDN-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">_or_refactor</span><span class="p">(</span><span class="n">maybe_lit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Or</span><span class="p">,</span> <span class="n">Var</span><span class="p">]):</span>
</span><span id="AMDN-118"><a href="#AMDN-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a &quot;Var&quot; fluent to an &quot;Or&quot; fluent.</span>
</span><span id="AMDN-119"><a href="#AMDN-119"><span class="linenos">119</span></a>
</span><span id="AMDN-120"><a href="#AMDN-120"><span class="linenos">120</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-121"><a href="#AMDN-121"><span class="linenos">121</span></a><span class="sd">            maybe_lit (Union[Or, Var]):</span>
</span><span id="AMDN-122"><a href="#AMDN-122"><span class="linenos">122</span></a><span class="sd">                Fluent that is either type &quot;Or&quot; or &quot;Var.&quot;</span>
</span><span id="AMDN-123"><a href="#AMDN-123"><span class="linenos">123</span></a>
</span><span id="AMDN-124"><a href="#AMDN-124"><span class="linenos">124</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-125"><a href="#AMDN-125"><span class="linenos">125</span></a><span class="sd">            A corresponding fluent of type &quot;Or.&quot;</span>
</span><span id="AMDN-126"><a href="#AMDN-126"><span class="linenos">126</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-127"><a href="#AMDN-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">Or</span><span class="p">([</span><span class="n">maybe_lit</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maybe_lit</span><span class="p">,</span> <span class="n">Var</span><span class="p">)</span> <span class="k">else</span> <span class="n">maybe_lit</span>
</span><span id="AMDN-128"><a href="#AMDN-128"><span class="linenos">128</span></a>
</span><span id="AMDN-129"><a href="#AMDN-129"><span class="linenos">129</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-130"><a href="#AMDN-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">_extract_aux_set_weights</span><span class="p">(</span>
</span><span id="AMDN-131"><a href="#AMDN-131"><span class="linenos">131</span></a>        <span class="n">cnf_formula</span><span class="p">:</span> <span class="n">And</span><span class="p">[</span><span class="n">Or</span><span class="p">[</span><span class="n">Var</span><span class="p">]],</span> <span class="n">constraints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">prob_disordered</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="AMDN-132"><a href="#AMDN-132"><span class="linenos">132</span></a>    <span class="p">):</span>
</span><span id="AMDN-133"><a href="#AMDN-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets each clause in a CNF formula as a hard constraint, then sets any auxiliary variables to</span>
</span><span id="AMDN-134"><a href="#AMDN-134"><span class="linenos">134</span></a><span class="sd">        the appropriate weight detailed in the &quot;Constraint DC&quot; section of the AMDN paper.</span>
</span><span id="AMDN-135"><a href="#AMDN-135"><span class="linenos">135</span></a><span class="sd">        Used to help create disorder constraints.</span>
</span><span id="AMDN-136"><a href="#AMDN-136"><span class="linenos">136</span></a>
</span><span id="AMDN-137"><a href="#AMDN-137"><span class="linenos">137</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-138"><a href="#AMDN-138"><span class="linenos">138</span></a><span class="sd">            cnf_formula (And[Or[Var]]):</span>
</span><span id="AMDN-139"><a href="#AMDN-139"><span class="linenos">139</span></a><span class="sd">                The CNF formula to extract the clauses and auxiliary variables from.</span>
</span><span id="AMDN-140"><a href="#AMDN-140"><span class="linenos">140</span></a><span class="sd">            constraints (Dict):</span>
</span><span id="AMDN-141"><a href="#AMDN-141"><span class="linenos">141</span></a><span class="sd">                The existing dictionary of disorder constraints.</span>
</span><span id="AMDN-142"><a href="#AMDN-142"><span class="linenos">142</span></a><span class="sd">            prob_disordered (float):</span>
</span><span id="AMDN-143"><a href="#AMDN-143"><span class="linenos">143</span></a><span class="sd">                The probability that the two actions relevant fot this constraint are disordered.</span>
</span><span id="AMDN-144"><a href="#AMDN-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-145"><a href="#AMDN-145"><span class="linenos">145</span></a>        <span class="c1"># find all the auxiliary variables</span>
</span><span id="AMDN-146"><a href="#AMDN-146"><span class="linenos">146</span></a>        <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">cnf_formula</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="AMDN-147"><a href="#AMDN-147"><span class="linenos">147</span></a>            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">clause</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="AMDN-148"><a href="#AMDN-148"><span class="linenos">148</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Aux</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">true</span><span class="p">:</span>
</span><span id="AMDN-149"><a href="#AMDN-149"><span class="linenos">149</span></a>                    <span class="c1"># aux variables are the soft clauses that get the original weight</span>
</span><span id="AMDN-150"><a href="#AMDN-150"><span class="linenos">150</span></a>                    <span class="n">constraints</span><span class="p">[</span><span class="n">AMDN</span><span class="o">.</span><span class="n">_or_refactor</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prob_disordered</span> <span class="o">*</span> <span class="n">WMAX</span>
</span><span id="AMDN-151"><a href="#AMDN-151"><span class="linenos">151</span></a>            <span class="c1"># set each original constraint to be a hard clause</span>
</span><span id="AMDN-152"><a href="#AMDN-152"><span class="linenos">152</span></a>            <span class="n">constraints</span><span class="p">[</span><span class="n">clause</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;HARD&quot;</span>
</span><span id="AMDN-153"><a href="#AMDN-153"><span class="linenos">153</span></a>
</span><span id="AMDN-154"><a href="#AMDN-154"><span class="linenos">154</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-155"><a href="#AMDN-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="nf">_get_observe</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="AMDN-156"><a href="#AMDN-156"><span class="linenos">156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets from the user which fluents they want to observe (for debug mode).</span>
</span><span id="AMDN-157"><a href="#AMDN-157"><span class="linenos">157</span></a>
</span><span id="AMDN-158"><a href="#AMDN-158"><span class="linenos">158</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-159"><a href="#AMDN-159"><span class="linenos">159</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-160"><a href="#AMDN-160"><span class="linenos">160</span></a><span class="sd">                The tokens that contain the fluents.</span>
</span><span id="AMDN-161"><a href="#AMDN-161"><span class="linenos">161</span></a>
</span><span id="AMDN-162"><a href="#AMDN-162"><span class="linenos">162</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-163"><a href="#AMDN-163"><span class="linenos">163</span></a><span class="sd">            A list of of which fluents the user wants to observe.</span>
</span><span id="AMDN-164"><a href="#AMDN-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-165"><a href="#AMDN-165"><span class="linenos">165</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Select a proposition to observe:&quot;</span><span class="p">)</span>
</span><span id="AMDN-166"><a href="#AMDN-166"><span class="linenos">166</span></a>        <span class="n">sorted_f</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">]</span>
</span><span id="AMDN-167"><a href="#AMDN-167"><span class="linenos">167</span></a>        <span class="n">sorted_f</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="AMDN-168"><a href="#AMDN-168"><span class="linenos">168</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sorted_f</span><span class="p">:</span>
</span><span id="AMDN-169"><a href="#AMDN-169"><span class="linenos">169</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="AMDN-170"><a href="#AMDN-170"><span class="linenos">170</span></a>        <span class="n">to_obs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AMDN-171"><a href="#AMDN-171"><span class="linenos">171</span></a>        <span class="n">user_input</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="AMDN-172"><a href="#AMDN-172"><span class="linenos">172</span></a>        <span class="k">while</span> <span class="n">user_input</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="AMDN-173"><a href="#AMDN-173"><span class="linenos">173</span></a>            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
</span><span id="AMDN-174"><a href="#AMDN-174"><span class="linenos">174</span></a>                <span class="s2">&quot;Which fluents do you want to observe? Enter &#39;x&#39; when you are finished.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AMDN-175"><a href="#AMDN-175"><span class="linenos">175</span></a>            <span class="p">)</span>
</span><span id="AMDN-176"><a href="#AMDN-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="n">sorted_f</span><span class="p">:</span>
</span><span id="AMDN-177"><a href="#AMDN-177"><span class="linenos">177</span></a>                <span class="n">to_obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AMDN-178"><a href="#AMDN-178"><span class="linenos">178</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span> <span class="o">+</span> <span class="s2">&quot; added to the debugging list.&quot;</span><span class="p">)</span>
</span><span id="AMDN-179"><a href="#AMDN-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AMDN-180"><a href="#AMDN-180"><span class="linenos">180</span></a>                <span class="k">if</span> <span class="n">user_input</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="AMDN-181"><a href="#AMDN-181"><span class="linenos">181</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The fluent you entered is invalid.&quot;</span><span class="p">)</span>
</span><span id="AMDN-182"><a href="#AMDN-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="n">to_obs</span>
</span><span id="AMDN-183"><a href="#AMDN-183"><span class="linenos">183</span></a>
</span><span id="AMDN-184"><a href="#AMDN-184"><span class="linenos">184</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-185"><a href="#AMDN-185"><span class="linenos">185</span></a>    <span class="k">def</span> <span class="nf">_debug_is_observed</span><span class="p">(</span><span class="n">constraint</span><span class="p">:</span> <span class="n">Or</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="AMDN-186"><a href="#AMDN-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines if the given constraint contains a fluent that is being observed in debug mode.</span>
</span><span id="AMDN-187"><a href="#AMDN-187"><span class="linenos">187</span></a>
</span><span id="AMDN-188"><a href="#AMDN-188"><span class="linenos">188</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-189"><a href="#AMDN-189"><span class="linenos">189</span></a><span class="sd">            constraint (Or):</span>
</span><span id="AMDN-190"><a href="#AMDN-190"><span class="linenos">190</span></a><span class="sd">                The constraint to be analyzed.</span>
</span><span id="AMDN-191"><a href="#AMDN-191"><span class="linenos">191</span></a><span class="sd">            to_obs (List[str]):</span>
</span><span id="AMDN-192"><a href="#AMDN-192"><span class="linenos">192</span></a><span class="sd">                The list of fluents being observed.</span>
</span><span id="AMDN-193"><a href="#AMDN-193"><span class="linenos">193</span></a>
</span><span id="AMDN-194"><a href="#AMDN-194"><span class="linenos">194</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-195"><a href="#AMDN-195"><span class="linenos">195</span></a><span class="sd">            A bool that determines if the constraint should be observed or not.</span>
</span><span id="AMDN-196"><a href="#AMDN-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-197"><a href="#AMDN-197"><span class="linenos">197</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="AMDN-198"><a href="#AMDN-198"><span class="linenos">198</span></a>            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">to_obs</span><span class="p">:</span>
</span><span id="AMDN-199"><a href="#AMDN-199"><span class="linenos">199</span></a>                <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
</span><span id="AMDN-200"><a href="#AMDN-200"><span class="linenos">200</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="AMDN-201"><a href="#AMDN-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="AMDN-202"><a href="#AMDN-202"><span class="linenos">202</span></a>
</span><span id="AMDN-203"><a href="#AMDN-203"><span class="linenos">203</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-204"><a href="#AMDN-204"><span class="linenos">204</span></a>    <span class="k">def</span> <span class="nf">_debug_simple_pprint</span><span class="p">(</span><span class="n">constraints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="AMDN-205"><a href="#AMDN-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty print used for simple formulas in debug mode.</span>
</span><span id="AMDN-206"><a href="#AMDN-206"><span class="linenos">206</span></a>
</span><span id="AMDN-207"><a href="#AMDN-207"><span class="linenos">207</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-208"><a href="#AMDN-208"><span class="linenos">208</span></a><span class="sd">            constraints (Dict):</span>
</span><span id="AMDN-209"><a href="#AMDN-209"><span class="linenos">209</span></a><span class="sd">                The constraints/weights to be pretty printed.</span>
</span><span id="AMDN-210"><a href="#AMDN-210"><span class="linenos">210</span></a><span class="sd">            to_obs (List[str]):</span>
</span><span id="AMDN-211"><a href="#AMDN-211"><span class="linenos">211</span></a><span class="sd">                The fluents being observed.</span>
</span><span id="AMDN-212"><a href="#AMDN-212"><span class="linenos">212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-213"><a href="#AMDN-213"><span class="linenos">213</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
</span><span id="AMDN-214"><a href="#AMDN-214"><span class="linenos">214</span></a>            <span class="n">observe</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_is_observed</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-215"><a href="#AMDN-215"><span class="linenos">215</span></a>            <span class="k">if</span> <span class="n">observe</span><span class="p">:</span>
</span><span id="AMDN-216"><a href="#AMDN-216"><span class="linenos">216</span></a>                <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span><span id="AMDN-217"><a href="#AMDN-217"><span class="linenos">217</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">constraints</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
</span><span id="AMDN-218"><a href="#AMDN-218"><span class="linenos">218</span></a>
</span><span id="AMDN-219"><a href="#AMDN-219"><span class="linenos">219</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-220"><a href="#AMDN-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">_debug_aux_pprint</span><span class="p">(</span><span class="n">constraints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="AMDN-221"><a href="#AMDN-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty print used for formulas with auxiliary variables in debug mode.</span>
</span><span id="AMDN-222"><a href="#AMDN-222"><span class="linenos">222</span></a>
</span><span id="AMDN-223"><a href="#AMDN-223"><span class="linenos">223</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-224"><a href="#AMDN-224"><span class="linenos">224</span></a><span class="sd">            constraints (Dict):</span>
</span><span id="AMDN-225"><a href="#AMDN-225"><span class="linenos">225</span></a><span class="sd">                The constraints/weights to be pretty printed.</span>
</span><span id="AMDN-226"><a href="#AMDN-226"><span class="linenos">226</span></a><span class="sd">            to_obs (List[str]):</span>
</span><span id="AMDN-227"><a href="#AMDN-227"><span class="linenos">227</span></a><span class="sd">                The fluents being observed.</span>
</span><span id="AMDN-228"><a href="#AMDN-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-229"><a href="#AMDN-229"><span class="linenos">229</span></a>        <span class="n">aux_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-230"><a href="#AMDN-230"><span class="linenos">230</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AMDN-231"><a href="#AMDN-231"><span class="linenos">231</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
</span><span id="AMDN-232"><a href="#AMDN-232"><span class="linenos">232</span></a>            <span class="k">if</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_is_observed</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">):</span>
</span><span id="AMDN-233"><a href="#AMDN-233"><span class="linenos">233</span></a>                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="AMDN-234"><a href="#AMDN-234"><span class="linenos">234</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Aux</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aux_map</span><span class="p">:</span>
</span><span id="AMDN-235"><a href="#AMDN-235"><span class="linenos">235</span></a>                        <span class="n">aux_map</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;aux </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AMDN-236"><a href="#AMDN-236"><span class="linenos">236</span></a>                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AMDN-237"><a href="#AMDN-237"><span class="linenos">237</span></a>
</span><span id="AMDN-238"><a href="#AMDN-238"><span class="linenos">238</span></a>        <span class="n">all_pretty_c</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-239"><a href="#AMDN-239"><span class="linenos">239</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
</span><span id="AMDN-240"><a href="#AMDN-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_is_observed</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">):</span>
</span><span id="AMDN-241"><a href="#AMDN-241"><span class="linenos">241</span></a>                <span class="n">pretty_c</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AMDN-242"><a href="#AMDN-242"><span class="linenos">242</span></a>                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="AMDN-243"><a href="#AMDN-243"><span class="linenos">243</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Aux</span><span class="p">):</span>
</span><span id="AMDN-244"><a href="#AMDN-244"><span class="linenos">244</span></a>                        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">true</span><span class="p">:</span>
</span><span id="AMDN-245"><a href="#AMDN-245"><span class="linenos">245</span></a>                            <span class="n">pretty_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Var</span><span class="p">(</span><span class="n">aux_map</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]))</span>
</span><span id="AMDN-246"><a href="#AMDN-246"><span class="linenos">246</span></a>                            <span class="n">all_pretty_c</span><span class="p">[</span><span class="n">AMDN</span><span class="o">.</span><span class="n">_or_refactor</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="AMDN-247"><a href="#AMDN-247"><span class="linenos">247</span></a>                                <span class="p">[</span><span class="n">Var</span><span class="p">(</span><span class="n">aux_map</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">])]</span>
</span><span id="AMDN-248"><a href="#AMDN-248"><span class="linenos">248</span></a>                            <span class="p">)</span>
</span><span id="AMDN-249"><a href="#AMDN-249"><span class="linenos">249</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AMDN-250"><a href="#AMDN-250"><span class="linenos">250</span></a>                            <span class="n">pretty_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">~</span><span class="n">Var</span><span class="p">(</span><span class="n">aux_map</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]))</span>
</span><span id="AMDN-251"><a href="#AMDN-251"><span class="linenos">251</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AMDN-252"><a href="#AMDN-252"><span class="linenos">252</span></a>                        <span class="n">pretty_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</span><span id="AMDN-253"><a href="#AMDN-253"><span class="linenos">253</span></a>                <span class="c1"># map disorder constraints to pretty disorder constraints</span>
</span><span id="AMDN-254"><a href="#AMDN-254"><span class="linenos">254</span></a>                <span class="n">all_pretty_c</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="n">pretty_c</span><span class="p">)</span>
</span><span id="AMDN-255"><a href="#AMDN-255"><span class="linenos">255</span></a>
</span><span id="AMDN-256"><a href="#AMDN-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">aux</span> <span class="ow">in</span> <span class="n">aux_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="AMDN-257"><a href="#AMDN-257"><span class="linenos">257</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_pretty_c</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AMDN-258"><a href="#AMDN-258"><span class="linenos">258</span></a>                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="AMDN-259"><a href="#AMDN-259"><span class="linenos">259</span></a>                    <span class="k">if</span> <span class="n">aux</span> <span class="o">==</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="AMDN-260"><a href="#AMDN-260"><span class="linenos">260</span></a>                        <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="AMDN-261"><a href="#AMDN-261"><span class="linenos">261</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">constraints</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
</span><span id="AMDN-262"><a href="#AMDN-262"><span class="linenos">262</span></a>                        <span class="k">break</span>
</span><span id="AMDN-263"><a href="#AMDN-263"><span class="linenos">263</span></a>            <span class="nb">print</span><span class="p">()</span>
</span><span id="AMDN-264"><a href="#AMDN-264"><span class="linenos">264</span></a>
</span><span id="AMDN-265"><a href="#AMDN-265"><span class="linenos">265</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-266"><a href="#AMDN-266"><span class="linenos">266</span></a>    <span class="k">def</span> <span class="nf">_build_disorder_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="AMDN-267"><a href="#AMDN-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds disorder constraints. Corresponds to step 1 of the AMDN algorithm.</span>
</span><span id="AMDN-268"><a href="#AMDN-268"><span class="linenos">268</span></a>
</span><span id="AMDN-269"><a href="#AMDN-269"><span class="linenos">269</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-270"><a href="#AMDN-270"><span class="linenos">270</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-271"><a href="#AMDN-271"><span class="linenos">271</span></a><span class="sd">                The tokens to be analyzed.</span>
</span><span id="AMDN-272"><a href="#AMDN-272"><span class="linenos">272</span></a>
</span><span id="AMDN-273"><a href="#AMDN-273"><span class="linenos">273</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-274"><a href="#AMDN-274"><span class="linenos">274</span></a><span class="sd">            The disorder constraints to be used in the algorithm.</span>
</span><span id="AMDN-275"><a href="#AMDN-275"><span class="linenos">275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-276"><a href="#AMDN-276"><span class="linenos">276</span></a>        <span class="n">disorder_constraints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-277"><a href="#AMDN-277"><span class="linenos">277</span></a>
</span><span id="AMDN-278"><a href="#AMDN-278"><span class="linenos">278</span></a>        <span class="c1"># iterate through all traces</span>
</span><span id="AMDN-279"><a href="#AMDN-279"><span class="linenos">279</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">)):</span>
</span><span id="AMDN-280"><a href="#AMDN-280"><span class="linenos">280</span></a>            <span class="c1"># get the parallel action sets for this trace</span>
</span><span id="AMDN-281"><a href="#AMDN-281"><span class="linenos">281</span></a>            <span class="n">par_act_sets</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AMDN-282"><a href="#AMDN-282"><span class="linenos">282</span></a>            <span class="c1"># iterate through all pairs of parallel action sets for this trace</span>
</span><span id="AMDN-283"><a href="#AMDN-283"><span class="linenos">283</span></a>            <span class="c1"># use -1 since we will be referencing the current parallel action set and the following one</span>
</span><span id="AMDN-284"><a href="#AMDN-284"><span class="linenos">284</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par_act_sets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AMDN-285"><a href="#AMDN-285"><span class="linenos">285</span></a>                <span class="c1"># for each action in psi_i+1</span>
</span><span id="AMDN-286"><a href="#AMDN-286"><span class="linenos">286</span></a>                <span class="k">for</span> <span class="n">act_y</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="AMDN-287"><a href="#AMDN-287"><span class="linenos">287</span></a>                    <span class="c1"># for each action in psi_i</span>
</span><span id="AMDN-288"><a href="#AMDN-288"><span class="linenos">288</span></a>                    <span class="c1"># NOTE: we do not use an existential here, as the paper describes (for each act_y in psi_i + 1,</span>
</span><span id="AMDN-289"><a href="#AMDN-289"><span class="linenos">289</span></a>                    <span class="c1"># there exists an act_x in psi_i such that the condition holds.)</span>
</span><span id="AMDN-290"><a href="#AMDN-290"><span class="linenos">290</span></a>                    <span class="c1"># this is due to the fact that the weights must be set for each action pair.</span>
</span><span id="AMDN-291"><a href="#AMDN-291"><span class="linenos">291</span></a>                    <span class="k">for</span> <span class="n">act_x</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="AMDN-292"><a href="#AMDN-292"><span class="linenos">292</span></a>                        <span class="k">if</span> <span class="n">act_x</span> <span class="o">!=</span> <span class="n">act_y</span><span class="p">:</span>
</span><span id="AMDN-293"><a href="#AMDN-293"><span class="linenos">293</span></a>                            <span class="c1"># calculate the probability of the actions being disordered (p)</span>
</span><span id="AMDN-294"><a href="#AMDN-294"><span class="linenos">294</span></a>                            <span class="n">p</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">probabilities</span><span class="p">[</span><span class="n">ActionPair</span><span class="p">({</span><span class="n">act_x</span><span class="p">,</span> <span class="n">act_y</span><span class="p">})]</span>
</span><span id="AMDN-295"><a href="#AMDN-295"><span class="linenos">295</span></a>                            <span class="c1"># each constraint only needs to hold for one proposition to be true</span>
</span><span id="AMDN-296"><a href="#AMDN-296"><span class="linenos">296</span></a>                            <span class="n">constraint_1</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AMDN-297"><a href="#AMDN-297"><span class="linenos">297</span></a>                            <span class="n">constraint_2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AMDN-298"><a href="#AMDN-298"><span class="linenos">298</span></a>                            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">:</span>
</span><span id="AMDN-299"><a href="#AMDN-299"><span class="linenos">299</span></a>                                <span class="n">constraint_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AMDN-300"><a href="#AMDN-300"><span class="linenos">300</span></a>                                    <span class="n">Or</span><span class="p">(</span>
</span><span id="AMDN-301"><a href="#AMDN-301"><span class="linenos">301</span></a>                                        <span class="p">[</span>
</span><span id="AMDN-302"><a href="#AMDN-302"><span class="linenos">302</span></a>                                            <span class="n">And</span><span class="p">(</span>
</span><span id="AMDN-303"><a href="#AMDN-303"><span class="linenos">303</span></a>                                                <span class="p">[</span>
</span><span id="AMDN-304"><a href="#AMDN-304"><span class="linenos">304</span></a>                                                    <span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span>
</span><span id="AMDN-305"><a href="#AMDN-305"><span class="linenos">305</span></a>                                                    <span class="o">~</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span>
</span><span id="AMDN-306"><a href="#AMDN-306"><span class="linenos">306</span></a>                                                    <span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span>
</span><span id="AMDN-307"><a href="#AMDN-307"><span class="linenos">307</span></a>                                                <span class="p">]</span>
</span><span id="AMDN-308"><a href="#AMDN-308"><span class="linenos">308</span></a>                                            <span class="p">),</span>
</span><span id="AMDN-309"><a href="#AMDN-309"><span class="linenos">309</span></a>                                            <span class="n">And</span><span class="p">([</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span> <span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">)]),</span>
</span><span id="AMDN-310"><a href="#AMDN-310"><span class="linenos">310</span></a>                                            <span class="n">And</span><span class="p">([</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span> <span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">)]),</span>
</span><span id="AMDN-311"><a href="#AMDN-311"><span class="linenos">311</span></a>                                            <span class="n">And</span><span class="p">([</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span> <span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">)]),</span>
</span><span id="AMDN-312"><a href="#AMDN-312"><span class="linenos">312</span></a>                                        <span class="p">]</span>
</span><span id="AMDN-313"><a href="#AMDN-313"><span class="linenos">313</span></a>                                    <span class="p">)</span>
</span><span id="AMDN-314"><a href="#AMDN-314"><span class="linenos">314</span></a>                                <span class="p">)</span>
</span><span id="AMDN-315"><a href="#AMDN-315"><span class="linenos">315</span></a>                                <span class="n">constraint_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AMDN-316"><a href="#AMDN-316"><span class="linenos">316</span></a>                                    <span class="n">Or</span><span class="p">(</span>
</span><span id="AMDN-317"><a href="#AMDN-317"><span class="linenos">317</span></a>                                        <span class="p">[</span>
</span><span id="AMDN-318"><a href="#AMDN-318"><span class="linenos">318</span></a>                                            <span class="n">And</span><span class="p">(</span>
</span><span id="AMDN-319"><a href="#AMDN-319"><span class="linenos">319</span></a>                                                <span class="p">[</span>
</span><span id="AMDN-320"><a href="#AMDN-320"><span class="linenos">320</span></a>                                                    <span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span>
</span><span id="AMDN-321"><a href="#AMDN-321"><span class="linenos">321</span></a>                                                    <span class="o">~</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span>
</span><span id="AMDN-322"><a href="#AMDN-322"><span class="linenos">322</span></a>                                                    <span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span>
</span><span id="AMDN-323"><a href="#AMDN-323"><span class="linenos">323</span></a>                                                <span class="p">]</span>
</span><span id="AMDN-324"><a href="#AMDN-324"><span class="linenos">324</span></a>                                            <span class="p">),</span>
</span><span id="AMDN-325"><a href="#AMDN-325"><span class="linenos">325</span></a>                                            <span class="n">And</span><span class="p">([</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span> <span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">)]),</span>
</span><span id="AMDN-326"><a href="#AMDN-326"><span class="linenos">326</span></a>                                            <span class="n">And</span><span class="p">([</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span> <span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">)]),</span>
</span><span id="AMDN-327"><a href="#AMDN-327"><span class="linenos">327</span></a>                                            <span class="n">And</span><span class="p">([</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span> <span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">)]),</span>
</span><span id="AMDN-328"><a href="#AMDN-328"><span class="linenos">328</span></a>                                        <span class="p">]</span>
</span><span id="AMDN-329"><a href="#AMDN-329"><span class="linenos">329</span></a>                                    <span class="p">)</span>
</span><span id="AMDN-330"><a href="#AMDN-330"><span class="linenos">330</span></a>                                <span class="p">)</span>
</span><span id="AMDN-331"><a href="#AMDN-331"><span class="linenos">331</span></a>                            <span class="n">disjunct_all_constr_1</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="n">constraint_1</span><span class="p">)</span><span class="o">.</span><span class="n">to_CNF</span><span class="p">()</span>
</span><span id="AMDN-332"><a href="#AMDN-332"><span class="linenos">332</span></a>                            <span class="n">disjunct_all_constr_2</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="n">constraint_2</span><span class="p">)</span><span class="o">.</span><span class="n">to_CNF</span><span class="p">()</span>
</span><span id="AMDN-333"><a href="#AMDN-333"><span class="linenos">333</span></a>                            <span class="n">AMDN</span><span class="o">.</span><span class="n">_extract_aux_set_weights</span><span class="p">(</span>
</span><span id="AMDN-334"><a href="#AMDN-334"><span class="linenos">334</span></a>                                <span class="n">disjunct_all_constr_1</span><span class="p">,</span> <span class="n">disorder_constraints</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
</span><span id="AMDN-335"><a href="#AMDN-335"><span class="linenos">335</span></a>                            <span class="p">)</span>
</span><span id="AMDN-336"><a href="#AMDN-336"><span class="linenos">336</span></a>                            <span class="n">AMDN</span><span class="o">.</span><span class="n">_extract_aux_set_weights</span><span class="p">(</span>
</span><span id="AMDN-337"><a href="#AMDN-337"><span class="linenos">337</span></a>                                <span class="n">disjunct_all_constr_2</span><span class="p">,</span> <span class="n">disorder_constraints</span><span class="p">,</span> <span class="n">p</span>
</span><span id="AMDN-338"><a href="#AMDN-338"><span class="linenos">338</span></a>                            <span class="p">)</span>
</span><span id="AMDN-339"><a href="#AMDN-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="n">disorder_constraints</span>
</span><span id="AMDN-340"><a href="#AMDN-340"><span class="linenos">340</span></a>
</span><span id="AMDN-341"><a href="#AMDN-341"><span class="linenos">341</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-342"><a href="#AMDN-342"><span class="linenos">342</span></a>    <span class="k">def</span> <span class="nf">_build_hard_parallel_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="AMDN-343"><a href="#AMDN-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds hard parallel constraints.</span>
</span><span id="AMDN-344"><a href="#AMDN-344"><span class="linenos">344</span></a>
</span><span id="AMDN-345"><a href="#AMDN-345"><span class="linenos">345</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-346"><a href="#AMDN-346"><span class="linenos">346</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-347"><a href="#AMDN-347"><span class="linenos">347</span></a><span class="sd">                The tokens to be analyzed.</span>
</span><span id="AMDN-348"><a href="#AMDN-348"><span class="linenos">348</span></a>
</span><span id="AMDN-349"><a href="#AMDN-349"><span class="linenos">349</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-350"><a href="#AMDN-350"><span class="linenos">350</span></a><span class="sd">            The hard parallel constraints to be used in the algorithm.</span>
</span><span id="AMDN-351"><a href="#AMDN-351"><span class="linenos">351</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-352"><a href="#AMDN-352"><span class="linenos">352</span></a>        <span class="n">hard_constraints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-353"><a href="#AMDN-353"><span class="linenos">353</span></a>        <span class="c1"># create a list of all &lt;a, r&gt; tuples</span>
</span><span id="AMDN-354"><a href="#AMDN-354"><span class="linenos">354</span></a>        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="AMDN-355"><a href="#AMDN-355"><span class="linenos">355</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">:</span>
</span><span id="AMDN-356"><a href="#AMDN-356"><span class="linenos">356</span></a>                <span class="c1"># for each action x proposition pair, enforce the two hard constraints with weight wmax</span>
</span><span id="AMDN-357"><a href="#AMDN-357"><span class="linenos">357</span></a>                <span class="n">hard_constraints</span><span class="p">[</span><span class="n">implies</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act</span><span class="p">),</span> <span class="o">~</span><span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act</span><span class="p">))]</span> <span class="o">=</span> <span class="n">WMAX</span>
</span><span id="AMDN-358"><a href="#AMDN-358"><span class="linenos">358</span></a>                <span class="n">hard_constraints</span><span class="p">[</span><span class="n">implies</span><span class="p">(</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act</span><span class="p">),</span> <span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act</span><span class="p">))]</span> <span class="o">=</span> <span class="n">WMAX</span>
</span><span id="AMDN-359"><a href="#AMDN-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="n">hard_constraints</span>
</span><span id="AMDN-360"><a href="#AMDN-360"><span class="linenos">360</span></a>
</span><span id="AMDN-361"><a href="#AMDN-361"><span class="linenos">361</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-362"><a href="#AMDN-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">_build_soft_parallel_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="AMDN-363"><a href="#AMDN-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds soft parallel constraints.</span>
</span><span id="AMDN-364"><a href="#AMDN-364"><span class="linenos">364</span></a>
</span><span id="AMDN-365"><a href="#AMDN-365"><span class="linenos">365</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-366"><a href="#AMDN-366"><span class="linenos">366</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-367"><a href="#AMDN-367"><span class="linenos">367</span></a><span class="sd">                The tokens to be analyzed.</span>
</span><span id="AMDN-368"><a href="#AMDN-368"><span class="linenos">368</span></a>
</span><span id="AMDN-369"><a href="#AMDN-369"><span class="linenos">369</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-370"><a href="#AMDN-370"><span class="linenos">370</span></a><span class="sd">            The soft parallel constraints to be used in the algorithm.</span>
</span><span id="AMDN-371"><a href="#AMDN-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-372"><a href="#AMDN-372"><span class="linenos">372</span></a>        <span class="n">soft_constraints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-373"><a href="#AMDN-373"><span class="linenos">373</span></a>
</span><span id="AMDN-374"><a href="#AMDN-374"><span class="linenos">374</span></a>        <span class="c1"># NOTE: the paper does not take into account possible conflicts between the preconditions of actions</span>
</span><span id="AMDN-375"><a href="#AMDN-375"><span class="linenos">375</span></a>        <span class="c1"># and the add/delete effects of other actions (similar to the hard constraints, but with other actions</span>
</span><span id="AMDN-376"><a href="#AMDN-376"><span class="linenos">376</span></a>        <span class="c1"># in the parallel action set).</span>
</span><span id="AMDN-377"><a href="#AMDN-377"><span class="linenos">377</span></a>
</span><span id="AMDN-378"><a href="#AMDN-378"><span class="linenos">378</span></a>        <span class="c1"># iterate through all traces</span>
</span><span id="AMDN-379"><a href="#AMDN-379"><span class="linenos">379</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">)):</span>
</span><span id="AMDN-380"><a href="#AMDN-380"><span class="linenos">380</span></a>            <span class="n">par_act_sets</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AMDN-381"><a href="#AMDN-381"><span class="linenos">381</span></a>            <span class="c1"># iterate through all parallel action sets for this trace</span>
</span><span id="AMDN-382"><a href="#AMDN-382"><span class="linenos">382</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par_act_sets</span><span class="p">)):</span>
</span><span id="AMDN-383"><a href="#AMDN-383"><span class="linenos">383</span></a>                <span class="c1"># within each parallel action set, iterate through the same action set again to compare</span>
</span><span id="AMDN-384"><a href="#AMDN-384"><span class="linenos">384</span></a>                <span class="c1"># each action to every other action in the set; setting constraints assuming actions are not disordered</span>
</span><span id="AMDN-385"><a href="#AMDN-385"><span class="linenos">385</span></a>                <span class="k">for</span> <span class="n">act_x</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="AMDN-386"><a href="#AMDN-386"><span class="linenos">386</span></a>                    <span class="k">for</span> <span class="n">act_x_prime</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">act_x</span><span class="p">}:</span>
</span><span id="AMDN-387"><a href="#AMDN-387"><span class="linenos">387</span></a>                        <span class="n">p</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">probabilities</span><span class="p">[</span>
</span><span id="AMDN-388"><a href="#AMDN-388"><span class="linenos">388</span></a>                            <span class="n">ActionPair</span><span class="p">({</span><span class="n">act_x</span><span class="p">,</span> <span class="n">act_x_prime</span><span class="p">})</span>
</span><span id="AMDN-389"><a href="#AMDN-389"><span class="linenos">389</span></a>                        <span class="p">]</span>
</span><span id="AMDN-390"><a href="#AMDN-390"><span class="linenos">390</span></a>                        <span class="c1"># iterate through all propositions</span>
</span><span id="AMDN-391"><a href="#AMDN-391"><span class="linenos">391</span></a>                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">:</span>
</span><span id="AMDN-392"><a href="#AMDN-392"><span class="linenos">392</span></a>                            <span class="n">soft_constraints</span><span class="p">[</span>
</span><span id="AMDN-393"><a href="#AMDN-393"><span class="linenos">393</span></a>                                <span class="n">implies</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x</span><span class="p">),</span> <span class="o">~</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x_prime</span><span class="p">))</span>
</span><span id="AMDN-394"><a href="#AMDN-394"><span class="linenos">394</span></a>                            <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">WMAX</span>
</span><span id="AMDN-395"><a href="#AMDN-395"><span class="linenos">395</span></a>
</span><span id="AMDN-396"><a href="#AMDN-396"><span class="linenos">396</span></a>        <span class="c1"># iterate through all traces</span>
</span><span id="AMDN-397"><a href="#AMDN-397"><span class="linenos">397</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">)):</span>
</span><span id="AMDN-398"><a href="#AMDN-398"><span class="linenos">398</span></a>            <span class="n">par_act_sets</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AMDN-399"><a href="#AMDN-399"><span class="linenos">399</span></a>            <span class="c1"># then, iterate through all pairs of parallel action sets for each trace</span>
</span><span id="AMDN-400"><a href="#AMDN-400"><span class="linenos">400</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par_act_sets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AMDN-401"><a href="#AMDN-401"><span class="linenos">401</span></a>                <span class="c1"># for each pair, compare every action in act_y to every action in act_x_prime; setting constraints assuming actions are disordered</span>
</span><span id="AMDN-402"><a href="#AMDN-402"><span class="linenos">402</span></a>                <span class="k">for</span> <span class="n">act_y</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="AMDN-403"><a href="#AMDN-403"><span class="linenos">403</span></a>                    <span class="k">for</span> <span class="n">act_x_prime</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">act_y</span><span class="p">}:</span>
</span><span id="AMDN-404"><a href="#AMDN-404"><span class="linenos">404</span></a>                        <span class="n">p</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">probabilities</span><span class="p">[</span>
</span><span id="AMDN-405"><a href="#AMDN-405"><span class="linenos">405</span></a>                            <span class="n">ActionPair</span><span class="p">({</span><span class="n">act_y</span><span class="p">,</span> <span class="n">act_x_prime</span><span class="p">})</span>
</span><span id="AMDN-406"><a href="#AMDN-406"><span class="linenos">406</span></a>                        <span class="p">]</span>
</span><span id="AMDN-407"><a href="#AMDN-407"><span class="linenos">407</span></a>                        <span class="c1"># iterate through all propositions and similarly set the constraint</span>
</span><span id="AMDN-408"><a href="#AMDN-408"><span class="linenos">408</span></a>                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">:</span>
</span><span id="AMDN-409"><a href="#AMDN-409"><span class="linenos">409</span></a>                            <span class="n">soft_constraints</span><span class="p">[</span>
</span><span id="AMDN-410"><a href="#AMDN-410"><span class="linenos">410</span></a>                                <span class="n">implies</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_y</span><span class="p">),</span> <span class="o">~</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act_x_prime</span><span class="p">))</span>
</span><span id="AMDN-411"><a href="#AMDN-411"><span class="linenos">411</span></a>                            <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">WMAX</span><span class="p">)</span>
</span><span id="AMDN-412"><a href="#AMDN-412"><span class="linenos">412</span></a>
</span><span id="AMDN-413"><a href="#AMDN-413"><span class="linenos">413</span></a>        <span class="k">return</span> <span class="n">soft_constraints</span>
</span><span id="AMDN-414"><a href="#AMDN-414"><span class="linenos">414</span></a>
</span><span id="AMDN-415"><a href="#AMDN-415"><span class="linenos">415</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-416"><a href="#AMDN-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">_build_parallel_constraints</span><span class="p">(</span>
</span><span id="AMDN-417"><a href="#AMDN-417"><span class="linenos">417</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="AMDN-418"><a href="#AMDN-418"><span class="linenos">418</span></a>    <span class="p">):</span>
</span><span id="AMDN-419"><a href="#AMDN-419"><span class="linenos">419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Main driver for building parallel constraints. Corresponds to step 2 of the AMDN algorithm.</span>
</span><span id="AMDN-420"><a href="#AMDN-420"><span class="linenos">420</span></a>
</span><span id="AMDN-421"><a href="#AMDN-421"><span class="linenos">421</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-422"><a href="#AMDN-422"><span class="linenos">422</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-423"><a href="#AMDN-423"><span class="linenos">423</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-424"><a href="#AMDN-424"><span class="linenos">424</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN-425"><a href="#AMDN-425"><span class="linenos">425</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN-426"><a href="#AMDN-426"><span class="linenos">426</span></a><span class="sd">            to_obs (Optional[List[str]]):</span>
</span><span id="AMDN-427"><a href="#AMDN-427"><span class="linenos">427</span></a><span class="sd">                If in the optional debugging mode, the list of fluents to observe.</span>
</span><span id="AMDN-428"><a href="#AMDN-428"><span class="linenos">428</span></a>
</span><span id="AMDN-429"><a href="#AMDN-429"><span class="linenos">429</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-430"><a href="#AMDN-430"><span class="linenos">430</span></a><span class="sd">            The parallel constraints.</span>
</span><span id="AMDN-431"><a href="#AMDN-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-432"><a href="#AMDN-432"><span class="linenos">432</span></a>        <span class="n">hard_constraints</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_build_hard_parallel_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-433"><a href="#AMDN-433"><span class="linenos">433</span></a>        <span class="n">soft_constraints</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_build_soft_parallel_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-434"><a href="#AMDN-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="AMDN-435"><a href="#AMDN-435"><span class="linenos">435</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Hard parallel constraints:&quot;</span><span class="p">)</span>
</span><span id="AMDN-436"><a href="#AMDN-436"><span class="linenos">436</span></a>            <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_simple_pprint</span><span class="p">(</span><span class="n">hard_constraints</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-437"><a href="#AMDN-437"><span class="linenos">437</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Soft parallel constraints:&quot;</span><span class="p">)</span>
</span><span id="AMDN-438"><a href="#AMDN-438"><span class="linenos">438</span></a>            <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_simple_pprint</span><span class="p">(</span><span class="n">soft_constraints</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-439"><a href="#AMDN-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">hard_constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">soft_constraints</span><span class="p">}</span>
</span><span id="AMDN-440"><a href="#AMDN-440"><span class="linenos">440</span></a>
</span><span id="AMDN-441"><a href="#AMDN-441"><span class="linenos">441</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-442"><a href="#AMDN-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">_calculate_all_r_occ</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="AMDN-443"><a href="#AMDN-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the total number of (true) propositions in the provided traces/tokens.</span>
</span><span id="AMDN-444"><a href="#AMDN-444"><span class="linenos">444</span></a>
</span><span id="AMDN-445"><a href="#AMDN-445"><span class="linenos">445</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-446"><a href="#AMDN-446"><span class="linenos">446</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-447"><a href="#AMDN-447"><span class="linenos">447</span></a><span class="sd">                The tokens to be analyzed.</span>
</span><span id="AMDN-448"><a href="#AMDN-448"><span class="linenos">448</span></a>
</span><span id="AMDN-449"><a href="#AMDN-449"><span class="linenos">449</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-450"><a href="#AMDN-450"><span class="linenos">450</span></a><span class="sd">            The total number of (true) propositions in the provided traces/tokens.</span>
</span><span id="AMDN-451"><a href="#AMDN-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-452"><a href="#AMDN-452"><span class="linenos">452</span></a>        <span class="c1"># tracks occurrences of all propositions</span>
</span><span id="AMDN-453"><a href="#AMDN-453"><span class="linenos">453</span></a>        <span class="n">all_occ</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AMDN-454"><a href="#AMDN-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="p">:</span>
</span><span id="AMDN-455"><a href="#AMDN-455"><span class="linenos">455</span></a>            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">:</span>
</span><span id="AMDN-456"><a href="#AMDN-456"><span class="linenos">456</span></a>                <span class="n">all_occ</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">state</span> <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">f</span><span class="p">]])</span>
</span><span id="AMDN-457"><a href="#AMDN-457"><span class="linenos">457</span></a>        <span class="k">return</span> <span class="n">all_occ</span>
</span><span id="AMDN-458"><a href="#AMDN-458"><span class="linenos">458</span></a>
</span><span id="AMDN-459"><a href="#AMDN-459"><span class="linenos">459</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-460"><a href="#AMDN-460"><span class="linenos">460</span></a>    <span class="k">def</span> <span class="nf">_set_up_occurrences_dict</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="AMDN-461"><a href="#AMDN-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function used when constructing noise constraints.</span>
</span><span id="AMDN-462"><a href="#AMDN-462"><span class="linenos">462</span></a><span class="sd">        Sets up an &quot;occurrence&quot; dictionary used to track the occurrences of propositions</span>
</span><span id="AMDN-463"><a href="#AMDN-463"><span class="linenos">463</span></a><span class="sd">        before or after actions.</span>
</span><span id="AMDN-464"><a href="#AMDN-464"><span class="linenos">464</span></a>
</span><span id="AMDN-465"><a href="#AMDN-465"><span class="linenos">465</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-466"><a href="#AMDN-466"><span class="linenos">466</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-467"><a href="#AMDN-467"><span class="linenos">467</span></a><span class="sd">                The tokens to be analyzed.</span>
</span><span id="AMDN-468"><a href="#AMDN-468"><span class="linenos">468</span></a>
</span><span id="AMDN-469"><a href="#AMDN-469"><span class="linenos">469</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-470"><a href="#AMDN-470"><span class="linenos">470</span></a><span class="sd">            The blank &quot;occurrences&quot; dictionary.</span>
</span><span id="AMDN-471"><a href="#AMDN-471"><span class="linenos">471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-472"><a href="#AMDN-472"><span class="linenos">472</span></a>        <span class="c1"># set up dict</span>
</span><span id="AMDN-473"><a href="#AMDN-473"><span class="linenos">473</span></a>        <span class="n">occurrences</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-474"><a href="#AMDN-474"><span class="linenos">474</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="AMDN-475"><a href="#AMDN-475"><span class="linenos">475</span></a>            <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-476"><a href="#AMDN-476"><span class="linenos">476</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">:</span>
</span><span id="AMDN-477"><a href="#AMDN-477"><span class="linenos">477</span></a>                <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AMDN-478"><a href="#AMDN-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="n">occurrences</span>
</span><span id="AMDN-479"><a href="#AMDN-479"><span class="linenos">479</span></a>
</span><span id="AMDN-480"><a href="#AMDN-480"><span class="linenos">480</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-481"><a href="#AMDN-481"><span class="linenos">481</span></a>    <span class="k">def</span> <span class="nf">_noise_constraints_6</span><span class="p">(</span>
</span><span id="AMDN-482"><a href="#AMDN-482"><span class="linenos">482</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">all_occ</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="AMDN-483"><a href="#AMDN-483"><span class="linenos">483</span></a>    <span class="p">):</span>
</span><span id="AMDN-484"><a href="#AMDN-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Noise constraints (6) in the AMDN paper.</span>
</span><span id="AMDN-485"><a href="#AMDN-485"><span class="linenos">485</span></a>
</span><span id="AMDN-486"><a href="#AMDN-486"><span class="linenos">486</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-487"><a href="#AMDN-487"><span class="linenos">487</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-488"><a href="#AMDN-488"><span class="linenos">488</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-489"><a href="#AMDN-489"><span class="linenos">489</span></a><span class="sd">            all_occ (int):</span>
</span><span id="AMDN-490"><a href="#AMDN-490"><span class="linenos">490</span></a><span class="sd">                The number of occurrences of all (true) propositions in the given observation list.</span>
</span><span id="AMDN-491"><a href="#AMDN-491"><span class="linenos">491</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-492"><a href="#AMDN-492"><span class="linenos">492</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-493"><a href="#AMDN-493"><span class="linenos">493</span></a>
</span><span id="AMDN-494"><a href="#AMDN-494"><span class="linenos">494</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-495"><a href="#AMDN-495"><span class="linenos">495</span></a><span class="sd">            The noise constraints.</span>
</span><span id="AMDN-496"><a href="#AMDN-496"><span class="linenos">496</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-497"><a href="#AMDN-497"><span class="linenos">497</span></a>        <span class="n">noise_constraints_6</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-498"><a href="#AMDN-498"><span class="linenos">498</span></a>        <span class="n">occurrences</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_set_up_occurrences_dict</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-499"><a href="#AMDN-499"><span class="linenos">499</span></a>
</span><span id="AMDN-500"><a href="#AMDN-500"><span class="linenos">500</span></a>        <span class="c1"># iterate over ALL the plan traces, adding occurrences accordingly</span>
</span><span id="AMDN-501"><a href="#AMDN-501"><span class="linenos">501</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)):</span>
</span><span id="AMDN-502"><a href="#AMDN-502"><span class="linenos">502</span></a>            <span class="c1"># iterate through each step in each trace, omitting the last step because the last action is None/we access the state in the next step</span>
</span><span id="AMDN-503"><a href="#AMDN-503"><span class="linenos">503</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AMDN-504"><a href="#AMDN-504"><span class="linenos">504</span></a>                <span class="n">true_prop</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AMDN-505"><a href="#AMDN-505"><span class="linenos">505</span></a>                    <span class="n">f</span>
</span><span id="AMDN-506"><a href="#AMDN-506"><span class="linenos">506</span></a>                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span>
</span><span id="AMDN-507"><a href="#AMDN-507"><span class="linenos">507</span></a>                    <span class="k">if</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
</span><span id="AMDN-508"><a href="#AMDN-508"><span class="linenos">508</span></a>                <span class="p">]</span>
</span><span id="AMDN-509"><a href="#AMDN-509"><span class="linenos">509</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">true_prop</span><span class="p">:</span>
</span><span id="AMDN-510"><a href="#AMDN-510"><span class="linenos">510</span></a>                    <span class="c1"># count the number of occurrences of each action and its following proposition</span>
</span><span id="AMDN-511"><a href="#AMDN-511"><span class="linenos">511</span></a>                    <span class="n">occurrences</span><span class="p">[</span><span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AMDN-512"><a href="#AMDN-512"><span class="linenos">512</span></a>
</span><span id="AMDN-513"><a href="#AMDN-513"><span class="linenos">513</span></a>        <span class="c1"># iterate through actions</span>
</span><span id="AMDN-514"><a href="#AMDN-514"><span class="linenos">514</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">occurrences</span><span class="p">:</span>
</span><span id="AMDN-515"><a href="#AMDN-515"><span class="linenos">515</span></a>            <span class="c1"># iterate through all propositions for this action</span>
</span><span id="AMDN-516"><a href="#AMDN-516"><span class="linenos">516</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span>
</span><span id="AMDN-517"><a href="#AMDN-517"><span class="linenos">517</span></a>                <span class="n">occ_r</span> <span class="o">=</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">r</span><span class="p">]</span>
</span><span id="AMDN-518"><a href="#AMDN-518"><span class="linenos">518</span></a>                <span class="c1"># if the # of occurrences is higher than the user-provided threshold:</span>
</span><span id="AMDN-519"><a href="#AMDN-519"><span class="linenos">519</span></a>                <span class="k">if</span> <span class="n">occ_r</span> <span class="o">&gt;</span> <span class="n">occ_threshold</span><span class="p">:</span>
</span><span id="AMDN-520"><a href="#AMDN-520"><span class="linenos">520</span></a>                    <span class="c1"># set constraint 6 with the calculated weight</span>
</span><span id="AMDN-521"><a href="#AMDN-521"><span class="linenos">521</span></a>                    <span class="n">noise_constraints_6</span><span class="p">[</span><span class="n">AMDN</span><span class="o">.</span><span class="n">_or_refactor</span><span class="p">(</span><span class="o">~</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="p">))]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AMDN-522"><a href="#AMDN-522"><span class="linenos">522</span></a>                        <span class="n">occ_r</span> <span class="o">/</span> <span class="n">all_occ</span>
</span><span id="AMDN-523"><a href="#AMDN-523"><span class="linenos">523</span></a>                    <span class="p">)</span> <span class="o">*</span> <span class="n">WMAX</span>
</span><span id="AMDN-524"><a href="#AMDN-524"><span class="linenos">524</span></a>        <span class="k">return</span> <span class="n">noise_constraints_6</span>
</span><span id="AMDN-525"><a href="#AMDN-525"><span class="linenos">525</span></a>
</span><span id="AMDN-526"><a href="#AMDN-526"><span class="linenos">526</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-527"><a href="#AMDN-527"><span class="linenos">527</span></a>    <span class="k">def</span> <span class="nf">_noise_constraints_7</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">all_occ</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AMDN-528"><a href="#AMDN-528"><span class="linenos">528</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Noise constraints (7) in the AMDN paper.</span>
</span><span id="AMDN-529"><a href="#AMDN-529"><span class="linenos">529</span></a>
</span><span id="AMDN-530"><a href="#AMDN-530"><span class="linenos">530</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-531"><a href="#AMDN-531"><span class="linenos">531</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-532"><a href="#AMDN-532"><span class="linenos">532</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-533"><a href="#AMDN-533"><span class="linenos">533</span></a><span class="sd">            all_occ (int):</span>
</span><span id="AMDN-534"><a href="#AMDN-534"><span class="linenos">534</span></a><span class="sd">                The number of occurrences of all (true) propositions in the given observation list.</span>
</span><span id="AMDN-535"><a href="#AMDN-535"><span class="linenos">535</span></a>
</span><span id="AMDN-536"><a href="#AMDN-536"><span class="linenos">536</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-537"><a href="#AMDN-537"><span class="linenos">537</span></a><span class="sd">            The noise constraints.</span>
</span><span id="AMDN-538"><a href="#AMDN-538"><span class="linenos">538</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-539"><a href="#AMDN-539"><span class="linenos">539</span></a>        <span class="n">noise_constraints_7</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-540"><a href="#AMDN-540"><span class="linenos">540</span></a>        <span class="c1"># set up dict</span>
</span><span id="AMDN-541"><a href="#AMDN-541"><span class="linenos">541</span></a>        <span class="n">occurrences</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-542"><a href="#AMDN-542"><span class="linenos">542</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span><span class="p">:</span>
</span><span id="AMDN-543"><a href="#AMDN-543"><span class="linenos">543</span></a>            <span class="n">occurrences</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AMDN-544"><a href="#AMDN-544"><span class="linenos">544</span></a>
</span><span id="AMDN-545"><a href="#AMDN-545"><span class="linenos">545</span></a>        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_states</span><span class="p">:</span>
</span><span id="AMDN-546"><a href="#AMDN-546"><span class="linenos">546</span></a>            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">:</span>
</span><span id="AMDN-547"><a href="#AMDN-547"><span class="linenos">547</span></a>                <span class="n">true_prop</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">state</span> <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span>
</span><span id="AMDN-548"><a href="#AMDN-548"><span class="linenos">548</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">true_prop</span><span class="p">:</span>
</span><span id="AMDN-549"><a href="#AMDN-549"><span class="linenos">549</span></a>                    <span class="n">occurrences</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AMDN-550"><a href="#AMDN-550"><span class="linenos">550</span></a>
</span><span id="AMDN-551"><a href="#AMDN-551"><span class="linenos">551</span></a>        <span class="c1"># iterate through all traces</span>
</span><span id="AMDN-552"><a href="#AMDN-552"><span class="linenos">552</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">)):</span>
</span><span id="AMDN-553"><a href="#AMDN-553"><span class="linenos">553</span></a>            <span class="c1"># get the next trace/states</span>
</span><span id="AMDN-554"><a href="#AMDN-554"><span class="linenos">554</span></a>            <span class="n">par_act_sets</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_par_act_sets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AMDN-555"><a href="#AMDN-555"><span class="linenos">555</span></a>            <span class="n">states</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">all_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AMDN-556"><a href="#AMDN-556"><span class="linenos">556</span></a>            <span class="c1"># iterate through all parallel action sets within the trace</span>
</span><span id="AMDN-557"><a href="#AMDN-557"><span class="linenos">557</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">par_act_sets</span><span class="p">)):</span>
</span><span id="AMDN-558"><a href="#AMDN-558"><span class="linenos">558</span></a>                <span class="c1"># examine the states before and after each parallel action set; set constraints accordinglly</span>
</span><span id="AMDN-559"><a href="#AMDN-559"><span class="linenos">559</span></a>                <span class="n">true_prop</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">states</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">states</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">r</span><span class="p">]]</span>
</span><span id="AMDN-560"><a href="#AMDN-560"><span class="linenos">560</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">true_prop</span><span class="p">:</span>
</span><span id="AMDN-561"><a href="#AMDN-561"><span class="linenos">561</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">states</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">r</span><span class="p">]:</span>
</span><span id="AMDN-562"><a href="#AMDN-562"><span class="linenos">562</span></a>                        <span class="n">noise_constraints_7</span><span class="p">[</span>
</span><span id="AMDN-563"><a href="#AMDN-563"><span class="linenos">563</span></a>                            <span class="n">Or</span><span class="p">([</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">act</span><span class="p">)</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">par_act_sets</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
</span><span id="AMDN-564"><a href="#AMDN-564"><span class="linenos">564</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">occurrences</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">all_occ</span><span class="p">)</span> <span class="o">*</span> <span class="n">WMAX</span>
</span><span id="AMDN-565"><a href="#AMDN-565"><span class="linenos">565</span></a>        <span class="k">return</span> <span class="n">noise_constraints_7</span>
</span><span id="AMDN-566"><a href="#AMDN-566"><span class="linenos">566</span></a>
</span><span id="AMDN-567"><a href="#AMDN-567"><span class="linenos">567</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-568"><a href="#AMDN-568"><span class="linenos">568</span></a>    <span class="k">def</span> <span class="nf">_noise_constraints_8</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">all_occ</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AMDN-569"><a href="#AMDN-569"><span class="linenos">569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Noise constraints (8) in the AMDN paper.</span>
</span><span id="AMDN-570"><a href="#AMDN-570"><span class="linenos">570</span></a>
</span><span id="AMDN-571"><a href="#AMDN-571"><span class="linenos">571</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-572"><a href="#AMDN-572"><span class="linenos">572</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-573"><a href="#AMDN-573"><span class="linenos">573</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-574"><a href="#AMDN-574"><span class="linenos">574</span></a><span class="sd">            all_occ (int):</span>
</span><span id="AMDN-575"><a href="#AMDN-575"><span class="linenos">575</span></a><span class="sd">                The number of occurrences of all (true) propositions in the given observation list.</span>
</span><span id="AMDN-576"><a href="#AMDN-576"><span class="linenos">576</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-577"><a href="#AMDN-577"><span class="linenos">577</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-578"><a href="#AMDN-578"><span class="linenos">578</span></a>
</span><span id="AMDN-579"><a href="#AMDN-579"><span class="linenos">579</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-580"><a href="#AMDN-580"><span class="linenos">580</span></a><span class="sd">            The noise constraints.</span>
</span><span id="AMDN-581"><a href="#AMDN-581"><span class="linenos">581</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-582"><a href="#AMDN-582"><span class="linenos">582</span></a>        <span class="n">noise_constraints_8</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-583"><a href="#AMDN-583"><span class="linenos">583</span></a>        <span class="n">occurrences</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_set_up_occurrences_dict</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-584"><a href="#AMDN-584"><span class="linenos">584</span></a>
</span><span id="AMDN-585"><a href="#AMDN-585"><span class="linenos">585</span></a>        <span class="c1"># iterate over ALL the plan traces, adding occurrences accordingly</span>
</span><span id="AMDN-586"><a href="#AMDN-586"><span class="linenos">586</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)):</span>
</span><span id="AMDN-587"><a href="#AMDN-587"><span class="linenos">587</span></a>            <span class="c1"># iterate through each step in each trace</span>
</span><span id="AMDN-588"><a href="#AMDN-588"><span class="linenos">588</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="AMDN-589"><a href="#AMDN-589"><span class="linenos">589</span></a>                <span class="c1"># if the action is not None</span>
</span><span id="AMDN-590"><a href="#AMDN-590"><span class="linenos">590</span></a>                <span class="k">if</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
</span><span id="AMDN-591"><a href="#AMDN-591"><span class="linenos">591</span></a>                    <span class="n">true_prop</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AMDN-592"><a href="#AMDN-592"><span class="linenos">592</span></a>                        <span class="n">f</span>
</span><span id="AMDN-593"><a href="#AMDN-593"><span class="linenos">593</span></a>                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">state</span>
</span><span id="AMDN-594"><a href="#AMDN-594"><span class="linenos">594</span></a>                        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
</span><span id="AMDN-595"><a href="#AMDN-595"><span class="linenos">595</span></a>                    <span class="p">]</span>
</span><span id="AMDN-596"><a href="#AMDN-596"><span class="linenos">596</span></a>                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">true_prop</span><span class="p">:</span>
</span><span id="AMDN-597"><a href="#AMDN-597"><span class="linenos">597</span></a>                        <span class="c1"># count the number of occurrences of each action and its previous proposition</span>
</span><span id="AMDN-598"><a href="#AMDN-598"><span class="linenos">598</span></a>                        <span class="n">occurrences</span><span class="p">[</span><span class="n">obs_tracelist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AMDN-599"><a href="#AMDN-599"><span class="linenos">599</span></a>
</span><span id="AMDN-600"><a href="#AMDN-600"><span class="linenos">600</span></a>        <span class="c1"># iterate through actions</span>
</span><span id="AMDN-601"><a href="#AMDN-601"><span class="linenos">601</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">occurrences</span><span class="p">:</span>
</span><span id="AMDN-602"><a href="#AMDN-602"><span class="linenos">602</span></a>            <span class="c1"># iterate through all propositions for this action</span>
</span><span id="AMDN-603"><a href="#AMDN-603"><span class="linenos">603</span></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span>
</span><span id="AMDN-604"><a href="#AMDN-604"><span class="linenos">604</span></a>                <span class="n">occ_r</span> <span class="o">=</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">r</span><span class="p">]</span>
</span><span id="AMDN-605"><a href="#AMDN-605"><span class="linenos">605</span></a>                <span class="c1"># if the # of occurrences is higher than the user-provided threshold:</span>
</span><span id="AMDN-606"><a href="#AMDN-606"><span class="linenos">606</span></a>                <span class="k">if</span> <span class="n">occ_r</span> <span class="o">&gt;</span> <span class="n">occ_threshold</span><span class="p">:</span>
</span><span id="AMDN-607"><a href="#AMDN-607"><span class="linenos">607</span></a>                    <span class="c1"># set constraint 8 with the calculated weight</span>
</span><span id="AMDN-608"><a href="#AMDN-608"><span class="linenos">608</span></a>                    <span class="n">noise_constraints_8</span><span class="p">[</span><span class="n">AMDN</span><span class="o">.</span><span class="n">_or_refactor</span><span class="p">(</span><span class="n">pre</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="p">))]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AMDN-609"><a href="#AMDN-609"><span class="linenos">609</span></a>                        <span class="n">occ_r</span> <span class="o">/</span> <span class="n">all_occ</span>
</span><span id="AMDN-610"><a href="#AMDN-610"><span class="linenos">610</span></a>                    <span class="p">)</span> <span class="o">*</span> <span class="n">WMAX</span>
</span><span id="AMDN-611"><a href="#AMDN-611"><span class="linenos">611</span></a>        <span class="k">return</span> <span class="n">noise_constraints_8</span>
</span><span id="AMDN-612"><a href="#AMDN-612"><span class="linenos">612</span></a>
</span><span id="AMDN-613"><a href="#AMDN-613"><span class="linenos">613</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-614"><a href="#AMDN-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">_build_noise_constraints</span><span class="p">(</span>
</span><span id="AMDN-615"><a href="#AMDN-615"><span class="linenos">615</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="AMDN-616"><a href="#AMDN-616"><span class="linenos">616</span></a>        <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="AMDN-617"><a href="#AMDN-617"><span class="linenos">617</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AMDN-618"><a href="#AMDN-618"><span class="linenos">618</span></a>        <span class="n">to_obs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="AMDN-619"><a href="#AMDN-619"><span class="linenos">619</span></a>    <span class="p">):</span>
</span><span id="AMDN-620"><a href="#AMDN-620"><span class="linenos">620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Driver for building all noise constraints. Corresponds to step 3 of the AMDN algorithm.</span>
</span><span id="AMDN-621"><a href="#AMDN-621"><span class="linenos">621</span></a>
</span><span id="AMDN-622"><a href="#AMDN-622"><span class="linenos">622</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-623"><a href="#AMDN-623"><span class="linenos">623</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-624"><a href="#AMDN-624"><span class="linenos">624</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-625"><a href="#AMDN-625"><span class="linenos">625</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-626"><a href="#AMDN-626"><span class="linenos">626</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-627"><a href="#AMDN-627"><span class="linenos">627</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN-628"><a href="#AMDN-628"><span class="linenos">628</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN-629"><a href="#AMDN-629"><span class="linenos">629</span></a><span class="sd">            to_obs (Optional[List[str]]):</span>
</span><span id="AMDN-630"><a href="#AMDN-630"><span class="linenos">630</span></a><span class="sd">                If in the optional debugging mode, the list of fluents to observe.</span>
</span><span id="AMDN-631"><a href="#AMDN-631"><span class="linenos">631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-632"><a href="#AMDN-632"><span class="linenos">632</span></a>        <span class="c1"># calculate all occurrences for use in weights</span>
</span><span id="AMDN-633"><a href="#AMDN-633"><span class="linenos">633</span></a>        <span class="n">all_occ</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_calculate_all_r_occ</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-634"><a href="#AMDN-634"><span class="linenos">634</span></a>        <span class="n">nc_6</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_noise_constraints_6</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">all_occ</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">)</span>
</span><span id="AMDN-635"><a href="#AMDN-635"><span class="linenos">635</span></a>        <span class="n">nc_7</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_noise_constraints_7</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">all_occ</span><span class="p">)</span>
</span><span id="AMDN-636"><a href="#AMDN-636"><span class="linenos">636</span></a>        <span class="n">nc_8</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_noise_constraints_8</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">all_occ</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">)</span>
</span><span id="AMDN-637"><a href="#AMDN-637"><span class="linenos">637</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="AMDN-638"><a href="#AMDN-638"><span class="linenos">638</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Noise constraints 6:&quot;</span><span class="p">)</span>
</span><span id="AMDN-639"><a href="#AMDN-639"><span class="linenos">639</span></a>            <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_simple_pprint</span><span class="p">(</span><span class="n">nc_6</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-640"><a href="#AMDN-640"><span class="linenos">640</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Noise constraints 7:&quot;</span><span class="p">)</span>
</span><span id="AMDN-641"><a href="#AMDN-641"><span class="linenos">641</span></a>            <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_simple_pprint</span><span class="p">(</span><span class="n">nc_7</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-642"><a href="#AMDN-642"><span class="linenos">642</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Noise constraints 8:&quot;</span><span class="p">)</span>
</span><span id="AMDN-643"><a href="#AMDN-643"><span class="linenos">643</span></a>            <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_simple_pprint</span><span class="p">(</span><span class="n">nc_8</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-644"><a href="#AMDN-644"><span class="linenos">644</span></a>        <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">nc_6</span><span class="p">,</span> <span class="o">**</span><span class="n">nc_7</span><span class="p">,</span> <span class="o">**</span><span class="n">nc_8</span><span class="p">}</span>
</span><span id="AMDN-645"><a href="#AMDN-645"><span class="linenos">645</span></a>
</span><span id="AMDN-646"><a href="#AMDN-646"><span class="linenos">646</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-647"><a href="#AMDN-647"><span class="linenos">647</span></a>    <span class="k">def</span> <span class="nf">_set_all_constraints</span><span class="p">(</span>
</span><span id="AMDN-648"><a href="#AMDN-648"><span class="linenos">648</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="AMDN-649"><a href="#AMDN-649"><span class="linenos">649</span></a>    <span class="p">):</span>
</span><span id="AMDN-650"><a href="#AMDN-650"><span class="linenos">650</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Main driver for generating all constraints in the AMDN algorithm.</span>
</span><span id="AMDN-651"><a href="#AMDN-651"><span class="linenos">651</span></a>
</span><span id="AMDN-652"><a href="#AMDN-652"><span class="linenos">652</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-653"><a href="#AMDN-653"><span class="linenos">653</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-654"><a href="#AMDN-654"><span class="linenos">654</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-655"><a href="#AMDN-655"><span class="linenos">655</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-656"><a href="#AMDN-656"><span class="linenos">656</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-657"><a href="#AMDN-657"><span class="linenos">657</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN-658"><a href="#AMDN-658"><span class="linenos">658</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN-659"><a href="#AMDN-659"><span class="linenos">659</span></a>
</span><span id="AMDN-660"><a href="#AMDN-660"><span class="linenos">660</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-661"><a href="#AMDN-661"><span class="linenos">661</span></a><span class="sd">            A dictionary that constains all of the constraints set and all of their weights.</span>
</span><span id="AMDN-662"><a href="#AMDN-662"><span class="linenos">662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-663"><a href="#AMDN-663"><span class="linenos">663</span></a>        <span class="n">to_obs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AMDN-664"><a href="#AMDN-664"><span class="linenos">664</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="AMDN-665"><a href="#AMDN-665"><span class="linenos">665</span></a>            <span class="n">to_obs</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_get_observe</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-666"><a href="#AMDN-666"><span class="linenos">666</span></a>        <span class="n">disorder_constraints</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_build_disorder_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="AMDN-667"><a href="#AMDN-667"><span class="linenos">667</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="AMDN-668"><a href="#AMDN-668"><span class="linenos">668</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Disorder constraints:&quot;</span><span class="p">)</span>
</span><span id="AMDN-669"><a href="#AMDN-669"><span class="linenos">669</span></a>            <span class="n">AMDN</span><span class="o">.</span><span class="n">_debug_aux_pprint</span><span class="p">(</span><span class="n">disorder_constraints</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">)</span>
</span><span id="AMDN-670"><a href="#AMDN-670"><span class="linenos">670</span></a>        <span class="n">parallel_constraints</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_build_parallel_constraints</span><span class="p">(</span>
</span><span id="AMDN-671"><a href="#AMDN-671"><span class="linenos">671</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">to_obs</span>
</span><span id="AMDN-672"><a href="#AMDN-672"><span class="linenos">672</span></a>        <span class="p">)</span>
</span><span id="AMDN-673"><a href="#AMDN-673"><span class="linenos">673</span></a>        <span class="n">noise_constraints</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_build_noise_constraints</span><span class="p">(</span>
</span><span id="AMDN-674"><a href="#AMDN-674"><span class="linenos">674</span></a>            <span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">to_obs</span>
</span><span id="AMDN-675"><a href="#AMDN-675"><span class="linenos">675</span></a>        <span class="p">)</span>
</span><span id="AMDN-676"><a href="#AMDN-676"><span class="linenos">676</span></a>        <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">disorder_constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">parallel_constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">noise_constraints</span><span class="p">}</span>
</span><span id="AMDN-677"><a href="#AMDN-677"><span class="linenos">677</span></a>
</span><span id="AMDN-678"><a href="#AMDN-678"><span class="linenos">678</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-679"><a href="#AMDN-679"><span class="linenos">679</span></a>    <span class="k">def</span> <span class="nf">_solve_constraints</span><span class="p">(</span>
</span><span id="AMDN-680"><a href="#AMDN-680"><span class="linenos">680</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="AMDN-681"><a href="#AMDN-681"><span class="linenos">681</span></a>    <span class="p">):</span>
</span><span id="AMDN-682"><a href="#AMDN-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the WCNF and the decoder according to the constraints generated.</span>
</span><span id="AMDN-683"><a href="#AMDN-683"><span class="linenos">683</span></a><span class="sd">        Corresponds to step 4 of the AMDN algorithm.</span>
</span><span id="AMDN-684"><a href="#AMDN-684"><span class="linenos">684</span></a>
</span><span id="AMDN-685"><a href="#AMDN-685"><span class="linenos">685</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-686"><a href="#AMDN-686"><span class="linenos">686</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-687"><a href="#AMDN-687"><span class="linenos">687</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-688"><a href="#AMDN-688"><span class="linenos">688</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN-689"><a href="#AMDN-689"><span class="linenos">689</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN-690"><a href="#AMDN-690"><span class="linenos">690</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN-691"><a href="#AMDN-691"><span class="linenos">691</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN-692"><a href="#AMDN-692"><span class="linenos">692</span></a>
</span><span id="AMDN-693"><a href="#AMDN-693"><span class="linenos">693</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-694"><a href="#AMDN-694"><span class="linenos">694</span></a><span class="sd">            The WCNF and corresponding decode dictionary.</span>
</span><span id="AMDN-695"><a href="#AMDN-695"><span class="linenos">695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-696"><a href="#AMDN-696"><span class="linenos">696</span></a>        <span class="n">constraints</span> <span class="o">=</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_set_all_constraints</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="AMDN-697"><a href="#AMDN-697"><span class="linenos">697</span></a>        <span class="c1"># extract hard constraints</span>
</span><span id="AMDN-698"><a href="#AMDN-698"><span class="linenos">698</span></a>        <span class="n">hard_constraints</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AMDN-699"><a href="#AMDN-699"><span class="linenos">699</span></a>        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">constraints</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AMDN-700"><a href="#AMDN-700"><span class="linenos">700</span></a>            <span class="k">if</span> <span class="n">weight</span> <span class="o">==</span> <span class="s2">&quot;HARD&quot;</span><span class="p">:</span>
</span><span id="AMDN-701"><a href="#AMDN-701"><span class="linenos">701</span></a>                <span class="n">hard_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="AMDN-702"><a href="#AMDN-702"><span class="linenos">702</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hard_constraints</span><span class="p">:</span>
</span><span id="AMDN-703"><a href="#AMDN-703"><span class="linenos">703</span></a>            <span class="k">del</span> <span class="n">constraints</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
</span><span id="AMDN-704"><a href="#AMDN-704"><span class="linenos">704</span></a>
</span><span id="AMDN-705"><a href="#AMDN-705"><span class="linenos">705</span></a>        <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">to_wcnf</span><span class="p">(</span>
</span><span id="AMDN-706"><a href="#AMDN-706"><span class="linenos">706</span></a>            <span class="n">soft_clauses</span><span class="o">=</span><span class="n">And</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
</span><span id="AMDN-707"><a href="#AMDN-707"><span class="linenos">707</span></a>            <span class="n">hard_clauses</span><span class="o">=</span><span class="n">And</span><span class="p">(</span><span class="n">hard_constraints</span><span class="p">),</span>
</span><span id="AMDN-708"><a href="#AMDN-708"><span class="linenos">708</span></a>            <span class="n">weights</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
</span><span id="AMDN-709"><a href="#AMDN-709"><span class="linenos">709</span></a>        <span class="p">)</span>
</span><span id="AMDN-710"><a href="#AMDN-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">wcnf</span><span class="p">,</span> <span class="n">decode</span>
</span><span id="AMDN-711"><a href="#AMDN-711"><span class="linenos">711</span></a>
</span><span id="AMDN-712"><a href="#AMDN-712"><span class="linenos">712</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-713"><a href="#AMDN-713"><span class="linenos">713</span></a>    <span class="k">def</span> <span class="nf">_split_raw_fluent</span><span class="p">(</span><span class="n">raw_f</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">learned_actions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LearnedAction</span><span class="p">]):</span>
</span><span id="AMDN-714"><a href="#AMDN-714"><span class="linenos">714</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function for `_extract_model` that updates takes raw fluents to update</span>
</span><span id="AMDN-715"><a href="#AMDN-715"><span class="linenos">715</span></a><span class="sd">        a dictionary of `LearnedActions`.</span>
</span><span id="AMDN-716"><a href="#AMDN-716"><span class="linenos">716</span></a>
</span><span id="AMDN-717"><a href="#AMDN-717"><span class="linenos">717</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-718"><a href="#AMDN-718"><span class="linenos">718</span></a><span class="sd">            raw_f (Hashable):</span>
</span><span id="AMDN-719"><a href="#AMDN-719"><span class="linenos">719</span></a><span class="sd">                The raw fluent to parse.</span>
</span><span id="AMDN-720"><a href="#AMDN-720"><span class="linenos">720</span></a><span class="sd">            learned_actions (Dict[str, LearnedAction]):</span>
</span><span id="AMDN-721"><a href="#AMDN-721"><span class="linenos">721</span></a><span class="sd">                The dictionary of learned actions that will be used to create the model.</span>
</span><span id="AMDN-722"><a href="#AMDN-722"><span class="linenos">722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-723"><a href="#AMDN-723"><span class="linenos">723</span></a>        <span class="n">raw_f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">raw_f</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="AMDN-724"><a href="#AMDN-724"><span class="linenos">724</span></a>        <span class="n">pre_str</span> <span class="o">=</span> <span class="s2">&quot; is a precondition of &quot;</span>
</span><span id="AMDN-725"><a href="#AMDN-725"><span class="linenos">725</span></a>        <span class="n">add_str</span> <span class="o">=</span> <span class="s2">&quot; is added by &quot;</span>
</span><span id="AMDN-726"><a href="#AMDN-726"><span class="linenos">726</span></a>        <span class="n">del_str</span> <span class="o">=</span> <span class="s2">&quot; is deleted by &quot;</span>
</span><span id="AMDN-727"><a href="#AMDN-727"><span class="linenos">727</span></a>        <span class="k">if</span> <span class="n">pre_str</span> <span class="ow">in</span> <span class="n">raw_f</span><span class="p">:</span>
</span><span id="AMDN-728"><a href="#AMDN-728"><span class="linenos">728</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">act</span> <span class="o">=</span> <span class="n">raw_f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pre_str</span><span class="p">)</span>
</span><span id="AMDN-729"><a href="#AMDN-729"><span class="linenos">729</span></a>            <span class="n">learned_actions</span><span class="p">[</span><span class="n">act</span><span class="p">]</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">f</span><span class="p">})</span>
</span><span id="AMDN-730"><a href="#AMDN-730"><span class="linenos">730</span></a>        <span class="k">elif</span> <span class="n">add_str</span> <span class="ow">in</span> <span class="n">raw_f</span><span class="p">:</span>
</span><span id="AMDN-731"><a href="#AMDN-731"><span class="linenos">731</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">act</span> <span class="o">=</span> <span class="n">raw_f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">add_str</span><span class="p">)</span>
</span><span id="AMDN-732"><a href="#AMDN-732"><span class="linenos">732</span></a>            <span class="n">learned_actions</span><span class="p">[</span><span class="n">act</span><span class="p">]</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">f</span><span class="p">})</span>
</span><span id="AMDN-733"><a href="#AMDN-733"><span class="linenos">733</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AMDN-734"><a href="#AMDN-734"><span class="linenos">734</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">act</span> <span class="o">=</span> <span class="n">raw_f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">del_str</span><span class="p">)</span>
</span><span id="AMDN-735"><a href="#AMDN-735"><span class="linenos">735</span></a>            <span class="n">learned_actions</span><span class="p">[</span><span class="n">act</span><span class="p">]</span><span class="o">.</span><span class="n">update_delete</span><span class="p">({</span><span class="n">f</span><span class="p">})</span>
</span><span id="AMDN-736"><a href="#AMDN-736"><span class="linenos">736</span></a>
</span><span id="AMDN-737"><a href="#AMDN-737"><span class="linenos">737</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AMDN-738"><a href="#AMDN-738"><span class="linenos">738</span></a>    <span class="k">def</span> <span class="nf">_extract_model</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]):</span>
</span><span id="AMDN-739"><a href="#AMDN-739"><span class="linenos">739</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a raw model generated from the pysat module into a macq `Model`.</span>
</span><span id="AMDN-740"><a href="#AMDN-740"><span class="linenos">740</span></a><span class="sd">        Corresponds to step 5 of the AMDN algorithm.</span>
</span><span id="AMDN-741"><a href="#AMDN-741"><span class="linenos">741</span></a>
</span><span id="AMDN-742"><a href="#AMDN-742"><span class="linenos">742</span></a><span class="sd">        Args:</span>
</span><span id="AMDN-743"><a href="#AMDN-743"><span class="linenos">743</span></a><span class="sd">            obs_tracelist (ObservationLists):</span>
</span><span id="AMDN-744"><a href="#AMDN-744"><span class="linenos">744</span></a><span class="sd">                The tokens that were analyzed.</span>
</span><span id="AMDN-745"><a href="#AMDN-745"><span class="linenos">745</span></a><span class="sd">            model (Dict[Hashable, bool]):</span>
</span><span id="AMDN-746"><a href="#AMDN-746"><span class="linenos">746</span></a><span class="sd">                The raw model to parse and analyze.</span>
</span><span id="AMDN-747"><a href="#AMDN-747"><span class="linenos">747</span></a>
</span><span id="AMDN-748"><a href="#AMDN-748"><span class="linenos">748</span></a><span class="sd">        Returns:</span>
</span><span id="AMDN-749"><a href="#AMDN-749"><span class="linenos">749</span></a><span class="sd">            The macq action `Model`.</span>
</span><span id="AMDN-750"><a href="#AMDN-750"><span class="linenos">750</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN-751"><a href="#AMDN-751"><span class="linenos">751</span></a>        <span class="c1"># convert the result to a Model</span>
</span><span id="AMDN-752"><a href="#AMDN-752"><span class="linenos">752</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">propositions</span>
</span><span id="AMDN-753"><a href="#AMDN-753"><span class="linenos">753</span></a>        <span class="c1"># set up LearnedActions</span>
</span><span id="AMDN-754"><a href="#AMDN-754"><span class="linenos">754</span></a>        <span class="n">learned_actions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AMDN-755"><a href="#AMDN-755"><span class="linenos">755</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="AMDN-756"><a href="#AMDN-756"><span class="linenos">756</span></a>            <span class="c1"># set up a base LearnedAction with the known information</span>
</span><span id="AMDN-757"><a href="#AMDN-757"><span class="linenos">757</span></a>            <span class="n">learned_actions</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">details</span><span class="p">()]</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">LearnedAction</span><span class="p">(</span>
</span><span id="AMDN-758"><a href="#AMDN-758"><span class="linenos">758</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">obj_params</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">cost</span>
</span><span id="AMDN-759"><a href="#AMDN-759"><span class="linenos">759</span></a>            <span class="p">)</span>
</span><span id="AMDN-760"><a href="#AMDN-760"><span class="linenos">760</span></a>        <span class="c1"># iterate through all fluents</span>
</span><span id="AMDN-761"><a href="#AMDN-761"><span class="linenos">761</span></a>        <span class="k">for</span> <span class="n">raw_f</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
</span><span id="AMDN-762"><a href="#AMDN-762"><span class="linenos">762</span></a>            <span class="c1"># update learned_actions (ignore auxiliary variables)</span>
</span><span id="AMDN-763"><a href="#AMDN-763"><span class="linenos">763</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_f</span><span class="p">,</span> <span class="n">Aux</span><span class="p">)</span> <span class="ow">and</span> <span class="n">model</span><span class="p">[</span><span class="n">raw_f</span><span class="p">]:</span>
</span><span id="AMDN-764"><a href="#AMDN-764"><span class="linenos">764</span></a>                <span class="n">AMDN</span><span class="o">.</span><span class="n">_split_raw_fluent</span><span class="p">(</span><span class="n">raw_f</span><span class="p">,</span> <span class="n">learned_actions</span><span class="p">)</span>
</span><span id="AMDN-765"><a href="#AMDN-765"><span class="linenos">765</span></a>        <span class="c1"># format</span>
</span><span id="AMDN-766"><a href="#AMDN-766"><span class="linenos">766</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">learned_actions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="AMDN-767"><a href="#AMDN-767"><span class="linenos">767</span></a>        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
</span><span id="AMDN-768"><a href="#AMDN-768"><span class="linenos">768</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">precond</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">precond</span><span class="p">}</span>
</span><span id="AMDN-769"><a href="#AMDN-769"><span class="linenos">769</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">add</span><span class="p">}</span>
</span><span id="AMDN-770"><a href="#AMDN-770"><span class="linenos">770</span></a>            <span class="n">act</span><span class="o">.</span><span class="n">delete</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">delete</span><span class="p">}</span>
</span><span id="AMDN-771"><a href="#AMDN-771"><span class="linenos">771</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="AMDN.__init__" class="classattr">
                                        <input id="AMDN.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AMDN</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="AMDN.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AMDN.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AMDN.__init__-69"><a href="#AMDN.__init__-69"><span class="linenos">69</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="AMDN.__init__-70"><a href="#AMDN.__init__-70"><span class="linenos">70</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AMDN.__init__-71"><a href="#AMDN.__init__-71"><span class="linenos">71</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="AMDN.__init__-72"><a href="#AMDN.__init__-72"><span class="linenos">72</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AMDN.__init__-73"><a href="#AMDN.__init__-73"><span class="linenos">73</span></a>        <span class="n">occ_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="AMDN.__init__-74"><a href="#AMDN.__init__-74"><span class="linenos">74</span></a>    <span class="p">):</span>
</span><span id="AMDN.__init__-75"><a href="#AMDN.__init__-75"><span class="linenos">75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="AMDN.__init__-76"><a href="#AMDN.__init__-76"><span class="linenos">76</span></a>
</span><span id="AMDN.__init__-77"><a href="#AMDN.__init__-77"><span class="linenos">77</span></a><span class="sd">        Args:</span>
</span><span id="AMDN.__init__-78"><a href="#AMDN.__init__-78"><span class="linenos">78</span></a><span class="sd">            obs_tracelist (ObservationList):</span>
</span><span id="AMDN.__init__-79"><a href="#AMDN.__init__-79"><span class="linenos">79</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="AMDN.__init__-80"><a href="#AMDN.__init__-80"><span class="linenos">80</span></a><span class="sd">            debug (bool):</span>
</span><span id="AMDN.__init__-81"><a href="#AMDN.__init__-81"><span class="linenos">81</span></a><span class="sd">                Optional debugging mode.</span>
</span><span id="AMDN.__init__-82"><a href="#AMDN.__init__-82"><span class="linenos">82</span></a><span class="sd">            occ_threshold (int):</span>
</span><span id="AMDN.__init__-83"><a href="#AMDN.__init__-83"><span class="linenos">83</span></a><span class="sd">                Threshold to be used for noise constraints.</span>
</span><span id="AMDN.__init__-84"><a href="#AMDN.__init__-84"><span class="linenos">84</span></a>
</span><span id="AMDN.__init__-85"><a href="#AMDN.__init__-85"><span class="linenos">85</span></a><span class="sd">        Raises:</span>
</span><span id="AMDN.__init__-86"><a href="#AMDN.__init__-86"><span class="linenos">86</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="AMDN.__init__-87"><a href="#AMDN.__init__-87"><span class="linenos">87</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="AMDN.__init__-88"><a href="#AMDN.__init__-88"><span class="linenos">88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AMDN.__init__-89"><a href="#AMDN.__init__-89"><span class="linenos">89</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoisyPartialDisorderedParallelObservation</span><span class="p">:</span>
</span><span id="AMDN.__init__-90"><a href="#AMDN.__init__-90"><span class="linenos">90</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">AMDN</span><span class="p">)</span>
</span><span id="AMDN.__init__-91"><a href="#AMDN.__init__-91"><span class="linenos">91</span></a>
</span><span id="AMDN.__init__-92"><a href="#AMDN.__init__-92"><span class="linenos">92</span></a>        <span class="k">return</span> <span class="n">AMDN</span><span class="o">.</span><span class="n">_amdn</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">occ_threshold</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a new Model object.</p>

<p>Args:
    obs_tracelist (ObservationList):
        The state observations to extract the model from.
    debug (bool):
        Optional debugging mode.
    occ_threshold (int):
        Threshold to be used for noise constraints.</p>

<p>Raises:
    IncompatibleObservationToken:
        Raised if the observations are not identity observation.</p>
</div>


                            </div>
                </section>
                <section id="LOCM">
                            <input id="LOCM-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LOCM</span>:

                <label class="view-source-button" for="LOCM-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LOCM"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LOCM-183"><a href="#LOCM-183"><span class="linenos">183</span></a><span class="k">class</span> <span class="nc">LOCM</span><span class="p">:</span>
</span><span id="LOCM-184"><a href="#LOCM-184"><span class="linenos">184</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;LOCM&quot;&quot;&quot;</span>
</span><span id="LOCM-185"><a href="#LOCM-185"><span class="linenos">185</span></a>
</span><span id="LOCM-186"><a href="#LOCM-186"><span class="linenos">186</span></a>    <span class="n">zero_obj</span> <span class="o">=</span> <span class="n">PlanningObject</span><span class="p">(</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span> <span class="s2">&quot;zero&quot;</span><span class="p">)</span>
</span><span id="LOCM-187"><a href="#LOCM-187"><span class="linenos">187</span></a>
</span><span id="LOCM-188"><a href="#LOCM-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="LOCM-189"><a href="#LOCM-189"><span class="linenos">189</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="LOCM-190"><a href="#LOCM-190"><span class="linenos">190</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="LOCM-191"><a href="#LOCM-191"><span class="linenos">191</span></a>        <span class="n">statics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Statics</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LOCM-192"><a href="#LOCM-192"><span class="linenos">192</span></a>        <span class="n">viz</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-193"><a href="#LOCM-193"><span class="linenos">193</span></a>        <span class="n">view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-194"><a href="#LOCM-194"><span class="linenos">194</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-195"><a href="#LOCM-195"><span class="linenos">195</span></a>    <span class="p">):</span>
</span><span id="LOCM-196"><a href="#LOCM-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="LOCM-197"><a href="#LOCM-197"><span class="linenos">197</span></a><span class="sd">        Args:</span>
</span><span id="LOCM-198"><a href="#LOCM-198"><span class="linenos">198</span></a><span class="sd">            observations (ObservationList):</span>
</span><span id="LOCM-199"><a href="#LOCM-199"><span class="linenos">199</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="LOCM-200"><a href="#LOCM-200"><span class="linenos">200</span></a><span class="sd">            statics (Dict[str, List[str]]):</span>
</span><span id="LOCM-201"><a href="#LOCM-201"><span class="linenos">201</span></a><span class="sd">                A dictionary mapping an action name and its arguments to the</span>
</span><span id="LOCM-202"><a href="#LOCM-202"><span class="linenos">202</span></a><span class="sd">                list of static preconditions of the action. A precondition should</span>
</span><span id="LOCM-203"><a href="#LOCM-203"><span class="linenos">203</span></a><span class="sd">                be a tuple, where the first element is the predicate name and the</span>
</span><span id="LOCM-204"><a href="#LOCM-204"><span class="linenos">204</span></a><span class="sd">                rest correspond to the arguments of the action (1-indexed).</span>
</span><span id="LOCM-205"><a href="#LOCM-205"><span class="linenos">205</span></a><span class="sd">                E.g. static( next(C1, C2), put_on_card_in_homecell(C2, C1, _) )</span>
</span><span id="LOCM-206"><a href="#LOCM-206"><span class="linenos">206</span></a><span class="sd">                should is provided as: {&quot;put_on_card_in_homecell&quot;: [(&quot;next&quot;, 2, 1)]}</span>
</span><span id="LOCM-207"><a href="#LOCM-207"><span class="linenos">207</span></a><span class="sd">            viz (bool):</span>
</span><span id="LOCM-208"><a href="#LOCM-208"><span class="linenos">208</span></a><span class="sd">                Whether to visualize the FSM.</span>
</span><span id="LOCM-209"><a href="#LOCM-209"><span class="linenos">209</span></a><span class="sd">            view (bool):</span>
</span><span id="LOCM-210"><a href="#LOCM-210"><span class="linenos">210</span></a><span class="sd">                Whether to view the FSM visualization.</span>
</span><span id="LOCM-211"><a href="#LOCM-211"><span class="linenos">211</span></a>
</span><span id="LOCM-212"><a href="#LOCM-212"><span class="linenos">212</span></a><span class="sd">        Raises:</span>
</span><span id="LOCM-213"><a href="#LOCM-213"><span class="linenos">213</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="LOCM-214"><a href="#LOCM-214"><span class="linenos">214</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="LOCM-215"><a href="#LOCM-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LOCM-216"><a href="#LOCM-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ActionObservation</span><span class="p">:</span>
</span><span id="LOCM-217"><a href="#LOCM-217"><span class="linenos">217</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">LOCM</span><span class="p">)</span>
</span><span id="LOCM-218"><a href="#LOCM-218"><span class="linenos">218</span></a>
</span><span id="LOCM-219"><a href="#LOCM-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LOCM-220"><a href="#LOCM-220"><span class="linenos">220</span></a>            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;LOCM only supports a single trace, using first trace only&quot;</span><span class="p">)</span>
</span><span id="LOCM-221"><a href="#LOCM-221"><span class="linenos">221</span></a>
</span><span id="LOCM-222"><a href="#LOCM-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-223"><a href="#LOCM-223"><span class="linenos">223</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="LOCM-224"><a href="#LOCM-224"><span class="linenos">224</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="LOCM-225"><a href="#LOCM-225"><span class="linenos">225</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="LOCM-226"><a href="#LOCM-226"><span class="linenos">226</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LOCM-227"><a href="#LOCM-227"><span class="linenos">227</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">debug</span><span class="p">})</span>
</span><span id="LOCM-228"><a href="#LOCM-228"><span class="linenos">228</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LOCM-229"><a href="#LOCM-229"><span class="linenos">229</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="LOCM-230"><a href="#LOCM-230"><span class="linenos">230</span></a>
</span><span id="LOCM-231"><a href="#LOCM-231"><span class="linenos">231</span></a>        <span class="n">obs_trace</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LOCM-232"><a href="#LOCM-232"><span class="linenos">232</span></a>        <span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="LOCM-233"><a href="#LOCM-233"><span class="linenos">233</span></a>
</span><span id="LOCM-234"><a href="#LOCM-234"><span class="linenos">234</span></a>        <span class="n">sorts</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_get_sorts</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">[</span><span class="s2">&quot;get_sorts&quot;</span><span class="p">])</span>
</span><span id="LOCM-235"><a href="#LOCM-235"><span class="linenos">235</span></a>
</span><span id="LOCM-236"><a href="#LOCM-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;sorts&quot;</span><span class="p">]:</span>
</span><span id="LOCM-237"><a href="#LOCM-237"><span class="linenos">237</span></a>            <span class="n">sortid2objs</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">sorts</span><span class="o">.</span><span class="n">values</span><span class="p">())}</span>
</span><span id="LOCM-238"><a href="#LOCM-238"><span class="linenos">238</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-239"><a href="#LOCM-239"><span class="linenos">239</span></a>                <span class="n">sortid2objs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="LOCM-240"><a href="#LOCM-240"><span class="linenos">240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sorts:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-241"><a href="#LOCM-241"><span class="linenos">241</span></a>            <span class="n">pprint</span><span class="p">(</span><span class="n">sortid2objs</span><span class="p">)</span>
</span><span id="LOCM-242"><a href="#LOCM-242"><span class="linenos">242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-243"><a href="#LOCM-243"><span class="linenos">243</span></a>
</span><span id="LOCM-244"><a href="#LOCM-244"><span class="linenos">244</span></a>        <span class="n">TS</span><span class="p">,</span> <span class="n">ap_state_pointers</span><span class="p">,</span> <span class="n">OS</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step1</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">,</span> <span class="n">sorts</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step1&quot;</span><span class="p">])</span>
</span><span id="LOCM-245"><a href="#LOCM-245"><span class="linenos">245</span></a>        <span class="n">HS</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step3</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">ap_state_pointers</span><span class="p">,</span> <span class="n">OS</span><span class="p">,</span> <span class="n">sorts</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step3&quot;</span><span class="p">])</span>
</span><span id="LOCM-246"><a href="#LOCM-246"><span class="linenos">246</span></a>        <span class="n">bindings</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step4</span><span class="p">(</span><span class="n">HS</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step4&quot;</span><span class="p">])</span>
</span><span id="LOCM-247"><a href="#LOCM-247"><span class="linenos">247</span></a>        <span class="n">bindings</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step5</span><span class="p">(</span><span class="n">HS</span><span class="p">,</span> <span class="n">bindings</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step5&quot;</span><span class="p">])</span>
</span><span id="LOCM-248"><a href="#LOCM-248"><span class="linenos">248</span></a>        <span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step7</span><span class="p">(</span>
</span><span id="LOCM-249"><a href="#LOCM-249"><span class="linenos">249</span></a>            <span class="n">OS</span><span class="p">,</span>
</span><span id="LOCM-250"><a href="#LOCM-250"><span class="linenos">250</span></a>            <span class="n">ap_state_pointers</span><span class="p">,</span>
</span><span id="LOCM-251"><a href="#LOCM-251"><span class="linenos">251</span></a>            <span class="n">sorts</span><span class="p">,</span>
</span><span id="LOCM-252"><a href="#LOCM-252"><span class="linenos">252</span></a>            <span class="n">bindings</span><span class="p">,</span>
</span><span id="LOCM-253"><a href="#LOCM-253"><span class="linenos">253</span></a>            <span class="n">statics</span> <span class="k">if</span> <span class="n">statics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="LOCM-254"><a href="#LOCM-254"><span class="linenos">254</span></a>            <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step7&quot;</span><span class="p">],</span>
</span><span id="LOCM-255"><a href="#LOCM-255"><span class="linenos">255</span></a>            <span class="n">viz</span><span class="p">,</span>
</span><span id="LOCM-256"><a href="#LOCM-256"><span class="linenos">256</span></a>        <span class="p">)</span>
</span><span id="LOCM-257"><a href="#LOCM-257"><span class="linenos">257</span></a>
</span><span id="LOCM-258"><a href="#LOCM-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span><span id="LOCM-259"><a href="#LOCM-259"><span class="linenos">259</span></a>
</span><span id="LOCM-260"><a href="#LOCM-260"><span class="linenos">260</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-261"><a href="#LOCM-261"><span class="linenos">261</span></a>    <span class="k">def</span> <span class="nf">_get_sorts</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Observation</span><span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sorts</span><span class="p">:</span>
</span><span id="LOCM-262"><a href="#LOCM-262"><span class="linenos">262</span></a>        <span class="n">sorts</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># initialize list of sorts for this trace</span>
</span><span id="LOCM-263"><a href="#LOCM-263"><span class="linenos">263</span></a>        <span class="c1"># track actions seen in the trace, and the sort each actions params belong to</span>
</span><span id="LOCM-264"><a href="#LOCM-264"><span class="linenos">264</span></a>        <span class="n">ap_sort_pointers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LOCM-265"><a href="#LOCM-265"><span class="linenos">265</span></a>        <span class="c1"># track objects seen in the trace, and the sort each belongs to</span>
</span><span id="LOCM-266"><a href="#LOCM-266"><span class="linenos">266</span></a>        <span class="c1"># obj_sort_pointers: Dict[str, int] = {}</span>
</span><span id="LOCM-267"><a href="#LOCM-267"><span class="linenos">267</span></a>        <span class="n">sorted_objs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LOCM-268"><a href="#LOCM-268"><span class="linenos">268</span></a>
</span><span id="LOCM-269"><a href="#LOCM-269"><span class="linenos">269</span></a>        <span class="k">def</span> <span class="nf">get_obj_sort</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">PlanningObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="LOCM-270"><a href="#LOCM-270"><span class="linenos">270</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Returns the sort index of the object&quot;&quot;&quot;</span>
</span><span id="LOCM-271"><a href="#LOCM-271"><span class="linenos">271</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sort</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorts</span><span class="p">):</span>
</span><span id="LOCM-272"><a href="#LOCM-272"><span class="linenos">272</span></a>                <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">:</span>
</span><span id="LOCM-273"><a href="#LOCM-273"><span class="linenos">273</span></a>                    <span class="k">return</span> <span class="n">i</span>
</span><span id="LOCM-274"><a href="#LOCM-274"><span class="linenos">274</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> not in any sort&quot;</span><span class="p">)</span>
</span><span id="LOCM-275"><a href="#LOCM-275"><span class="linenos">275</span></a>
</span><span id="LOCM-276"><a href="#LOCM-276"><span class="linenos">276</span></a>        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obs_trace</span><span class="p">:</span>
</span><span id="LOCM-277"><a href="#LOCM-277"><span class="linenos">277</span></a>            <span class="n">action</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span>
</span><span id="LOCM-278"><a href="#LOCM-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LOCM-279"><a href="#LOCM-279"><span class="linenos">279</span></a>                <span class="k">continue</span>
</span><span id="LOCM-280"><a href="#LOCM-280"><span class="linenos">280</span></a>
</span><span id="LOCM-281"><a href="#LOCM-281"><span class="linenos">281</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-282"><a href="#LOCM-282"><span class="linenos">282</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">action:&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span>
</span><span id="LOCM-283"><a href="#LOCM-283"><span class="linenos">283</span></a>
</span><span id="LOCM-284"><a href="#LOCM-284"><span class="linenos">284</span></a>            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ap_sort_pointers</span><span class="p">:</span>  <span class="c1"># new action</span>
</span><span id="LOCM-285"><a href="#LOCM-285"><span class="linenos">285</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-286"><a href="#LOCM-286"><span class="linenos">286</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new action&quot;</span><span class="p">)</span>
</span><span id="LOCM-287"><a href="#LOCM-287"><span class="linenos">287</span></a>
</span><span id="LOCM-288"><a href="#LOCM-288"><span class="linenos">288</span></a>                <span class="n">ap_sort_pointers</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LOCM-289"><a href="#LOCM-289"><span class="linenos">289</span></a>
</span><span id="LOCM-290"><a href="#LOCM-290"><span class="linenos">290</span></a>                <span class="c1"># for each parameter of the action</span>
</span><span id="LOCM-291"><a href="#LOCM-291"><span class="linenos">291</span></a>                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">:</span>
</span><span id="LOCM-292"><a href="#LOCM-292"><span class="linenos">292</span></a>                    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sorted_objs</span><span class="p">:</span>  <span class="c1"># unsorted object</span>
</span><span id="LOCM-293"><a href="#LOCM-293"><span class="linenos">293</span></a>                        <span class="c1"># append a sort (set) containing the object</span>
</span><span id="LOCM-294"><a href="#LOCM-294"><span class="linenos">294</span></a>                        <span class="n">sorts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">obj</span><span class="p">})</span>
</span><span id="LOCM-295"><a href="#LOCM-295"><span class="linenos">295</span></a>
</span><span id="LOCM-296"><a href="#LOCM-296"><span class="linenos">296</span></a>                        <span class="c1"># record the object has been sorted and the index of the sort it belongs to</span>
</span><span id="LOCM-297"><a href="#LOCM-297"><span class="linenos">297</span></a>                        <span class="n">obj_sort</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="LOCM-298"><a href="#LOCM-298"><span class="linenos">298</span></a>                        <span class="n">sorted_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LOCM-299"><a href="#LOCM-299"><span class="linenos">299</span></a>                        <span class="n">ap_sort_pointers</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_sort</span><span class="p">)</span>
</span><span id="LOCM-300"><a href="#LOCM-300"><span class="linenos">300</span></a>
</span><span id="LOCM-301"><a href="#LOCM-301"><span class="linenos">301</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-302"><a href="#LOCM-302"><span class="linenos">302</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new object&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LOCM-303"><a href="#LOCM-303"><span class="linenos">303</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sorts:&quot;</span><span class="p">,</span> <span class="n">sorts</span><span class="p">)</span>
</span><span id="LOCM-304"><a href="#LOCM-304"><span class="linenos">304</span></a>
</span><span id="LOCM-305"><a href="#LOCM-305"><span class="linenos">305</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># object already sorted</span>
</span><span id="LOCM-306"><a href="#LOCM-306"><span class="linenos">306</span></a>                        <span class="c1"># look up the sort of the object</span>
</span><span id="LOCM-307"><a href="#LOCM-307"><span class="linenos">307</span></a>                        <span class="n">obj_sort</span> <span class="o">=</span> <span class="n">get_obj_sort</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="LOCM-308"><a href="#LOCM-308"><span class="linenos">308</span></a>                        <span class="n">ap_sort_pointers</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_sort</span><span class="p">)</span>
</span><span id="LOCM-309"><a href="#LOCM-309"><span class="linenos">309</span></a>
</span><span id="LOCM-310"><a href="#LOCM-310"><span class="linenos">310</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-311"><a href="#LOCM-311"><span class="linenos">311</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sorted object&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LOCM-312"><a href="#LOCM-312"><span class="linenos">312</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sorts:&quot;</span><span class="p">,</span> <span class="n">sorts</span><span class="p">)</span>
</span><span id="LOCM-313"><a href="#LOCM-313"><span class="linenos">313</span></a>
</span><span id="LOCM-314"><a href="#LOCM-314"><span class="linenos">314</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-315"><a href="#LOCM-315"><span class="linenos">315</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ap sorts:&quot;</span><span class="p">,</span> <span class="n">ap_sort_pointers</span><span class="p">)</span>
</span><span id="LOCM-316"><a href="#LOCM-316"><span class="linenos">316</span></a>
</span><span id="LOCM-317"><a href="#LOCM-317"><span class="linenos">317</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># action seen before</span>
</span><span id="LOCM-318"><a href="#LOCM-318"><span class="linenos">318</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-319"><a href="#LOCM-319"><span class="linenos">319</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;seen action&quot;</span><span class="p">)</span>
</span><span id="LOCM-320"><a href="#LOCM-320"><span class="linenos">320</span></a>
</span><span id="LOCM-321"><a href="#LOCM-321"><span class="linenos">321</span></a>                <span class="k">for</span> <span class="n">ap_sort</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="LOCM-322"><a href="#LOCM-322"><span class="linenos">322</span></a>                    <span class="n">ap_sort_pointers</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">action</span><span class="o">.</span><span class="n">obj_params</span>
</span><span id="LOCM-323"><a href="#LOCM-323"><span class="linenos">323</span></a>                <span class="p">):</span>
</span><span id="LOCM-324"><a href="#LOCM-324"><span class="linenos">324</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-325"><a href="#LOCM-325"><span class="linenos">325</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;checking obj&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LOCM-326"><a href="#LOCM-326"><span class="linenos">326</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ap sort:&quot;</span><span class="p">,</span> <span class="n">ap_sort</span><span class="p">)</span>
</span><span id="LOCM-327"><a href="#LOCM-327"><span class="linenos">327</span></a>
</span><span id="LOCM-328"><a href="#LOCM-328"><span class="linenos">328</span></a>                    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sorted_objs</span><span class="p">:</span>  <span class="c1"># unsorted object</span>
</span><span id="LOCM-329"><a href="#LOCM-329"><span class="linenos">329</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-330"><a href="#LOCM-330"><span class="linenos">330</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unsorted object&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LOCM-331"><a href="#LOCM-331"><span class="linenos">331</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sorts:&quot;</span><span class="p">,</span> <span class="n">sorts</span><span class="p">)</span>
</span><span id="LOCM-332"><a href="#LOCM-332"><span class="linenos">332</span></a>
</span><span id="LOCM-333"><a href="#LOCM-333"><span class="linenos">333</span></a>                        <span class="c1"># add the object to the sort of current action parameter</span>
</span><span id="LOCM-334"><a href="#LOCM-334"><span class="linenos">334</span></a>                        <span class="n">sorts</span><span class="p">[</span><span class="n">ap_sort</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="LOCM-335"><a href="#LOCM-335"><span class="linenos">335</span></a>                        <span class="n">sorted_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LOCM-336"><a href="#LOCM-336"><span class="linenos">336</span></a>
</span><span id="LOCM-337"><a href="#LOCM-337"><span class="linenos">337</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># object already has a sort</span>
</span><span id="LOCM-338"><a href="#LOCM-338"><span class="linenos">338</span></a>                        <span class="c1"># retrieve the sort the object belongs to</span>
</span><span id="LOCM-339"><a href="#LOCM-339"><span class="linenos">339</span></a>                        <span class="n">obj_sort</span> <span class="o">=</span> <span class="n">get_obj_sort</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="LOCM-340"><a href="#LOCM-340"><span class="linenos">340</span></a>
</span><span id="LOCM-341"><a href="#LOCM-341"><span class="linenos">341</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-342"><a href="#LOCM-342"><span class="linenos">342</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;retrieving sorted obj </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-343"><a href="#LOCM-343"><span class="linenos">343</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;obj_sort_idx: </span><span class="si">{</span><span class="n">obj_sort</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-344"><a href="#LOCM-344"><span class="linenos">344</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;seq_sorts: </span><span class="si">{</span><span class="n">sorts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-345"><a href="#LOCM-345"><span class="linenos">345</span></a>
</span><span id="LOCM-346"><a href="#LOCM-346"><span class="linenos">346</span></a>                        <span class="c1"># check if the object&#39;s sort matches the action paremeter&#39;s</span>
</span><span id="LOCM-347"><a href="#LOCM-347"><span class="linenos">347</span></a>                        <span class="c1"># if so, do nothing and move on to next step</span>
</span><span id="LOCM-348"><a href="#LOCM-348"><span class="linenos">348</span></a>                        <span class="c1"># otherwise, unite the two sorts</span>
</span><span id="LOCM-349"><a href="#LOCM-349"><span class="linenos">349</span></a>                        <span class="k">if</span> <span class="n">obj_sort</span> <span class="o">==</span> <span class="n">ap_sort</span><span class="p">:</span>
</span><span id="LOCM-350"><a href="#LOCM-350"><span class="linenos">350</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-351"><a href="#LOCM-351"><span class="linenos">351</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obj sort matches action&quot;</span><span class="p">)</span>
</span><span id="LOCM-352"><a href="#LOCM-352"><span class="linenos">352</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LOCM-353"><a href="#LOCM-353"><span class="linenos">353</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-354"><a href="#LOCM-354"><span class="linenos">354</span></a>                                <span class="nb">print</span><span class="p">(</span>
</span><span id="LOCM-355"><a href="#LOCM-355"><span class="linenos">355</span></a>                                    <span class="sa">f</span><span class="s2">&quot;obj sort </span><span class="si">{</span><span class="n">obj_sort</span><span class="si">}</span><span class="s2"> doesn&#39;t match action </span><span class="si">{</span><span class="n">ap_sort</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-356"><a href="#LOCM-356"><span class="linenos">356</span></a>                                <span class="p">)</span>
</span><span id="LOCM-357"><a href="#LOCM-357"><span class="linenos">357</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;seq_sorts: </span><span class="si">{</span><span class="n">sorts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-358"><a href="#LOCM-358"><span class="linenos">358</span></a>
</span><span id="LOCM-359"><a href="#LOCM-359"><span class="linenos">359</span></a>                            <span class="c1"># unite the action parameter&#39;s sort and the object&#39;s sort</span>
</span><span id="LOCM-360"><a href="#LOCM-360"><span class="linenos">360</span></a>                            <span class="n">sorts</span><span class="p">[</span><span class="n">obj_sort</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorts</span><span class="p">[</span><span class="n">obj_sort</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">sorts</span><span class="p">[</span><span class="n">ap_sort</span><span class="p">])</span>
</span><span id="LOCM-361"><a href="#LOCM-361"><span class="linenos">361</span></a>
</span><span id="LOCM-362"><a href="#LOCM-362"><span class="linenos">362</span></a>                            <span class="c1"># drop the not unionized sort</span>
</span><span id="LOCM-363"><a href="#LOCM-363"><span class="linenos">363</span></a>                            <span class="n">sorts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ap_sort</span><span class="p">)</span>
</span><span id="LOCM-364"><a href="#LOCM-364"><span class="linenos">364</span></a>
</span><span id="LOCM-365"><a href="#LOCM-365"><span class="linenos">365</span></a>                            <span class="n">old_obj_sort</span> <span class="o">=</span> <span class="n">obj_sort</span>
</span><span id="LOCM-366"><a href="#LOCM-366"><span class="linenos">366</span></a>
</span><span id="LOCM-367"><a href="#LOCM-367"><span class="linenos">367</span></a>                            <span class="n">obj_sort</span> <span class="o">=</span> <span class="n">get_obj_sort</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="LOCM-368"><a href="#LOCM-368"><span class="linenos">368</span></a>
</span><span id="LOCM-369"><a href="#LOCM-369"><span class="linenos">369</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-370"><a href="#LOCM-370"><span class="linenos">370</span></a>                                <span class="nb">print</span><span class="p">(</span>
</span><span id="LOCM-371"><a href="#LOCM-371"><span class="linenos">371</span></a>                                    <span class="sa">f</span><span class="s2">&quot;united seq_sorts[</span><span class="si">{</span><span class="n">ap_sort</span><span class="si">}</span><span class="s2">] and seq_sorts[</span><span class="si">{</span><span class="n">obj_sort</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="LOCM-372"><a href="#LOCM-372"><span class="linenos">372</span></a>                                <span class="p">)</span>
</span><span id="LOCM-373"><a href="#LOCM-373"><span class="linenos">373</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;seq_sorts: </span><span class="si">{</span><span class="n">sorts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-374"><a href="#LOCM-374"><span class="linenos">374</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ap_sort_pointers: </span><span class="si">{</span><span class="n">ap_sort_pointers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-375"><a href="#LOCM-375"><span class="linenos">375</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;updating pointers...&quot;</span><span class="p">)</span>
</span><span id="LOCM-376"><a href="#LOCM-376"><span class="linenos">376</span></a>
</span><span id="LOCM-377"><a href="#LOCM-377"><span class="linenos">377</span></a>                            <span class="n">min_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ap_sort</span><span class="p">,</span> <span class="n">obj_sort</span><span class="p">)</span>
</span><span id="LOCM-378"><a href="#LOCM-378"><span class="linenos">378</span></a>
</span><span id="LOCM-379"><a href="#LOCM-379"><span class="linenos">379</span></a>                            <span class="c1"># update all outdated records of which sort the affected objects belong to</span>
</span><span id="LOCM-380"><a href="#LOCM-380"><span class="linenos">380</span></a>                            <span class="k">for</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">ap_sorts</span> <span class="ow">in</span> <span class="n">ap_sort_pointers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-381"><a href="#LOCM-381"><span class="linenos">381</span></a>                                <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">sort</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ap_sorts</span><span class="p">):</span>
</span><span id="LOCM-382"><a href="#LOCM-382"><span class="linenos">382</span></a>                                    <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="n">ap_sort</span> <span class="ow">or</span> <span class="n">sort</span> <span class="o">==</span> <span class="n">old_obj_sort</span><span class="p">:</span>
</span><span id="LOCM-383"><a href="#LOCM-383"><span class="linenos">383</span></a>                                        <span class="n">ap_sort_pointers</span><span class="p">[</span><span class="n">action_name</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_sort</span>
</span><span id="LOCM-384"><a href="#LOCM-384"><span class="linenos">384</span></a>                                    <span class="k">elif</span> <span class="n">sort</span> <span class="o">&gt;</span> <span class="n">min_idx</span><span class="p">:</span>
</span><span id="LOCM-385"><a href="#LOCM-385"><span class="linenos">385</span></a>                                        <span class="n">ap_sort_pointers</span><span class="p">[</span><span class="n">action_name</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="LOCM-386"><a href="#LOCM-386"><span class="linenos">386</span></a>
</span><span id="LOCM-387"><a href="#LOCM-387"><span class="linenos">387</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM-388"><a href="#LOCM-388"><span class="linenos">388</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ap_sort_pointers: </span><span class="si">{</span><span class="n">ap_sort_pointers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-389"><a href="#LOCM-389"><span class="linenos">389</span></a>
</span><span id="LOCM-390"><a href="#LOCM-390"><span class="linenos">390</span></a>        <span class="n">obj_sorts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LOCM-391"><a href="#LOCM-391"><span class="linenos">391</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sort</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorts</span><span class="p">):</span>
</span><span id="LOCM-392"><a href="#LOCM-392"><span class="linenos">392</span></a>            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">:</span>
</span><span id="LOCM-393"><a href="#LOCM-393"><span class="linenos">393</span></a>                <span class="c1"># NOTE: object sorts are 1-indexed so the zero-object can be sort 0</span>
</span><span id="LOCM-394"><a href="#LOCM-394"><span class="linenos">394</span></a>                <span class="n">obj_sorts</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LOCM-395"><a href="#LOCM-395"><span class="linenos">395</span></a>
</span><span id="LOCM-396"><a href="#LOCM-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">obj_sorts</span>
</span><span id="LOCM-397"><a href="#LOCM-397"><span class="linenos">397</span></a>
</span><span id="LOCM-398"><a href="#LOCM-398"><span class="linenos">398</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-399"><a href="#LOCM-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">_pointer_to_set</span><span class="p">(</span><span class="n">states</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">],</span> <span class="n">pointer</span><span class="p">,</span> <span class="n">pointer2</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="LOCM-400"><a href="#LOCM-400"><span class="linenos">400</span></a>        <span class="n">state1</span><span class="p">,</span> <span class="n">state2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="LOCM-401"><a href="#LOCM-401"><span class="linenos">401</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">state_set</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">states</span><span class="p">):</span>
</span><span id="LOCM-402"><a href="#LOCM-402"><span class="linenos">402</span></a>            <span class="k">if</span> <span class="n">pointer</span> <span class="ow">in</span> <span class="n">state_set</span><span class="p">:</span>
</span><span id="LOCM-403"><a href="#LOCM-403"><span class="linenos">403</span></a>                <span class="n">state1</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="LOCM-404"><a href="#LOCM-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">pointer2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pointer2</span> <span class="ow">in</span> <span class="n">state_set</span><span class="p">:</span>
</span><span id="LOCM-405"><a href="#LOCM-405"><span class="linenos">405</span></a>                <span class="n">state2</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="LOCM-406"><a href="#LOCM-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="n">state1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">state2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LOCM-407"><a href="#LOCM-407"><span class="linenos">407</span></a>                <span class="k">break</span>
</span><span id="LOCM-408"><a href="#LOCM-408"><span class="linenos">408</span></a>
</span><span id="LOCM-409"><a href="#LOCM-409"><span class="linenos">409</span></a>        <span class="k">assert</span> <span class="n">state1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pointer (</span><span class="si">{</span><span class="n">pointer</span><span class="si">}</span><span class="s2">) not in states: </span><span class="si">{</span><span class="n">states</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-410"><a href="#LOCM-410"><span class="linenos">410</span></a>        <span class="k">assert</span> <span class="n">state2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pointer (</span><span class="si">{</span><span class="n">pointer2</span><span class="si">}</span><span class="s2">) not in states: </span><span class="si">{</span><span class="n">states</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-411"><a href="#LOCM-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="n">state1</span><span class="p">,</span> <span class="n">state2</span>
</span><span id="LOCM-412"><a href="#LOCM-412"><span class="linenos">412</span></a>
</span><span id="LOCM-413"><a href="#LOCM-413"><span class="linenos">413</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-414"><a href="#LOCM-414"><span class="linenos">414</span></a>    <span class="k">def</span> <span class="nf">_step1</span><span class="p">(</span>
</span><span id="LOCM-415"><a href="#LOCM-415"><span class="linenos">415</span></a>        <span class="n">obs_trace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Observation</span><span class="p">],</span> <span class="n">sorts</span><span class="p">:</span> <span class="n">Sorts</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="LOCM-416"><a href="#LOCM-416"><span class="linenos">416</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TSType</span><span class="p">,</span> <span class="n">APStatePointers</span><span class="p">,</span> <span class="n">OSType</span><span class="p">]:</span>
</span><span id="LOCM-417"><a href="#LOCM-417"><span class="linenos">417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 1: Create a state machine for each object sort</span>
</span><span id="LOCM-418"><a href="#LOCM-418"><span class="linenos">418</span></a><span class="sd">        Implicitly includes Step 2 (zero analysis) by including the zero-object throughout</span>
</span><span id="LOCM-419"><a href="#LOCM-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LOCM-420"><a href="#LOCM-420"><span class="linenos">420</span></a>
</span><span id="LOCM-421"><a href="#LOCM-421"><span class="linenos">421</span></a>        <span class="c1"># create the zero-object for zero analysis (step 2)</span>
</span><span id="LOCM-422"><a href="#LOCM-422"><span class="linenos">422</span></a>        <span class="n">zero_obj</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">zero_obj</span>
</span><span id="LOCM-423"><a href="#LOCM-423"><span class="linenos">423</span></a>
</span><span id="LOCM-424"><a href="#LOCM-424"><span class="linenos">424</span></a>        <span class="c1"># collect action sequences for each object</span>
</span><span id="LOCM-425"><a href="#LOCM-425"><span class="linenos">425</span></a>        <span class="n">obj_traces</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">PlanningObject</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">AP</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="LOCM-426"><a href="#LOCM-426"><span class="linenos">426</span></a>        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obs_trace</span><span class="p">:</span>
</span><span id="LOCM-427"><a href="#LOCM-427"><span class="linenos">427</span></a>            <span class="n">action</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span>
</span><span id="LOCM-428"><a href="#LOCM-428"><span class="linenos">428</span></a>            <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LOCM-429"><a href="#LOCM-429"><span class="linenos">429</span></a>                <span class="c1"># add the step for the zero-object</span>
</span><span id="LOCM-430"><a href="#LOCM-430"><span class="linenos">430</span></a>                <span class="n">obj_traces</span><span class="p">[</span><span class="n">zero_obj</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AP</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="LOCM-431"><a href="#LOCM-431"><span class="linenos">431</span></a>                <span class="c1"># for each combination of action name A and argument pos P</span>
</span><span id="LOCM-432"><a href="#LOCM-432"><span class="linenos">432</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">):</span>
</span><span id="LOCM-433"><a href="#LOCM-433"><span class="linenos">433</span></a>                    <span class="c1"># create transition A.P</span>
</span><span id="LOCM-434"><a href="#LOCM-434"><span class="linenos">434</span></a>                    <span class="n">ap</span> <span class="o">=</span> <span class="n">AP</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sorts</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
</span><span id="LOCM-435"><a href="#LOCM-435"><span class="linenos">435</span></a>                    <span class="n">obj_traces</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</span><span id="LOCM-436"><a href="#LOCM-436"><span class="linenos">436</span></a>
</span><span id="LOCM-437"><a href="#LOCM-437"><span class="linenos">437</span></a>        <span class="c1"># initialize the state set OS and transition set TS</span>
</span><span id="LOCM-438"><a href="#LOCM-438"><span class="linenos">438</span></a>        <span class="n">OS</span><span class="p">:</span> <span class="n">OSType</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="LOCM-439"><a href="#LOCM-439"><span class="linenos">439</span></a>        <span class="n">TS</span><span class="p">:</span> <span class="n">TSType</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-440"><a href="#LOCM-440"><span class="linenos">440</span></a>        <span class="c1"># track pointers mapping A.P to its start and end states</span>
</span><span id="LOCM-441"><a href="#LOCM-441"><span class="linenos">441</span></a>        <span class="n">ap_state_pointers</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-442"><a href="#LOCM-442"><span class="linenos">442</span></a>        <span class="c1"># iterate over each object and its action sequence</span>
</span><span id="LOCM-443"><a href="#LOCM-443"><span class="linenos">443</span></a>        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">obj_traces</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-444"><a href="#LOCM-444"><span class="linenos">444</span></a>            <span class="n">sort</span> <span class="o">=</span> <span class="n">sorts</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="n">zero_obj</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="LOCM-445"><a href="#LOCM-445"><span class="linenos">445</span></a>            <span class="n">TS</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span>  <span class="c1"># add the sequence to the transition set</span>
</span><span id="LOCM-446"><a href="#LOCM-446"><span class="linenos">446</span></a>            <span class="c1"># max of the states already in OS[sort], plus 1</span>
</span><span id="LOCM-447"><a href="#LOCM-447"><span class="linenos">447</span></a>            <span class="n">state_n</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="LOCM-448"><a href="#LOCM-448"><span class="linenos">448</span></a>                <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LOCM-449"><a href="#LOCM-449"><span class="linenos">449</span></a>            <span class="p">)</span>  <span class="c1"># count current (new) state id</span>
</span><span id="LOCM-450"><a href="#LOCM-450"><span class="linenos">450</span></a>            <span class="n">prev_states</span><span class="p">:</span> <span class="n">StatePointers</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
</span><span id="LOCM-451"><a href="#LOCM-451"><span class="linenos">451</span></a>            <span class="c1"># iterate over each transition A.P in the sequence</span>
</span><span id="LOCM-452"><a href="#LOCM-452"><span class="linenos">452</span></a>            <span class="k">for</span> <span class="n">ap</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
</span><span id="LOCM-453"><a href="#LOCM-453"><span class="linenos">453</span></a>                <span class="c1"># if the transition has not been seen before for the current sort</span>
</span><span id="LOCM-454"><a href="#LOCM-454"><span class="linenos">454</span></a>                <span class="k">if</span> <span class="n">ap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">sort</span><span class="p">]:</span>
</span><span id="LOCM-455"><a href="#LOCM-455"><span class="linenos">455</span></a>                    <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">ap</span><span class="p">]</span> <span class="o">=</span> <span class="n">StatePointers</span><span class="p">(</span><span class="n">state_n</span><span class="p">,</span> <span class="n">state_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="LOCM-456"><a href="#LOCM-456"><span class="linenos">456</span></a>
</span><span id="LOCM-457"><a href="#LOCM-457"><span class="linenos">457</span></a>                    <span class="c1"># add the start and end states to the state set as unique states</span>
</span><span id="LOCM-458"><a href="#LOCM-458"><span class="linenos">458</span></a>                    <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">state_n</span><span class="p">})</span>
</span><span id="LOCM-459"><a href="#LOCM-459"><span class="linenos">459</span></a>                    <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">state_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
</span><span id="LOCM-460"><a href="#LOCM-460"><span class="linenos">460</span></a>
</span><span id="LOCM-461"><a href="#LOCM-461"><span class="linenos">461</span></a>                    <span class="n">state_n</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="LOCM-462"><a href="#LOCM-462"><span class="linenos">462</span></a>
</span><span id="LOCM-463"><a href="#LOCM-463"><span class="linenos">463</span></a>                <span class="n">ap_states</span> <span class="o">=</span> <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">ap</span><span class="p">]</span>
</span><span id="LOCM-464"><a href="#LOCM-464"><span class="linenos">464</span></a>
</span><span id="LOCM-465"><a href="#LOCM-465"><span class="linenos">465</span></a>                <span class="k">if</span> <span class="n">prev_states</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LOCM-466"><a href="#LOCM-466"><span class="linenos">466</span></a>                    <span class="c1"># get the state ids (indecies) of the state sets containing</span>
</span><span id="LOCM-467"><a href="#LOCM-467"><span class="linenos">467</span></a>                    <span class="c1"># start(A.P) and the end state of the previous transition</span>
</span><span id="LOCM-468"><a href="#LOCM-468"><span class="linenos">468</span></a>                    <span class="n">start_state</span><span class="p">,</span> <span class="n">prev_end_state</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_pointer_to_set</span><span class="p">(</span>
</span><span id="LOCM-469"><a href="#LOCM-469"><span class="linenos">469</span></a>                        <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">ap_states</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">prev_states</span><span class="o">.</span><span class="n">end</span>
</span><span id="LOCM-470"><a href="#LOCM-470"><span class="linenos">470</span></a>                    <span class="p">)</span>
</span><span id="LOCM-471"><a href="#LOCM-471"><span class="linenos">471</span></a>
</span><span id="LOCM-472"><a href="#LOCM-472"><span class="linenos">472</span></a>                    <span class="c1"># if not the same state set, merge the two</span>
</span><span id="LOCM-473"><a href="#LOCM-473"><span class="linenos">473</span></a>                    <span class="k">if</span> <span class="n">start_state</span> <span class="o">!=</span> <span class="n">prev_end_state</span><span class="p">:</span>
</span><span id="LOCM-474"><a href="#LOCM-474"><span class="linenos">474</span></a>                        <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">start_state</span><span class="p">]</span> <span class="o">=</span> <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">start_state</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
</span><span id="LOCM-475"><a href="#LOCM-475"><span class="linenos">475</span></a>                            <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">prev_end_state</span><span class="p">]</span>
</span><span id="LOCM-476"><a href="#LOCM-476"><span class="linenos">476</span></a>                        <span class="p">)</span>
</span><span id="LOCM-477"><a href="#LOCM-477"><span class="linenos">477</span></a>                        <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prev_end_state</span><span class="p">)</span>
</span><span id="LOCM-478"><a href="#LOCM-478"><span class="linenos">478</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">]])</span>
</span><span id="LOCM-479"><a href="#LOCM-479"><span class="linenos">479</span></a>
</span><span id="LOCM-480"><a href="#LOCM-480"><span class="linenos">480</span></a>                <span class="n">prev_states</span> <span class="o">=</span> <span class="n">ap_states</span>
</span><span id="LOCM-481"><a href="#LOCM-481"><span class="linenos">481</span></a>
</span><span id="LOCM-482"><a href="#LOCM-482"><span class="linenos">482</span></a>        <span class="c1"># remove the zero-object sort if it only has one state</span>
</span><span id="LOCM-483"><a href="#LOCM-483"><span class="linenos">483</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">OS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LOCM-484"><a href="#LOCM-484"><span class="linenos">484</span></a>            <span class="n">ap_state_pointers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LOCM-485"><a href="#LOCM-485"><span class="linenos">485</span></a>            <span class="n">OS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LOCM-486"><a href="#LOCM-486"><span class="linenos">486</span></a>
</span><span id="LOCM-487"><a href="#LOCM-487"><span class="linenos">487</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">TS</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ap_state_pointers</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OS</span><span class="p">)</span>
</span><span id="LOCM-488"><a href="#LOCM-488"><span class="linenos">488</span></a>
</span><span id="LOCM-489"><a href="#LOCM-489"><span class="linenos">489</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-490"><a href="#LOCM-490"><span class="linenos">490</span></a>    <span class="k">def</span> <span class="nf">_step3</span><span class="p">(</span>
</span><span id="LOCM-491"><a href="#LOCM-491"><span class="linenos">491</span></a>        <span class="n">TS</span><span class="p">:</span> <span class="n">TSType</span><span class="p">,</span>
</span><span id="LOCM-492"><a href="#LOCM-492"><span class="linenos">492</span></a>        <span class="n">ap_state_pointers</span><span class="p">:</span> <span class="n">APStatePointers</span><span class="p">,</span>
</span><span id="LOCM-493"><a href="#LOCM-493"><span class="linenos">493</span></a>        <span class="n">OS</span><span class="p">:</span> <span class="n">OSType</span><span class="p">,</span>
</span><span id="LOCM-494"><a href="#LOCM-494"><span class="linenos">494</span></a>        <span class="n">sorts</span><span class="p">:</span> <span class="n">Sorts</span><span class="p">,</span>
</span><span id="LOCM-495"><a href="#LOCM-495"><span class="linenos">495</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-496"><a href="#LOCM-496"><span class="linenos">496</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hypotheses</span><span class="p">:</span>
</span><span id="LOCM-497"><a href="#LOCM-497"><span class="linenos">497</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 3: Induction of parameterised FSMs&quot;&quot;&quot;</span>
</span><span id="LOCM-498"><a href="#LOCM-498"><span class="linenos">498</span></a>
</span><span id="LOCM-499"><a href="#LOCM-499"><span class="linenos">499</span></a>        <span class="n">zero_obj</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">zero_obj</span>
</span><span id="LOCM-500"><a href="#LOCM-500"><span class="linenos">500</span></a>
</span><span id="LOCM-501"><a href="#LOCM-501"><span class="linenos">501</span></a>        <span class="c1"># indexed by B.k and C.l for 3.2 matching hypotheses against transitions</span>
</span><span id="LOCM-502"><a href="#LOCM-502"><span class="linenos">502</span></a>        <span class="n">HS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">HSIndex</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">HSItem</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
</span><span id="LOCM-503"><a href="#LOCM-503"><span class="linenos">503</span></a>
</span><span id="LOCM-504"><a href="#LOCM-504"><span class="linenos">504</span></a>        <span class="c1"># 3.1: Form hypotheses from state machines</span>
</span><span id="LOCM-505"><a href="#LOCM-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">G</span><span class="p">,</span> <span class="n">sort_ts</span> <span class="ow">in</span> <span class="n">TS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-506"><a href="#LOCM-506"><span class="linenos">506</span></a>            <span class="c1"># for each O  O_u (not including the zero-object)</span>
</span><span id="LOCM-507"><a href="#LOCM-507"><span class="linenos">507</span></a>            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sort_ts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-508"><a href="#LOCM-508"><span class="linenos">508</span></a>                <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="n">zero_obj</span><span class="p">:</span>
</span><span id="LOCM-509"><a href="#LOCM-509"><span class="linenos">509</span></a>                    <span class="k">continue</span>
</span><span id="LOCM-510"><a href="#LOCM-510"><span class="linenos">510</span></a>                <span class="c1"># for each pair of transitions B.k and C.l consecutive for O</span>
</span><span id="LOCM-511"><a href="#LOCM-511"><span class="linenos">511</span></a>                <span class="k">for</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="LOCM-512"><a href="#LOCM-512"><span class="linenos">512</span></a>                    <span class="c1"># skip if B or C only have one parameter, since there is no k&#39; or l&#39; to match on</span>
</span><span id="LOCM-513"><a href="#LOCM-513"><span class="linenos">513</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LOCM-514"><a href="#LOCM-514"><span class="linenos">514</span></a>                        <span class="k">continue</span>
</span><span id="LOCM-515"><a href="#LOCM-515"><span class="linenos">515</span></a>
</span><span id="LOCM-516"><a href="#LOCM-516"><span class="linenos">516</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">pos</span>
</span><span id="LOCM-517"><a href="#LOCM-517"><span class="linenos">517</span></a>                    <span class="n">l</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">pos</span>
</span><span id="LOCM-518"><a href="#LOCM-518"><span class="linenos">518</span></a>
</span><span id="LOCM-519"><a href="#LOCM-519"><span class="linenos">519</span></a>                    <span class="c1"># check each pair B.k&#39; and C.l&#39;</span>
</span><span id="LOCM-520"><a href="#LOCM-520"><span class="linenos">520</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Bk_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">):</span>
</span><span id="LOCM-521"><a href="#LOCM-521"><span class="linenos">521</span></a>                        <span class="n">k_</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LOCM-522"><a href="#LOCM-522"><span class="linenos">522</span></a>                        <span class="k">if</span> <span class="n">k_</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
</span><span id="LOCM-523"><a href="#LOCM-523"><span class="linenos">523</span></a>                            <span class="k">continue</span>
</span><span id="LOCM-524"><a href="#LOCM-524"><span class="linenos">524</span></a>                        <span class="n">G_</span> <span class="o">=</span> <span class="n">sorts</span><span class="p">[</span><span class="n">Bk_</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="LOCM-525"><a href="#LOCM-525"><span class="linenos">525</span></a>                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">Cl_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">):</span>
</span><span id="LOCM-526"><a href="#LOCM-526"><span class="linenos">526</span></a>                            <span class="n">l_</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LOCM-527"><a href="#LOCM-527"><span class="linenos">527</span></a>                            <span class="k">if</span> <span class="n">l_</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
</span><span id="LOCM-528"><a href="#LOCM-528"><span class="linenos">528</span></a>                                <span class="k">continue</span>
</span><span id="LOCM-529"><a href="#LOCM-529"><span class="linenos">529</span></a>
</span><span id="LOCM-530"><a href="#LOCM-530"><span class="linenos">530</span></a>                            <span class="c1"># check that B.k&#39; and C.l&#39; are of the same sort</span>
</span><span id="LOCM-531"><a href="#LOCM-531"><span class="linenos">531</span></a>                            <span class="k">if</span> <span class="n">sorts</span><span class="p">[</span><span class="n">Cl_</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="n">G_</span><span class="p">:</span>
</span><span id="LOCM-532"><a href="#LOCM-532"><span class="linenos">532</span></a>                                <span class="c1"># check that end(B.P) = start(C.P)</span>
</span><span id="LOCM-533"><a href="#LOCM-533"><span class="linenos">533</span></a>                                <span class="c1"># NOTE: just a sanity check, should never fail</span>
</span><span id="LOCM-534"><a href="#LOCM-534"><span class="linenos">534</span></a>                                <span class="n">S</span><span class="p">,</span> <span class="n">S2</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_pointer_to_set</span><span class="p">(</span>
</span><span id="LOCM-535"><a href="#LOCM-535"><span class="linenos">535</span></a>                                    <span class="n">OS</span><span class="p">[</span><span class="n">G</span><span class="p">],</span>
</span><span id="LOCM-536"><a href="#LOCM-536"><span class="linenos">536</span></a>                                    <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">G</span><span class="p">][</span><span class="n">B</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
</span><span id="LOCM-537"><a href="#LOCM-537"><span class="linenos">537</span></a>                                    <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">G</span><span class="p">][</span><span class="n">C</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
</span><span id="LOCM-538"><a href="#LOCM-538"><span class="linenos">538</span></a>                                <span class="p">)</span>
</span><span id="LOCM-539"><a href="#LOCM-539"><span class="linenos">539</span></a>                                <span class="k">assert</span> <span class="p">(</span>
</span><span id="LOCM-540"><a href="#LOCM-540"><span class="linenos">540</span></a>                                    <span class="n">S</span> <span class="o">==</span> <span class="n">S2</span>
</span><span id="LOCM-541"><a href="#LOCM-541"><span class="linenos">541</span></a>                                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;end(B.P) != start(C.P)</span><span class="se">\n</span><span class="s2">B.P: </span><span class="si">{</span><span class="n">B</span><span class="si">}</span><span class="se">\n</span><span class="s2">C.P: </span><span class="si">{</span><span class="n">C</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-542"><a href="#LOCM-542"><span class="linenos">542</span></a>
</span><span id="LOCM-543"><a href="#LOCM-543"><span class="linenos">543</span></a>                                <span class="c1"># save the hypothesis in the hypothesis set</span>
</span><span id="LOCM-544"><a href="#LOCM-544"><span class="linenos">544</span></a>                                <span class="n">HS</span><span class="p">[</span><span class="n">HSIndex</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="LOCM-545"><a href="#LOCM-545"><span class="linenos">545</span></a>                                    <span class="n">HSItem</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">k_</span><span class="p">,</span> <span class="n">l_</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">G_</span><span class="p">,</span> <span class="n">supported</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="LOCM-546"><a href="#LOCM-546"><span class="linenos">546</span></a>                                <span class="p">)</span>
</span><span id="LOCM-547"><a href="#LOCM-547"><span class="linenos">547</span></a>
</span><span id="LOCM-548"><a href="#LOCM-548"><span class="linenos">548</span></a>        <span class="c1"># 3.2: Test hypotheses against sequence</span>
</span><span id="LOCM-549"><a href="#LOCM-549"><span class="linenos">549</span></a>        <span class="k">for</span> <span class="n">G</span><span class="p">,</span> <span class="n">sort_ts</span> <span class="ow">in</span> <span class="n">TS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-550"><a href="#LOCM-550"><span class="linenos">550</span></a>            <span class="c1"># for each O  O_u (not including the zero-object)</span>
</span><span id="LOCM-551"><a href="#LOCM-551"><span class="linenos">551</span></a>            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sort_ts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-552"><a href="#LOCM-552"><span class="linenos">552</span></a>                <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="n">zero_obj</span><span class="p">:</span>
</span><span id="LOCM-553"><a href="#LOCM-553"><span class="linenos">553</span></a>                    <span class="k">continue</span>
</span><span id="LOCM-554"><a href="#LOCM-554"><span class="linenos">554</span></a>                <span class="c1"># for each pair of transitions Ap.m and Aq.n consecutive for O</span>
</span><span id="LOCM-555"><a href="#LOCM-555"><span class="linenos">555</span></a>                <span class="k">for</span> <span class="n">Ap</span><span class="p">,</span> <span class="n">Aq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="LOCM-556"><a href="#LOCM-556"><span class="linenos">556</span></a>                    <span class="n">m</span> <span class="o">=</span> <span class="n">Ap</span><span class="o">.</span><span class="n">pos</span>
</span><span id="LOCM-557"><a href="#LOCM-557"><span class="linenos">557</span></a>                    <span class="n">n</span> <span class="o">=</span> <span class="n">Aq</span><span class="o">.</span><span class="n">pos</span>
</span><span id="LOCM-558"><a href="#LOCM-558"><span class="linenos">558</span></a>                    <span class="c1"># Check if we have a hypothesis matching Ap=B, m=k, Aq=C, n=l</span>
</span><span id="LOCM-559"><a href="#LOCM-559"><span class="linenos">559</span></a>                    <span class="n">BkCl</span> <span class="o">=</span> <span class="n">HSIndex</span><span class="p">(</span><span class="n">Ap</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Aq</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="LOCM-560"><a href="#LOCM-560"><span class="linenos">560</span></a>                    <span class="k">if</span> <span class="n">BkCl</span> <span class="ow">in</span> <span class="n">HS</span><span class="p">:</span>
</span><span id="LOCM-561"><a href="#LOCM-561"><span class="linenos">561</span></a>                        <span class="c1"># check each matching hypothesis</span>
</span><span id="LOCM-562"><a href="#LOCM-562"><span class="linenos">562</span></a>                        <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">HS</span><span class="p">[</span><span class="n">BkCl</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="LOCM-563"><a href="#LOCM-563"><span class="linenos">563</span></a>                            <span class="c1"># if Op,k&#39; = Oq,l&#39; then mark the hypothesis as supported</span>
</span><span id="LOCM-564"><a href="#LOCM-564"><span class="linenos">564</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="LOCM-565"><a href="#LOCM-565"><span class="linenos">565</span></a>                                <span class="n">Ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">[</span><span class="n">H</span><span class="o">.</span><span class="n">k_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="LOCM-566"><a href="#LOCM-566"><span class="linenos">566</span></a>                                <span class="o">==</span> <span class="n">Aq</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">[</span><span class="n">H</span><span class="o">.</span><span class="n">l_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="LOCM-567"><a href="#LOCM-567"><span class="linenos">567</span></a>                            <span class="p">):</span>
</span><span id="LOCM-568"><a href="#LOCM-568"><span class="linenos">568</span></a>                                <span class="n">H</span><span class="o">.</span><span class="n">supported</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="LOCM-569"><a href="#LOCM-569"><span class="linenos">569</span></a>                            <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise remove the hypothesis</span>
</span><span id="LOCM-570"><a href="#LOCM-570"><span class="linenos">570</span></a>                                <span class="n">HS</span><span class="p">[</span><span class="n">BkCl</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</span><span id="LOCM-571"><a href="#LOCM-571"><span class="linenos">571</span></a>
</span><span id="LOCM-572"><a href="#LOCM-572"><span class="linenos">572</span></a>        <span class="c1"># Remove any unsupported hypotheses (but yet undisputed)</span>
</span><span id="LOCM-573"><a href="#LOCM-573"><span class="linenos">573</span></a>        <span class="k">for</span> <span class="n">hind</span><span class="p">,</span> <span class="n">hs</span> <span class="ow">in</span> <span class="n">HS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-574"><a href="#LOCM-574"><span class="linenos">574</span></a>            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="LOCM-575"><a href="#LOCM-575"><span class="linenos">575</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="o">.</span><span class="n">supported</span><span class="p">:</span>
</span><span id="LOCM-576"><a href="#LOCM-576"><span class="linenos">576</span></a>                    <span class="n">hs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span><span id="LOCM-577"><a href="#LOCM-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LOCM-578"><a href="#LOCM-578"><span class="linenos">578</span></a>                <span class="k">del</span> <span class="n">HS</span><span class="p">[</span><span class="n">hind</span><span class="p">]</span>
</span><span id="LOCM-579"><a href="#LOCM-579"><span class="linenos">579</span></a>
</span><span id="LOCM-580"><a href="#LOCM-580"><span class="linenos">580</span></a>        <span class="c1"># Converts HS {HSIndex: HSItem} to a mapping of hypothesis for states of a sort {sort: {state: Hypothesis}}</span>
</span><span id="LOCM-581"><a href="#LOCM-581"><span class="linenos">581</span></a>        <span class="k">return</span> <span class="n">Hypothesis</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">HS</span><span class="p">)</span>
</span><span id="LOCM-582"><a href="#LOCM-582"><span class="linenos">582</span></a>
</span><span id="LOCM-583"><a href="#LOCM-583"><span class="linenos">583</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-584"><a href="#LOCM-584"><span class="linenos">584</span></a>    <span class="k">def</span> <span class="nf">_step4</span><span class="p">(</span><span class="n">HS</span><span class="p">:</span> <span class="n">Hypotheses</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bindings</span><span class="p">:</span>
</span><span id="LOCM-585"><a href="#LOCM-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 4: Creation and merging of state parameters&quot;&quot;&quot;</span>
</span><span id="LOCM-586"><a href="#LOCM-586"><span class="linenos">586</span></a>        <span class="c1"># bindings = {sort: {state: [(hypothesis, state param)]}}</span>
</span><span id="LOCM-587"><a href="#LOCM-587"><span class="linenos">587</span></a>        <span class="n">bindings</span><span class="p">:</span> <span class="n">Bindings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-588"><a href="#LOCM-588"><span class="linenos">588</span></a>        <span class="k">for</span> <span class="n">sort</span><span class="p">,</span> <span class="n">hs_sort</span> <span class="ow">in</span> <span class="n">HS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-589"><a href="#LOCM-589"><span class="linenos">589</span></a>            <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">hs_sort_state</span> <span class="ow">in</span> <span class="n">hs_sort</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-590"><a href="#LOCM-590"><span class="linenos">590</span></a>                <span class="c1"># state_bindings = {hypothesis (h): state param (v)}</span>
</span><span id="LOCM-591"><a href="#LOCM-591"><span class="linenos">591</span></a>                <span class="n">state_bindings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hypothesis</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LOCM-592"><a href="#LOCM-592"><span class="linenos">592</span></a>
</span><span id="LOCM-593"><a href="#LOCM-593"><span class="linenos">593</span></a>                <span class="c1"># state_params = [set(v)]; params in the same set are the same</span>
</span><span id="LOCM-594"><a href="#LOCM-594"><span class="linenos">594</span></a>                <span class="n">state_params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LOCM-595"><a href="#LOCM-595"><span class="linenos">595</span></a>
</span><span id="LOCM-596"><a href="#LOCM-596"><span class="linenos">596</span></a>                <span class="c1"># state_param_pointers = {v: P}; maps state param to the state_params set index</span>
</span><span id="LOCM-597"><a href="#LOCM-597"><span class="linenos">597</span></a>                <span class="c1"># i.e. map hypothesis state param v -&gt; actual state param P</span>
</span><span id="LOCM-598"><a href="#LOCM-598"><span class="linenos">598</span></a>                <span class="n">state_param_pointers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LOCM-599"><a href="#LOCM-599"><span class="linenos">599</span></a>
</span><span id="LOCM-600"><a href="#LOCM-600"><span class="linenos">600</span></a>                <span class="c1"># for each hypothesis h,</span>
</span><span id="LOCM-601"><a href="#LOCM-601"><span class="linenos">601</span></a>                <span class="n">hs_sort_state</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hs_sort_state</span><span class="p">)</span>
</span><span id="LOCM-602"><a href="#LOCM-602"><span class="linenos">602</span></a>                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hs_sort_state</span><span class="p">):</span>
</span><span id="LOCM-603"><a href="#LOCM-603"><span class="linenos">603</span></a>                    <span class="c1"># add the &lt;h, v&gt; binding pair</span>
</span><span id="LOCM-604"><a href="#LOCM-604"><span class="linenos">604</span></a>                    <span class="n">state_bindings</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="LOCM-605"><a href="#LOCM-605"><span class="linenos">605</span></a>                    <span class="c1"># add a param v as a unique state parameter</span>
</span><span id="LOCM-606"><a href="#LOCM-606"><span class="linenos">606</span></a>                    <span class="n">state_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">v</span><span class="p">})</span>
</span><span id="LOCM-607"><a href="#LOCM-607"><span class="linenos">607</span></a>                    <span class="n">state_param_pointers</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="LOCM-608"><a href="#LOCM-608"><span class="linenos">608</span></a>
</span><span id="LOCM-609"><a href="#LOCM-609"><span class="linenos">609</span></a>                <span class="c1"># for each (unordered) pair of hypotheses h1, h2</span>
</span><span id="LOCM-610"><a href="#LOCM-610"><span class="linenos">610</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hs_sort_state</span><span class="p">):</span>
</span><span id="LOCM-611"><a href="#LOCM-611"><span class="linenos">611</span></a>                    <span class="k">for</span> <span class="n">h2</span> <span class="ow">in</span> <span class="n">hs_sort_state</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]:</span>
</span><span id="LOCM-612"><a href="#LOCM-612"><span class="linenos">612</span></a>                        <span class="c1"># check if hypothesis parameters (v1 &amp; v2) need to be unified</span>
</span><span id="LOCM-613"><a href="#LOCM-613"><span class="linenos">613</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="LOCM-614"><a href="#LOCM-614"><span class="linenos">614</span></a>                            <span class="p">(</span><span class="n">h1</span><span class="o">.</span><span class="n">B</span> <span class="o">==</span> <span class="n">h2</span><span class="o">.</span><span class="n">B</span> <span class="ow">and</span> <span class="n">h1</span><span class="o">.</span><span class="n">k</span> <span class="o">==</span> <span class="n">h2</span><span class="o">.</span><span class="n">k</span> <span class="ow">and</span> <span class="n">h1</span><span class="o">.</span><span class="n">k_</span> <span class="o">==</span> <span class="n">h2</span><span class="o">.</span><span class="n">k_</span><span class="p">)</span>
</span><span id="LOCM-615"><a href="#LOCM-615"><span class="linenos">615</span></a>                                    <span class="ow">or</span>   <span class="c1"># See https://github.com/AI-Planning/macq/discussions/200</span>
</span><span id="LOCM-616"><a href="#LOCM-616"><span class="linenos">616</span></a>                            <span class="p">(</span><span class="n">h1</span><span class="o">.</span><span class="n">C</span> <span class="o">==</span> <span class="n">h2</span><span class="o">.</span><span class="n">C</span> <span class="ow">and</span> <span class="n">h1</span><span class="o">.</span><span class="n">l</span> <span class="o">==</span> <span class="n">h2</span><span class="o">.</span><span class="n">l</span> <span class="ow">and</span> <span class="n">h1</span><span class="o">.</span><span class="n">l_</span> <span class="o">==</span> <span class="n">h2</span><span class="o">.</span><span class="n">l_</span><span class="p">)</span>  <span class="c1"># fmt: skip</span>
</span><span id="LOCM-617"><a href="#LOCM-617"><span class="linenos">617</span></a>                        <span class="p">):</span>
</span><span id="LOCM-618"><a href="#LOCM-618"><span class="linenos">618</span></a>                            <span class="n">v1</span> <span class="o">=</span> <span class="n">state_bindings</span><span class="p">[</span><span class="n">h1</span><span class="p">]</span>
</span><span id="LOCM-619"><a href="#LOCM-619"><span class="linenos">619</span></a>                            <span class="n">v2</span> <span class="o">=</span> <span class="n">state_bindings</span><span class="p">[</span><span class="n">h2</span><span class="p">]</span>
</span><span id="LOCM-620"><a href="#LOCM-620"><span class="linenos">620</span></a>
</span><span id="LOCM-621"><a href="#LOCM-621"><span class="linenos">621</span></a>                            <span class="c1"># get the parameter sets P1, P2 that v1, v2 belong to</span>
</span><span id="LOCM-622"><a href="#LOCM-622"><span class="linenos">622</span></a>                            <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_pointer_to_set</span><span class="p">(</span><span class="n">state_params</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
</span><span id="LOCM-623"><a href="#LOCM-623"><span class="linenos">623</span></a>
</span><span id="LOCM-624"><a href="#LOCM-624"><span class="linenos">624</span></a>                            <span class="k">if</span> <span class="n">P1</span> <span class="o">!=</span> <span class="n">P2</span><span class="p">:</span>
</span><span id="LOCM-625"><a href="#LOCM-625"><span class="linenos">625</span></a>                                <span class="c1"># merge P1 and P2</span>
</span><span id="LOCM-626"><a href="#LOCM-626"><span class="linenos">626</span></a>                                <span class="n">state_params</span><span class="p">[</span><span class="n">P1</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_params</span><span class="p">[</span><span class="n">P1</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
</span><span id="LOCM-627"><a href="#LOCM-627"><span class="linenos">627</span></a>                                    <span class="n">state_params</span><span class="p">[</span><span class="n">P2</span><span class="p">]</span>
</span><span id="LOCM-628"><a href="#LOCM-628"><span class="linenos">628</span></a>                                <span class="p">)</span>
</span><span id="LOCM-629"><a href="#LOCM-629"><span class="linenos">629</span></a>                                <span class="n">state_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">P2</span><span class="p">)</span>
</span><span id="LOCM-630"><a href="#LOCM-630"><span class="linenos">630</span></a>                                <span class="n">state_param_pointers</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="n">P1</span>
</span><span id="LOCM-631"><a href="#LOCM-631"><span class="linenos">631</span></a>
</span><span id="LOCM-632"><a href="#LOCM-632"><span class="linenos">632</span></a>                                <span class="c1"># fix state_param_pointers after v2</span>
</span><span id="LOCM-633"><a href="#LOCM-633"><span class="linenos">633</span></a>                                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_param_pointers</span><span class="p">)):</span>
</span><span id="LOCM-634"><a href="#LOCM-634"><span class="linenos">634</span></a>                                    <span class="n">state_param_pointers</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="LOCM-635"><a href="#LOCM-635"><span class="linenos">635</span></a>
</span><span id="LOCM-636"><a href="#LOCM-636"><span class="linenos">636</span></a>                <span class="c1"># add state bindings for the sort to the output bindings</span>
</span><span id="LOCM-637"><a href="#LOCM-637"><span class="linenos">637</span></a>                <span class="c1"># replacing hypothesis params with actual state params</span>
</span><span id="LOCM-638"><a href="#LOCM-638"><span class="linenos">638</span></a>                <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LOCM-639"><a href="#LOCM-639"><span class="linenos">639</span></a>                    <span class="n">Binding</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_pointer_to_set</span><span class="p">(</span><span class="n">state_params</span><span class="p">,</span> <span class="n">v</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="LOCM-640"><a href="#LOCM-640"><span class="linenos">640</span></a>                    <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state_bindings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="LOCM-641"><a href="#LOCM-641"><span class="linenos">641</span></a>                <span class="p">]</span>
</span><span id="LOCM-642"><a href="#LOCM-642"><span class="linenos">642</span></a>
</span><span id="LOCM-643"><a href="#LOCM-643"><span class="linenos">643</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bindings</span><span class="p">)</span>
</span><span id="LOCM-644"><a href="#LOCM-644"><span class="linenos">644</span></a>
</span><span id="LOCM-645"><a href="#LOCM-645"><span class="linenos">645</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-646"><a href="#LOCM-646"><span class="linenos">646</span></a>    <span class="k">def</span> <span class="nf">_step5</span><span class="p">(</span>
</span><span id="LOCM-647"><a href="#LOCM-647"><span class="linenos">647</span></a>        <span class="n">HS</span><span class="p">:</span> <span class="n">Hypotheses</span><span class="p">,</span>
</span><span id="LOCM-648"><a href="#LOCM-648"><span class="linenos">648</span></a>        <span class="n">bindings</span><span class="p">:</span> <span class="n">Bindings</span><span class="p">,</span>
</span><span id="LOCM-649"><a href="#LOCM-649"><span class="linenos">649</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-650"><a href="#LOCM-650"><span class="linenos">650</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bindings</span><span class="p">:</span>
</span><span id="LOCM-651"><a href="#LOCM-651"><span class="linenos">651</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 5: Removing parameter flaws&quot;&quot;&quot;</span>
</span><span id="LOCM-652"><a href="#LOCM-652"><span class="linenos">652</span></a>
</span><span id="LOCM-653"><a href="#LOCM-653"><span class="linenos">653</span></a>        <span class="c1"># check each bindings[G][S] -&gt; (h, P)</span>
</span><span id="LOCM-654"><a href="#LOCM-654"><span class="linenos">654</span></a>        <span class="k">for</span> <span class="n">sort</span><span class="p">,</span> <span class="n">hs_sort</span> <span class="ow">in</span> <span class="n">HS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-655"><a href="#LOCM-655"><span class="linenos">655</span></a>            <span class="k">for</span> <span class="n">state_id</span> <span class="ow">in</span> <span class="n">hs_sort</span><span class="p">:</span>
</span><span id="LOCM-656"><a href="#LOCM-656"><span class="linenos">656</span></a>                <span class="c1"># track all the h.Bs that occur in bindings[G][S]</span>
</span><span id="LOCM-657"><a href="#LOCM-657"><span class="linenos">657</span></a>                <span class="n">all_hB</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LOCM-658"><a href="#LOCM-658"><span class="linenos">658</span></a>                <span class="c1"># track the set of h.B that set parameter P</span>
</span><span id="LOCM-659"><a href="#LOCM-659"><span class="linenos">659</span></a>                <span class="n">sets_P</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
</span><span id="LOCM-660"><a href="#LOCM-660"><span class="linenos">660</span></a>                <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]:</span>
</span><span id="LOCM-661"><a href="#LOCM-661"><span class="linenos">661</span></a>                    <span class="n">sets_P</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
</span><span id="LOCM-662"><a href="#LOCM-662"><span class="linenos">662</span></a>                    <span class="n">all_hB</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
</span><span id="LOCM-663"><a href="#LOCM-663"><span class="linenos">663</span></a>
</span><span id="LOCM-664"><a href="#LOCM-664"><span class="linenos">664</span></a>                <span class="c1"># for each P, check if there is a transition h.B that never sets parameter P</span>
</span><span id="LOCM-665"><a href="#LOCM-665"><span class="linenos">665</span></a>                <span class="c1"># i.e. if sets_P[P] != all_hB</span>
</span><span id="LOCM-666"><a href="#LOCM-666"><span class="linenos">666</span></a>                <span class="k">for</span> <span class="n">P</span><span class="p">,</span> <span class="n">setby</span> <span class="ow">in</span> <span class="n">sets_P</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-667"><a href="#LOCM-667"><span class="linenos">667</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">setby</span> <span class="o">==</span> <span class="n">all_hB</span><span class="p">:</span>  <span class="c1"># P is a flawed parameter</span>
</span><span id="LOCM-668"><a href="#LOCM-668"><span class="linenos">668</span></a>                        <span class="c1"># remove all bindings referencing P</span>
</span><span id="LOCM-669"><a href="#LOCM-669"><span class="linenos">669</span></a>                        <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">P_</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="LOCM-670"><a href="#LOCM-670"><span class="linenos">670</span></a>                            <span class="k">if</span> <span class="n">P_</span> <span class="o">==</span> <span class="n">P</span><span class="p">:</span>
</span><span id="LOCM-671"><a href="#LOCM-671"><span class="linenos">671</span></a>                                <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">Binding</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">P_</span><span class="p">))</span>
</span><span id="LOCM-672"><a href="#LOCM-672"><span class="linenos">672</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LOCM-673"><a href="#LOCM-673"><span class="linenos">673</span></a>                            <span class="k">del</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]</span>
</span><span id="LOCM-674"><a href="#LOCM-674"><span class="linenos">674</span></a>
</span><span id="LOCM-675"><a href="#LOCM-675"><span class="linenos">675</span></a>                <span class="c1"># do the same for checking h.C reading parameter P</span>
</span><span id="LOCM-676"><a href="#LOCM-676"><span class="linenos">676</span></a>                <span class="c1"># See https://github.com/AI-Planning/macq/discussions/200</span>
</span><span id="LOCM-677"><a href="#LOCM-677"><span class="linenos">677</span></a>                <span class="n">all_hC</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LOCM-678"><a href="#LOCM-678"><span class="linenos">678</span></a>                <span class="n">reads_P</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
</span><span id="LOCM-679"><a href="#LOCM-679"><span class="linenos">679</span></a>                <span class="k">if</span> <span class="n">state_id</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">]:</span>
</span><span id="LOCM-680"><a href="#LOCM-680"><span class="linenos">680</span></a>                    <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]:</span>
</span><span id="LOCM-681"><a href="#LOCM-681"><span class="linenos">681</span></a>                        <span class="n">reads_P</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span><span id="LOCM-682"><a href="#LOCM-682"><span class="linenos">682</span></a>                        <span class="n">all_hC</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span><span id="LOCM-683"><a href="#LOCM-683"><span class="linenos">683</span></a>                    <span class="k">for</span> <span class="n">P</span><span class="p">,</span> <span class="n">readby</span> <span class="ow">in</span> <span class="n">reads_P</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-684"><a href="#LOCM-684"><span class="linenos">684</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">readby</span> <span class="o">==</span> <span class="n">all_hC</span><span class="p">:</span>
</span><span id="LOCM-685"><a href="#LOCM-685"><span class="linenos">685</span></a>                            <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">P_</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
</span><span id="LOCM-686"><a href="#LOCM-686"><span class="linenos">686</span></a>                                <span class="k">if</span> <span class="n">P_</span> <span class="o">==</span> <span class="n">P</span><span class="p">:</span>
</span><span id="LOCM-687"><a href="#LOCM-687"><span class="linenos">687</span></a>                                    <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">Binding</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">P_</span><span class="p">))</span>
</span><span id="LOCM-688"><a href="#LOCM-688"><span class="linenos">688</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LOCM-689"><a href="#LOCM-689"><span class="linenos">689</span></a>                                <span class="k">del</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state_id</span><span class="p">]</span>
</span><span id="LOCM-690"><a href="#LOCM-690"><span class="linenos">690</span></a>
</span><span id="LOCM-691"><a href="#LOCM-691"><span class="linenos">691</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bindings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-692"><a href="#LOCM-692"><span class="linenos">692</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
</span><span id="LOCM-693"><a href="#LOCM-693"><span class="linenos">693</span></a>                <span class="k">del</span> <span class="n">bindings</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="LOCM-694"><a href="#LOCM-694"><span class="linenos">694</span></a>
</span><span id="LOCM-695"><a href="#LOCM-695"><span class="linenos">695</span></a>        <span class="k">return</span> <span class="n">bindings</span>
</span><span id="LOCM-696"><a href="#LOCM-696"><span class="linenos">696</span></a>
</span><span id="LOCM-697"><a href="#LOCM-697"><span class="linenos">697</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-698"><a href="#LOCM-698"><span class="linenos">698</span></a>    <span class="k">def</span> <span class="nf">_debug_state_machines</span><span class="p">(</span><span class="n">OS</span><span class="p">,</span> <span class="n">ap_state_pointers</span><span class="p">,</span> <span class="n">state_params</span><span class="p">):</span>
</span><span id="LOCM-699"><a href="#LOCM-699"><span class="linenos">699</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="LOCM-700"><a href="#LOCM-700"><span class="linenos">700</span></a>
</span><span id="LOCM-701"><a href="#LOCM-701"><span class="linenos">701</span></a>        <span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span><span id="LOCM-702"><a href="#LOCM-702"><span class="linenos">702</span></a>
</span><span id="LOCM-703"><a href="#LOCM-703"><span class="linenos">703</span></a>        <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">OS</span><span class="p">:</span>
</span><span id="LOCM-704"><a href="#LOCM-704"><span class="linenos">704</span></a>            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="LOCM-705"><a href="#LOCM-705"><span class="linenos">705</span></a>            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">])):</span>
</span><span id="LOCM-706"><a href="#LOCM-706"><span class="linenos">706</span></a>                <span class="n">lbl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;state</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-707"><a href="#LOCM-707"><span class="linenos">707</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="LOCM-708"><a href="#LOCM-708"><span class="linenos">708</span></a>                    <span class="n">state_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="LOCM-709"><a href="#LOCM-709"><span class="linenos">709</span></a>                    <span class="ow">and</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">state_params</span>
</span><span id="LOCM-710"><a href="#LOCM-710"><span class="linenos">710</span></a>                    <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">state_params</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span>
</span><span id="LOCM-711"><a href="#LOCM-711"><span class="linenos">711</span></a>                <span class="p">):</span>
</span><span id="LOCM-712"><a href="#LOCM-712"><span class="linenos">712</span></a>                    <span class="n">lbl</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="LOCM-713"><a href="#LOCM-713"><span class="linenos">713</span></a>                        <span class="p">[</span>
</span><span id="LOCM-714"><a href="#LOCM-714"><span class="linenos">714</span></a>                            <span class="n">state_params</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
</span><span id="LOCM-715"><a href="#LOCM-715"><span class="linenos">715</span></a>                            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_params</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="LOCM-716"><a href="#LOCM-716"><span class="linenos">716</span></a>                        <span class="p">]</span>
</span><span id="LOCM-717"><a href="#LOCM-717"><span class="linenos">717</span></a>                    <span class="p">)</span>
</span><span id="LOCM-718"><a href="#LOCM-718"><span class="linenos">718</span></a>                <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;oval&quot;</span><span class="p">)</span>
</span><span id="LOCM-719"><a href="#LOCM-719"><span class="linenos">719</span></a>            <span class="k">for</span> <span class="n">ap</span><span class="p">,</span> <span class="n">apstate</span> <span class="ow">in</span> <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM-720"><a href="#LOCM-720"><span class="linenos">720</span></a>                <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_pointer_to_set</span><span class="p">(</span>
</span><span id="LOCM-721"><a href="#LOCM-721"><span class="linenos">721</span></a>                    <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">apstate</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">apstate</span><span class="o">.</span><span class="n">end</span>
</span><span id="LOCM-722"><a href="#LOCM-722"><span class="linenos">722</span></a>                <span class="p">)</span>
</span><span id="LOCM-723"><a href="#LOCM-723"><span class="linenos">723</span></a>                <span class="c1"># check if edge is already in graph</span>
</span><span id="LOCM-724"><a href="#LOCM-724"><span class="linenos">724</span></a>                <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">):</span>
</span><span id="LOCM-725"><a href="#LOCM-725"><span class="linenos">725</span></a>                    <span class="c1"># append to the edge label</span>
</span><span id="LOCM-726"><a href="#LOCM-726"><span class="linenos">726</span></a>                    <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">][</span>
</span><span id="LOCM-727"><a href="#LOCM-727"><span class="linenos">727</span></a>                        <span class="s2">&quot;label&quot;</span>
</span><span id="LOCM-728"><a href="#LOCM-728"><span class="linenos">728</span></a>                    <span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ap</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-729"><a href="#LOCM-729"><span class="linenos">729</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LOCM-730"><a href="#LOCM-730"><span class="linenos">730</span></a>                    <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ap</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-731"><a href="#LOCM-731"><span class="linenos">731</span></a>            <span class="c1"># write to dot file</span>
</span><span id="LOCM-732"><a href="#LOCM-732"><span class="linenos">732</span></a>            <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">write_dot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;LOCM-step7-sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">.dot&quot;</span><span class="p">)</span>
</span><span id="LOCM-733"><a href="#LOCM-733"><span class="linenos">733</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span>
</span><span id="LOCM-734"><a href="#LOCM-734"><span class="linenos">734</span></a>                <span class="sa">f</span><span class="s2">&quot;dot -Tpng LOCM-step7-sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">.dot -o LOCM-step7-sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="LOCM-735"><a href="#LOCM-735"><span class="linenos">735</span></a>            <span class="p">)</span>
</span><span id="LOCM-736"><a href="#LOCM-736"><span class="linenos">736</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rm LOCM-step7-sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">.dot&quot;</span><span class="p">)</span>
</span><span id="LOCM-737"><a href="#LOCM-737"><span class="linenos">737</span></a>
</span><span id="LOCM-738"><a href="#LOCM-738"><span class="linenos">738</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LOCM-739"><a href="#LOCM-739"><span class="linenos">739</span></a>    <span class="k">def</span> <span class="nf">_step7</span><span class="p">(</span>
</span><span id="LOCM-740"><a href="#LOCM-740"><span class="linenos">740</span></a>        <span class="n">OS</span><span class="p">:</span> <span class="n">OSType</span><span class="p">,</span>
</span><span id="LOCM-741"><a href="#LOCM-741"><span class="linenos">741</span></a>        <span class="n">ap_state_pointers</span><span class="p">:</span> <span class="n">APStatePointers</span><span class="p">,</span>
</span><span id="LOCM-742"><a href="#LOCM-742"><span class="linenos">742</span></a>        <span class="n">sorts</span><span class="p">:</span> <span class="n">Sorts</span><span class="p">,</span>
</span><span id="LOCM-743"><a href="#LOCM-743"><span class="linenos">743</span></a>        <span class="n">bindings</span><span class="p">:</span> <span class="n">Bindings</span><span class="p">,</span>
</span><span id="LOCM-744"><a href="#LOCM-744"><span class="linenos">744</span></a>        <span class="n">statics</span><span class="p">:</span> <span class="n">Statics</span><span class="p">,</span>
</span><span id="LOCM-745"><a href="#LOCM-745"><span class="linenos">745</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-746"><a href="#LOCM-746"><span class="linenos">746</span></a>        <span class="n">viz</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM-747"><a href="#LOCM-747"><span class="linenos">747</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedFluent</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n">LearnedLiftedAction</span><span class="p">]]:</span>
</span><span id="LOCM-748"><a href="#LOCM-748"><span class="linenos">748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step 7: Formation of PDDL action schema</span>
</span><span id="LOCM-749"><a href="#LOCM-749"><span class="linenos">749</span></a><span class="sd">        Implicitly includes Step 6 (statics) by including statics as an argument</span>
</span><span id="LOCM-750"><a href="#LOCM-750"><span class="linenos">750</span></a><span class="sd">        and adding to the relevant actions while being constructed.</span>
</span><span id="LOCM-751"><a href="#LOCM-751"><span class="linenos">751</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LOCM-752"><a href="#LOCM-752"><span class="linenos">752</span></a>
</span><span id="LOCM-753"><a href="#LOCM-753"><span class="linenos">753</span></a>        <span class="c1"># delete zero-object if it&#39;s state machine was discarded</span>
</span><span id="LOCM-754"><a href="#LOCM-754"><span class="linenos">754</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">OS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="LOCM-755"><a href="#LOCM-755"><span class="linenos">755</span></a>            <span class="k">del</span> <span class="n">OS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LOCM-756"><a href="#LOCM-756"><span class="linenos">756</span></a>            <span class="k">del</span> <span class="n">ap_state_pointers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LOCM-757"><a href="#LOCM-757"><span class="linenos">757</span></a>
</span><span id="LOCM-758"><a href="#LOCM-758"><span class="linenos">758</span></a>        <span class="c1"># all_aps = {action_name: [AP]}</span>
</span><span id="LOCM-759"><a href="#LOCM-759"><span class="linenos">759</span></a>        <span class="n">all_aps</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">AP</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="LOCM-760"><a href="#LOCM-760"><span class="linenos">760</span></a>        <span class="k">for</span> <span class="n">aps</span> <span class="ow">in</span> <span class="n">ap_state_pointers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="LOCM-761"><a href="#LOCM-761"><span class="linenos">761</span></a>            <span class="k">for</span> <span class="n">ap</span> <span class="ow">in</span> <span class="n">aps</span><span class="p">:</span>
</span><span id="LOCM-762"><a href="#LOCM-762"><span class="linenos">762</span></a>                <span class="n">all_aps</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</span><span id="LOCM-763"><a href="#LOCM-763"><span class="linenos">763</span></a>
</span><span id="LOCM-764"><a href="#LOCM-764"><span class="linenos">764</span></a>        <span class="n">state_params</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-765"><a href="#LOCM-765"><span class="linenos">765</span></a>        <span class="n">state_params_to_hyps</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-766"><a href="#LOCM-766"><span class="linenos">766</span></a>        <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">:</span>
</span><span id="LOCM-767"><a href="#LOCM-767"><span class="linenos">767</span></a>            <span class="n">state_params</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-768"><a href="#LOCM-768"><span class="linenos">768</span></a>            <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-769"><a href="#LOCM-769"><span class="linenos">769</span></a>            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">]:</span>
</span><span id="LOCM-770"><a href="#LOCM-770"><span class="linenos">770</span></a>                <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="o">.</span><span class="n">param</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state</span><span class="p">]}</span>
</span><span id="LOCM-771"><a href="#LOCM-771"><span class="linenos">771</span></a>                <span class="n">typ</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LOCM-772"><a href="#LOCM-772"><span class="linenos">772</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="LOCM-773"><a href="#LOCM-773"><span class="linenos">773</span></a>                    <span class="n">hyps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LOCM-774"><a href="#LOCM-774"><span class="linenos">774</span></a>                        <span class="n">b</span><span class="o">.</span><span class="n">hypothesis</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state</span><span class="p">]</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="n">key</span>
</span><span id="LOCM-775"><a href="#LOCM-775"><span class="linenos">775</span></a>                    <span class="p">]</span>
</span><span id="LOCM-776"><a href="#LOCM-776"><span class="linenos">776</span></a>                    <span class="c1"># assert that all are the same G_</span>
</span><span id="LOCM-777"><a href="#LOCM-777"><span class="linenos">777</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">h</span><span class="o">.</span><span class="n">G_</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hyps</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="LOCM-778"><a href="#LOCM-778"><span class="linenos">778</span></a>                    <span class="n">state_params</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">G_</span>
</span><span id="LOCM-779"><a href="#LOCM-779"><span class="linenos">779</span></a>                    <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">state</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyps</span>
</span><span id="LOCM-780"><a href="#LOCM-780"><span class="linenos">780</span></a>
</span><span id="LOCM-781"><a href="#LOCM-781"><span class="linenos">781</span></a>        <span class="k">if</span> <span class="n">viz</span><span class="p">:</span>
</span><span id="LOCM-782"><a href="#LOCM-782"><span class="linenos">782</span></a>            <span class="n">LOCM</span><span class="o">.</span><span class="n">_debug_state_machines</span><span class="p">(</span><span class="n">OS</span><span class="p">,</span> <span class="n">ap_state_pointers</span><span class="p">,</span> <span class="n">state_params</span><span class="p">)</span>
</span><span id="LOCM-783"><a href="#LOCM-783"><span class="linenos">783</span></a>
</span><span id="LOCM-784"><a href="#LOCM-784"><span class="linenos">784</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="LOCM-785"><a href="#LOCM-785"><span class="linenos">785</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LOCM-786"><a href="#LOCM-786"><span class="linenos">786</span></a>        <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">ap_state_pointers</span><span class="p">:</span>
</span><span id="LOCM-787"><a href="#LOCM-787"><span class="linenos">787</span></a>            <span class="n">sort_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-788"><a href="#LOCM-788"><span class="linenos">788</span></a>            <span class="k">for</span> <span class="n">ap</span> <span class="ow">in</span> <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">sort</span><span class="p">]:</span>
</span><span id="LOCM-789"><a href="#LOCM-789"><span class="linenos">789</span></a>                <span class="k">if</span> <span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
</span><span id="LOCM-790"><a href="#LOCM-790"><span class="linenos">790</span></a>                    <span class="n">actions</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">LearnedLiftedAction</span><span class="p">(</span>
</span><span id="LOCM-791"><a href="#LOCM-791"><span class="linenos">791</span></a>                        <span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="LOCM-792"><a href="#LOCM-792"><span class="linenos">792</span></a>                        <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_aps</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]))],</span>  <span class="c1"># type: ignore</span>
</span><span id="LOCM-793"><a href="#LOCM-793"><span class="linenos">793</span></a>                    <span class="p">)</span>
</span><span id="LOCM-794"><a href="#LOCM-794"><span class="linenos">794</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="LOCM-795"><a href="#LOCM-795"><span class="linenos">795</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">param_sorts</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_str</span>
</span><span id="LOCM-796"><a href="#LOCM-796"><span class="linenos">796</span></a>
</span><span id="LOCM-797"><a href="#LOCM-797"><span class="linenos">797</span></a>                <span class="n">start_pointer</span><span class="p">,</span> <span class="n">end_pointer</span> <span class="o">=</span> <span class="n">ap_state_pointers</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">ap</span><span class="p">]</span>
</span><span id="LOCM-798"><a href="#LOCM-798"><span class="linenos">798</span></a>                <span class="n">start_state</span><span class="p">,</span> <span class="n">end_state</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_pointer_to_set</span><span class="p">(</span>
</span><span id="LOCM-799"><a href="#LOCM-799"><span class="linenos">799</span></a>                    <span class="n">OS</span><span class="p">[</span><span class="n">sort</span><span class="p">],</span> <span class="n">start_pointer</span><span class="p">,</span> <span class="n">end_pointer</span>
</span><span id="LOCM-800"><a href="#LOCM-800"><span class="linenos">800</span></a>                <span class="p">)</span>
</span><span id="LOCM-801"><a href="#LOCM-801"><span class="linenos">801</span></a>
</span><span id="LOCM-802"><a href="#LOCM-802"><span class="linenos">802</span></a>                <span class="n">start_fluent_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">_state</span><span class="si">{</span><span class="n">start_state</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-803"><a href="#LOCM-803"><span class="linenos">803</span></a>                <span class="k">if</span> <span class="n">start_fluent_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fluents</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
</span><span id="LOCM-804"><a href="#LOCM-804"><span class="linenos">804</span></a>                    <span class="n">start_fluent</span> <span class="o">=</span> <span class="n">LearnedLiftedFluent</span><span class="p">(</span>
</span><span id="LOCM-805"><a href="#LOCM-805"><span class="linenos">805</span></a>                        <span class="n">start_fluent_name</span><span class="p">,</span>
</span><span id="LOCM-806"><a href="#LOCM-806"><span class="linenos">806</span></a>                        <span class="n">param_sorts</span><span class="o">=</span><span class="p">[</span><span class="n">sort_str</span><span class="p">],</span>
</span><span id="LOCM-807"><a href="#LOCM-807"><span class="linenos">807</span></a>                        <span class="n">param_act_inds</span><span class="o">=</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="LOCM-808"><a href="#LOCM-808"><span class="linenos">808</span></a>                    <span class="p">)</span>
</span><span id="LOCM-809"><a href="#LOCM-809"><span class="linenos">809</span></a>                    <span class="n">fluents</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">start_fluent_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_fluent</span>
</span><span id="LOCM-810"><a href="#LOCM-810"><span class="linenos">810</span></a>
</span><span id="LOCM-811"><a href="#LOCM-811"><span class="linenos">811</span></a>                <span class="n">start_fluent</span> <span class="o">=</span> <span class="n">fluents</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">start_fluent_name</span><span class="p">]</span>
</span><span id="LOCM-812"><a href="#LOCM-812"><span class="linenos">812</span></a>
</span><span id="LOCM-813"><a href="#LOCM-813"><span class="linenos">813</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="LOCM-814"><a href="#LOCM-814"><span class="linenos">814</span></a>                    <span class="n">sort</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span>
</span><span id="LOCM-815"><a href="#LOCM-815"><span class="linenos">815</span></a>                    <span class="ow">and</span> <span class="n">start_state</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span>
</span><span id="LOCM-816"><a href="#LOCM-816"><span class="linenos">816</span></a>                <span class="p">):</span>
</span><span id="LOCM-817"><a href="#LOCM-817"><span class="linenos">817</span></a>                    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">start_state</span><span class="p">]:</span>
</span><span id="LOCM-818"><a href="#LOCM-818"><span class="linenos">818</span></a>                        <span class="n">psort</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LOCM-819"><a href="#LOCM-819"><span class="linenos">819</span></a>                        <span class="n">pind</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LOCM-820"><a href="#LOCM-820"><span class="linenos">820</span></a>                        <span class="k">for</span> <span class="n">hyp</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">start_state</span><span class="p">][</span><span class="n">param</span><span class="p">]:</span>
</span><span id="LOCM-821"><a href="#LOCM-821"><span class="linenos">821</span></a>                            <span class="k">if</span> <span class="n">hyp</span><span class="o">.</span><span class="n">C</span> <span class="o">==</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="LOCM-822"><a href="#LOCM-822"><span class="linenos">822</span></a>                                <span class="k">if</span> <span class="p">(</span><span class="n">psort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">psort</span> <span class="o">!=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">G_</span><span class="p">)</span> <span class="ow">or</span> \
</span><span id="LOCM-823"><a href="#LOCM-823"><span class="linenos">823</span></a>                                   <span class="p">(</span><span class="n">pind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pind</span> <span class="o">!=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">l_</span><span class="p">):</span>
</span><span id="LOCM-824"><a href="#LOCM-824"><span class="linenos">824</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Error: The following set of hypotheses for sort </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2"> and state </span><span class="si">{</span><span class="n">start_state</span><span class="si">}</span><span class="s2"> are not consistent (ap = </span><span class="si">{</span><span class="n">ap</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
</span><span id="LOCM-825"><a href="#LOCM-825"><span class="linenos">825</span></a>                                    <span class="k">for</span> <span class="n">hyp</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">start_state</span><span class="p">][</span><span class="n">param</span><span class="p">]:</span>
</span><span id="LOCM-826"><a href="#LOCM-826"><span class="linenos">826</span></a>                                        <span class="k">if</span> <span class="n">hyp</span><span class="o">.</span><span class="n">C</span> <span class="o">==</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="LOCM-827"><a href="#LOCM-827"><span class="linenos">827</span></a>                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="si">{</span><span class="n">hyp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-828"><a href="#LOCM-828"><span class="linenos">828</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"> This domain cannot be handled by LOCMv1. Please see https://github.com/AI-Planning/macq/discussions/200 for more info.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-829"><a href="#LOCM-829"><span class="linenos">829</span></a>                                    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LOCM-830"><a href="#LOCM-830"><span class="linenos">830</span></a>                                <span class="k">assert</span> <span class="n">psort</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">psort</span> <span class="o">==</span> <span class="n">hyp</span><span class="o">.</span><span class="n">G_</span>
</span><span id="LOCM-831"><a href="#LOCM-831"><span class="linenos">831</span></a>                                <span class="k">assert</span> <span class="n">pind</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pind</span> <span class="o">==</span> <span class="n">hyp</span><span class="o">.</span><span class="n">l_</span>
</span><span id="LOCM-832"><a href="#LOCM-832"><span class="linenos">832</span></a>                                <span class="n">psort</span> <span class="o">=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">G_</span>
</span><span id="LOCM-833"><a href="#LOCM-833"><span class="linenos">833</span></a>                                <span class="n">pind</span> <span class="o">=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">l_</span>
</span><span id="LOCM-834"><a href="#LOCM-834"><span class="linenos">834</span></a>                        <span class="k">if</span> <span class="n">psort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LOCM-835"><a href="#LOCM-835"><span class="linenos">835</span></a>                            <span class="n">start_fluent</span><span class="o">.</span><span class="n">param_sorts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sort</span><span class="si">{</span><span class="n">psort</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-836"><a href="#LOCM-836"><span class="linenos">836</span></a>                            <span class="n">start_fluent</span><span class="o">.</span><span class="n">param_act_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="LOCM-837"><a href="#LOCM-837"><span class="linenos">837</span></a>
</span><span id="LOCM-838"><a href="#LOCM-838"><span class="linenos">838</span></a>                <span class="n">a</span><span class="o">.</span><span class="n">update_precond</span><span class="p">(</span><span class="n">start_fluent</span><span class="p">)</span>
</span><span id="LOCM-839"><a href="#LOCM-839"><span class="linenos">839</span></a>
</span><span id="LOCM-840"><a href="#LOCM-840"><span class="linenos">840</span></a>                <span class="k">if</span> <span class="n">end_state</span> <span class="o">!=</span> <span class="n">start_state</span><span class="p">:</span>
</span><span id="LOCM-841"><a href="#LOCM-841"><span class="linenos">841</span></a>                    <span class="n">end_fluent_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sort</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">_state</span><span class="si">{</span><span class="n">end_state</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LOCM-842"><a href="#LOCM-842"><span class="linenos">842</span></a>                    <span class="k">if</span> <span class="n">end_fluent_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fluents</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
</span><span id="LOCM-843"><a href="#LOCM-843"><span class="linenos">843</span></a>                        <span class="n">end_fluent</span> <span class="o">=</span> <span class="n">LearnedLiftedFluent</span><span class="p">(</span>
</span><span id="LOCM-844"><a href="#LOCM-844"><span class="linenos">844</span></a>                            <span class="n">end_fluent_name</span><span class="p">,</span>
</span><span id="LOCM-845"><a href="#LOCM-845"><span class="linenos">845</span></a>                            <span class="n">param_sorts</span><span class="o">=</span><span class="p">[</span><span class="n">sort_str</span><span class="p">],</span>
</span><span id="LOCM-846"><a href="#LOCM-846"><span class="linenos">846</span></a>                            <span class="n">param_act_inds</span><span class="o">=</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="LOCM-847"><a href="#LOCM-847"><span class="linenos">847</span></a>                        <span class="p">)</span>
</span><span id="LOCM-848"><a href="#LOCM-848"><span class="linenos">848</span></a>                        <span class="n">fluents</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">end_fluent_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_fluent</span>
</span><span id="LOCM-849"><a href="#LOCM-849"><span class="linenos">849</span></a>
</span><span id="LOCM-850"><a href="#LOCM-850"><span class="linenos">850</span></a>                    <span class="n">end_fluent</span> <span class="o">=</span> <span class="n">fluents</span><span class="p">[</span><span class="n">ap</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">end_fluent_name</span><span class="p">]</span>
</span><span id="LOCM-851"><a href="#LOCM-851"><span class="linenos">851</span></a>
</span><span id="LOCM-852"><a href="#LOCM-852"><span class="linenos">852</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="LOCM-853"><a href="#LOCM-853"><span class="linenos">853</span></a>                        <span class="n">sort</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span>
</span><span id="LOCM-854"><a href="#LOCM-854"><span class="linenos">854</span></a>                        <span class="ow">and</span> <span class="n">end_state</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">]</span>
</span><span id="LOCM-855"><a href="#LOCM-855"><span class="linenos">855</span></a>                    <span class="p">):</span>
</span><span id="LOCM-856"><a href="#LOCM-856"><span class="linenos">856</span></a>                        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">end_state</span><span class="p">]:</span>
</span><span id="LOCM-857"><a href="#LOCM-857"><span class="linenos">857</span></a>                            <span class="n">psort</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LOCM-858"><a href="#LOCM-858"><span class="linenos">858</span></a>                            <span class="n">pind</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LOCM-859"><a href="#LOCM-859"><span class="linenos">859</span></a>                            <span class="k">for</span> <span class="n">hyp</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">end_state</span><span class="p">][</span><span class="n">param</span><span class="p">]:</span>
</span><span id="LOCM-860"><a href="#LOCM-860"><span class="linenos">860</span></a>                                <span class="k">if</span> <span class="n">hyp</span><span class="o">.</span><span class="n">B</span> <span class="o">==</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="LOCM-861"><a href="#LOCM-861"><span class="linenos">861</span></a>                                    <span class="k">if</span> <span class="p">(</span><span class="n">psort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">psort</span> <span class="o">!=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">G_</span><span class="p">)</span> <span class="ow">or</span> \
</span><span id="LOCM-862"><a href="#LOCM-862"><span class="linenos">862</span></a>                                       <span class="p">(</span><span class="n">pind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pind</span> <span class="o">!=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">k_</span><span class="p">):</span>
</span><span id="LOCM-863"><a href="#LOCM-863"><span class="linenos">863</span></a>                                         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Error: The following set of hypotheses for sort </span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2"> and state </span><span class="si">{</span><span class="n">end_state</span><span class="si">}</span><span class="s2"> are not consistent (ap = </span><span class="si">{</span><span class="n">ap</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
</span><span id="LOCM-864"><a href="#LOCM-864"><span class="linenos">864</span></a>                                         <span class="k">for</span> <span class="n">hyp</span> <span class="ow">in</span> <span class="n">state_params_to_hyps</span><span class="p">[</span><span class="n">sort</span><span class="p">][</span><span class="n">end_state</span><span class="p">][</span><span class="n">param</span><span class="p">]:</span>
</span><span id="LOCM-865"><a href="#LOCM-865"><span class="linenos">865</span></a>                                              <span class="k">if</span> <span class="n">hyp</span><span class="o">.</span><span class="n">B</span> <span class="o">==</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="LOCM-866"><a href="#LOCM-866"><span class="linenos">866</span></a>                                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="si">{</span><span class="n">hyp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-867"><a href="#LOCM-867"><span class="linenos">867</span></a>                                         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"> This domain cannot be handled by LOCMv1. Please see https://github.com/AI-Planning/macq/discussions/200 for more info.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-868"><a href="#LOCM-868"><span class="linenos">868</span></a>                                         <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LOCM-869"><a href="#LOCM-869"><span class="linenos">869</span></a>                                    <span class="k">assert</span> <span class="n">psort</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">psort</span> <span class="o">==</span> <span class="n">hyp</span><span class="o">.</span><span class="n">G_</span>
</span><span id="LOCM-870"><a href="#LOCM-870"><span class="linenos">870</span></a>                                    <span class="k">assert</span> <span class="n">pind</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pind</span> <span class="o">==</span> <span class="n">hyp</span><span class="o">.</span><span class="n">k_</span>
</span><span id="LOCM-871"><a href="#LOCM-871"><span class="linenos">871</span></a>                                    <span class="n">psort</span> <span class="o">=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">G_</span>
</span><span id="LOCM-872"><a href="#LOCM-872"><span class="linenos">872</span></a>                                    <span class="n">pind</span> <span class="o">=</span> <span class="n">hyp</span><span class="o">.</span><span class="n">k_</span>
</span><span id="LOCM-873"><a href="#LOCM-873"><span class="linenos">873</span></a>                            <span class="k">if</span> <span class="n">psort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LOCM-874"><a href="#LOCM-874"><span class="linenos">874</span></a>                                <span class="n">end_fluent</span><span class="o">.</span><span class="n">param_sorts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sort</span><span class="si">{</span><span class="n">psort</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM-875"><a href="#LOCM-875"><span class="linenos">875</span></a>                                <span class="n">end_fluent</span><span class="o">.</span><span class="n">param_act_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="LOCM-876"><a href="#LOCM-876"><span class="linenos">876</span></a>
</span><span id="LOCM-877"><a href="#LOCM-877"><span class="linenos">877</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">update_delete</span><span class="p">(</span><span class="n">start_fluent</span><span class="p">)</span>
</span><span id="LOCM-878"><a href="#LOCM-878"><span class="linenos">878</span></a>                    <span class="n">a</span><span class="o">.</span><span class="n">update_add</span><span class="p">(</span><span class="n">end_fluent</span><span class="p">)</span>
</span><span id="LOCM-879"><a href="#LOCM-879"><span class="linenos">879</span></a>
</span><span id="LOCM-880"><a href="#LOCM-880"><span class="linenos">880</span></a>        <span class="c1"># Step 6: Extraction of static preconditions</span>
</span><span id="LOCM-881"><a href="#LOCM-881"><span class="linenos">881</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="LOCM-882"><a href="#LOCM-882"><span class="linenos">882</span></a>            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">statics</span><span class="p">:</span>
</span><span id="LOCM-883"><a href="#LOCM-883"><span class="linenos">883</span></a>                <span class="k">for</span> <span class="n">static</span> <span class="ow">in</span> <span class="n">statics</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
</span><span id="LOCM-884"><a href="#LOCM-884"><span class="linenos">884</span></a>                    <span class="n">action</span><span class="o">.</span><span class="n">update_precond</span><span class="p">(</span><span class="n">static</span><span class="p">)</span>
</span><span id="LOCM-885"><a href="#LOCM-885"><span class="linenos">885</span></a>
</span><span id="LOCM-886"><a href="#LOCM-886"><span class="linenos">886</span></a>        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="LOCM-887"><a href="#LOCM-887"><span class="linenos">887</span></a>            <span class="n">fluent</span>
</span><span id="LOCM-888"><a href="#LOCM-888"><span class="linenos">888</span></a>            <span class="k">for</span> <span class="n">action_fluents</span> <span class="ow">in</span> <span class="n">fluents</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="LOCM-889"><a href="#LOCM-889"><span class="linenos">889</span></a>            <span class="k">for</span> <span class="n">fluent</span> <span class="ow">in</span> <span class="n">action_fluents</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="LOCM-890"><a href="#LOCM-890"><span class="linenos">890</span></a>        <span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">actions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>LOCM</p>
</div>


                            <div id="LOCM.__init__" class="classattr">
                                        <input id="LOCM.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LOCM</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">statics</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">viz</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="LOCM.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LOCM.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LOCM.__init__-188"><a href="#LOCM.__init__-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="LOCM.__init__-189"><a href="#LOCM.__init__-189"><span class="linenos">189</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="LOCM.__init__-190"><a href="#LOCM.__init__-190"><span class="linenos">190</span></a>        <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span>
</span><span id="LOCM.__init__-191"><a href="#LOCM.__init__-191"><span class="linenos">191</span></a>        <span class="n">statics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Statics</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LOCM.__init__-192"><a href="#LOCM.__init__-192"><span class="linenos">192</span></a>        <span class="n">viz</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM.__init__-193"><a href="#LOCM.__init__-193"><span class="linenos">193</span></a>        <span class="n">view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM.__init__-194"><a href="#LOCM.__init__-194"><span class="linenos">194</span></a>        <span class="n">debug</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LOCM.__init__-195"><a href="#LOCM.__init__-195"><span class="linenos">195</span></a>    <span class="p">):</span>
</span><span id="LOCM.__init__-196"><a href="#LOCM.__init__-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="LOCM.__init__-197"><a href="#LOCM.__init__-197"><span class="linenos">197</span></a><span class="sd">        Args:</span>
</span><span id="LOCM.__init__-198"><a href="#LOCM.__init__-198"><span class="linenos">198</span></a><span class="sd">            observations (ObservationList):</span>
</span><span id="LOCM.__init__-199"><a href="#LOCM.__init__-199"><span class="linenos">199</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="LOCM.__init__-200"><a href="#LOCM.__init__-200"><span class="linenos">200</span></a><span class="sd">            statics (Dict[str, List[str]]):</span>
</span><span id="LOCM.__init__-201"><a href="#LOCM.__init__-201"><span class="linenos">201</span></a><span class="sd">                A dictionary mapping an action name and its arguments to the</span>
</span><span id="LOCM.__init__-202"><a href="#LOCM.__init__-202"><span class="linenos">202</span></a><span class="sd">                list of static preconditions of the action. A precondition should</span>
</span><span id="LOCM.__init__-203"><a href="#LOCM.__init__-203"><span class="linenos">203</span></a><span class="sd">                be a tuple, where the first element is the predicate name and the</span>
</span><span id="LOCM.__init__-204"><a href="#LOCM.__init__-204"><span class="linenos">204</span></a><span class="sd">                rest correspond to the arguments of the action (1-indexed).</span>
</span><span id="LOCM.__init__-205"><a href="#LOCM.__init__-205"><span class="linenos">205</span></a><span class="sd">                E.g. static( next(C1, C2), put_on_card_in_homecell(C2, C1, _) )</span>
</span><span id="LOCM.__init__-206"><a href="#LOCM.__init__-206"><span class="linenos">206</span></a><span class="sd">                should is provided as: {&quot;put_on_card_in_homecell&quot;: [(&quot;next&quot;, 2, 1)]}</span>
</span><span id="LOCM.__init__-207"><a href="#LOCM.__init__-207"><span class="linenos">207</span></a><span class="sd">            viz (bool):</span>
</span><span id="LOCM.__init__-208"><a href="#LOCM.__init__-208"><span class="linenos">208</span></a><span class="sd">                Whether to visualize the FSM.</span>
</span><span id="LOCM.__init__-209"><a href="#LOCM.__init__-209"><span class="linenos">209</span></a><span class="sd">            view (bool):</span>
</span><span id="LOCM.__init__-210"><a href="#LOCM.__init__-210"><span class="linenos">210</span></a><span class="sd">                Whether to view the FSM visualization.</span>
</span><span id="LOCM.__init__-211"><a href="#LOCM.__init__-211"><span class="linenos">211</span></a>
</span><span id="LOCM.__init__-212"><a href="#LOCM.__init__-212"><span class="linenos">212</span></a><span class="sd">        Raises:</span>
</span><span id="LOCM.__init__-213"><a href="#LOCM.__init__-213"><span class="linenos">213</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="LOCM.__init__-214"><a href="#LOCM.__init__-214"><span class="linenos">214</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="LOCM.__init__-215"><a href="#LOCM.__init__-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LOCM.__init__-216"><a href="#LOCM.__init__-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ActionObservation</span><span class="p">:</span>
</span><span id="LOCM.__init__-217"><a href="#LOCM.__init__-217"><span class="linenos">217</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">LOCM</span><span class="p">)</span>
</span><span id="LOCM.__init__-218"><a href="#LOCM.__init__-218"><span class="linenos">218</span></a>
</span><span id="LOCM.__init__-219"><a href="#LOCM.__init__-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LOCM.__init__-220"><a href="#LOCM.__init__-220"><span class="linenos">220</span></a>            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;LOCM only supports a single trace, using first trace only&quot;</span><span class="p">)</span>
</span><span id="LOCM.__init__-221"><a href="#LOCM.__init__-221"><span class="linenos">221</span></a>
</span><span id="LOCM.__init__-222"><a href="#LOCM.__init__-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="LOCM.__init__-223"><a href="#LOCM.__init__-223"><span class="linenos">223</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="LOCM.__init__-224"><a href="#LOCM.__init__-224"><span class="linenos">224</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="LOCM.__init__-225"><a href="#LOCM.__init__-225"><span class="linenos">225</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="LOCM.__init__-226"><a href="#LOCM.__init__-226"><span class="linenos">226</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="LOCM.__init__-227"><a href="#LOCM.__init__-227"><span class="linenos">227</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">debug</span><span class="p">})</span>
</span><span id="LOCM.__init__-228"><a href="#LOCM.__init__-228"><span class="linenos">228</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LOCM.__init__-229"><a href="#LOCM.__init__-229"><span class="linenos">229</span></a>            <span class="n">debug</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="LOCM.__init__-230"><a href="#LOCM.__init__-230"><span class="linenos">230</span></a>
</span><span id="LOCM.__init__-231"><a href="#LOCM.__init__-231"><span class="linenos">231</span></a>        <span class="n">obs_trace</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LOCM.__init__-232"><a href="#LOCM.__init__-232"><span class="linenos">232</span></a>        <span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="LOCM.__init__-233"><a href="#LOCM.__init__-233"><span class="linenos">233</span></a>
</span><span id="LOCM.__init__-234"><a href="#LOCM.__init__-234"><span class="linenos">234</span></a>        <span class="n">sorts</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_get_sorts</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">[</span><span class="s2">&quot;get_sorts&quot;</span><span class="p">])</span>
</span><span id="LOCM.__init__-235"><a href="#LOCM.__init__-235"><span class="linenos">235</span></a>
</span><span id="LOCM.__init__-236"><a href="#LOCM.__init__-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;sorts&quot;</span><span class="p">]:</span>
</span><span id="LOCM.__init__-237"><a href="#LOCM.__init__-237"><span class="linenos">237</span></a>            <span class="n">sortid2objs</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">sorts</span><span class="o">.</span><span class="n">values</span><span class="p">())}</span>
</span><span id="LOCM.__init__-238"><a href="#LOCM.__init__-238"><span class="linenos">238</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LOCM.__init__-239"><a href="#LOCM.__init__-239"><span class="linenos">239</span></a>                <span class="n">sortid2objs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="LOCM.__init__-240"><a href="#LOCM.__init__-240"><span class="linenos">240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sorts:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM.__init__-241"><a href="#LOCM.__init__-241"><span class="linenos">241</span></a>            <span class="n">pprint</span><span class="p">(</span><span class="n">sortid2objs</span><span class="p">)</span>
</span><span id="LOCM.__init__-242"><a href="#LOCM.__init__-242"><span class="linenos">242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LOCM.__init__-243"><a href="#LOCM.__init__-243"><span class="linenos">243</span></a>
</span><span id="LOCM.__init__-244"><a href="#LOCM.__init__-244"><span class="linenos">244</span></a>        <span class="n">TS</span><span class="p">,</span> <span class="n">ap_state_pointers</span><span class="p">,</span> <span class="n">OS</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step1</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">,</span> <span class="n">sorts</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step1&quot;</span><span class="p">])</span>
</span><span id="LOCM.__init__-245"><a href="#LOCM.__init__-245"><span class="linenos">245</span></a>        <span class="n">HS</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step3</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">ap_state_pointers</span><span class="p">,</span> <span class="n">OS</span><span class="p">,</span> <span class="n">sorts</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step3&quot;</span><span class="p">])</span>
</span><span id="LOCM.__init__-246"><a href="#LOCM.__init__-246"><span class="linenos">246</span></a>        <span class="n">bindings</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step4</span><span class="p">(</span><span class="n">HS</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step4&quot;</span><span class="p">])</span>
</span><span id="LOCM.__init__-247"><a href="#LOCM.__init__-247"><span class="linenos">247</span></a>        <span class="n">bindings</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step5</span><span class="p">(</span><span class="n">HS</span><span class="p">,</span> <span class="n">bindings</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step5&quot;</span><span class="p">])</span>
</span><span id="LOCM.__init__-248"><a href="#LOCM.__init__-248"><span class="linenos">248</span></a>        <span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">LOCM</span><span class="o">.</span><span class="n">_step7</span><span class="p">(</span>
</span><span id="LOCM.__init__-249"><a href="#LOCM.__init__-249"><span class="linenos">249</span></a>            <span class="n">OS</span><span class="p">,</span>
</span><span id="LOCM.__init__-250"><a href="#LOCM.__init__-250"><span class="linenos">250</span></a>            <span class="n">ap_state_pointers</span><span class="p">,</span>
</span><span id="LOCM.__init__-251"><a href="#LOCM.__init__-251"><span class="linenos">251</span></a>            <span class="n">sorts</span><span class="p">,</span>
</span><span id="LOCM.__init__-252"><a href="#LOCM.__init__-252"><span class="linenos">252</span></a>            <span class="n">bindings</span><span class="p">,</span>
</span><span id="LOCM.__init__-253"><a href="#LOCM.__init__-253"><span class="linenos">253</span></a>            <span class="n">statics</span> <span class="k">if</span> <span class="n">statics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="LOCM.__init__-254"><a href="#LOCM.__init__-254"><span class="linenos">254</span></a>            <span class="n">debug</span><span class="p">[</span><span class="s2">&quot;step7&quot;</span><span class="p">],</span>
</span><span id="LOCM.__init__-255"><a href="#LOCM.__init__-255"><span class="linenos">255</span></a>            <span class="n">viz</span><span class="p">,</span>
</span><span id="LOCM.__init__-256"><a href="#LOCM.__init__-256"><span class="linenos">256</span></a>        <span class="p">)</span>
</span><span id="LOCM.__init__-257"><a href="#LOCM.__init__-257"><span class="linenos">257</span></a>
</span><span id="LOCM.__init__-258"><a href="#LOCM.__init__-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a new Model object.
Args:
    observations (ObservationList):
        The state observations to extract the model from.
    statics (Dict[str, List[str]]):
        A dictionary mapping an action name and its arguments to the
        list of static preconditions of the action. A precondition should
        be a tuple, where the first element is the predicate name and the
        rest correspond to the arguments of the action (1-indexed).
        E.g. static( next(C1, C2), put_on_card_in_homecell(C2, C1, _) )
        should is provided as: {"put_on_card_in_homecell": [("next", 2, 1)]}
    viz (bool):
        Whether to visualize the FSM.
    view (bool):
        Whether to view the FSM visualization.</p>

<p>Raises:
    IncompatibleObservationToken:
        Raised if the observations are not identity observation.</p>
</div>


                            </div>
                            <div id="LOCM.zero_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">zero_obj</span>        =
<span class="default_value">zero zero</span>

        
    </div>
    <a class="headerlink" href="#LOCM.zero_obj"></a>
    
    

                            </div>
                </section>
                <section id="SLAF">
                            <input id="SLAF-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SLAF</span>:

                <label class="view-source-button" for="SLAF-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SLAF"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SLAF-20"><a href="#SLAF-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">SLAF</span><span class="p">:</span>
</span><span id="SLAF-21"><a href="#SLAF-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;SLAF model extraction method.</span>
</span><span id="SLAF-22"><a href="#SLAF-22"><span class="linenos"> 22</span></a>
</span><span id="SLAF-23"><a href="#SLAF-23"><span class="linenos"> 23</span></a><span class="sd">    Amir, E, and A Chang. 2008. Learning Partially Observable Deterministic Action Models.</span>
</span><span id="SLAF-24"><a href="#SLAF-24"><span class="linenos"> 24</span></a><span class="sd">    Journal of Artificial Intelligence Research 33: 349402. https://doi.org/10.1613/jair.2575.</span>
</span><span id="SLAF-25"><a href="#SLAF-25"><span class="linenos"> 25</span></a>
</span><span id="SLAF-26"><a href="#SLAF-26"><span class="linenos"> 26</span></a><span class="sd">    Extracts a Model from state observations using the SLAF technique. The AS-STRIPS-SLAF</span>
</span><span id="SLAF-27"><a href="#SLAF-27"><span class="linenos"> 27</span></a><span class="sd">    algorithm is used to extract the effects of actions given a trace/observation. The algorithm</span>
</span><span id="SLAF-28"><a href="#SLAF-28"><span class="linenos"> 28</span></a><span class="sd">    is incapable of finding the preconditions of those actions, however.</span>
</span><span id="SLAF-29"><a href="#SLAF-29"><span class="linenos"> 29</span></a>
</span><span id="SLAF-30"><a href="#SLAF-30"><span class="linenos"> 30</span></a><span class="sd">    Note that SLAF learns partially observable, deterministic action models, and thus takes</span>
</span><span id="SLAF-31"><a href="#SLAF-31"><span class="linenos"> 31</span></a><span class="sd">    PartialObservation as the token type.</span>
</span><span id="SLAF-32"><a href="#SLAF-32"><span class="linenos"> 32</span></a>
</span><span id="SLAF-33"><a href="#SLAF-33"><span class="linenos"> 33</span></a><span class="sd">    The AS-STRIPS-SLAF algorithm works by defining &quot;action propositions&quot; for each action that define</span>
</span><span id="SLAF-34"><a href="#SLAF-34"><span class="linenos"> 34</span></a><span class="sd">    the possible preconditions, effects, or lack-thereof of that action and every possible fluent. A</span>
</span><span id="SLAF-35"><a href="#SLAF-35"><span class="linenos"> 35</span></a><span class="sd">    propositional formula is updated as each step is iterated through, and kept in a &quot;fluent-factored form&quot;</span>
</span><span id="SLAF-36"><a href="#SLAF-36"><span class="linenos"> 36</span></a><span class="sd">    that specifies the possible &quot;explanations&quot; behind each fluent being true, false, or unaffected. As actions</span>
</span><span id="SLAF-37"><a href="#SLAF-37"><span class="linenos"> 37</span></a><span class="sd">    are taken and states observed, these reasonings are updated and simplified. (Note that the pieces of the formula</span>
</span><span id="SLAF-38"><a href="#SLAF-38"><span class="linenos"> 38</span></a><span class="sd">    are stored carefully so as to easily conjoin them into one CNF formula later). Once all steps in the trace</span>
</span><span id="SLAF-39"><a href="#SLAF-39"><span class="linenos"> 39</span></a><span class="sd">    have been iterated through, the CNF formula is created, and all possible fluents/action propositions are</span>
</span><span id="SLAF-40"><a href="#SLAF-40"><span class="linenos"> 40</span></a><span class="sd">    iterated through to determine which ones are entailed. This information is then used to extract the Model.</span>
</span><span id="SLAF-41"><a href="#SLAF-41"><span class="linenos"> 41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SLAF-42"><a href="#SLAF-42"><span class="linenos"> 42</span></a>
</span><span id="SLAF-43"><a href="#SLAF-43"><span class="linenos"> 43</span></a>    <span class="c1"># only need one true and one false</span>
</span><span id="SLAF-44"><a href="#SLAF-44"><span class="linenos"> 44</span></a>    <span class="n">top</span> <span class="o">=</span> <span class="n">true</span>
</span><span id="SLAF-45"><a href="#SLAF-45"><span class="linenos"> 45</span></a>    <span class="n">bottom</span> <span class="o">=</span> <span class="n">false</span>
</span><span id="SLAF-46"><a href="#SLAF-46"><span class="linenos"> 46</span></a>
</span><span id="SLAF-47"><a href="#SLAF-47"><span class="linenos"> 47</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">o_list</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="SLAF-48"><a href="#SLAF-48"><span class="linenos"> 48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="SLAF-49"><a href="#SLAF-49"><span class="linenos"> 49</span></a>
</span><span id="SLAF-50"><a href="#SLAF-50"><span class="linenos"> 50</span></a><span class="sd">        Args:</span>
</span><span id="SLAF-51"><a href="#SLAF-51"><span class="linenos"> 51</span></a><span class="sd">            o_list (ObservationList):</span>
</span><span id="SLAF-52"><a href="#SLAF-52"><span class="linenos"> 52</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="SLAF-53"><a href="#SLAF-53"><span class="linenos"> 53</span></a><span class="sd">            debug_mode (bool):</span>
</span><span id="SLAF-54"><a href="#SLAF-54"><span class="linenos"> 54</span></a><span class="sd">                An optional mode that helps the user track any fluents they desire by examining the evolution</span>
</span><span id="SLAF-55"><a href="#SLAF-55"><span class="linenos"> 55</span></a><span class="sd">                of their fluent-factored formulas through the steps.</span>
</span><span id="SLAF-56"><a href="#SLAF-56"><span class="linenos"> 56</span></a><span class="sd">            sample (bool):</span>
</span><span id="SLAF-57"><a href="#SLAF-57"><span class="linenos"> 57</span></a><span class="sd">                An optional mode that allows the user to sample the possible models instead of returning</span>
</span><span id="SLAF-58"><a href="#SLAF-58"><span class="linenos"> 58</span></a><span class="sd">                one that includes only guaranteed entailed fluents.</span>
</span><span id="SLAF-59"><a href="#SLAF-59"><span class="linenos"> 59</span></a><span class="sd">        Raises:</span>
</span><span id="SLAF-60"><a href="#SLAF-60"><span class="linenos"> 60</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="SLAF-61"><a href="#SLAF-61"><span class="linenos"> 61</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="SLAF-62"><a href="#SLAF-62"><span class="linenos"> 62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF-63"><a href="#SLAF-63"><span class="linenos"> 63</span></a>        <span class="k">if</span> <span class="n">o_list</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">AtomicPartialObservation</span><span class="p">:</span>
</span><span id="SLAF-64"><a href="#SLAF-64"><span class="linenos"> 64</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">o_list</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">SLAF</span><span class="p">)</span>
</span><span id="SLAF-65"><a href="#SLAF-65"><span class="linenos"> 65</span></a>
</span><span id="SLAF-66"><a href="#SLAF-66"><span class="linenos"> 66</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">o_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SLAF-67"><a href="#SLAF-67"><span class="linenos"> 67</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The SLAF extraction technique only takes one trace.&quot;</span><span class="p">)</span>
</span><span id="SLAF-68"><a href="#SLAF-68"><span class="linenos"> 68</span></a>
</span><span id="SLAF-69"><a href="#SLAF-69"><span class="linenos"> 69</span></a>        <span class="n">SLAF</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="SLAF-70"><a href="#SLAF-70"><span class="linenos"> 70</span></a>        <span class="n">entailed</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">__as_strips_slaf</span><span class="p">(</span><span class="n">o_list</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</span><span id="SLAF-71"><a href="#SLAF-71"><span class="linenos"> 71</span></a>        <span class="c1"># return the Model</span>
</span><span id="SLAF-72"><a href="#SLAF-72"><span class="linenos"> 72</span></a>        <span class="k">return</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">__sort_results</span><span class="p">(</span><span class="n">o_list</span><span class="p">,</span> <span class="n">entailed</span><span class="p">)</span>
</span><span id="SLAF-73"><a href="#SLAF-73"><span class="linenos"> 73</span></a>
</span><span id="SLAF-74"><a href="#SLAF-74"><span class="linenos"> 74</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SLAF-75"><a href="#SLAF-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">__get_initial_fluent_factored</span><span class="p">(</span><span class="n">o_list</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="SLAF-76"><a href="#SLAF-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the initial fluent-factored formula of an observation/trace.</span>
</span><span id="SLAF-77"><a href="#SLAF-77"><span class="linenos"> 77</span></a>
</span><span id="SLAF-78"><a href="#SLAF-78"><span class="linenos"> 78</span></a><span class="sd">        Args:</span>
</span><span id="SLAF-79"><a href="#SLAF-79"><span class="linenos"> 79</span></a><span class="sd">            o_list (ObservationList):</span>
</span><span id="SLAF-80"><a href="#SLAF-80"><span class="linenos"> 80</span></a><span class="sd">                The observation list to extract the fluent-factored formula from.</span>
</span><span id="SLAF-81"><a href="#SLAF-81"><span class="linenos"> 81</span></a>
</span><span id="SLAF-82"><a href="#SLAF-82"><span class="linenos"> 82</span></a><span class="sd">        Returns:</span>
</span><span id="SLAF-83"><a href="#SLAF-83"><span class="linenos"> 83</span></a><span class="sd">            A list of dictionaries that holds the fluent-factored formula.</span>
</span><span id="SLAF-84"><a href="#SLAF-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF-85"><a href="#SLAF-85"><span class="linenos"> 85</span></a>        <span class="n">top</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">top</span>
</span><span id="SLAF-86"><a href="#SLAF-86"><span class="linenos"> 86</span></a>        <span class="n">bottom</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">bottom</span>
</span><span id="SLAF-87"><a href="#SLAF-87"><span class="linenos"> 87</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-88"><a href="#SLAF-88"><span class="linenos"> 88</span></a>        <span class="c1"># get all the base fluents</span>
</span><span id="SLAF-89"><a href="#SLAF-89"><span class="linenos"> 89</span></a>        <span class="n">fluents</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">o_list</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">state</span><span class="p">])</span>
</span><span id="SLAF-90"><a href="#SLAF-90"><span class="linenos"> 90</span></a>
</span><span id="SLAF-91"><a href="#SLAF-91"><span class="linenos"> 91</span></a>        <span class="c1"># set up the initial fluent factored form for the problem</span>
</span><span id="SLAF-92"><a href="#SLAF-92"><span class="linenos"> 92</span></a>        <span class="n">raw_fluent_factored</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SLAF-93"><a href="#SLAF-93"><span class="linenos"> 93</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fluents</span><span class="p">:</span>
</span><span id="SLAF-94"><a href="#SLAF-94"><span class="linenos"> 94</span></a>            <span class="n">phi</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SLAF-95"><a href="#SLAF-95"><span class="linenos"> 95</span></a>            <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-96"><a href="#SLAF-96"><span class="linenos"> 96</span></a>            <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">top</span><span class="p">}</span>
</span><span id="SLAF-97"><a href="#SLAF-97"><span class="linenos"> 97</span></a>            <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">top</span><span class="p">}</span>
</span><span id="SLAF-98"><a href="#SLAF-98"><span class="linenos"> 98</span></a>            <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">top</span><span class="p">}</span>
</span><span id="SLAF-99"><a href="#SLAF-99"><span class="linenos"> 99</span></a>            <span class="n">raw_fluent_factored</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span>
</span><span id="SLAF-100"><a href="#SLAF-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="n">raw_fluent_factored</span>
</span><span id="SLAF-101"><a href="#SLAF-101"><span class="linenos">101</span></a>
</span><span id="SLAF-102"><a href="#SLAF-102"><span class="linenos">102</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SLAF-103"><a href="#SLAF-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">__remove_subsumed_clauses</span><span class="p">(</span><span class="n">phi_form</span><span class="p">:</span> <span class="n">Set</span><span class="p">):</span>
</span><span id="SLAF-104"><a href="#SLAF-104"><span class="linenos">104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes subsumed clauses to simplify the given formula.</span>
</span><span id="SLAF-105"><a href="#SLAF-105"><span class="linenos">105</span></a><span class="sd">        This is step 2. of AS-STRIPS-SLAF, however this step was taken as the formula was</span>
</span><span id="SLAF-106"><a href="#SLAF-106"><span class="linenos">106</span></a><span class="sd">        progressively created instead of once at the end, for efficiency purposes.</span>
</span><span id="SLAF-107"><a href="#SLAF-107"><span class="linenos">107</span></a>
</span><span id="SLAF-108"><a href="#SLAF-108"><span class="linenos">108</span></a><span class="sd">        Args:</span>
</span><span id="SLAF-109"><a href="#SLAF-109"><span class="linenos">109</span></a><span class="sd">            phi_form (Set):</span>
</span><span id="SLAF-110"><a href="#SLAF-110"><span class="linenos">110</span></a><span class="sd">                The set (conjunction) of formulas to simplify.</span>
</span><span id="SLAF-111"><a href="#SLAF-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF-112"><a href="#SLAF-112"><span class="linenos">112</span></a>        <span class="n">to_del</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-113"><a href="#SLAF-113"><span class="linenos">113</span></a>        <span class="c1"># if the overall phi formula (conjunction) has false, throw everything out</span>
</span><span id="SLAF-114"><a href="#SLAF-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">false</span> <span class="ow">in</span> <span class="n">phi_form</span><span class="p">:</span>
</span><span id="SLAF-115"><a href="#SLAF-115"><span class="linenos">115</span></a>            <span class="n">phi_form</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="SLAF-116"><a href="#SLAF-116"><span class="linenos">116</span></a>            <span class="k">return</span>
</span><span id="SLAF-117"><a href="#SLAF-117"><span class="linenos">117</span></a>        <span class="c1"># eliminate subsumed clauses by comparing each formula with the others</span>
</span><span id="SLAF-118"><a href="#SLAF-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi_form</span><span class="p">:</span>
</span><span id="SLAF-119"><a href="#SLAF-119"><span class="linenos">119</span></a>            <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">phi_form</span><span class="p">:</span>
</span><span id="SLAF-120"><a href="#SLAF-120"><span class="linenos">120</span></a>                <span class="c1"># simplify the formulas to sets of strings for comparison purposes</span>
</span><span id="SLAF-121"><a href="#SLAF-121"><span class="linenos">121</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Or</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">And</span><span class="p">):</span>
</span><span id="SLAF-122"><a href="#SLAF-122"><span class="linenos">122</span></a>                    <span class="n">f_set</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">children</span><span class="p">}</span>
</span><span id="SLAF-123"><a href="#SLAF-123"><span class="linenos">123</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-124"><a href="#SLAF-124"><span class="linenos">124</span></a>                    <span class="n">f_set</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)}</span>
</span><span id="SLAF-125"><a href="#SLAF-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
</span><span id="SLAF-126"><a href="#SLAF-126"><span class="linenos">126</span></a>                    <span class="n">other_set</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">children</span><span class="p">}</span>
</span><span id="SLAF-127"><a href="#SLAF-127"><span class="linenos">127</span></a>                    <span class="c1"># if the subformula is a conjunction and has false in it, throw it out</span>
</span><span id="SLAF-128"><a href="#SLAF-128"><span class="linenos">128</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">And</span><span class="p">):</span>
</span><span id="SLAF-129"><a href="#SLAF-129"><span class="linenos">129</span></a>                        <span class="k">if</span> <span class="s2">&quot;false&quot;</span> <span class="ow">in</span> <span class="n">other_set</span><span class="p">:</span>
</span><span id="SLAF-130"><a href="#SLAF-130"><span class="linenos">130</span></a>                            <span class="n">to_del</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="SLAF-131"><a href="#SLAF-131"><span class="linenos">131</span></a>                            <span class="k">break</span>
</span><span id="SLAF-132"><a href="#SLAF-132"><span class="linenos">132</span></a>                    <span class="c1"># if the subformula is a disjunction and has true in it, throw it out</span>
</span><span id="SLAF-133"><a href="#SLAF-133"><span class="linenos">133</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Or</span><span class="p">):</span>
</span><span id="SLAF-134"><a href="#SLAF-134"><span class="linenos">134</span></a>                        <span class="k">if</span> <span class="s2">&quot;true&quot;</span> <span class="ow">in</span> <span class="n">other_set</span><span class="p">:</span>
</span><span id="SLAF-135"><a href="#SLAF-135"><span class="linenos">135</span></a>                            <span class="n">to_del</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="SLAF-136"><a href="#SLAF-136"><span class="linenos">136</span></a>                            <span class="k">break</span>
</span><span id="SLAF-137"><a href="#SLAF-137"><span class="linenos">137</span></a>                    <span class="c1"># otherwise, if the subformula can be represented by a smaller subformula, throw it out.</span>
</span><span id="SLAF-138"><a href="#SLAF-138"><span class="linenos">138</span></a>                    <span class="c1"># also, &quot;true&quot; and &quot;false&quot; are empty sets, and unless we have one of the two cases above, we need to</span>
</span><span id="SLAF-139"><a href="#SLAF-139"><span class="linenos">139</span></a>                    <span class="c1"># prevent them from throwing out formulas unnecessarily</span>
</span><span id="SLAF-140"><a href="#SLAF-140"><span class="linenos">140</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="SLAF-141"><a href="#SLAF-141"><span class="linenos">141</span></a>                        <span class="n">f_set</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">other_set</span><span class="p">)</span>
</span><span id="SLAF-142"><a href="#SLAF-142"><span class="linenos">142</span></a>                        <span class="ow">and</span> <span class="n">f_set</span> <span class="o">!=</span> <span class="n">other_set</span>
</span><span id="SLAF-143"><a href="#SLAF-143"><span class="linenos">143</span></a>                        <span class="ow">and</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">true</span>
</span><span id="SLAF-144"><a href="#SLAF-144"><span class="linenos">144</span></a>                        <span class="ow">and</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">false</span>
</span><span id="SLAF-145"><a href="#SLAF-145"><span class="linenos">145</span></a>                    <span class="p">):</span>
</span><span id="SLAF-146"><a href="#SLAF-146"><span class="linenos">146</span></a>                        <span class="n">to_del</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="SLAF-147"><a href="#SLAF-147"><span class="linenos">147</span></a>        <span class="c1"># discard unnecessary formulas</span>
</span><span id="SLAF-148"><a href="#SLAF-148"><span class="linenos">148</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">to_del</span><span class="p">:</span>
</span><span id="SLAF-149"><a href="#SLAF-149"><span class="linenos">149</span></a>            <span class="n">phi_form</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="SLAF-150"><a href="#SLAF-150"><span class="linenos">150</span></a>
</span><span id="SLAF-151"><a href="#SLAF-151"><span class="linenos">151</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SLAF-152"><a href="#SLAF-152"><span class="linenos">152</span></a>    <span class="k">def</span> <span class="nf">__or_refactor</span><span class="p">(</span><span class="n">maybe_lit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Or</span><span class="p">,</span> <span class="n">Var</span><span class="p">]):</span>
</span><span id="SLAF-153"><a href="#SLAF-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a &quot;Var&quot; fluent to an &quot;Or&quot; fluent.</span>
</span><span id="SLAF-154"><a href="#SLAF-154"><span class="linenos">154</span></a>
</span><span id="SLAF-155"><a href="#SLAF-155"><span class="linenos">155</span></a><span class="sd">        Args:</span>
</span><span id="SLAF-156"><a href="#SLAF-156"><span class="linenos">156</span></a><span class="sd">            maybe_lit (Union[Or, Var]):</span>
</span><span id="SLAF-157"><a href="#SLAF-157"><span class="linenos">157</span></a><span class="sd">                Fluent that is either type &quot;Or&quot; or &quot;Var.&quot;</span>
</span><span id="SLAF-158"><a href="#SLAF-158"><span class="linenos">158</span></a>
</span><span id="SLAF-159"><a href="#SLAF-159"><span class="linenos">159</span></a><span class="sd">        Returns:</span>
</span><span id="SLAF-160"><a href="#SLAF-160"><span class="linenos">160</span></a><span class="sd">            A corresponding fluent of type &quot;Or.&quot;</span>
</span><span id="SLAF-161"><a href="#SLAF-161"><span class="linenos">161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF-162"><a href="#SLAF-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">Or</span><span class="p">([</span><span class="n">maybe_lit</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maybe_lit</span><span class="p">,</span> <span class="n">Var</span><span class="p">)</span> <span class="k">else</span> <span class="n">maybe_lit</span>
</span><span id="SLAF-163"><a href="#SLAF-163"><span class="linenos">163</span></a>
</span><span id="SLAF-164"><a href="#SLAF-164"><span class="linenos">164</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SLAF-165"><a href="#SLAF-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">__sort_results</span><span class="p">(</span><span class="n">observations</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">entailed</span><span class="p">:</span> <span class="n">Set</span><span class="p">):</span>
</span><span id="SLAF-166"><a href="#SLAF-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a `Model` given the set of entailed propositions.</span>
</span><span id="SLAF-167"><a href="#SLAF-167"><span class="linenos">167</span></a>
</span><span id="SLAF-168"><a href="#SLAF-168"><span class="linenos">168</span></a><span class="sd">        Args:</span>
</span><span id="SLAF-169"><a href="#SLAF-169"><span class="linenos">169</span></a><span class="sd">            observations (ObservationLists):</span>
</span><span id="SLAF-170"><a href="#SLAF-170"><span class="linenos">170</span></a><span class="sd">                The observations supplied for extraction.</span>
</span><span id="SLAF-171"><a href="#SLAF-171"><span class="linenos">171</span></a><span class="sd">            entailed (Set)</span>
</span><span id="SLAF-172"><a href="#SLAF-172"><span class="linenos">172</span></a><span class="sd">                The set of propositions that were found to be entailed.</span>
</span><span id="SLAF-173"><a href="#SLAF-173"><span class="linenos">173</span></a>
</span><span id="SLAF-174"><a href="#SLAF-174"><span class="linenos">174</span></a><span class="sd">        Returns:</span>
</span><span id="SLAF-175"><a href="#SLAF-175"><span class="linenos">175</span></a><span class="sd">            The extracted `Model`.</span>
</span><span id="SLAF-176"><a href="#SLAF-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF-177"><a href="#SLAF-177"><span class="linenos">177</span></a>        <span class="n">learned_actions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SLAF-178"><a href="#SLAF-178"><span class="linenos">178</span></a>        <span class="n">model_fluents</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">get_fluents</span><span class="p">()</span>
</span><span id="SLAF-179"><a href="#SLAF-179"><span class="linenos">179</span></a>
</span><span id="SLAF-180"><a href="#SLAF-180"><span class="linenos">180</span></a>        <span class="c1"># iterate through each step</span>
</span><span id="SLAF-181"><a href="#SLAF-181"><span class="linenos">181</span></a>        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">:</span>
</span><span id="SLAF-182"><a href="#SLAF-182"><span class="linenos">182</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
</span><span id="SLAF-183"><a href="#SLAF-183"><span class="linenos">183</span></a>                <span class="c1"># if an action was taken on this step</span>
</span><span id="SLAF-184"><a href="#SLAF-184"><span class="linenos">184</span></a>                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
</span><span id="SLAF-185"><a href="#SLAF-185"><span class="linenos">185</span></a>                    <span class="c1"># set up a base LearnedAction with the known information</span>
</span><span id="SLAF-186"><a href="#SLAF-186"><span class="linenos">186</span></a>                    <span class="n">learned_actions</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">action</span><span class="p">)]</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">LearnedAction</span><span class="p">(</span>
</span><span id="SLAF-187"><a href="#SLAF-187"><span class="linenos">187</span></a>                        <span class="n">token</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="SLAF-188"><a href="#SLAF-188"><span class="linenos">188</span></a>                        <span class="n">token</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">,</span>
</span><span id="SLAF-189"><a href="#SLAF-189"><span class="linenos">189</span></a>                        <span class="n">cost</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
</span><span id="SLAF-190"><a href="#SLAF-190"><span class="linenos">190</span></a>                    <span class="p">)</span>
</span><span id="SLAF-191"><a href="#SLAF-191"><span class="linenos">191</span></a>        <span class="c1"># iterate through all entailed propositions</span>
</span><span id="SLAF-192"><a href="#SLAF-192"><span class="linenos">192</span></a>        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entailed</span><span class="p">:</span>
</span><span id="SLAF-193"><a href="#SLAF-193"><span class="linenos">193</span></a>            <span class="n">precond</span> <span class="o">=</span> <span class="s2">&quot; is a precondition of &quot;</span>
</span><span id="SLAF-194"><a href="#SLAF-194"><span class="linenos">194</span></a>            <span class="n">effect</span> <span class="o">=</span> <span class="s2">&quot; causes &quot;</span>
</span><span id="SLAF-195"><a href="#SLAF-195"><span class="linenos">195</span></a>            <span class="n">neutral</span> <span class="o">=</span> <span class="s2">&quot; has no effect on &quot;</span>
</span><span id="SLAF-196"><a href="#SLAF-196"><span class="linenos">196</span></a>            <span class="n">e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="SLAF-197"><a href="#SLAF-197"><span class="linenos">197</span></a>            <span class="c1"># if this proposition holds information about a precondition</span>
</span><span id="SLAF-198"><a href="#SLAF-198"><span class="linenos">198</span></a>            <span class="k">if</span> <span class="n">precond</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SLAF-199"><a href="#SLAF-199"><span class="linenos">199</span></a>                <span class="c1"># split to separate precondition and action, get rid of extra brackets</span>
</span><span id="SLAF-200"><a href="#SLAF-200"><span class="linenos">200</span></a>                <span class="n">info_split</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">precond</span><span class="p">)</span>
</span><span id="SLAF-201"><a href="#SLAF-201"><span class="linenos">201</span></a>                <span class="n">precond</span> <span class="o">=</span> <span class="n">info_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SLAF-202"><a href="#SLAF-202"><span class="linenos">202</span></a>                <span class="n">action</span> <span class="o">=</span> <span class="n">info_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SLAF-203"><a href="#SLAF-203"><span class="linenos">203</span></a>                <span class="c1"># update the precondition of this action with the appropriate fluent</span>
</span><span id="SLAF-204"><a href="#SLAF-204"><span class="linenos">204</span></a>                <span class="c1">#  only if it&#39;s a positive precondition</span>
</span><span id="SLAF-205"><a href="#SLAF-205"><span class="linenos">205</span></a>                <span class="k">if</span> <span class="s2">&quot;~&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">precond</span><span class="p">:</span>
</span><span id="SLAF-206"><a href="#SLAF-206"><span class="linenos">206</span></a>                    <span class="n">learned_actions</span><span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="n">precond</span><span class="p">})</span>
</span><span id="SLAF-207"><a href="#SLAF-207"><span class="linenos">207</span></a>            <span class="c1"># if this proposition holds information about an effect</span>
</span><span id="SLAF-208"><a href="#SLAF-208"><span class="linenos">208</span></a>            <span class="k">elif</span> <span class="n">effect</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SLAF-209"><a href="#SLAF-209"><span class="linenos">209</span></a>                <span class="c1"># split to separate effect and action, get rid of extra brackets</span>
</span><span id="SLAF-210"><a href="#SLAF-210"><span class="linenos">210</span></a>                <span class="n">info_split</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">effect</span><span class="p">)</span>
</span><span id="SLAF-211"><a href="#SLAF-211"><span class="linenos">211</span></a>                <span class="n">action</span> <span class="o">=</span> <span class="n">info_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SLAF-212"><a href="#SLAF-212"><span class="linenos">212</span></a>                <span class="n">effect</span> <span class="o">=</span> <span class="n">info_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SLAF-213"><a href="#SLAF-213"><span class="linenos">213</span></a>                <span class="c1"># update either add or delete effects appropriately</span>
</span><span id="SLAF-214"><a href="#SLAF-214"><span class="linenos">214</span></a>                <span class="k">if</span> <span class="s2">&quot;~&quot;</span> <span class="ow">in</span> <span class="n">effect</span><span class="p">:</span>
</span><span id="SLAF-215"><a href="#SLAF-215"><span class="linenos">215</span></a>                    <span class="c1"># get rid of &quot;~&quot;</span>
</span><span id="SLAF-216"><a href="#SLAF-216"><span class="linenos">216</span></a>                    <span class="n">effect</span> <span class="o">=</span> <span class="n">effect</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="SLAF-217"><a href="#SLAF-217"><span class="linenos">217</span></a>                    <span class="c1"># update the delete effects of this action with the appropriate fluent</span>
</span><span id="SLAF-218"><a href="#SLAF-218"><span class="linenos">218</span></a>                    <span class="n">learned_actions</span><span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">update_delete</span><span class="p">({</span><span class="n">effect</span><span class="p">})</span>
</span><span id="SLAF-219"><a href="#SLAF-219"><span class="linenos">219</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-220"><a href="#SLAF-220"><span class="linenos">220</span></a>                    <span class="c1"># update the add effects of this action with the appropriate fluent</span>
</span><span id="SLAF-221"><a href="#SLAF-221"><span class="linenos">221</span></a>                    <span class="n">learned_actions</span><span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="n">effect</span><span class="p">})</span>
</span><span id="SLAF-222"><a href="#SLAF-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">model_fluents</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">learned_actions</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="SLAF-223"><a href="#SLAF-223"><span class="linenos">223</span></a>
</span><span id="SLAF-224"><a href="#SLAF-224"><span class="linenos">224</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SLAF-225"><a href="#SLAF-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">__as_strips_slaf</span><span class="p">(</span><span class="n">o_list</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SLAF-226"><a href="#SLAF-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements the AS-STRIPS-SLAF algorithm from section 5.3 of the SLAF paper.</span>
</span><span id="SLAF-227"><a href="#SLAF-227"><span class="linenos">227</span></a><span class="sd">        Iterates through the action/observation pairs of each observation/trace, returning</span>
</span><span id="SLAF-228"><a href="#SLAF-228"><span class="linenos">228</span></a><span class="sd">        a fluent-factored transition belief formula that filters according to that action/observation.</span>
</span><span id="SLAF-229"><a href="#SLAF-229"><span class="linenos">229</span></a><span class="sd">        The transition belief formulas for each trace/observation are conjoined to get one final formula,</span>
</span><span id="SLAF-230"><a href="#SLAF-230"><span class="linenos">230</span></a><span class="sd">        which is then solved using a SAT solver to extract models.</span>
</span><span id="SLAF-231"><a href="#SLAF-231"><span class="linenos">231</span></a>
</span><span id="SLAF-232"><a href="#SLAF-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="SLAF-233"><a href="#SLAF-233"><span class="linenos">233</span></a><span class="sd">            o_list (ObservationList):</span>
</span><span id="SLAF-234"><a href="#SLAF-234"><span class="linenos">234</span></a><span class="sd">                The list of observations/traces to apply the filtering algorithm to.</span>
</span><span id="SLAF-235"><a href="#SLAF-235"><span class="linenos">235</span></a><span class="sd">                NOTE: with the current implementation, SLAF only works with a single trace.</span>
</span><span id="SLAF-236"><a href="#SLAF-236"><span class="linenos">236</span></a>
</span><span id="SLAF-237"><a href="#SLAF-237"><span class="linenos">237</span></a><span class="sd">            sample (bool):</span>
</span><span id="SLAF-238"><a href="#SLAF-238"><span class="linenos">238</span></a><span class="sd">                If true, an arbitrary solution will be produced rather than just the entailed literals.</span>
</span><span id="SLAF-239"><a href="#SLAF-239"><span class="linenos">239</span></a>
</span><span id="SLAF-240"><a href="#SLAF-240"><span class="linenos">240</span></a><span class="sd">        Returns:</span>
</span><span id="SLAF-241"><a href="#SLAF-241"><span class="linenos">241</span></a><span class="sd">            The set of fluents that are entailed.</span>
</span><span id="SLAF-242"><a href="#SLAF-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF-243"><a href="#SLAF-243"><span class="linenos">243</span></a>
</span><span id="SLAF-244"><a href="#SLAF-244"><span class="linenos">244</span></a>        <span class="k">global</span> <span class="n">e</span>
</span><span id="SLAF-245"><a href="#SLAF-245"><span class="linenos">245</span></a>        <span class="n">top</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">top</span>
</span><span id="SLAF-246"><a href="#SLAF-246"><span class="linenos">246</span></a>        <span class="n">bottom</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">bottom</span>
</span><span id="SLAF-247"><a href="#SLAF-247"><span class="linenos">247</span></a>        <span class="n">validity_constraints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-248"><a href="#SLAF-248"><span class="linenos">248</span></a>        <span class="n">all_var</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-249"><a href="#SLAF-249"><span class="linenos">249</span></a>        <span class="n">debug_mode</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">debug_mode</span>
</span><span id="SLAF-250"><a href="#SLAF-250"><span class="linenos">250</span></a>
</span><span id="SLAF-251"><a href="#SLAF-251"><span class="linenos">251</span></a>        <span class="c1"># get the fluent factored formula</span>
</span><span id="SLAF-252"><a href="#SLAF-252"><span class="linenos">252</span></a>        <span class="n">raw_fluent_factored</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">__get_initial_fluent_factored</span><span class="p">(</span><span class="n">o_list</span><span class="p">)</span>
</span><span id="SLAF-253"><a href="#SLAF-253"><span class="linenos">253</span></a>        <span class="c1"># get all base fluents to check entailments later</span>
</span><span id="SLAF-254"><a href="#SLAF-254"><span class="linenos">254</span></a>        <span class="n">all_var</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">phi</span><span class="p">[</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">raw_fluent_factored</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="SLAF-255"><a href="#SLAF-255"><span class="linenos">255</span></a>        <span class="c1"># iterate through every observation</span>
</span><span id="SLAF-256"><a href="#SLAF-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">o_list</span><span class="p">:</span>
</span><span id="SLAF-257"><a href="#SLAF-257"><span class="linenos">257</span></a>            <span class="c1"># more options if the user is in debug mode</span>
</span><span id="SLAF-258"><a href="#SLAF-258"><span class="linenos">258</span></a>            <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SLAF-259"><a href="#SLAF-259"><span class="linenos">259</span></a>                <span class="n">all_f_details</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">raw_fluent_factored</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="SLAF-260"><a href="#SLAF-260"><span class="linenos">260</span></a>                <span class="n">all_f_details</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="SLAF-261"><a href="#SLAF-261"><span class="linenos">261</span></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_f_details</span><span class="p">:</span>
</span><span id="SLAF-262"><a href="#SLAF-262"><span class="linenos">262</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-263"><a href="#SLAF-263"><span class="linenos">263</span></a>                <span class="n">to_obs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SLAF-264"><a href="#SLAF-264"><span class="linenos">264</span></a>                <span class="n">user_input</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SLAF-265"><a href="#SLAF-265"><span class="linenos">265</span></a>                <span class="k">while</span> <span class="n">user_input</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="SLAF-266"><a href="#SLAF-266"><span class="linenos">266</span></a>                    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
</span><span id="SLAF-267"><a href="#SLAF-267"><span class="linenos">267</span></a>                        <span class="s2">&quot;Which fluents do you want to observe? Enter &#39;x&#39; when you are finished.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SLAF-268"><a href="#SLAF-268"><span class="linenos">268</span></a>                    <span class="p">)</span>
</span><span id="SLAF-269"><a href="#SLAF-269"><span class="linenos">269</span></a>                    <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="n">all_f_details</span><span class="p">:</span>
</span><span id="SLAF-270"><a href="#SLAF-270"><span class="linenos">270</span></a>                        <span class="n">to_obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>
</span><span id="SLAF-271"><a href="#SLAF-271"><span class="linenos">271</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span> <span class="o">+</span> <span class="s2">&quot; added to the debugging list.&quot;</span><span class="p">)</span>
</span><span id="SLAF-272"><a href="#SLAF-272"><span class="linenos">272</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-273"><a href="#SLAF-273"><span class="linenos">273</span></a>                        <span class="k">if</span> <span class="n">user_input</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="SLAF-274"><a href="#SLAF-274"><span class="linenos">274</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The fluent you entered is invalid.&quot;</span><span class="p">)</span>
</span><span id="SLAF-275"><a href="#SLAF-275"><span class="linenos">275</span></a>
</span><span id="SLAF-276"><a href="#SLAF-276"><span class="linenos">276</span></a>            <span class="c1"># iterate through all tokens (action/observation pairs) in this observation/trace</span>
</span><span id="SLAF-277"><a href="#SLAF-277"><span class="linenos">277</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
</span><span id="SLAF-278"><a href="#SLAF-278"><span class="linenos">278</span></a>                <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SLAF-279"><a href="#SLAF-279"><span class="linenos">279</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SLAF-280"><a href="#SLAF-280"><span class="linenos">280</span></a>
</span><span id="SLAF-281"><a href="#SLAF-281"><span class="linenos">281</span></a>                <span class="n">all_o</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SLAF-282"><a href="#SLAF-282"><span class="linenos">282</span></a>                <span class="c1"># retrieve list of observations from the current state. Missing fluents are not taken into account.</span>
</span><span id="SLAF-283"><a href="#SLAF-283"><span class="linenos">283</span></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
</span><span id="SLAF-284"><a href="#SLAF-284"><span class="linenos">284</span></a>                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SLAF-285"><a href="#SLAF-285"><span class="linenos">285</span></a>                        <span class="n">all_o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Var</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">f</span><span class="p">])))</span>
</span><span id="SLAF-286"><a href="#SLAF-286"><span class="linenos">286</span></a>
</span><span id="SLAF-287"><a href="#SLAF-287"><span class="linenos">287</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Steps 1 (d)-(e) of AS-STRIPS-SLAF are taken care of in this loop.</span>
</span><span id="SLAF-288"><a href="#SLAF-288"><span class="linenos">288</span></a><span class="sd">                Note that steps (d)-(e) are done first as the action-observation order of SLAF is opposite to that of</span>
</span><span id="SLAF-289"><a href="#SLAF-289"><span class="linenos">289</span></a><span class="sd">                how steps are stored in macq.</span>
</span><span id="SLAF-290"><a href="#SLAF-290"><span class="linenos">290</span></a>
</span><span id="SLAF-291"><a href="#SLAF-291"><span class="linenos">291</span></a><span class="sd">                Iterate through every fluent in the fluent-factored transition belief formula and take</span>
</span><span id="SLAF-292"><a href="#SLAF-292"><span class="linenos">292</span></a><span class="sd">                account of all of the current observations BEFORE the next action is taken.&quot;&quot;&quot;</span>
</span><span id="SLAF-293"><a href="#SLAF-293"><span class="linenos">293</span></a>                <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">raw_fluent_factored</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="SLAF-294"><a href="#SLAF-294"><span class="linenos">294</span></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span>
</span><span id="SLAF-295"><a href="#SLAF-295"><span class="linenos">295</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_o</span><span class="p">:</span>
</span><span id="SLAF-296"><a href="#SLAF-296"><span class="linenos">296</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;Step 1 (d): If this fluent is observed, update the formula accordingly.</span>
</span><span id="SLAF-297"><a href="#SLAF-297"><span class="linenos">297</span></a><span class="sd">                        Since we know the fluent is now true, the prior possible explanation for the fluent being true</span>
</span><span id="SLAF-298"><a href="#SLAF-298"><span class="linenos">298</span></a><span class="sd">                        (involving past actions, etc) are now set to the neutral explanation; that is, one of those explanations</span>
</span><span id="SLAF-299"><a href="#SLAF-299"><span class="linenos">299</span></a><span class="sd">                        has to be true in order for the prior action to have no effect on the fluent currently being true.</span>
</span><span id="SLAF-300"><a href="#SLAF-300"><span class="linenos">300</span></a><span class="sd">                        &quot;&quot;&quot;</span>
</span><span id="SLAF-301"><a href="#SLAF-301"><span class="linenos">301</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]])</span>
</span><span id="SLAF-302"><a href="#SLAF-302"><span class="linenos">302</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">top</span><span class="p">}</span>
</span><span id="SLAF-303"><a href="#SLAF-303"><span class="linenos">303</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">bottom</span><span class="p">}</span>
</span><span id="SLAF-304"><a href="#SLAF-304"><span class="linenos">304</span></a>                        <span class="k">if</span> <span class="n">debug_mode</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">to_obs</span><span class="p">:</span>
</span><span id="SLAF-305"><a href="#SLAF-305"><span class="linenos">305</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="SLAF-306"><a href="#SLAF-306"><span class="linenos">306</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> was observed to be true after the previous action was taken.&quot;</span>
</span><span id="SLAF-307"><a href="#SLAF-307"><span class="linenos">307</span></a>                            <span class="p">)</span>
</span><span id="SLAF-308"><a href="#SLAF-308"><span class="linenos">308</span></a>
</span><span id="SLAF-309"><a href="#SLAF-309"><span class="linenos">309</span></a>                    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="o">~</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_o</span><span class="p">:</span>
</span><span id="SLAF-310"><a href="#SLAF-310"><span class="linenos">310</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;For Step 1 (e), the opposite happens if the fluent is observed to be false.&quot;&quot;&quot;</span>
</span><span id="SLAF-311"><a href="#SLAF-311"><span class="linenos">311</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]])</span>
</span><span id="SLAF-312"><a href="#SLAF-312"><span class="linenos">312</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">bottom</span><span class="p">}</span>
</span><span id="SLAF-313"><a href="#SLAF-313"><span class="linenos">313</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">top</span><span class="p">}</span>
</span><span id="SLAF-314"><a href="#SLAF-314"><span class="linenos">314</span></a>                        <span class="k">if</span> <span class="n">debug_mode</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">to_obs</span><span class="p">:</span>
</span><span id="SLAF-315"><a href="#SLAF-315"><span class="linenos">315</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="SLAF-316"><a href="#SLAF-316"><span class="linenos">316</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> was observed to be false after the previous action was taken.&quot;</span>
</span><span id="SLAF-317"><a href="#SLAF-317"><span class="linenos">317</span></a>                            <span class="p">)</span>
</span><span id="SLAF-318"><a href="#SLAF-318"><span class="linenos">318</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;If the fluent is not observed to be either true or false (it is missing), then nothing happens.&quot;&quot;&quot;</span>
</span><span id="SLAF-319"><a href="#SLAF-319"><span class="linenos">319</span></a>                <span class="c1"># display current updates</span>
</span><span id="SLAF-320"><a href="#SLAF-320"><span class="linenos">320</span></a>                <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SLAF-321"><a href="#SLAF-321"><span class="linenos">321</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Update according to observations.&quot;</span><span class="p">)</span>
</span><span id="SLAF-322"><a href="#SLAF-322"><span class="linenos">322</span></a>                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">to_obs</span><span class="p">:</span>
</span><span id="SLAF-323"><a href="#SLAF-323"><span class="linenos">323</span></a>                        <span class="n">f_str</span> <span class="o">=</span> <span class="n">raw_fluent_factored</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</span><span id="SLAF-324"><a href="#SLAF-324"><span class="linenos">324</span></a>                        <span class="n">phi</span> <span class="o">=</span> <span class="n">raw_fluent_factored</span><span class="p">[</span><span class="n">f_str</span><span class="p">]</span>
</span><span id="SLAF-325"><a href="#SLAF-325"><span class="linenos">325</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">fluent: &quot;</span> <span class="o">+</span> <span class="n">f_str</span><span class="p">)</span>
</span><span id="SLAF-326"><a href="#SLAF-326"><span class="linenos">326</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">possible expl. for fluent being true:&quot;</span><span class="p">)</span>
</span><span id="SLAF-327"><a href="#SLAF-327"><span class="linenos">327</span></a>                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]:</span>
</span><span id="SLAF-328"><a href="#SLAF-328"><span class="linenos">328</span></a>                            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">top</span><span class="p">:</span>
</span><span id="SLAF-329"><a href="#SLAF-329"><span class="linenos">329</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</span><span id="SLAF-330"><a href="#SLAF-330"><span class="linenos">330</span></a>                            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">:</span>
</span><span id="SLAF-331"><a href="#SLAF-331"><span class="linenos">331</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</span><span id="SLAF-332"><a href="#SLAF-332"><span class="linenos">332</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-333"><a href="#SLAF-333"><span class="linenos">333</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-334"><a href="#SLAF-334"><span class="linenos">334</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">possible expl. for fluent being false:&quot;</span><span class="p">)</span>
</span><span id="SLAF-335"><a href="#SLAF-335"><span class="linenos">335</span></a>                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]:</span>
</span><span id="SLAF-336"><a href="#SLAF-336"><span class="linenos">336</span></a>                            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">top</span><span class="p">:</span>
</span><span id="SLAF-337"><a href="#SLAF-337"><span class="linenos">337</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</span><span id="SLAF-338"><a href="#SLAF-338"><span class="linenos">338</span></a>                            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">:</span>
</span><span id="SLAF-339"><a href="#SLAF-339"><span class="linenos">339</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</span><span id="SLAF-340"><a href="#SLAF-340"><span class="linenos">340</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-341"><a href="#SLAF-341"><span class="linenos">341</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-342"><a href="#SLAF-342"><span class="linenos">342</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">possible expl. for fluent being unaffected:&quot;</span><span class="p">)</span>
</span><span id="SLAF-343"><a href="#SLAF-343"><span class="linenos">343</span></a>                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]:</span>
</span><span id="SLAF-344"><a href="#SLAF-344"><span class="linenos">344</span></a>                            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">top</span><span class="p">:</span>
</span><span id="SLAF-345"><a href="#SLAF-345"><span class="linenos">345</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</span><span id="SLAF-346"><a href="#SLAF-346"><span class="linenos">346</span></a>                            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">:</span>
</span><span id="SLAF-347"><a href="#SLAF-347"><span class="linenos">347</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</span><span id="SLAF-348"><a href="#SLAF-348"><span class="linenos">348</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-349"><a href="#SLAF-349"><span class="linenos">349</span></a>                                <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-350"><a href="#SLAF-350"><span class="linenos">350</span></a>                    <span class="nb">print</span><span class="p">()</span>
</span><span id="SLAF-351"><a href="#SLAF-351"><span class="linenos">351</span></a>
</span><span id="SLAF-352"><a href="#SLAF-352"><span class="linenos">352</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Steps 1. (a)-(c) and Step 2 of AS-STRIPS-SLAF are taken care of in this loop.&quot;&quot;&quot;</span>
</span><span id="SLAF-353"><a href="#SLAF-353"><span class="linenos">353</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">action</span>
</span><span id="SLAF-354"><a href="#SLAF-354"><span class="linenos">354</span></a>                <span class="c1"># ensures that the action is not None (happens on the last step of a trace)</span>
</span><span id="SLAF-355"><a href="#SLAF-355"><span class="linenos">355</span></a>                <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
</span><span id="SLAF-356"><a href="#SLAF-356"><span class="linenos">356</span></a>                    <span class="c1"># iterate through every fluent in the fluent-factored transition belief formula</span>
</span><span id="SLAF-357"><a href="#SLAF-357"><span class="linenos">357</span></a>                    <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">raw_fluent_factored</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="SLAF-358"><a href="#SLAF-358"><span class="linenos">358</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span>
</span><span id="SLAF-359"><a href="#SLAF-359"><span class="linenos">359</span></a>
</span><span id="SLAF-360"><a href="#SLAF-360"><span class="linenos">360</span></a>                        <span class="c1"># create action propositions</span>
</span><span id="SLAF-361"><a href="#SLAF-361"><span class="linenos">361</span></a>                        <span class="n">pos_precond</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> is a precondition of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SLAF-362"><a href="#SLAF-362"><span class="linenos">362</span></a>                        <span class="n">neg_precond</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(~</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> is a precondition of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SLAF-363"><a href="#SLAF-363"><span class="linenos">363</span></a>                        <span class="n">pos_effect</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> causes </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SLAF-364"><a href="#SLAF-364"><span class="linenos">364</span></a>                        <span class="n">neg_effect</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> causes ~</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SLAF-365"><a href="#SLAF-365"><span class="linenos">365</span></a>                        <span class="n">neutral</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> has no effect on </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="SLAF-366"><a href="#SLAF-366"><span class="linenos">366</span></a>
</span><span id="SLAF-367"><a href="#SLAF-367"><span class="linenos">367</span></a>                        <span class="n">all_var</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="SLAF-368"><a href="#SLAF-368"><span class="linenos">368</span></a>                            <span class="p">[</span><span class="n">pos_precond</span><span class="p">,</span> <span class="n">neg_precond</span><span class="p">,</span> <span class="n">pos_effect</span><span class="p">,</span> <span class="n">neg_effect</span><span class="p">,</span> <span class="n">neutral</span><span class="p">]</span>
</span><span id="SLAF-369"><a href="#SLAF-369"><span class="linenos">369</span></a>                        <span class="p">)</span>
</span><span id="SLAF-370"><a href="#SLAF-370"><span class="linenos">370</span></a>
</span><span id="SLAF-371"><a href="#SLAF-371"><span class="linenos">371</span></a>                        <span class="c1"># update the fluent-factored formula</span>
</span><span id="SLAF-372"><a href="#SLAF-372"><span class="linenos">372</span></a>                        <span class="n">all_phi_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]]</span>
</span><span id="SLAF-373"><a href="#SLAF-373"><span class="linenos">373</span></a>                        <span class="n">all_phi_neg</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]]</span>
</span><span id="SLAF-374"><a href="#SLAF-374"><span class="linenos">374</span></a>                        <span class="n">all_phi_neut</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]]</span>
</span><span id="SLAF-375"><a href="#SLAF-375"><span class="linenos">375</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-376"><a href="#SLAF-376"><span class="linenos">376</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-377"><a href="#SLAF-377"><span class="linenos">377</span></a>
</span><span id="SLAF-378"><a href="#SLAF-378"><span class="linenos">378</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;Steps 1 (a-c) - Update every fluent in the fluent-factored transition belief formula</span>
</span><span id="SLAF-379"><a href="#SLAF-379"><span class="linenos">379</span></a><span class="sd">                        with information from the last step.&quot;&quot;&quot;</span>
</span><span id="SLAF-380"><a href="#SLAF-380"><span class="linenos">380</span></a>
</span><span id="SLAF-381"><a href="#SLAF-381"><span class="linenos">381</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;Step 1 (a) - update the neutral effects.&quot;&quot;&quot;</span>
</span><span id="SLAF-382"><a href="#SLAF-382"><span class="linenos">382</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="SLAF-383"><a href="#SLAF-383"><span class="linenos">383</span></a>                            <span class="p">[(</span><span class="o">~</span><span class="n">pos_precond</span> <span class="o">|</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_phi_pos</span><span class="p">]</span>
</span><span id="SLAF-384"><a href="#SLAF-384"><span class="linenos">384</span></a>                        <span class="p">)</span>
</span><span id="SLAF-385"><a href="#SLAF-385"><span class="linenos">385</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="SLAF-386"><a href="#SLAF-386"><span class="linenos">386</span></a>                            <span class="p">[(</span><span class="o">~</span><span class="n">neg_precond</span> <span class="o">|</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_phi_neg</span><span class="p">]</span>
</span><span id="SLAF-387"><a href="#SLAF-387"><span class="linenos">387</span></a>                        <span class="p">)</span>
</span><span id="SLAF-388"><a href="#SLAF-388"><span class="linenos">388</span></a>
</span><span id="SLAF-389"><a href="#SLAF-389"><span class="linenos">389</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;Step 1 (b) - update the positive effects.&quot;&quot;&quot;</span>
</span><span id="SLAF-390"><a href="#SLAF-390"><span class="linenos">390</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos_effect</span> <span class="o">|</span> <span class="n">neutral</span><span class="p">)</span>
</span><span id="SLAF-391"><a href="#SLAF-391"><span class="linenos">391</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos_effect</span> <span class="o">|</span> <span class="o">~</span><span class="n">neg_precond</span><span class="p">)</span>
</span><span id="SLAF-392"><a href="#SLAF-392"><span class="linenos">392</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="SLAF-393"><a href="#SLAF-393"><span class="linenos">393</span></a>                            <span class="p">[(</span><span class="n">pos_effect</span> <span class="o">|</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_phi_pos</span><span class="p">]</span>
</span><span id="SLAF-394"><a href="#SLAF-394"><span class="linenos">394</span></a>                        <span class="p">)</span>
</span><span id="SLAF-395"><a href="#SLAF-395"><span class="linenos">395</span></a>
</span><span id="SLAF-396"><a href="#SLAF-396"><span class="linenos">396</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;Step 1 (c) - update the negative effects.&quot;&quot;&quot;</span>
</span><span id="SLAF-397"><a href="#SLAF-397"><span class="linenos">397</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">neg_effect</span> <span class="o">|</span> <span class="n">neutral</span><span class="p">)</span>
</span><span id="SLAF-398"><a href="#SLAF-398"><span class="linenos">398</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">neg_effect</span> <span class="o">|</span> <span class="o">~</span><span class="n">pos_precond</span><span class="p">)</span>
</span><span id="SLAF-399"><a href="#SLAF-399"><span class="linenos">399</span></a>                        <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="SLAF-400"><a href="#SLAF-400"><span class="linenos">400</span></a>                            <span class="p">[(</span><span class="n">neg_effect</span> <span class="o">|</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_phi_neg</span><span class="p">]</span>
</span><span id="SLAF-401"><a href="#SLAF-401"><span class="linenos">401</span></a>                        <span class="p">)</span>
</span><span id="SLAF-402"><a href="#SLAF-402"><span class="linenos">402</span></a>
</span><span id="SLAF-403"><a href="#SLAF-403"><span class="linenos">403</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;add validity constraints (from section 5.2 of the SLAF paper).&quot;&quot;&quot;</span>
</span><span id="SLAF-404"><a href="#SLAF-404"><span class="linenos">404</span></a>                        <span class="n">validity_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pos_effect</span> <span class="o">|</span> <span class="n">neg_effect</span> <span class="o">|</span> <span class="n">neutral</span><span class="p">)</span>
</span><span id="SLAF-405"><a href="#SLAF-405"><span class="linenos">405</span></a>                        <span class="n">validity_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="o">~</span><span class="n">pos_effect</span> <span class="o">|</span> <span class="o">~</span><span class="n">neg_effect</span><span class="p">))</span>
</span><span id="SLAF-406"><a href="#SLAF-406"><span class="linenos">406</span></a>                        <span class="n">validity_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">~</span><span class="n">neg_effect</span> <span class="o">|</span> <span class="o">~</span><span class="n">neutral</span><span class="p">)</span>
</span><span id="SLAF-407"><a href="#SLAF-407"><span class="linenos">407</span></a>                        <span class="n">validity_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">~</span><span class="n">pos_effect</span> <span class="o">|</span> <span class="o">~</span><span class="n">neutral</span><span class="p">)</span>
</span><span id="SLAF-408"><a href="#SLAF-408"><span class="linenos">408</span></a>                        <span class="n">validity_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">~</span><span class="n">pos_precond</span> <span class="o">|</span> <span class="o">~</span><span class="n">neg_precond</span><span class="p">)</span>
</span><span id="SLAF-409"><a href="#SLAF-409"><span class="linenos">409</span></a>
</span><span id="SLAF-410"><a href="#SLAF-410"><span class="linenos">410</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;Step 2 - eliminate subsumed clauses in phi.&quot;&quot;&quot;</span>
</span><span id="SLAF-411"><a href="#SLAF-411"><span class="linenos">411</span></a>                        <span class="n">SLAF</span><span class="o">.</span><span class="n">__remove_subsumed_clauses</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">])</span>
</span><span id="SLAF-412"><a href="#SLAF-412"><span class="linenos">412</span></a>                        <span class="n">SLAF</span><span class="o">.</span><span class="n">__remove_subsumed_clauses</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">])</span>
</span><span id="SLAF-413"><a href="#SLAF-413"><span class="linenos">413</span></a>                        <span class="n">SLAF</span><span class="o">.</span><span class="n">__remove_subsumed_clauses</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">])</span>
</span><span id="SLAF-414"><a href="#SLAF-414"><span class="linenos">414</span></a>                <span class="c1"># display current updates</span>
</span><span id="SLAF-415"><a href="#SLAF-415"><span class="linenos">415</span></a>                <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
</span><span id="SLAF-416"><a href="#SLAF-416"><span class="linenos">416</span></a>                    <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
</span><span id="SLAF-417"><a href="#SLAF-417"><span class="linenos">417</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Action taken: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SLAF-418"><a href="#SLAF-418"><span class="linenos">418</span></a>                        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">to_obs</span><span class="p">:</span>
</span><span id="SLAF-419"><a href="#SLAF-419"><span class="linenos">419</span></a>                            <span class="n">f_str</span> <span class="o">=</span> <span class="n">raw_fluent_factored</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</span><span id="SLAF-420"><a href="#SLAF-420"><span class="linenos">420</span></a>                            <span class="n">phi</span> <span class="o">=</span> <span class="n">raw_fluent_factored</span><span class="p">[</span><span class="n">f_str</span><span class="p">]</span>
</span><span id="SLAF-421"><a href="#SLAF-421"><span class="linenos">421</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">fluent: &quot;</span> <span class="o">+</span> <span class="n">f_str</span><span class="p">)</span>
</span><span id="SLAF-422"><a href="#SLAF-422"><span class="linenos">422</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="SLAF-423"><a href="#SLAF-423"><span class="linenos">423</span></a>                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">possible expl. for fluent being true after &quot;</span>
</span><span id="SLAF-424"><a href="#SLAF-424"><span class="linenos">424</span></a>                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="SLAF-425"><a href="#SLAF-425"><span class="linenos">425</span></a>                                <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
</span><span id="SLAF-426"><a href="#SLAF-426"><span class="linenos">426</span></a>                            <span class="p">)</span>
</span><span id="SLAF-427"><a href="#SLAF-427"><span class="linenos">427</span></a>                            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]:</span>
</span><span id="SLAF-428"><a href="#SLAF-428"><span class="linenos">428</span></a>                                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">top</span><span class="p">:</span>
</span><span id="SLAF-429"><a href="#SLAF-429"><span class="linenos">429</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</span><span id="SLAF-430"><a href="#SLAF-430"><span class="linenos">430</span></a>                                <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">:</span>
</span><span id="SLAF-431"><a href="#SLAF-431"><span class="linenos">431</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</span><span id="SLAF-432"><a href="#SLAF-432"><span class="linenos">432</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-433"><a href="#SLAF-433"><span class="linenos">433</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-434"><a href="#SLAF-434"><span class="linenos">434</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="SLAF-435"><a href="#SLAF-435"><span class="linenos">435</span></a>                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">possible expl. for fluent being false after &quot;</span>
</span><span id="SLAF-436"><a href="#SLAF-436"><span class="linenos">436</span></a>                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="SLAF-437"><a href="#SLAF-437"><span class="linenos">437</span></a>                                <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
</span><span id="SLAF-438"><a href="#SLAF-438"><span class="linenos">438</span></a>                            <span class="p">)</span>
</span><span id="SLAF-439"><a href="#SLAF-439"><span class="linenos">439</span></a>                            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]:</span>
</span><span id="SLAF-440"><a href="#SLAF-440"><span class="linenos">440</span></a>                                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">top</span><span class="p">:</span>
</span><span id="SLAF-441"><a href="#SLAF-441"><span class="linenos">441</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</span><span id="SLAF-442"><a href="#SLAF-442"><span class="linenos">442</span></a>                                <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">:</span>
</span><span id="SLAF-443"><a href="#SLAF-443"><span class="linenos">443</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</span><span id="SLAF-444"><a href="#SLAF-444"><span class="linenos">444</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-445"><a href="#SLAF-445"><span class="linenos">445</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-446"><a href="#SLAF-446"><span class="linenos">446</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="SLAF-447"><a href="#SLAF-447"><span class="linenos">447</span></a>                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">possible expl. for fluent being unaffected after &quot;</span>
</span><span id="SLAF-448"><a href="#SLAF-448"><span class="linenos">448</span></a>                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="SLAF-449"><a href="#SLAF-449"><span class="linenos">449</span></a>                                <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
</span><span id="SLAF-450"><a href="#SLAF-450"><span class="linenos">450</span></a>                            <span class="p">)</span>
</span><span id="SLAF-451"><a href="#SLAF-451"><span class="linenos">451</span></a>                            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]:</span>
</span><span id="SLAF-452"><a href="#SLAF-452"><span class="linenos">452</span></a>                                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">top</span><span class="p">:</span>
</span><span id="SLAF-453"><a href="#SLAF-453"><span class="linenos">453</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</span><span id="SLAF-454"><a href="#SLAF-454"><span class="linenos">454</span></a>                                <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">:</span>
</span><span id="SLAF-455"><a href="#SLAF-455"><span class="linenos">455</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</span><span id="SLAF-456"><a href="#SLAF-456"><span class="linenos">456</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-457"><a href="#SLAF-457"><span class="linenos">457</span></a>                                    <span class="n">e</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-458"><a href="#SLAF-458"><span class="linenos">458</span></a>                    <span class="nb">print</span><span class="p">()</span>
</span><span id="SLAF-459"><a href="#SLAF-459"><span class="linenos">459</span></a>                    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Hit enter to continue.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SLAF-460"><a href="#SLAF-460"><span class="linenos">460</span></a>
</span><span id="SLAF-461"><a href="#SLAF-461"><span class="linenos">461</span></a>        <span class="n">formula</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-462"><a href="#SLAF-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to formula once you have stepped through all observations and applied all transformations.</span>
</span><span id="SLAF-463"><a href="#SLAF-463"><span class="linenos">463</span></a><span class="sd">        NOTE: This would have to be refactored if the functionality for multiple traces was added, as each trace would</span>
</span><span id="SLAF-464"><a href="#SLAF-464"><span class="linenos">464</span></a><span class="sd">        have to store its own separate formulas, and the conjunction would be taken at the end.&quot;&quot;&quot;</span>
</span><span id="SLAF-465"><a href="#SLAF-465"><span class="linenos">465</span></a>        <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">raw_fluent_factored</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="SLAF-466"><a href="#SLAF-466"><span class="linenos">466</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;fluent&quot;</span><span class="p">]</span>
</span><span id="SLAF-467"><a href="#SLAF-467"><span class="linenos">467</span></a>            <span class="c1"># convert to formula for each fluent</span>
</span><span id="SLAF-468"><a href="#SLAF-468"><span class="linenos">468</span></a>            <span class="n">all_phi_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;pos expl&quot;</span><span class="p">]]</span>
</span><span id="SLAF-469"><a href="#SLAF-469"><span class="linenos">469</span></a>            <span class="n">all_phi_neg</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neg expl&quot;</span><span class="p">]]</span>
</span><span id="SLAF-470"><a href="#SLAF-470"><span class="linenos">470</span></a>            <span class="n">all_phi_neut</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">[</span><span class="s2">&quot;neutral&quot;</span><span class="p">]]</span>
</span><span id="SLAF-471"><a href="#SLAF-471"><span class="linenos">471</span></a>            <span class="n">formula</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="o">~</span><span class="n">f</span> <span class="o">|</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_phi_pos</span><span class="p">])</span>
</span><span id="SLAF-472"><a href="#SLAF-472"><span class="linenos">472</span></a>            <span class="n">formula</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">f</span> <span class="o">|</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_phi_neg</span><span class="p">])</span>
</span><span id="SLAF-473"><a href="#SLAF-473"><span class="linenos">473</span></a>            <span class="n">formula</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_phi_neut</span><span class="p">])</span>
</span><span id="SLAF-474"><a href="#SLAF-474"><span class="linenos">474</span></a>        <span class="c1"># add the validity constraints</span>
</span><span id="SLAF-475"><a href="#SLAF-475"><span class="linenos">475</span></a>        <span class="n">formula</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">validity_constraints</span><span class="p">)</span>
</span><span id="SLAF-476"><a href="#SLAF-476"><span class="linenos">476</span></a>        <span class="c1"># create CNF formula</span>
</span><span id="SLAF-477"><a href="#SLAF-477"><span class="linenos">477</span></a>        <span class="n">full_formula</span> <span class="o">=</span> <span class="n">And</span><span class="p">({</span><span class="o">*</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">]})</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</span><span id="SLAF-478"><a href="#SLAF-478"><span class="linenos">478</span></a>        <span class="n">cnf_formula</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">SLAF</span><span class="o">.</span><span class="n">__or_refactor</span><span class="p">,</span> <span class="n">full_formula</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
</span><span id="SLAF-479"><a href="#SLAF-479"><span class="linenos">479</span></a>
</span><span id="SLAF-480"><a href="#SLAF-480"><span class="linenos">480</span></a>        <span class="n">entailed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SLAF-481"><a href="#SLAF-481"><span class="linenos">481</span></a>        <span class="k">if</span> <span class="n">sample</span><span class="p">:</span>
</span><span id="SLAF-482"><a href="#SLAF-482"><span class="linenos">482</span></a>            <span class="k">with</span> <span class="n">config</span><span class="p">(</span><span class="n">sat_backend</span><span class="o">=</span><span class="s2">&quot;kissat&quot;</span><span class="p">):</span>
</span><span id="SLAF-483"><a href="#SLAF-483"><span class="linenos">483</span></a>                <span class="n">sol</span> <span class="o">=</span> <span class="n">cnf_formula</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</span><span id="SLAF-484"><a href="#SLAF-484"><span class="linenos">484</span></a>                <span class="k">if</span> <span class="n">sol</span><span class="p">:</span>
</span><span id="SLAF-485"><a href="#SLAF-485"><span class="linenos">485</span></a>                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_var</span><span class="p">:</span>
</span><span id="SLAF-486"><a href="#SLAF-486"><span class="linenos">486</span></a>                        <span class="k">if</span> <span class="n">sol</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)]:</span>
</span><span id="SLAF-487"><a href="#SLAF-487"><span class="linenos">487</span></a>                            <span class="n">entailed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-488"><a href="#SLAF-488"><span class="linenos">488</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SLAF-489"><a href="#SLAF-489"><span class="linenos">489</span></a>            <span class="n">children</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cnf_formula</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
</span><span id="SLAF-490"><a href="#SLAF-490"><span class="linenos">490</span></a>            <span class="c1"># iterate through all fluents, gathering those that are entailed</span>
</span><span id="SLAF-491"><a href="#SLAF-491"><span class="linenos">491</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_var</span><span class="p">:</span>
</span><span id="SLAF-492"><a href="#SLAF-492"><span class="linenos">492</span></a>                <span class="n">children</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Or</span><span class="p">([</span><span class="o">~</span><span class="n">f</span><span class="p">]))</span>
</span><span id="SLAF-493"><a href="#SLAF-493"><span class="linenos">493</span></a>                <span class="n">check_theory</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
</span><span id="SLAF-494"><a href="#SLAF-494"><span class="linenos">494</span></a>                <span class="c1"># if False, then f is entailed</span>
</span><span id="SLAF-495"><a href="#SLAF-495"><span class="linenos">495</span></a>                <span class="k">with</span> <span class="n">config</span><span class="p">(</span><span class="n">sat_backend</span><span class="o">=</span><span class="s2">&quot;kissat&quot;</span><span class="p">):</span>
</span><span id="SLAF-496"><a href="#SLAF-496"><span class="linenos">496</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_theory</span><span class="o">.</span><span class="n">solve</span><span class="p">():</span>
</span><span id="SLAF-497"><a href="#SLAF-497"><span class="linenos">497</span></a>                        <span class="n">entailed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SLAF-498"><a href="#SLAF-498"><span class="linenos">498</span></a>                <span class="n">children</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">Or</span><span class="p">([</span><span class="o">~</span><span class="n">f</span><span class="p">]))</span>
</span><span id="SLAF-499"><a href="#SLAF-499"><span class="linenos">499</span></a>        <span class="k">return</span> <span class="n">entailed</span>
</span></pre></div>


            <div class="docstring"><p>SLAF model extraction method.</p>

<p>Amir, E, and A Chang. 2008. Learning Partially Observable Deterministic Action Models.
Journal of Artificial Intelligence Research 33: 349402. <a href="https://doi.org/10.1613/jair.2575">https://doi.org/10.1613/jair.2575</a>.</p>

<p>Extracts a Model from state observations using the SLAF technique. The AS-STRIPS-SLAF
algorithm is used to extract the effects of actions given a trace/observation. The algorithm
is incapable of finding the preconditions of those actions, however.</p>

<p>Note that SLAF learns partially observable, deterministic action models, and thus takes
PartialObservation as the token type.</p>

<p>The AS-STRIPS-SLAF algorithm works by defining "action propositions" for each action that define
the possible preconditions, effects, or lack-thereof of that action and every possible fluent. A
propositional formula is updated as each step is iterated through, and kept in a "fluent-factored form"
that specifies the possible "explanations" behind each fluent being true, false, or unaffected. As actions
are taken and states observed, these reasonings are updated and simplified. (Note that the pieces of the formula
are stored carefully so as to easily conjoin them into one CNF formula later). Once all steps in the trace
have been iterated through, the CNF formula is created, and all possible fluents/action propositions are
iterated through to determine which ones are entailed. This information is then used to extract the Model.</p>
</div>


                            <div id="SLAF.__init__" class="classattr">
                                        <input id="SLAF.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SLAF</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">o_list</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">sample</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SLAF.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SLAF.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SLAF.__init__-47"><a href="#SLAF.__init__-47"><span class="linenos">47</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">o_list</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="SLAF.__init__-48"><a href="#SLAF.__init__-48"><span class="linenos">48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="SLAF.__init__-49"><a href="#SLAF.__init__-49"><span class="linenos">49</span></a>
</span><span id="SLAF.__init__-50"><a href="#SLAF.__init__-50"><span class="linenos">50</span></a><span class="sd">        Args:</span>
</span><span id="SLAF.__init__-51"><a href="#SLAF.__init__-51"><span class="linenos">51</span></a><span class="sd">            o_list (ObservationList):</span>
</span><span id="SLAF.__init__-52"><a href="#SLAF.__init__-52"><span class="linenos">52</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="SLAF.__init__-53"><a href="#SLAF.__init__-53"><span class="linenos">53</span></a><span class="sd">            debug_mode (bool):</span>
</span><span id="SLAF.__init__-54"><a href="#SLAF.__init__-54"><span class="linenos">54</span></a><span class="sd">                An optional mode that helps the user track any fluents they desire by examining the evolution</span>
</span><span id="SLAF.__init__-55"><a href="#SLAF.__init__-55"><span class="linenos">55</span></a><span class="sd">                of their fluent-factored formulas through the steps.</span>
</span><span id="SLAF.__init__-56"><a href="#SLAF.__init__-56"><span class="linenos">56</span></a><span class="sd">            sample (bool):</span>
</span><span id="SLAF.__init__-57"><a href="#SLAF.__init__-57"><span class="linenos">57</span></a><span class="sd">                An optional mode that allows the user to sample the possible models instead of returning</span>
</span><span id="SLAF.__init__-58"><a href="#SLAF.__init__-58"><span class="linenos">58</span></a><span class="sd">                one that includes only guaranteed entailed fluents.</span>
</span><span id="SLAF.__init__-59"><a href="#SLAF.__init__-59"><span class="linenos">59</span></a><span class="sd">        Raises:</span>
</span><span id="SLAF.__init__-60"><a href="#SLAF.__init__-60"><span class="linenos">60</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="SLAF.__init__-61"><a href="#SLAF.__init__-61"><span class="linenos">61</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="SLAF.__init__-62"><a href="#SLAF.__init__-62"><span class="linenos">62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SLAF.__init__-63"><a href="#SLAF.__init__-63"><span class="linenos">63</span></a>        <span class="k">if</span> <span class="n">o_list</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">AtomicPartialObservation</span><span class="p">:</span>
</span><span id="SLAF.__init__-64"><a href="#SLAF.__init__-64"><span class="linenos">64</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">o_list</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">SLAF</span><span class="p">)</span>
</span><span id="SLAF.__init__-65"><a href="#SLAF.__init__-65"><span class="linenos">65</span></a>
</span><span id="SLAF.__init__-66"><a href="#SLAF.__init__-66"><span class="linenos">66</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">o_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SLAF.__init__-67"><a href="#SLAF.__init__-67"><span class="linenos">67</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The SLAF extraction technique only takes one trace.&quot;</span><span class="p">)</span>
</span><span id="SLAF.__init__-68"><a href="#SLAF.__init__-68"><span class="linenos">68</span></a>
</span><span id="SLAF.__init__-69"><a href="#SLAF.__init__-69"><span class="linenos">69</span></a>        <span class="n">SLAF</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="SLAF.__init__-70"><a href="#SLAF.__init__-70"><span class="linenos">70</span></a>        <span class="n">entailed</span> <span class="o">=</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">__as_strips_slaf</span><span class="p">(</span><span class="n">o_list</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</span><span id="SLAF.__init__-71"><a href="#SLAF.__init__-71"><span class="linenos">71</span></a>        <span class="c1"># return the Model</span>
</span><span id="SLAF.__init__-72"><a href="#SLAF.__init__-72"><span class="linenos">72</span></a>        <span class="k">return</span> <span class="n">SLAF</span><span class="o">.</span><span class="n">__sort_results</span><span class="p">(</span><span class="n">o_list</span><span class="p">,</span> <span class="n">entailed</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a new Model object.</p>

<p>Args:
    o_list (ObservationList):
        The state observations to extract the model from.
    debug_mode (bool):
        An optional mode that helps the user track any fluents they desire by examining the evolution
        of their fluent-factored formulas through the steps.
    sample (bool):
        An optional mode that allows the user to sample the possible models instead of returning
        one that includes only guaranteed entailed fluents.
Raises:
    IncompatibleObservationToken:
        Raised if the observations are not identity observation.</p>
</div>


                            </div>
                            <div id="SLAF.top" class="classattr">
                                <div class="attr variable">
            <span class="name">top</span>        =
<span class="default_value">true</span>

        
    </div>
    <a class="headerlink" href="#SLAF.top"></a>
    
    

                            </div>
                            <div id="SLAF.bottom" class="classattr">
                                <div class="attr variable">
            <span class="name">bottom</span>        =
<span class="default_value">false</span>

        
    </div>
    <a class="headerlink" href="#SLAF.bottom"></a>
    
    

                            </div>
                </section>
                <section id="Observer">
                            <input id="Observer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Observer</span>:

                <label class="view-source-button" for="Observer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Observer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Observer-22"><a href="#Observer-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">Observer</span><span class="p">:</span>
</span><span id="Observer-23"><a href="#Observer-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Observer model extraction method.</span>
</span><span id="Observer-24"><a href="#Observer-24"><span class="linenos"> 24</span></a>
</span><span id="Observer-25"><a href="#Observer-25"><span class="linenos"> 25</span></a><span class="sd">    Extracts a Model from state observations using the observer technique.  All</span>
</span><span id="Observer-26"><a href="#Observer-26"><span class="linenos"> 26</span></a><span class="sd">    the fluents present in the observations are saved as is. The actions have</span>
</span><span id="Observer-27"><a href="#Observer-27"><span class="linenos"> 27</span></a><span class="sd">    their preconditions, add effects, and delete effects found and added to the</span>
</span><span id="Observer-28"><a href="#Observer-28"><span class="linenos"> 28</span></a><span class="sd">    object.</span>
</span><span id="Observer-29"><a href="#Observer-29"><span class="linenos"> 29</span></a>
</span><span id="Observer-30"><a href="#Observer-30"><span class="linenos"> 30</span></a><span class="sd">    The preconditions of an action are defined as the (positive) intersection</span>
</span><span id="Observer-31"><a href="#Observer-31"><span class="linenos"> 31</span></a><span class="sd">    of all pre-states to that action. The effects are the union off all fluents</span>
</span><span id="Observer-32"><a href="#Observer-32"><span class="linenos"> 32</span></a><span class="sd">    that changed state from a pre-state to a post-state of an action. Add this</span>
</span><span id="Observer-33"><a href="#Observer-33"><span class="linenos"> 33</span></a><span class="sd">    effects are fluents that went from False to True, delete effects are</span>
</span><span id="Observer-34"><a href="#Observer-34"><span class="linenos"> 34</span></a><span class="sd">    fluents that went from True to False.</span>
</span><span id="Observer-35"><a href="#Observer-35"><span class="linenos"> 35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Observer-36"><a href="#Observer-36"><span class="linenos"> 36</span></a>
</span><span id="Observer-37"><a href="#Observer-37"><span class="linenos"> 37</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Observer-38"><a href="#Observer-38"><span class="linenos"> 38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="Observer-39"><a href="#Observer-39"><span class="linenos"> 39</span></a>
</span><span id="Observer-40"><a href="#Observer-40"><span class="linenos"> 40</span></a><span class="sd">        Args:</span>
</span><span id="Observer-41"><a href="#Observer-41"><span class="linenos"> 41</span></a><span class="sd">            observations (ObservationList):</span>
</span><span id="Observer-42"><a href="#Observer-42"><span class="linenos"> 42</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="Observer-43"><a href="#Observer-43"><span class="linenos"> 43</span></a><span class="sd">        Raises:</span>
</span><span id="Observer-44"><a href="#Observer-44"><span class="linenos"> 44</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="Observer-45"><a href="#Observer-45"><span class="linenos"> 45</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="Observer-46"><a href="#Observer-46"><span class="linenos"> 46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Observer-47"><a href="#Observer-47"><span class="linenos"> 47</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">IdentityObservation</span><span class="p">:</span>
</span><span id="Observer-48"><a href="#Observer-48"><span class="linenos"> 48</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">Observer</span><span class="p">)</span>
</span><span id="Observer-49"><a href="#Observer-49"><span class="linenos"> 49</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">.</span><span class="n">_get_fluents</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="Observer-50"><a href="#Observer-50"><span class="linenos"> 50</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">.</span><span class="n">_get_actions</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="Observer-51"><a href="#Observer-51"><span class="linenos"> 51</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span><span id="Observer-52"><a href="#Observer-52"><span class="linenos"> 52</span></a>
</span><span id="Observer-53"><a href="#Observer-53"><span class="linenos"> 53</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Observer-54"><a href="#Observer-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="nf">_get_fluents</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="Observer-55"><a href="#Observer-55"><span class="linenos"> 55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the set of fluents in the observations.&quot;&quot;&quot;</span>
</span><span id="Observer-56"><a href="#Observer-56"><span class="linenos"> 56</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Observer-57"><a href="#Observer-57"><span class="linenos"> 57</span></a>        <span class="n">obs_trace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">IdentityObservation</span><span class="p">]</span>
</span><span id="Observer-58"><a href="#Observer-58"><span class="linenos"> 58</span></a>        <span class="k">for</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="p">:</span>
</span><span id="Observer-59"><a href="#Observer-59"><span class="linenos"> 59</span></a>            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obs_trace</span><span class="p">:</span>
</span><span id="Observer-60"><a href="#Observer-60"><span class="linenos"> 60</span></a>                <span class="c1"># Update fluents with the fluents in this observation</span>
</span><span id="Observer-61"><a href="#Observer-61"><span class="linenos"> 61</span></a>                <span class="n">fluents</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="Observer-62"><a href="#Observer-62"><span class="linenos"> 62</span></a>                    <span class="n">LearnedFluent</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">details</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">objects</span><span class="p">])</span>
</span><span id="Observer-63"><a href="#Observer-63"><span class="linenos"> 63</span></a>                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">obs</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Observer-64"><a href="#Observer-64"><span class="linenos"> 64</span></a>                <span class="p">)</span>
</span><span id="Observer-65"><a href="#Observer-65"><span class="linenos"> 65</span></a>        <span class="k">return</span> <span class="n">fluents</span>
</span><span id="Observer-66"><a href="#Observer-66"><span class="linenos"> 66</span></a>
</span><span id="Observer-67"><a href="#Observer-67"><span class="linenos"> 67</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Observer-68"><a href="#Observer-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">_get_actions</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">):</span>
</span><span id="Observer-69"><a href="#Observer-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves and augments the set of actions in the observations.&quot;&quot;&quot;</span>
</span><span id="Observer-70"><a href="#Observer-70"><span class="linenos"> 70</span></a>        <span class="c1"># Get the unique actions and the relevant traces</span>
</span><span id="Observer-71"><a href="#Observer-71"><span class="linenos"> 71</span></a>        <span class="n">action_obs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="Observer-72"><a href="#Observer-72"><span class="linenos"> 72</span></a>        <span class="n">obs_trace</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">IdentityObservation</span><span class="p">]</span>
</span><span id="Observer-73"><a href="#Observer-73"><span class="linenos"> 73</span></a>        <span class="k">for</span> <span class="n">obs_trace</span> <span class="ow">in</span> <span class="n">obs_tracelist</span><span class="p">:</span>
</span><span id="Observer-74"><a href="#Observer-74"><span class="linenos"> 74</span></a>            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obs_trace</span><span class="p">:</span>
</span><span id="Observer-75"><a href="#Observer-75"><span class="linenos"> 75</span></a>                <span class="n">action</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">action</span>
</span><span id="Observer-76"><a href="#Observer-76"><span class="linenos"> 76</span></a>                <span class="k">if</span> <span class="n">action</span><span class="p">:</span>  <span class="c1"># Final step has no action</span>
</span><span id="Observer-77"><a href="#Observer-77"><span class="linenos"> 77</span></a>                    <span class="n">action_obs</span><span class="p">[</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs_trace</span><span class="p">)</span>
</span><span id="Observer-78"><a href="#Observer-78"><span class="linenos"> 78</span></a>
</span><span id="Observer-79"><a href="#Observer-79"><span class="linenos"> 79</span></a>        <span class="n">action_pre_states</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
</span><span id="Observer-80"><a href="#Observer-80"><span class="linenos"> 80</span></a>        <span class="c1"># Get transitions for each action</span>
</span><span id="Observer-81"><a href="#Observer-81"><span class="linenos"> 81</span></a>        <span class="n">action_transitions</span> <span class="o">=</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">get_all_transitions</span><span class="p">()</span>
</span><span id="Observer-82"><a href="#Observer-82"><span class="linenos"> 82</span></a>        <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">transitions</span> <span class="ow">in</span> <span class="n">action_transitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Observer-83"><a href="#Observer-83"><span class="linenos"> 83</span></a>            <span class="c1"># Create a LearnedAction for the current action</span>
</span><span id="Observer-84"><a href="#Observer-84"><span class="linenos"> 84</span></a>            <span class="n">model_action</span> <span class="o">=</span> <span class="n">LearnedAction</span><span class="p">(</span>
</span><span id="Observer-85"><a href="#Observer-85"><span class="linenos"> 85</span></a>                <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">obj_params</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">action</span><span class="o">.</span><span class="n">cost</span>
</span><span id="Observer-86"><a href="#Observer-86"><span class="linenos"> 86</span></a>            <span class="p">)</span>
</span><span id="Observer-87"><a href="#Observer-87"><span class="linenos"> 87</span></a>
</span><span id="Observer-88"><a href="#Observer-88"><span class="linenos"> 88</span></a>            <span class="k">for</span> <span class="n">pre</span><span class="p">,</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">transitions</span><span class="p">:</span>
</span><span id="Observer-89"><a href="#Observer-89"><span class="linenos"> 89</span></a>                <span class="c1"># Add all action pre-states to a set</span>
</span><span id="Observer-90"><a href="#Observer-90"><span class="linenos"> 90</span></a>                <span class="n">action_pre_states</span><span class="p">[</span><span class="n">model_action</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pre</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="Observer-91"><a href="#Observer-91"><span class="linenos"> 91</span></a>                <span class="c1"># Update the action&#39;s effects</span>
</span><span id="Observer-92"><a href="#Observer-92"><span class="linenos"> 92</span></a>                <span class="n">delta</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">.</span><span class="n">get_delta</span><span class="p">(</span><span class="n">pre</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="Observer-93"><a href="#Observer-93"><span class="linenos"> 93</span></a>                <span class="n">model_action</span><span class="o">.</span><span class="n">update_add</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">delta</span><span class="o">.</span><span class="n">added</span><span class="p">})</span>
</span><span id="Observer-94"><a href="#Observer-94"><span class="linenos"> 94</span></a>                <span class="n">model_action</span><span class="o">.</span><span class="n">update_delete</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">delta</span><span class="o">.</span><span class="n">deleted</span><span class="p">})</span>
</span><span id="Observer-95"><a href="#Observer-95"><span class="linenos"> 95</span></a>
</span><span id="Observer-96"><a href="#Observer-96"><span class="linenos"> 96</span></a>        <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">pre_states</span> <span class="ow">in</span> <span class="n">action_pre_states</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Observer-97"><a href="#Observer-97"><span class="linenos"> 97</span></a>            <span class="c1"># Find the (positive) intersection of the pre-states</span>
</span><span id="Observer-98"><a href="#Observer-98"><span class="linenos"> 98</span></a>            <span class="n">precond</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">Observer</span><span class="o">.</span><span class="n">_filter_positive</span><span class="p">,</span> <span class="n">pre_states</span><span class="p">))</span>
</span><span id="Observer-99"><a href="#Observer-99"><span class="linenos"> 99</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">update_precond</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">precond</span><span class="p">})</span>
</span><span id="Observer-100"><a href="#Observer-100"><span class="linenos">100</span></a>
</span><span id="Observer-101"><a href="#Observer-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">action_pre_states</span><span class="p">}</span>
</span><span id="Observer-102"><a href="#Observer-102"><span class="linenos">102</span></a>
</span><span id="Observer-103"><a href="#Observer-103"><span class="linenos">103</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Observer-104"><a href="#Observer-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">get_delta</span><span class="p">(</span><span class="n">pre</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">post</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Observer-105"><a href="#Observer-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines the delta-state between pre and post.</span>
</span><span id="Observer-106"><a href="#Observer-106"><span class="linenos">106</span></a>
</span><span id="Observer-107"><a href="#Observer-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="Observer-108"><a href="#Observer-108"><span class="linenos">108</span></a><span class="sd">            pre (dict):</span>
</span><span id="Observer-109"><a href="#Observer-109"><span class="linenos">109</span></a><span class="sd">                The pre-state to compare.</span>
</span><span id="Observer-110"><a href="#Observer-110"><span class="linenos">110</span></a><span class="sd">            post (dict):</span>
</span><span id="Observer-111"><a href="#Observer-111"><span class="linenos">111</span></a><span class="sd">                The post-state to compare.</span>
</span><span id="Observer-112"><a href="#Observer-112"><span class="linenos">112</span></a>
</span><span id="Observer-113"><a href="#Observer-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="Observer-114"><a href="#Observer-114"><span class="linenos">114</span></a><span class="sd">            A `DeltaState` object, containing two sets: `added` and `deleted`.</span>
</span><span id="Observer-115"><a href="#Observer-115"><span class="linenos">115</span></a><span class="sd">            The added set contains the list of fluents that were False in this</span>
</span><span id="Observer-116"><a href="#Observer-116"><span class="linenos">116</span></a><span class="sd">            state and True in `other`. The deleted set contains the list of</span>
</span><span id="Observer-117"><a href="#Observer-117"><span class="linenos">117</span></a><span class="sd">            fluents that were True in this state and False in `other`.</span>
</span><span id="Observer-118"><a href="#Observer-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Observer-119"><a href="#Observer-119"><span class="linenos">119</span></a>        <span class="n">added</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Observer-120"><a href="#Observer-120"><span class="linenos">120</span></a>        <span class="n">deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Observer-121"><a href="#Observer-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">pre</span><span class="p">:</span>
</span><span id="Observer-122"><a href="#Observer-122"><span class="linenos">122</span></a>            <span class="k">if</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">post</span><span class="p">[</span><span class="n">f</span><span class="p">]:</span>  <span class="c1"># true pre, false post -&gt; deleted</span>
</span><span id="Observer-123"><a href="#Observer-123"><span class="linenos">123</span></a>                <span class="n">deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Observer-124"><a href="#Observer-124"><span class="linenos">124</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">and</span> <span class="n">post</span><span class="p">[</span><span class="n">f</span><span class="p">]:</span>  <span class="c1"># false pre, true post -&gt; added</span>
</span><span id="Observer-125"><a href="#Observer-125"><span class="linenos">125</span></a>                <span class="n">added</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Observer-126"><a href="#Observer-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">DeltaObservation</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">deleted</span><span class="p">)</span>
</span><span id="Observer-127"><a href="#Observer-127"><span class="linenos">127</span></a>
</span><span id="Observer-128"><a href="#Observer-128"><span class="linenos">128</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Observer-129"><a href="#Observer-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">_filter_positive</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
</span><span id="Observer-130"><a href="#Observer-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the set of true fluents in a state.&quot;&quot;&quot;</span>
</span><span id="Observer-131"><a href="#Observer-131"><span class="linenos">131</span></a>        <span class="n">true_fluents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Observer-132"><a href="#Observer-132"><span class="linenos">132</span></a>        <span class="k">for</span> <span class="n">fluent</span><span class="p">,</span> <span class="n">is_true</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Observer-133"><a href="#Observer-133"><span class="linenos">133</span></a>            <span class="k">if</span> <span class="n">is_true</span><span class="p">:</span>
</span><span id="Observer-134"><a href="#Observer-134"><span class="linenos">134</span></a>                <span class="n">true_fluents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fluent</span><span class="p">)</span>
</span><span id="Observer-135"><a href="#Observer-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="n">true_fluents</span>
</span></pre></div>


            <div class="docstring"><p>Observer model extraction method.</p>

<p>Extracts a Model from state observations using the observer technique.  All
the fluents present in the observations are saved as is. The actions have
their preconditions, add effects, and delete effects found and added to the
object.</p>

<p>The preconditions of an action are defined as the (positive) intersection
of all pre-states to that action. The effects are the union off all fluents
that changed state from a pre-state to a post-state of an action. Add this
effects are fluents that went from False to True, delete effects are
fluents that went from True to False.</p>
</div>


                            <div id="Observer.__init__" class="classattr">
                                        <input id="Observer.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Observer</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">macq</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">observed_tracelist</span><span class="o">.</span><span class="n">ObservedTraceList</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="Observer.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Observer.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Observer.__init__-37"><a href="#Observer.__init__-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obs_tracelist</span><span class="p">:</span> <span class="n">ObservedTraceList</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Observer.__init__-38"><a href="#Observer.__init__-38"><span class="linenos">38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new Model object.</span>
</span><span id="Observer.__init__-39"><a href="#Observer.__init__-39"><span class="linenos">39</span></a>
</span><span id="Observer.__init__-40"><a href="#Observer.__init__-40"><span class="linenos">40</span></a><span class="sd">        Args:</span>
</span><span id="Observer.__init__-41"><a href="#Observer.__init__-41"><span class="linenos">41</span></a><span class="sd">            observations (ObservationList):</span>
</span><span id="Observer.__init__-42"><a href="#Observer.__init__-42"><span class="linenos">42</span></a><span class="sd">                The state observations to extract the model from.</span>
</span><span id="Observer.__init__-43"><a href="#Observer.__init__-43"><span class="linenos">43</span></a><span class="sd">        Raises:</span>
</span><span id="Observer.__init__-44"><a href="#Observer.__init__-44"><span class="linenos">44</span></a><span class="sd">            IncompatibleObservationToken:</span>
</span><span id="Observer.__init__-45"><a href="#Observer.__init__-45"><span class="linenos">45</span></a><span class="sd">                Raised if the observations are not identity observation.</span>
</span><span id="Observer.__init__-46"><a href="#Observer.__init__-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Observer.__init__-47"><a href="#Observer.__init__-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">IdentityObservation</span><span class="p">:</span>
</span><span id="Observer.__init__-48"><a href="#Observer.__init__-48"><span class="linenos">48</span></a>            <span class="k">raise</span> <span class="n">IncompatibleObservationToken</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">Observer</span><span class="p">)</span>
</span><span id="Observer.__init__-49"><a href="#Observer.__init__-49"><span class="linenos">49</span></a>        <span class="n">fluents</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">.</span><span class="n">_get_fluents</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="Observer.__init__-50"><a href="#Observer.__init__-50"><span class="linenos">50</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">.</span><span class="n">_get_actions</span><span class="p">(</span><span class="n">obs_tracelist</span><span class="p">)</span>
</span><span id="Observer.__init__-51"><a href="#Observer.__init__-51"><span class="linenos">51</span></a>        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">fluents</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a new Model object.</p>

<p>Args:
    observations (ObservationList):
        The state observations to extract the model from.
Raises:
    IncompatibleObservationToken:
        Raised if the observations are not identity observation.</p>
</div>


                            </div>
                            <div id="Observer.get_delta" class="classattr">
                                        <input id="Observer.get_delta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_delta</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pre</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">post</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Observer.get_delta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Observer.get_delta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Observer.get_delta-103"><a href="#Observer.get_delta-103"><span class="linenos">103</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Observer.get_delta-104"><a href="#Observer.get_delta-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">get_delta</span><span class="p">(</span><span class="n">pre</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">post</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Observer.get_delta-105"><a href="#Observer.get_delta-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines the delta-state between pre and post.</span>
</span><span id="Observer.get_delta-106"><a href="#Observer.get_delta-106"><span class="linenos">106</span></a>
</span><span id="Observer.get_delta-107"><a href="#Observer.get_delta-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="Observer.get_delta-108"><a href="#Observer.get_delta-108"><span class="linenos">108</span></a><span class="sd">            pre (dict):</span>
</span><span id="Observer.get_delta-109"><a href="#Observer.get_delta-109"><span class="linenos">109</span></a><span class="sd">                The pre-state to compare.</span>
</span><span id="Observer.get_delta-110"><a href="#Observer.get_delta-110"><span class="linenos">110</span></a><span class="sd">            post (dict):</span>
</span><span id="Observer.get_delta-111"><a href="#Observer.get_delta-111"><span class="linenos">111</span></a><span class="sd">                The post-state to compare.</span>
</span><span id="Observer.get_delta-112"><a href="#Observer.get_delta-112"><span class="linenos">112</span></a>
</span><span id="Observer.get_delta-113"><a href="#Observer.get_delta-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="Observer.get_delta-114"><a href="#Observer.get_delta-114"><span class="linenos">114</span></a><span class="sd">            A `DeltaState` object, containing two sets: `added` and `deleted`.</span>
</span><span id="Observer.get_delta-115"><a href="#Observer.get_delta-115"><span class="linenos">115</span></a><span class="sd">            The added set contains the list of fluents that were False in this</span>
</span><span id="Observer.get_delta-116"><a href="#Observer.get_delta-116"><span class="linenos">116</span></a><span class="sd">            state and True in `other`. The deleted set contains the list of</span>
</span><span id="Observer.get_delta-117"><a href="#Observer.get_delta-117"><span class="linenos">117</span></a><span class="sd">            fluents that were True in this state and False in `other`.</span>
</span><span id="Observer.get_delta-118"><a href="#Observer.get_delta-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Observer.get_delta-119"><a href="#Observer.get_delta-119"><span class="linenos">119</span></a>        <span class="n">added</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Observer.get_delta-120"><a href="#Observer.get_delta-120"><span class="linenos">120</span></a>        <span class="n">deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Observer.get_delta-121"><a href="#Observer.get_delta-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">pre</span><span class="p">:</span>
</span><span id="Observer.get_delta-122"><a href="#Observer.get_delta-122"><span class="linenos">122</span></a>            <span class="k">if</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">post</span><span class="p">[</span><span class="n">f</span><span class="p">]:</span>  <span class="c1"># true pre, false post -&gt; deleted</span>
</span><span id="Observer.get_delta-123"><a href="#Observer.get_delta-123"><span class="linenos">123</span></a>                <span class="n">deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Observer.get_delta-124"><a href="#Observer.get_delta-124"><span class="linenos">124</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">and</span> <span class="n">post</span><span class="p">[</span><span class="n">f</span><span class="p">]:</span>  <span class="c1"># false pre, true post -&gt; added</span>
</span><span id="Observer.get_delta-125"><a href="#Observer.get_delta-125"><span class="linenos">125</span></a>                <span class="n">added</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Observer.get_delta-126"><a href="#Observer.get_delta-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">DeltaObservation</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">deleted</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Determines the delta-state between pre and post.</p>

<p>Args:
    pre (dict):
        The pre-state to compare.
    post (dict):
        The post-state to compare.</p>

<p>Returns:
    A <code>DeltaState</code> object, containing two sets: <code>added</code> and <code>deleted</code>.
    The added set contains the list of fluents that were False in this
    state and True in <code>other</code>. The deleted set contains the list of
    fluents that were True in this state and False in <code>other</code>.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>